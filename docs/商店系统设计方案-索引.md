# BlazorIdle 商店系统设计方案 - 索引文档

**项目**: BlazorIdle  
**文档版本**: 1.0  
**创建日期**: 2025-10-12  
**状态**: 设计完成  
**作者**: 系统架构设计团队  

---

## 📋 文档概述

本索引文档为 BlazorIdle 商店系统设计方案的导航页面，帮助您快速找到所需的设计文档。

商店系统设计方案共分为三个部分，采用与装备系统相同的文档结构（上、中、下三篇），确保设计的完整性和可操作性。

---

## 📚 文档结构

### [商店系统设计方案（上篇）](./商店系统设计方案（上）.md)
**系统分析与架构设计**

#### 主要内容
1. **愿景与设计目标**
   - 核心设计目标（8项）
   - 设计原则（7项）

2. **需求分析**
   - 核心需求汇总（基础交易、货币系统、条件解锁、限购刷新）
   - 现有系统集成分析（经济系统、装备系统）

3. **系统架构设计**
   - 整体架构（四层架构图）
   - 核心模块划分（6个核心模块 + 4个辅助模块）

4. **商店类型系统**
   - 6种商店类型（常规、声望、限时、特殊兑换、黑市、季节）
   - 商店特性对比表

5. **商品定义系统**
   - 7种商品类型
   - 定价策略公式

6. **货币与交易系统**
   - 9种货币类型
   - 以物易物机制

7. **条件解锁系统**
   - 条件表达式DSL语法
   - 条件评估接口设计

8. **刷新与库存机制**
   - 5种刷新类型
   - 随机商品池设计
   - 购买限制配置

9. **领域模型详细设计**
   - ShopDefinition（商店定义）
   - ShopItemDefinition（商品定义）
   - ShopInstance（商店实例）
   - PurchaseRecord（购买记录）
   - CurrencyBalance（货币余额）
   - PurchaseCounter（购买计数器）

#### 阅读对象
- 系统架构师
- 技术负责人
- 高级开发人员

#### 预计阅读时间
30-45分钟

---

### [商店系统设计方案（中篇）](./商店系统设计方案（中）.md)
**实施计划与技术规范**

#### 主要内容
1. **整体实施计划概览**
   - Phase 1-6 划分（共14周）
   - 6个关键里程碑

2. **Phase 1: 基础模型与数据库**（第1-2周）
   - 枚举类型定义
   - 领域模型创建
   - 数据库表设计（6张核心表）
   - Entity Framework配置

3. **Phase 2: 货币系统与条件引擎**（第3-4周）
   - 货币管理服务（ICurrencyService）
   - 条件解锁引擎（IConditionEvaluator）
   - 声望系统设计

4. **Phase 3: 核心商店服务**（第5-7周）
   - 商店服务（IShopService）
   - 配置加载器
   - 种子数据设计

5. **Phase 4: 购买流程实现**（第8-10周）
   - 购买服务（IPurchaseService）
   - 价格计算器（IPriceCalculator）
   - 完整事务管理

6. **Phase 5: 刷新机制与前端**（第11-12周）
   - 刷新服务（IRefreshService）
   - 定时刷新后台服务
   - 随机商品抽取算法

7. **Phase 6: 测试优化与上线**（第13-14周）
   - 参见下篇

8. **数据库设计补充说明**
   - JSON字段说明
   - 索引策略

9. **集成现有系统**
   - 与经济系统集成
   - 与装备系统集成
   - 与条件系统集成

#### 阅读对象
- 开发工程师
- 数据库管理员
- 测试工程师

#### 预计阅读时间
60-90分钟

---

### [商店系统设计方案（下篇）](./商店系统设计方案（下）.md)
**测试验证与扩展设计**

#### 主要内容
1. **测试策略**
   - 5层测试体系（单元/集成/API/前端/E2E）
   - 目标覆盖率要求
   - 详细测试用例示例

2. **单元测试**
   - CurrencyServiceTests（货币服务测试）
   - ConditionEvaluatorTests（条件评估器测试）
   - PriceCalculatorTests（价格计算器测试）

3. **集成测试**
   - PurchaseIntegrationTests（购买流程测试）
   - 完整购买流程验证
   - 边界条件测试

4. **API测试**
   - ShopControllerTests
   - 端到端API测试

5. **前端UI设计**
   - 页面结构设计
   - 8个关键组件设计
   - Blazor组件完整代码
   - CSS样式示例

6. **性能优化**
   - 缓存策略（商店数据缓存、条件评估缓存）
   - 批量操作优化
   - 数据库查询优化

7. **扩展性设计**
   - 拍卖行系统预留接口
   - 玩家交易系统预留接口
   - 限时活动商店扩展

8. **风险评估与应对**
   - 技术风险（5项）
   - 业务风险（4项）
   - 应对策略

9. **交付清单**
   - 代码交付物（50+文件）
   - 文档交付物（7份文档）
   - 配置交付物（4份配置）

10. **后续优化方向**
    - 短期优化（3个月）
    - 中期优化（6个月）
    - 长期优化（1年）

#### 阅读对象
- 测试工程师
- 前端开发工程师
- 产品经理
- 运维工程师

#### 预计阅读时间
60-90分钟

---

## 🎯 快速导航

### 按角色查阅

#### 产品经理/项目经理
1. 先读 **上篇** 第1-2节（愿景与需求分析）
2. 再读 **中篇** 第1节（实施计划概览）
3. 最后读 **下篇** 第6节（交付清单）

#### 系统架构师
1. 完整阅读 **上篇**（系统分析与架构设计）
2. 重点阅读 **中篇** 第9节（集成现有系统）
3. 重点阅读 **下篇** 第7节（扩展性设计）

#### 开发工程师
1. 浏览 **上篇** 第9节（领域模型设计）
2. 详细阅读 **中篇**（实施计划与技术规范）
3. 参考 **下篇** 第2-3节（单元测试和集成测试）

#### 前端工程师
1. 浏览 **上篇** 第3-5节（了解系统架构和商店类型）
2. 重点阅读 **下篇** 第5节（前端UI设计）
3. 参考 **下篇** 第4节（前端测试）

#### 测试工程师
1. 浏览 **上篇** 第2节（需求分析）
2. 详细阅读 **下篇** 第1-4节（测试策略和测试用例）
3. 参考 **中篇**（了解实施细节以便制定测试计划）

### 按功能查阅

#### 商店类型设计
- **上篇** 第4节 - 商店类型系统

#### 商品配置
- **上篇** 第5节 - 商品定义系统
- **中篇** 第3.2节 - 配置加载器

#### 货币系统
- **上篇** 第6节 - 货币与交易系统
- **中篇** 第2.1节 - 货币管理服务

#### 条件解锁
- **上篇** 第7节 - 条件解锁系统
- **中篇** 第2.2节 - 条件解锁引擎

#### 购买流程
- **中篇** 第4节 - 购买流程实现
- **下篇** 第3节 - 购买流程集成测试

#### 刷新机制
- **上篇** 第8节 - 刷新与库存机制
- **中篇** 第5节 - 刷新机制实现

#### 前端UI
- **下篇** 第5节 - 前端UI设计

#### 数据库设计
- **中篇** 第1.3节 - 数据库表设计
- **中篇** 第8节 - 数据库设计补充说明

---

## 📊 设计统计

### 系统规模

| 类别 | 数量 |
|------|------|
| **核心模块** | 6个 |
| **辅助模块** | 4个 |
| **领域模型** | 11个类 |
| **枚举类型** | 5个 |
| **服务接口** | 7个 |
| **数据库表** | 6张 |
| **前端组件** | 8个 |
| **实施阶段** | 6个Phase |
| **总周期** | 14周 |

### 技术特性

| 特性 | 说明 |
|------|------|
| **商店类型** | 6种（常规、声望、限时、特殊兑换、黑市、季节） |
| **商品类型** | 7种（消耗品、装备、材料、配方、货币包、特殊物品、装备生成器） |
| **货币类型** | 9种（含自定义扩展） |
| **刷新机制** | 5种（不刷新、每日、每周、定时、手动） |
| **购买限制** | 5种（库存、单次、每日、每周、永久） |
| **条件类型** | 8种（等级、声望、任务、成就、物品、职业、技能、时间） |

---

## ✅ 设计完整性检查

### 核心功能覆盖

- [x] 商店定义与实例管理
- [x] 商品配置与解锁条件
- [x] 多种货币支持
- [x] 以物易物机制
- [x] 购买流程与事务管理
- [x] 价格计算与折扣
- [x] 购买限制与计数
- [x] 商店刷新机制
- [x] 库存管理
- [x] 购买记录与审计

### 非功能需求覆盖

- [x] 服务端权威
- [x] 数据驱动配置
- [x] 事务安全保证
- [x] 幂等保护机制
- [x] 审计追踪能力
- [x] 缓存优化策略
- [x] 批量操作支持
- [x] 扩展性预留
- [x] 测试覆盖策略
- [x] 前端UI设计

### 文档完整性

- [x] 需求分析文档
- [x] 架构设计文档
- [x] 领域模型文档
- [x] 实施计划文档
- [x] 技术规范文档
- [x] 测试策略文档
- [x] 前端设计文档
- [x] 交付清单文档
- [x] 风险评估文档
- [x] 扩展规划文档

---

## 🔗 相关文档链接

### 项目文档
- [整合设计总结.txt](../整合设计总结.txt) - 项目整体设计规范
- [项目进度与规划.md](../项目进度与规划.md) - 项目进度追踪

### 装备系统文档
- [装备系统优化总体方案-索引.md](../装备系统优化总体方案-索引.md) - 装备系统设计参考
- [装备系统优化总体方案（上）.md](../装备系统优化总体方案（上）.md)
- [装备系统优化总体方案（中）.md](../装备系统优化总体方案（中）.md)
- [装备系统优化总体方案（下）.md](../装备系统优化总体方案（下）.md)

### 经济系统文档
- [边打边发-README.md](./边打边发-README.md) - 实时奖励系统

---

## 📝 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|---------|
| 1.0 | 2025-10-12 | 系统架构设计团队 | 初始版本，完整商店系统设计 |

---

## 📮 反馈与建议

如有任何问题或建议，请通过以下方式反馈：
- 创建 GitHub Issue
- 联系项目负责人
- 在设计评审会议上提出

---

**文档状态**: 已完成  
**审核状态**: 待审核  
**最后更新**: 2025-10-12
