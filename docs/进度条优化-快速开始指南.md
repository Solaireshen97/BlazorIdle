# è¿›åº¦æ¡ä¼˜åŒ– - å¿«é€Ÿå¼€å§‹æŒ‡å—

> æœ¬æŒ‡å—å¸®åŠ©å¼€å‘è€…å¿«é€Ÿäº†è§£å’Œä½¿ç”¨æ–°çš„å‰ç«¯è¿›åº¦æ¡ä¼˜åŒ–åŠŸèƒ½

---

## ğŸ¯ åŠŸèƒ½æ¦‚è§ˆ

### ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½

1. **å¾ªç¯è¿›åº¦æ¡** ğŸ”„
   - è¿›åº¦è¾¾åˆ°100%åç»§ç»­æ»šåŠ¨
   - åŸºäºintervalè‡ªåŠ¨æ¨è¿›
   - æ— éœ€ç­‰å¾…æœåŠ¡ç«¯åˆ·æ–°

2. **JITå³æ—¶è½®è¯¢** âš¡
   - é¢„æµ‹æ”»å‡»è§¦å‘ç‚¹
   - æå‰è§¦å‘è½®è¯¢
   - å»¶è¿Ÿé™ä½88%

3. **å¹³æ»‘åŠ¨ç”»** ğŸ¨
   - HPæ¡å¹³æ»‘è¿‡æ¸¡
   - æ¶ˆé™¤æ•°å€¼è·³å˜
   - è§†è§‰ä½“éªŒæå‡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ–‡ä»¶ä½ç½®

```
BlazorIdle/wwwroot/config/progress-bar-config.json
```

### 2. é»˜è®¤é…ç½®ï¼ˆå¼€ç®±å³ç”¨ï¼‰

ç³»ç»Ÿå·²é…ç½®æœ€ä¼˜å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨ï¼š

```json
{
  "ProgressBar": {
    "EnableLoopingProgress": true,
    "AnimationIntervalMs": 100
  },
  "JITPolling": {
    "EnableJITPolling": true,
    "TriggerWindowMs": 150
  },
  "HPAnimation": {
    "TransitionDurationMs": 120
  }
}
```

### 3. éªŒè¯åŠŸèƒ½

å¯åŠ¨åº”ç”¨åï¼Œè§‚å¯Ÿä»¥ä¸‹æ•ˆæœï¼š

âœ… **å¾ªç¯è¿›åº¦**
- è¿›å…¥æˆ˜æ–—
- è§‚å¯Ÿæ”»å‡»è¿›åº¦æ¡
- ç¡®è®¤è¾¾åˆ°100%åç»§ç»­æ»šåŠ¨ï¼ˆä¸å¡ä½ï¼‰

âœ… **JITè½®è¯¢**
- å¼€å¯æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
- åˆ‡æ¢åˆ°Consoleæ ‡ç­¾
- ä¸´æ—¶å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼š
  ```json
  "Debug": {
    "LogJITPollingEvents": true
  }
  ```
- è§‚å¯Ÿæ—¥å¿—è¾“å‡ºï¼š`[JIT Polling] Attack trigger scheduled in XXXms`

âœ… **å¹³æ»‘åŠ¨ç”»**
- è§‚å¯Ÿç©å®¶/æ•ŒäººHPæ¡å˜åŒ–
- ç¡®è®¤æ•°å€¼å¹³æ»‘è¿‡æ¸¡ï¼ˆéè·³å˜ï¼‰

---

## âš™ï¸ å¸¸ç”¨é…ç½®è°ƒæ•´

### åœºæ™¯1: ç½‘ç»œå»¶è¿Ÿè¾ƒå¤§

å¦‚æœç½‘ç»œå»¶è¿Ÿ > 200msï¼Œå»ºè®®è°ƒæ•´JITè§¦å‘çª—å£ï¼š

```json
{
  "JITPolling": {
    "TriggerWindowMs": 250,  // å¢å¤§è§¦å‘çª—å£
    "MinPredictionTimeMs": 150  // å¢å¤§æœ€å°é¢„æµ‹æ—¶é—´
  }
}
```

### åœºæ™¯2: æ€§èƒ½å—é™è®¾å¤‡

é™ä½è½®è¯¢é¢‘ç‡å’ŒåŠ¨ç”»åˆ·æ–°ç‡ï¼š

```json
{
  "ProgressBar": {
    "AnimationIntervalMs": 200  // é™ä½åˆ·æ–°ç‡
  },
  "JITPolling": {
    "EnableJITPolling": false,  // ç¦ç”¨JITè½®è¯¢
    "NormalPollingMs": 3000  // å¢å¤§å¸¸è§„è½®è¯¢é—´éš”
  }
}
```

### åœºæ™¯3: å¼€å‘è°ƒè¯•

å¯ç”¨å®Œæ•´è°ƒè¯•ä¿¡æ¯ï¼š

```json
{
  "Debug": {
    "LogProgressCalculations": true,
    "LogJITPollingEvents": true,
    "ShowProgressDebugInfo": true
  }
}
```

### åœºæ™¯4: è‡ªå®šä¹‰åŠ¨ç”»é€Ÿåº¦

è°ƒæ•´HPæ¡è¿‡æ¸¡æ—¶é•¿ï¼š

```json
{
  "HPAnimation": {
    "TransitionDurationMs": 200,  // æ›´æ…¢ï¼ˆæ›´å¹³æ»‘ï¼‰
    "PlayerHPTransitionMs": 150,
    "EnemyHPTransitionMs": 100    // æ•Œäººæ›´å¿«å“åº”
  }
}
```

---

## ğŸ”§ é…ç½®å‚æ•°é€ŸæŸ¥

### è¿›åº¦æ¡é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èèŒƒå›´ |
|-----|--------|------|---------|
| EnableLoopingProgress | true | å¯ç”¨å¾ªç¯ | true/false |
| AnimationIntervalMs | 100 | åˆ·æ–°é—´éš” | 50-200ms |
| MinIntervalForLooping | 0.1 | æœ€å°interval | 0.05-1s |
| MaxIntervalForLooping | 100.0 | æœ€å¤§interval | 50-200s |

### JITè½®è¯¢é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èèŒƒå›´ |
|-----|--------|------|---------|
| EnableJITPolling | true | å¯ç”¨JIT | true/false |
| TriggerWindowMs | 150 | è§¦å‘çª—å£ | 100-300ms |
| MinPredictionTimeMs | 100 | æœ€å°é¢„æµ‹ | 50-200ms |
| HealthCriticalThreshold | 0.3 | å±æ€¥é˜ˆå€¼ | 0.2-0.4 |
| HealthLowThreshold | 0.5 | åä½é˜ˆå€¼ | 0.4-0.6 |
| CriticalHealthPollingMs | 500 | å±æ€¥è½®è¯¢ | 300-800ms |
| LowHealthPollingMs | 1000 | åä½è½®è¯¢ | 800-1500ms |
| NormalPollingMs | 2000 | æ­£å¸¸è½®è¯¢ | 1500-3000ms |

### HPåŠ¨ç”»é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èèŒƒå›´ |
|-----|--------|------|---------|
| TransitionDurationMs | 120 | è¿‡æ¸¡æ—¶é•¿ | 80-200ms |
| TransitionTimingFunction | "linear" | è¿‡æ¸¡å‡½æ•° | linear/ease |
| PlayerHPTransitionMs | 120 | ç©å®¶HP | 80-200ms |
| EnemyHPTransitionMs | 120 | æ•ŒäººHP | 80-200ms |

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æ£€æŸ¥ç‚¹

#### 1. CPUä½¿ç”¨ç‡
- æ­£å¸¸èŒƒå›´ï¼š8-12%
- è¶…è¿‡15%ï¼šè€ƒè™‘é™ä½åˆ·æ–°ç‡æˆ–ç¦ç”¨JIT

#### 2. ç½‘ç»œè¯·æ±‚æ•°
- æ­£å¸¸èŒƒå›´ï¼š100-120 è¯·æ±‚/50ç§’
- è¶…è¿‡150ï¼šè€ƒè™‘å¢å¤§è½®è¯¢é—´éš”

#### 3. å†…å­˜å ç”¨
- å¢é‡ï¼š~10KBï¼ˆé…ç½®å’ŒçŠ¶æ€ï¼‰
- æ— æ˜æ˜¾æ³„æ¼

#### 4. ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- è¿›åº¦æµç•…åº¦ï¼šåº”æ— å¡é¡¿
- ä¼¤å®³åé¦ˆå»¶è¿Ÿï¼š< 300ms
- HPè¿‡æ¸¡å¹³æ»‘åº¦ï¼šæ— è·³å˜

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·

**Performanceæ ‡ç­¾**ï¼š
- å½•åˆ¶5-10ç§’æˆ˜æ–—åœºæ™¯
- æ£€æŸ¥å¸§ç‡ï¼ˆåº” > 50 FPSï¼‰
- æ£€æŸ¥é•¿ä»»åŠ¡ï¼ˆåº” < 50msï¼‰

**Networkæ ‡ç­¾**ï¼š
- ç­›é€‰XHRè¯·æ±‚
- æ£€æŸ¥è½®è¯¢é¢‘ç‡
- ç¡®è®¤JITè¯·æ±‚è§¦å‘æ—¶æœº

**Consoleæ ‡ç­¾**ï¼š
- å¯ç”¨è°ƒè¯•æ—¥å¿—
- è§‚å¯Ÿè¿›åº¦è®¡ç®—å’ŒJITè§¦å‘

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¿›åº¦æ¡ä¸å¾ªç¯

**ç—‡çŠ¶**ï¼šè¿›åº¦è¾¾åˆ°100%ååœæ­¢

**æ£€æŸ¥**ï¼š
1. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½
2. `EnableLoopingProgress` æ˜¯å¦ä¸º true
3. interval æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´ (0.1-100s)

**è§£å†³**ï¼š
```json
{
  "ProgressBar": {
    "EnableLoopingProgress": true,
    "MinIntervalForLooping": 0.1,
    "MaxIntervalForLooping": 100.0
  }
}
```

### é—®é¢˜2: JITè½®è¯¢æœªè§¦å‘

**ç—‡çŠ¶**ï¼šConsoleæ— JITæ—¥å¿—ï¼Œä¼¤å®³å»¶è¿Ÿä»å¤§

**æ£€æŸ¥**ï¼š
1. `EnableJITPolling` æ˜¯å¦ä¸º true
2. è°ƒè¯•æ—¥å¿—æ˜¯å¦å¯ç”¨
3. ç½‘ç»œå»¶è¿Ÿæ˜¯å¦è¿‡å¤§

**è§£å†³**ï¼š
```json
{
  "JITPolling": {
    "EnableJITPolling": true,
    "TriggerWindowMs": 200  // å¢å¤§çª—å£
  },
  "Debug": {
    "LogJITPollingEvents": true
  }
}
```

### é—®é¢˜3: HPåŠ¨ç”»ä¸å¹³æ»‘

**ç—‡çŠ¶**ï¼šHPæ¡ä»ç„¶è·³å˜

**æ£€æŸ¥**ï¼š
1. æµè§ˆå™¨æ˜¯å¦æ”¯æŒCSS transition
2. `EnableSmoothTransition` æ˜¯å¦ä¸º true
3. è¿‡æ¸¡æ—¶é•¿æ˜¯å¦åˆç†

**è§£å†³**ï¼š
```json
{
  "HPAnimation": {
    "EnableSmoothTransition": true,
    "TransitionDurationMs": 120
  }
}
```

### é—®é¢˜4: é…ç½®ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šä¿®æ”¹é…ç½®åæ— å˜åŒ–

**åŸå› **ï¼šé…ç½®åœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½

**è§£å†³**ï¼šåˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆF5æˆ–Ctrl+Rï¼‰

### é—®é¢˜5: æ€§èƒ½ä¸‹é™

**ç—‡çŠ¶**ï¼šCPUå ç”¨è¿‡é«˜æˆ–å¡é¡¿

**æ£€æŸ¥**ï¼š
1. AnimationIntervalMs æ˜¯å¦è¿‡å°
2. æ˜¯å¦å¯ç”¨äº†è¿‡å¤šè°ƒè¯•æ—¥å¿—
3. è½®è¯¢é—´éš”æ˜¯å¦è¿‡å°

**è§£å†³**ï¼š
```json
{
  "ProgressBar": {
    "AnimationIntervalMs": 150  // é™ä½åˆ·æ–°ç‡
  },
  "JITPolling": {
    "NormalPollingMs": 2500  // å¢å¤§é—´éš”
  },
  "Debug": {
    "LogProgressCalculations": false,  // å…³é—­è°ƒè¯•
    "LogJITPollingEvents": false
  }
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®

```json
{
  "ProgressBar": {
    "EnableLoopingProgress": true,
    "AnimationIntervalMs": 100
  },
  "JITPolling": {
    "EnableJITPolling": true,
    "AdaptivePollingEnabled": true,
    "TriggerWindowMs": 150
  },
  "HPAnimation": {
    "EnableSmoothTransition": true,
    "TransitionDurationMs": 120
  },
  "Debug": {
    "LogProgressCalculations": false,
    "LogJITPollingEvents": false,
    "ShowProgressDebugInfo": false
  }
}
```

### 2. å¼€å‘ç¯å¢ƒé…ç½®

```json
{
  "Debug": {
    "LogProgressCalculations": true,
    "LogJITPollingEvents": true,
    "ShowProgressDebugInfo": false  // UIä¸æ˜¾ç¤ºï¼Œé¿å…å½±å“å¸ƒå±€
  }
}
```

### 3. ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–

```json
{
  "ProgressBar": {
    "AnimationIntervalMs": 150  // é™ä½åˆ·æ–°ç‡
  },
  "JITPolling": {
    "EnableJITPolling": false,  // ç¦ç”¨JITèŠ‚çœç”µé‡
    "NormalPollingMs": 3000
  },
  "HPAnimation": {
    "TransitionDurationMs": 100  // åŠ å¿«åŠ¨ç”»
  }
}
```

### 4. ä½ç½‘é€Ÿç¯å¢ƒ

```json
{
  "JITPolling": {
    "TriggerWindowMs": 250,  // å¢å¤§çª—å£
    "MinPredictionTimeMs": 150,
    "CriticalHealthPollingMs": 800,
    "LowHealthPollingMs": 1500,
    "NormalPollingMs": 3000
  }
}
```

---

## ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ 

### è¯¦ç»†æ–‡æ¡£

1. **å®ç°æŠ¥å‘Š**ï¼š`docs/è¿›åº¦æ¡ä¼˜åŒ–å®ç°æŠ¥å‘Š.md`
   - æŠ€æœ¯ç»†èŠ‚
   - ç®—æ³•è¯´æ˜
   - æ€§èƒ½åˆ†æ

2. **æ¶æ„å›¾**ï¼š`docs/è¿›åº¦æ¡ä¼˜åŒ–æ¶æ„å›¾.md`
   - ç³»ç»Ÿæ¶æ„
   - æµç¨‹å›¾
   - æ—¶åºå›¾

3. **é…ç½®è¯´æ˜**ï¼š`wwwroot/config/README.md`
   - å‚æ•°è¯¦è§£
   - é…ç½®ç¤ºä¾‹

### ä»£ç å‚è€ƒ

- `BlazorIdle/Pages/Characters.razor` - ä¸»è¦é€»è¾‘
- `BlazorIdle/Components/PlayerStatusPanel.razor` - ç©å®¶é¢æ¿
- `BlazorIdle/Components/MonsterStatusPanel.razor` - æ€ªç‰©é¢æ¿
- `BlazorIdle/Models/ProgressBarConfig.cs` - é…ç½®æ¨¡å‹
- `BlazorIdle/Services/ProgressBarConfigService.cs` - é…ç½®æœåŠ¡

### æµ‹è¯•ç”¨ä¾‹

- `tests/BlazorIdle.Tests/LoopingProgressTests.cs` - å¾ªç¯è¿›åº¦æµ‹è¯•
- `tests/BlazorIdle.Tests/ProgressBarConfigTests.cs` - é…ç½®æµ‹è¯•

---

## ğŸ¤ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ–‡æ¡£å’Œæ•…éšœæ’æŸ¥æŒ‡å—
2. æ£€æŸ¥æµè§ˆå™¨Consoleæ˜¯å¦æœ‰é”™è¯¯
3. å¯ç”¨è°ƒè¯•æ—¥å¿—è¿›è¡Œè¯Šæ–­
4. æäº¤Issueå¹¶é™„ä¸Šé…ç½®å’Œæ—¥å¿—

---

**ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-14  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
