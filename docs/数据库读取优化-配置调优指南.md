# æ•°æ®åº“è¯»å–ä¼˜åŒ– - é…ç½®è°ƒä¼˜æŒ‡å—

**é¡¹ç›®**: BlazorIdle æ•°æ®åº“è¯»å–ä¼˜åŒ–  
**æ–‡æ¡£ç±»å‹**: è¿ç»´é…ç½®æŒ‡å—  
**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-19

---

## ğŸ“‹ ç›®å½•

1. [é…ç½®æ–‡ä»¶æ¦‚è§ˆ](#é…ç½®æ–‡ä»¶æ¦‚è§ˆ)
2. [ç¼“å­˜ç­–ç•¥é…ç½®](#ç¼“å­˜ç­–ç•¥é…ç½®)
3. [ç›‘æ§é…ç½®](#ç›‘æ§é…ç½®)
4. [æ€§èƒ½è°ƒä¼˜](#æ€§èƒ½è°ƒä¼˜)
5. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## é…ç½®æ–‡ä»¶æ¦‚è§ˆ

### é…ç½®æ–‡ä»¶ä½ç½®

```
BlazorIdle.Server/
â”œâ”€â”€ appsettings.json                      # åŸºç¡€é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
â”œâ”€â”€ appsettings.Development.json          # å¼€å‘ç¯å¢ƒè¦†ç›–é…ç½®
â”œâ”€â”€ appsettings.Production.json           # ç”Ÿäº§ç¯å¢ƒè¦†ç›–é…ç½®
â””â”€â”€ appsettings.Production.example.json   # ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿
```

### é…ç½®èŠ‚è¯´æ˜

| é…ç½®èŠ‚ | ç”¨é€” | æ ¸å¿ƒå‚æ•° |
|--------|------|----------|
| CacheConfiguration | ç¼“å­˜ç­–ç•¥é…ç½® | EntityStrategies, GlobalSettings |
| Monitoring | ç›‘æ§é…ç½® | CacheMonitoring, MaxRecentOperations |
| Persistence | æŒä¹…åŒ–é…ç½® | SaveIntervalMs, MaxBatchSize |
| MemoryCache | å†…å­˜ç¼“å­˜é…ç½® | MaxCachedEntities, EvictionPolicy |

---

## ç¼“å­˜ç­–ç•¥é…ç½®

### ç¼“å­˜ç­–ç•¥ç±»å‹

#### 1. Permanentï¼ˆæ°¸ä¹…ç¼“å­˜ï¼‰

**é€‚ç”¨åœºæ™¯**: é™æ€é…ç½®æ•°æ®ï¼Œå¾ˆå°‘æˆ–ä»ä¸æ”¹å˜
- GearDefinitionï¼ˆè£…å¤‡å®šä¹‰ï¼‰
- Affixï¼ˆè¯ç¼€å®šä¹‰ï¼‰
- GearSetï¼ˆè£…å¤‡å¥—è£…ï¼‰

**é…ç½®ç¤ºä¾‹**:
```json
{
  "GearDefinition": {
    "Strategy": "Permanent",
    "PreloadOnStartup": true,
    "PreloadBatchSize": 500,
    "MaxCachedCount": 10000,
    "TtlSeconds": 86400
  }
}
```

**å‚æ•°è¯´æ˜**:
- `Strategy`: "Permanent" - æ°¸ä¹…ç¼“å­˜ç­–ç•¥
- `PreloadOnStartup`: true - æœåŠ¡å¯åŠ¨æ—¶é¢„åŠ è½½
- `PreloadBatchSize`: 500 - æ¯æ‰¹é¢„åŠ è½½æ•°é‡
- `MaxCachedCount`: 10000 - æœ€å¤§ç¼“å­˜æ•°é‡
- `TtlSeconds`: 86400 - æ‰‹åŠ¨åˆ·æ–°çš„ TTLï¼ˆ24å°æ—¶ï¼‰

**è°ƒä¼˜å»ºè®®**:
- æ•°æ®é‡å°ï¼ˆ<1000æ¡ï¼‰ï¼šPreloadBatchSize = å…¨éƒ¨æ•°é‡
- æ•°æ®é‡ä¸­ï¼ˆ1000-5000æ¡ï¼‰ï¼šPreloadBatchSize = 500-1000
- æ•°æ®é‡å¤§ï¼ˆ>5000æ¡ï¼‰ï¼šPreloadBatchSize = 1000-2000ï¼Œåˆ†æ‰¹åŠ è½½

#### 2. Temporaryï¼ˆä¸´æ—¶ç¼“å­˜ï¼‰

**é€‚ç”¨åœºæ™¯**: ç”¨æˆ·è¿è¡Œæ—¶æ•°æ®ï¼Œä¼šè¢«ä¿®æ”¹æˆ–è¿‡æœŸ
- Characterï¼ˆè§’è‰²ï¼‰
- GearInstanceï¼ˆè£…å¤‡å®ä¾‹ï¼‰
- ActivityPlanï¼ˆæ´»åŠ¨è®¡åˆ’ï¼‰
- RunningBattleSnapshotï¼ˆæˆ˜æ–—å¿«ç…§ï¼‰

**é…ç½®ç¤ºä¾‹**:
```json
{
  "Character": {
    "Strategy": "Temporary",
    "TtlSeconds": 3600,
    "MaxCachedCount": 10000,
    "PreloadOnStartup": false
  }
}
```

**å‚æ•°è¯´æ˜**:
- `Strategy`: "Temporary" - ä¸´æ—¶ç¼“å­˜ç­–ç•¥
- `TtlSeconds`: 3600 - ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
- `MaxCachedCount`: 10000 - æœ€å¤§ç¼“å­˜æ•°é‡
- `PreloadOnStartup`: false - æŒ‰éœ€åŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰

**TTL è°ƒä¼˜å»ºè®®**:

| å®ä½“ç±»å‹ | æ¨è TTL | è€ƒè™‘å› ç´  |
|----------|----------|----------|
| Character | 3600s (1å°æ—¶) | ç”¨æˆ·ç™»å½•åé•¿æ—¶é—´åœ¨çº¿ï¼Œè®¿é—®é¢‘ç¹ |
| GearInstance | 1800s (30åˆ†é’Ÿ) | è£…å¤‡å¯èƒ½è¢«äº¤æ˜“æˆ–å‡çº§ï¼Œä¸­ç­‰é¢‘ç‡è®¿é—® |
| ActivityPlan | 900s (15åˆ†é’Ÿ) | æ´»åŠ¨çŠ¶æ€æ›´æ–°é¢‘ç¹ï¼Œä½†æ´»åŠ¨æŒç»­æ—¶é—´é•¿ |
| RunningBattleSnapshot | 600s (10åˆ†é’Ÿ) | æˆ˜æ–—è¿‡ç¨‹ä¸­é«˜é¢‘è®¿é—®ï¼Œæˆ˜æ–—ç»“æŸåä¸å†éœ€è¦ |

**MaxCachedCount è°ƒä¼˜å»ºè®®**:
- æ ¹æ®åœ¨çº¿ç”¨æˆ·æ•°é‡ï¼šMaxCachedCount â‰¥ åœ¨çº¿ç”¨æˆ·æ•° Ã— 1.5
- Character: 1000ï¼ˆ100ç”¨æˆ·ï¼‰åˆ° 10000ï¼ˆ1000ç”¨æˆ·ï¼‰
- GearInstance: 5000ï¼ˆå°é‡è£…å¤‡ï¼‰åˆ° 50000ï¼ˆå¤§é‡è£…å¤‡ï¼‰
- ActivityPlan: 2000ï¼ˆå°‘é‡æ´»åŠ¨ï¼‰åˆ° 20000ï¼ˆå¤§é‡æ´»åŠ¨ï¼‰
- RunningBattleSnapshot: 500ï¼ˆå°‘é‡æˆ˜æ–—ï¼‰åˆ° 5000ï¼ˆå¤§é‡æˆ˜æ–—ï¼‰

#### 3. Noneï¼ˆä¸ç¼“å­˜ï¼‰

**é€‚ç”¨åœºæ™¯**: å®æ—¶æ€§è¦æ±‚æé«˜ï¼Œä¸é€‚åˆç¼“å­˜çš„æ•°æ®
- äº¤æ˜“è®°å½•ï¼ˆå¼ºä¸€è‡´æ€§è¦æ±‚ï¼‰
- å®æ—¶æ’è¡Œæ¦œï¼ˆå˜åŒ–æå¿«ï¼‰

**é…ç½®ç¤ºä¾‹**:
```json
{
  "Transaction": {
    "Strategy": "None"
  }
}
```

### å…¨å±€ç¼“å­˜è®¾ç½®

```json
{
  "GlobalSettings": {
    "EnableReadCaching": true,
    "CleanupIntervalMinutes": 5,
    "TrackCacheHitRate": true,
    "HitRateLogIntervalMinutes": 10
  }
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | è°ƒä¼˜å»ºè®® |
|------|--------|------|----------|
| EnableReadCaching | true | æ€»å¼€å…³ | ç”Ÿäº§ç¯å¢ƒå»ºè®® true |
| CleanupIntervalMinutes | 5 | æ¸…ç†é—´éš” | å†…å­˜å……è£•ï¼š5-10åˆ†é’Ÿï¼›å†…å­˜ç´§å¼ ï¼š2-3åˆ†é’Ÿ |
| TrackCacheHitRate | true | è·Ÿè¸ªå‘½ä¸­ç‡ | ç”Ÿäº§ç¯å¢ƒå»ºè®® true |
| HitRateLogIntervalMinutes | 10 | ç»Ÿè®¡è¾“å‡ºé—´éš” | å¼€å‘ç¯å¢ƒï¼š5åˆ†é’Ÿï¼›ç”Ÿäº§ç¯å¢ƒï¼š10-15åˆ†é’Ÿ |

---

## ç›‘æ§é…ç½®

### åŸºç¡€ç›‘æ§é…ç½®

```json
{
  "Monitoring": {
    "MaxRecentOperations": 100,
    "EnableDetailedLogging": false,
    "DefaultTimeWindowMinutes": 10,
    "MemoryStateSnapshotIntervalSeconds": 0
  }
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | è°ƒä¼˜å»ºè®® |
|------|--------|------|----------|
| MaxRecentOperations | 100 | ä¿ç•™çš„æœ€è¿‘æ“ä½œè®°å½•æ•° | å¼€å‘ç¯å¢ƒï¼š200-500ï¼›ç”Ÿäº§ç¯å¢ƒï¼š50-100 |
| EnableDetailedLogging | false | è¯¦ç»†æ—¥å¿— | ä»…è°ƒè¯•æ—¶å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®® false |
| DefaultTimeWindowMinutes | 10 | ç»Ÿè®¡æ—¶é—´çª—å£ | æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼Œ5-30åˆ†é’Ÿ |
| MemoryStateSnapshotIntervalSeconds | 0 | å¿«ç…§é—´éš” | 0 = æ¯æ¬¡ä¿å­˜è®°å½• |

### ç¼“å­˜ç›‘æ§é…ç½®

```json
{
  "CacheMonitoring": {
    "EnableCacheMetrics": true,
    "TrackPerEntityMetrics": true,
    "CacheMetricsIntervalSeconds": 60,
    "LogCacheAccess": false,
    "CacheHitRateThreshold": 70.0
  }
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | è°ƒä¼˜å»ºè®® |
|------|--------|------|----------|
| EnableCacheMetrics | true | å¯ç”¨ç¼“å­˜æŒ‡æ ‡æ”¶é›† | ç”Ÿäº§ç¯å¢ƒå»ºè®® true |
| TrackPerEntityMetrics | true | è·Ÿè¸ªæ¯ä¸ªå®ä½“ç±»å‹ | ç”Ÿäº§ç¯å¢ƒå»ºè®® true |
| CacheMetricsIntervalSeconds | 60 | æŒ‡æ ‡è®°å½•é—´éš” | 30-120ç§’ |
| LogCacheAccess | false | è®°å½•è¯¦ç»†è®¿é—®æ—¥å¿— | ä»…è°ƒè¯•æ—¶å¯ç”¨ |
| CacheHitRateThreshold | 70.0 | å‘½ä¸­ç‡å‘Šè­¦é˜ˆå€¼ | æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œ60-80% |

**CacheHitRateThreshold è°ƒä¼˜**:
- é™æ€æ•°æ®ï¼ˆGearDefinitionç­‰ï¼‰ï¼šå»ºè®® 85-95%
- ç”¨æˆ·æ•°æ®ï¼ˆCharacterç­‰ï¼‰ï¼šå»ºè®® 70-85%
- ä¸´æ—¶æ•°æ®ï¼ˆRunningBattleSnapshotï¼‰ï¼šå»ºè®® 60-75%

---

## æ€§èƒ½è°ƒä¼˜

### åœºæ™¯ 1: é«˜å¹¶å‘åœºæ™¯ï¼ˆå¤§é‡ç”¨æˆ·ï¼‰

**ç‰¹å¾**:
- åœ¨çº¿ç”¨æˆ· > 500
- å¹¶å‘è¯·æ±‚ > 50 req/s
- ç¼“å­˜å‘½ä¸­ç‡ > 80%

**æ¨èé…ç½®**:
```json
{
  "CacheConfiguration": {
    "EntityStrategies": {
      "Character": {
        "TtlSeconds": 7200,
        "MaxCachedCount": 20000
      },
      "GearInstance": {
        "TtlSeconds": 3600,
        "MaxCachedCount": 100000
      },
      "ActivityPlan": {
        "TtlSeconds": 1800,
        "MaxCachedCount": 40000
      }
    },
    "GlobalSettings": {
      "CleanupIntervalMinutes": 10,
      "HitRateLogIntervalMinutes": 15
    }
  }
}
```

**è°ƒä¼˜è¦ç‚¹**:
1. å¢å¤§ TTLï¼Œå‡å°‘ç¼“å­˜è¿‡æœŸ
2. å¢å¤§ MaxCachedCountï¼Œå®¹çº³æ›´å¤šç”¨æˆ·æ•°æ®
3. å¢å¤§æ¸…ç†é—´éš”ï¼Œå‡å°‘æ¸…ç†é¢‘ç‡

### åœºæ™¯ 2: å†…å­˜å—é™åœºæ™¯

**ç‰¹å¾**:
- å¯ç”¨å†…å­˜ < 2GB
- æœåŠ¡å™¨èµ„æºç´§å¼ 
- éœ€è¦æ§åˆ¶å†…å­˜å ç”¨

**æ¨èé…ç½®**:
```json
{
  "CacheConfiguration": {
    "EntityStrategies": {
      "Character": {
        "TtlSeconds": 1800,
        "MaxCachedCount": 5000
      },
      "GearInstance": {
        "TtlSeconds": 900,
        "MaxCachedCount": 25000
      },
      "ActivityPlan": {
        "TtlSeconds": 600,
        "MaxCachedCount": 10000
      },
      "RunningBattleSnapshot": {
        "TtlSeconds": 300,
        "MaxCachedCount": 2500
      }
    },
    "GlobalSettings": {
      "CleanupIntervalMinutes": 3,
      "TrackCacheHitRate": true
    }
  },
  "MemoryCache": {
    "MaxCachedEntities": 50000,
    "EvictionPolicy": "LRU"
  }
}
```

**è°ƒä¼˜è¦ç‚¹**:
1. å‡å° TTLï¼ŒåŠ å¿«ç¼“å­˜è¿‡æœŸ
2. å‡å° MaxCachedCountï¼Œæ§åˆ¶å†…å­˜å ç”¨
3. å‡å°æ¸…ç†é—´éš”ï¼ŒåŠæ—¶é‡Šæ”¾å†…å­˜
4. å¯ç”¨ LRU æ¸…ç†ç­–ç•¥

### åœºæ™¯ 3: å¼€å‘æµ‹è¯•åœºæ™¯

**ç‰¹å¾**:
- å¿«é€Ÿè¿­ä»£å¼€å‘
- éœ€è¦è¯¦ç»†æ—¥å¿—
- é¢‘ç¹é‡å¯æœåŠ¡

**æ¨èé…ç½®**:
```json
{
  "CacheConfiguration": {
    "EntityStrategies": {
      "Character": {
        "TtlSeconds": 600,
        "MaxCachedCount": 1000
      },
      "GearInstance": {
        "TtlSeconds": 300,
        "MaxCachedCount": 5000
      }
    },
    "GlobalSettings": {
      "CleanupIntervalMinutes": 2,
      "TrackCacheHitRate": true,
      "HitRateLogIntervalMinutes": 5
    }
  },
  "Monitoring": {
    "EnableDetailedLogging": true,
    "CacheMonitoring": {
      "LogCacheAccess": true,
      "CacheHitRateThreshold": 50.0
    }
  }
}
```

**è°ƒä¼˜è¦ç‚¹**:
1. çŸ­ TTLï¼Œå¿«é€Ÿåæ˜ æ•°æ®å˜åŒ–
2. å°ç¼“å­˜å®¹é‡ï¼Œå‡å°‘å†…å­˜å ç”¨
3. è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
4. è¾ƒä½çš„å‘Šè­¦é˜ˆå€¼ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½

**ç—‡çŠ¶**:
```log
âš ï¸  Character: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ (45.50% < 70.00%), 
ç¼“å­˜ 150 ä¸ª, Dirty 5 ä¸ª, å‘½ä¸­ 455 æ¬¡, æœªå‘½ä¸­ 545 æ¬¡
```

**å¯èƒ½åŸå› **:
1. TTL è®¾ç½®è¿‡çŸ­ï¼Œç¼“å­˜é¢‘ç¹è¿‡æœŸ
2. MaxCachedCount è¿‡å°ï¼Œç¼“å­˜å®¹é‡ä¸è¶³
3. è®¿é—®æ¨¡å¼åˆ†æ•£ï¼Œæ•°æ®è®¿é—®éšæœºæ€§å¼º
4. ç¼“å­˜æ¸…ç†è¿‡äºé¢‘ç¹

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ç¼“å­˜ç»Ÿè®¡
curl http://localhost:5000/api/database/cache-stats | jq

# 2. æ£€æŸ¥å†…å­˜çŠ¶æ€
curl http://localhost:5000/api/database/memory-state | jq

# 3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ç¼“å­˜æ¸…ç†è®°å½•
grep "è¿‡æœŸç¼“å­˜æ¸…ç†" logs/app.log
```

**è§£å†³æ–¹æ¡ˆ**:
1. **å¢åŠ  TTL**:
   ```json
   {
     "Character": {
       "TtlSeconds": 3600  // ä» 1800 å¢åŠ åˆ° 3600
     }
   }
   ```

2. **å¢å¤§ç¼“å­˜å®¹é‡**:
   ```json
   {
     "Character": {
       "MaxCachedCount": 20000  // ä» 10000 å¢åŠ åˆ° 20000
     }
   }
   ```

3. **è°ƒæ•´æ¸…ç†é—´éš”**:
   ```json
   {
     "GlobalSettings": {
       "CleanupIntervalMinutes": 10  // ä» 5 å¢åŠ åˆ° 10
     }
   }
   ```

### é—®é¢˜ 2: å†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶**:
- å†…å­˜ä½¿ç”¨ç‡ > 80%
- é¢‘ç¹ GC
- ç³»ç»Ÿå“åº”å˜æ…¢

**å¯èƒ½åŸå› **:
1. MaxCachedCount è®¾ç½®è¿‡å¤§
2. TTL è®¾ç½®è¿‡é•¿ï¼Œç¼“å­˜ç´¯ç§¯
3. æ¸…ç†é—´éš”è¿‡é•¿ï¼Œè¿‡æœŸæ•°æ®æœªåŠæ—¶æ¸…ç†
4. å¤§é‡ Dirty å®ä½“æœªä¿å­˜

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥å†…å­˜çŠ¶æ€
curl http://localhost:5000/api/database/status | jq '.systemInfo.memory'

# 2. æ£€æŸ¥ç¼“å­˜å¤§å°
curl http://localhost:5000/api/database/memory-state | jq '.memoryState'

# 3. æ£€æŸ¥ Dirty å®ä½“æ•°é‡
curl http://localhost:5000/api/database/memory-state | jq '.memoryState[].dirtyCount'
```

**è§£å†³æ–¹æ¡ˆ**:
1. **å‡å°ç¼“å­˜å®¹é‡**:
   ```json
   {
     "Character": {
       "MaxCachedCount": 5000  // ä» 10000 å‡å°‘åˆ° 5000
     }
   }
   ```

2. **ç¼©çŸ­ TTL**:
   ```json
   {
     "Character": {
       "TtlSeconds": 1800  // ä» 3600 å‡å°‘åˆ° 1800
     }
   }
   ```

3. **å¢åŠ æ¸…ç†é¢‘ç‡**:
   ```json
   {
     "GlobalSettings": {
       "CleanupIntervalMinutes": 3  // ä» 5 å‡å°‘åˆ° 3
     }
   }
   ```

4. **æ‰‹åŠ¨è§¦å‘æ¸…ç†**:
   ```bash
   # è§¦å‘ç«‹å³ä¿å­˜ï¼ˆæ¸…ç† Dirty å®ä½“ï¼‰
   curl -X POST http://localhost:5000/api/database/trigger-save
   ```

### é—®é¢˜ 3: é¢‘ç¹å‘Šè­¦

**ç—‡çŠ¶**:
```log
âš ï¸  ActivityPlan: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ (68.50% < 70.00%)
âš ï¸  ActivityPlan: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ (69.20% < 70.00%)
âš ï¸  ActivityPlan: ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ (67.80% < 70.00%)
```

**å¯èƒ½åŸå› **:
1. é˜ˆå€¼è®¾ç½®è¿‡é«˜
2. æ­£å¸¸çš„ä¸šåŠ¡æ³¢åŠ¨
3. ç¼“å­˜ç­–ç•¥é…ç½®ä¸åˆç†

**è§£å†³æ–¹æ¡ˆ**:
1. **è°ƒæ•´é˜ˆå€¼**:
   ```json
   {
     "CacheMonitoring": {
       "CacheHitRateThreshold": 60.0  // ä» 70.0 é™ä½åˆ° 60.0
     }
   }
   ```

2. **é’ˆå¯¹ä¸åŒå®ä½“è®¾ç½®ä¸åŒé¢„æœŸ**:
   - é™æ€æ•°æ®ï¼š85-95%
   - ç”¨æˆ·æ ¸å¿ƒæ•°æ®ï¼š70-85%
   - ä¸´æ—¶æ•°æ®ï¼š60-75%

3. **å¢åŠ ç»Ÿè®¡æ ·æœ¬é‡åˆ¤æ–­**ï¼ˆä»£ç å±‚é¢å·²å®ç°ï¼‰:
   - åªæœ‰è®¿é—®æ¬¡æ•° > 100 æ—¶æ‰å‘Šè­¦
   - é¿å…å¯åŠ¨åˆæœŸè¯¯æŠ¥

---

## æœ€ä½³å®è·µ

### 1. åˆ†ç¯å¢ƒé…ç½®

**å¼€å‘ç¯å¢ƒ** (appsettings.Development.json):
```json
{
  "CacheConfiguration": {
    "GlobalSettings": {
      "EnableReadCaching": true,
      "CleanupIntervalMinutes": 2,
      "HitRateLogIntervalMinutes": 5
    }
  },
  "Monitoring": {
    "EnableDetailedLogging": true,
    "CacheMonitoring": {
      "LogCacheAccess": true,
      "CacheHitRateThreshold": 50.0
    }
  }
}
```

**ç”Ÿäº§ç¯å¢ƒ** (appsettings.Production.json):
```json
{
  "CacheConfiguration": {
    "GlobalSettings": {
      "EnableReadCaching": true,
      "CleanupIntervalMinutes": 5,
      "HitRateLogIntervalMinutes": 15
    }
  },
  "Monitoring": {
    "EnableDetailedLogging": false,
    "CacheMonitoring": {
      "LogCacheAccess": false,
      "CacheHitRateThreshold": 70.0
    }
  }
}
```

### 2. æ¸è¿›å¼ä¼˜åŒ–

**ç¬¬ä¸€å‘¨**: ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œæ”¶é›†ç›‘æ§æ•°æ®
```bash
# å®šæœŸæ£€æŸ¥ç¼“å­˜ç»Ÿè®¡
curl http://localhost:5000/api/database/cache-stats | jq > stats_day1.json
```

**ç¬¬äºŒå‘¨**: æ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´ TTL
- å‘½ä¸­ç‡ä½çš„å®ä½“ï¼šå¢åŠ  TTL
- å†…å­˜å ç”¨é«˜çš„å®ä½“ï¼šå‡å°‘ TTL

**ç¬¬ä¸‰å‘¨**: è°ƒæ•´ç¼“å­˜å®¹é‡
- é¢‘ç¹è¢« LRU æ¸…ç†ï¼šå¢åŠ  MaxCachedCount
- å†…å­˜å‹åŠ›å¤§ï¼šå‡å°‘ MaxCachedCount

**ç¬¬å››å‘¨**: å¾®è°ƒç›‘æ§å‚æ•°
- å‘Šè­¦è¿‡å¤šï¼šé™ä½é˜ˆå€¼æˆ–å¢åŠ æ¸…ç†é—´éš”
- å‘Šè­¦è¿‡å°‘ï¼šæé«˜é˜ˆå€¼

### 3. ç›‘æ§æŒ‡æ ‡è§‚å¯Ÿ

**æ¯æ—¥æ£€æŸ¥**:
1. ç¼“å­˜å‘½ä¸­ç‡ï¼ˆç›®æ ‡ > 70%ï¼‰
2. å†…å­˜ä½¿ç”¨ç‡ï¼ˆç›®æ ‡ < 70%ï¼‰
3. å‘Šè­¦é¢‘ç‡ï¼ˆç›®æ ‡ < 5æ¬¡/å¤©ï¼‰

**æ¯å‘¨æ£€æŸ¥**:
1. ç¼“å­˜ç­–ç•¥æœ‰æ•ˆæ€§
2. TTL åˆç†æ€§
3. å®¹é‡é…ç½®åˆç†æ€§

**æ¯æœˆæ£€æŸ¥**:
1. é•¿æœŸè¶‹åŠ¿åˆ†æ
2. é…ç½®ä¼˜åŒ–ç©ºé—´
3. æ€§èƒ½æ”¹è¿›æœºä¼š

### 4. é…ç½®å¤‡ä»½

å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶:
```bash
# å¤‡ä»½å½“å‰ç”Ÿäº§ç¯å¢ƒé…ç½®
cp appsettings.Production.json appsettings.Production.backup.$(date +%Y%m%d).json

# ç‰ˆæœ¬æ§åˆ¶
git add appsettings.Production.json
git commit -m "Update cache configuration for performance tuning"
```

### 5. A/B æµ‹è¯•

å¯¹äºå…³é”®é…ç½®å˜æ›´ï¼Œä½¿ç”¨ A/B æµ‹è¯•éªŒè¯æ•ˆæœ:
1. ä¿æŒ 50% æœåŠ¡å™¨ä½¿ç”¨æ—§é…ç½®
2. å¦å¤– 50% ä½¿ç”¨æ–°é…ç½®
3. å¯¹æ¯” 1-2 å‘¨çš„ç›‘æ§æ•°æ®
4. é€‰æ‹©æ•ˆæœæ›´å¥½çš„é…ç½®å…¨é‡åº”ç”¨

---

## é…ç½®å‚è€ƒé€ŸæŸ¥è¡¨

### ç¼“å­˜ç­–ç•¥å¿«é€Ÿå‚è€ƒ

| æ•°æ®ç±»å‹ | ç­–ç•¥ | TTL | MaxCached | é¢„åŠ è½½ |
|----------|------|-----|-----------|--------|
| è£…å¤‡å®šä¹‰ | Permanent | 86400s | 10000 | æ˜¯ |
| è¯ç¼€å®šä¹‰ | Permanent | 86400s | 10000 | æ˜¯ |
| è£…å¤‡å¥—è£… | Permanent | 86400s | 1000 | æ˜¯ |
| è§’è‰² | Temporary | 3600s | 10000 | å¦ |
| è£…å¤‡å®ä¾‹ | Temporary | 1800s | 50000 | å¦ |
| æ´»åŠ¨è®¡åˆ’ | Temporary | 900s | 20000 | å¦ |
| æˆ˜æ–—å¿«ç…§ | Temporary | 600s | 5000 | å¦ |

### ç›‘æ§å‚æ•°å¿«é€Ÿå‚è€ƒ

| å‚æ•° | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ | ä½å†…å­˜ç¯å¢ƒ |
|------|----------|----------|------------|
| CleanupIntervalMinutes | 2 | 5 | 3 |
| HitRateLogIntervalMinutes | 5 | 10 | 10 |
| MaxRecentOperations | 200 | 100 | 50 |
| EnableDetailedLogging | true | false | false |
| LogCacheAccess | true | false | false |
| CacheHitRateThreshold | 50% | 70% | 60% |

---

## é™„å½•

### A. é…ç½®æ¨¡æ¿

å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿ï¼š`appsettings.Production.example.json`

### B. ç›‘æ§è„šæœ¬

**cache_monitor.sh** - ç¼“å­˜ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# ç¼“å­˜ç›‘æ§è„šæœ¬
API_URL="http://localhost:5000"

# è·å–ç¼“å­˜ç»Ÿè®¡
echo "=== Cache Statistics ==="
curl -s ${API_URL}/api/database/cache-stats | jq '.entityMetrics'

# æ£€æŸ¥å‘½ä¸­ç‡
HIT_RATE=$(curl -s ${API_URL}/api/database/cache-stats | jq '.overallStatistics.overallHitRate')
echo "Overall Hit Rate: ${HIT_RATE}%"

if (( $(echo "$HIT_RATE < 70" | bc -l) )); then
    echo "âš ï¸  WARNING: Cache hit rate is below threshold!"
fi
```

### C. æ€§èƒ½åŸºå‡†

**é¢„æœŸæ€§èƒ½æŒ‡æ ‡**:
- æ•°æ®åº“è¯»å–å‡å°‘ï¼š85%
- ç¼“å­˜å‘½ä¸­ç‡ï¼ˆé™æ€æ•°æ®ï¼‰ï¼š95%+
- ç¼“å­˜å‘½ä¸­ç‡ï¼ˆç”¨æˆ·æ•°æ®ï¼‰ï¼š80%+
- API å“åº”æ—¶é—´æ”¹å–„ï¼š30%+

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-19  
**ç»´æŠ¤äºº**: Database Optimization Team  
**åé¦ˆ**: å¦‚æœ‰é…ç½®é—®é¢˜æˆ–ä¼˜åŒ–å»ºè®®ï¼Œè¯·è”ç³»è¿ç»´å›¢é˜Ÿ
