# BlazorIdle æ•°æ®åº“æ“ä½œä¼˜åŒ–å®æ–½æ–¹æ¡ˆ - ä¸­ç¯‡ï¼šä¸šåŠ¡æ¨¡å—é›†æˆ

**é¡¹ç›®**: BlazorIdle æœåŠ¡ç«¯æ•°æ®åº“æ“ä½œä¼˜åŒ–  
**é˜¶æ®µ**: ä¸­ç¯‡ - ä¸šåŠ¡æ¨¡å—é›†æˆ  
**å·¥ä½œé‡**: 5-7 å·¥ä½œæ—¥  
**ä¼˜å…ˆçº§**: P0ï¼ˆæœ€é«˜ï¼‰  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0

---

## ğŸ“‹ ç›®å½•

1. [ä¸­ç¯‡æ¦‚è¿°](#ä¸­ç¯‡æ¦‚è¿°)
2. [Phase 5: æˆ˜æ–—å¿«ç…§æ‰¹é‡æŒä¹…åŒ–](#phase-5-æˆ˜æ–—å¿«ç…§æ‰¹é‡æŒä¹…åŒ–)
3. [Phase 6: è§’è‰²çŠ¶æ€æ‰¹é‡æ›´æ–°](#phase-6-è§’è‰²çŠ¶æ€æ‰¹é‡æ›´æ–°)
4. [Phase 7: æ´»åŠ¨è®¡åˆ’æ‰¹é‡æŒä¹…åŒ–](#phase-7-æ´»åŠ¨è®¡åˆ’æ‰¹é‡æŒä¹…åŒ–)
5. [Phase 8: è£…å¤‡æ“ä½œæ‰¹é‡æŒä¹…åŒ–](#phase-8-è£…å¤‡æ“ä½œæ‰¹é‡æŒä¹…åŒ–)
6. [ä¸­ç¯‡æ€»ç»“ä¸éªŒæ”¶](#ä¸­ç¯‡æ€»ç»“ä¸éªŒæ”¶)

---

## ä¸­ç¯‡æ¦‚è¿°

### ç›®æ ‡

ä¸­ç¯‡èšç„¦äº**ä¸šåŠ¡æ¨¡å—é›†æˆ**ï¼Œå°†æ‰¹é‡æŒä¹…åŒ–æœºåˆ¶åº”ç”¨åˆ°å®é™…ä¸šåŠ¡åœºæ™¯ï¼š

1. âœ… æˆ˜æ–—å¿«ç…§ï¼šä»æ¯500msä¿å­˜æ”¹ä¸ºæ‰¹é‡ä¿å­˜ï¼ˆ5ç§’ï¼‰
2. âœ… è§’è‰²çŠ¶æ€ï¼šä»å¿ƒè·³ç«‹å³æ›´æ–°æ”¹ä¸ºæ‰¹é‡æ›´æ–°ï¼ˆ30ç§’ï¼‰
3. âœ… æ´»åŠ¨è®¡åˆ’ï¼šçŠ¶æ€å˜æ›´å»¶è¿Ÿä¿å­˜ï¼ˆ10ç§’ï¼‰
4. âœ… è£…å¤‡æ“ä½œï¼šæ”¯æŒæ‰¹é‡å’Œç«‹å³ä¿å­˜æ··åˆæ¨¡å¼

### å‰ç½®æ¡ä»¶

- âœ… ä¸Šç¯‡å·²å®Œæˆï¼šé…ç½®ç³»ç»Ÿã€æŒä¹…åŒ–ç®¡ç†å™¨ã€æ‰¹é‡åˆ·æ–°æœåŠ¡
- âœ… æ‰€æœ‰ä¸Šç¯‡çš„å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… åŸºç¡€è®¾æ–½å·²éªŒæ”¶

### å…³é”®äº§å‡º

- ğŸ“¦ ä¿®æ”¹åçš„ `StepBattleSnapshotService.cs`
- ğŸ“¦ ä¿®æ”¹åçš„ `CharactersController.cs`
- ğŸ“¦ ä¿®æ”¹åçš„ `ActivityPlanRepository.cs`
- ğŸ“¦ ä¿®æ”¹åçš„ `GearInstanceRepository.cs`
- ğŸ“„ ä¸šåŠ¡æ¨¡å—é›†æˆæµ‹è¯•æŠ¥å‘Š
- ğŸ“„ æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š

---

## Phase 5: æˆ˜æ–—å¿«ç…§æ‰¹é‡æŒä¹…åŒ–

**å·¥ä½œé‡**: 2 å¤©  
**ä¼˜å…ˆçº§**: P0  
**é¢„æœŸæ€§èƒ½æå‡**: æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½ 90%

### 5.1 ç°çŠ¶åˆ†æ

**å½“å‰å®ç°** (`StepBattleSnapshotService.cs`)ï¼š

```csharp
// å½“å‰ï¼šæ¯500msæ£€æŸ¥å¹¶ç«‹å³ä¿å­˜
if ((DateTime.UtcNow - lastSnapAt).TotalMilliseconds >= 500)
{
    foreach (var id in _coordinator.InternalIdsSnapshot())
    {
        if (_coordinator.TryGet(id, out var rb) && rb is not null && !rb.Completed)
        {
            if (!SnapshotThrottler.ShouldSkip(...))
            {
                await _snapshot.SaveAsync(rb, stoppingToken);  // âš ï¸ ç«‹å³ä¿å­˜
            }
        }
    }
}
```

**é—®é¢˜**ï¼š
- é«˜å¹¶å‘æ—¶ï¼ˆ10ä¸ªæˆ˜æ–—ï¼‰= 20æ¬¡/ç§’æ•°æ®åº“å†™å…¥
- æ¯ä¸ªå¿«ç…§ç‹¬ç«‹ä¿å­˜ï¼Œæ— æ‰¹é‡å¤„ç†

### 5.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆè®¾è®¡

```
åŸæµç¨‹: æ£€æŸ¥ â†’ ç«‹å³SaveAsync â†’ æ•°æ®åº“å†™å…¥
æ–°æµç¨‹: æ£€æŸ¥ â†’ MarkDirty â†’ å†…å­˜ç¼“å­˜ â†’ (5ç§’å) BatchFlush â†’ æ‰¹é‡æ•°æ®åº“å†™å…¥
```

**ç‰¹æ®Šæƒ…å†µ**ï¼š
- æˆ˜æ–—å®Œæˆæ—¶ï¼šç«‹å³ä¿å­˜ï¼ˆ`ImmediateCondition: "BattleComplete"`ï¼‰
- æœåŠ¡å™¨å…³é—­æ—¶ï¼šé€šè¿‡ä¼˜é›…å…³é—­æœºåˆ¶æ‰¹é‡ä¿å­˜

### 5.3 å®æ–½æ­¥éª¤

#### Step 5.1: ä¿®æ”¹æˆ˜æ–—å¿«ç…§æœåŠ¡

**æ–‡ä»¶**: `BlazorIdle.Server/Application/Battles/Step/StepBattleSnapshotService.cs`

**ä¿®æ”¹ç‚¹**ï¼š

1. æ³¨å…¥ `IPersistenceManager`
2. å°† `SaveAsync` æ”¹ä¸ºæ ‡è®°è„æ•°æ®
3. æˆ˜æ–—å®Œæˆæ—¶ç«‹å³ä¿å­˜

```csharp
// åœ¨ç±»é¡¶éƒ¨æ·»åŠ æ–°çš„ä¾èµ–
public sealed class StepBattleSnapshotService
{
    private readonly IServiceScopeFactory _scopeFactory;
    private readonly IPersistenceManager _persistenceManager;  // â¬…ï¸ æ–°å¢
    
    public StepBattleSnapshotService(
        IServiceScopeFactory scopeFactory,
        IPersistenceManager persistenceManager)  // â¬…ï¸ æ–°å¢å‚æ•°
    {
        _scopeFactory = scopeFactory;
        _persistenceManager = persistenceManager;
    }

    // === ä¿®æ”¹ SaveAsync æ–¹æ³• ===
    
    /// <summary>
    /// ä¿å­˜æˆ˜æ–—å¿«ç…§ï¼ˆä½¿ç”¨æ‰¹é‡æŒä¹…åŒ–ï¼‰
    /// </summary>
    public async Task SaveAsync(RunningBattle rb, CancellationToken ct = default)
    {
        // æ„å»ºå¿«ç…§DTOï¼ˆä¸åŸæ¥ä¸€è‡´ï¼‰
        var dto = new StepBattleSnapshotDto(
            rb.Id,
            rb.CharacterId,
            (int)rb.Profession,
            rb.EnemyId,
            rb.EnemyCount,
            rb.Seed,
            rb.TargetDurationSeconds,
            rb.Clock.CurrentTime,
            rb.Segments.ToList()
        );

        var json = JsonSerializer.Serialize(dto);

        using var scope = _scopeFactory.CreateScope();
        var db = scope.ServiceProvider.GetRequiredService<GameDbContext>();

        // æŸ¥è¯¢æˆ–åˆ›å»ºå¿«ç…§è®°å½•
        var row = await db.Set<RunningBattleSnapshotRecord>()
            .FirstOrDefaultAsync(x => x.StepBattleId == rb.Id, ct);

        if (row is null)
        {
            row = new RunningBattleSnapshotRecord
            {
                Id = Guid.NewGuid(),
                StepBattleId = rb.Id,
                CharacterId = rb.CharacterId,
                Profession = (int)rb.Profession,
                EnemyId = rb.EnemyId,
                EnemyCount = rb.EnemyCount,
                Seed = rb.Seed.ToString(),
                TargetSeconds = rb.TargetDurationSeconds,
                SimulatedSeconds = rb.Clock.CurrentTime,
                UpdatedAtUtc = DateTime.UtcNow,
                SnapshotJson = json
            };
            db.Set<RunningBattleSnapshotRecord>().Add(row);
            
            // â¬‡ï¸ æ–°å¢ï¼šç«‹å³ä¿å­˜æ–°åˆ›å»ºçš„å¿«ç…§ï¼ˆé¦–æ¬¡ï¼‰
            await DatabaseRetryPolicy.SaveChangesWithRetryAsync(db, ct);
        }
        else
        {
            // æ›´æ–°ç°æœ‰å¿«ç…§
            row.CharacterId = rb.CharacterId;
            row.Profession = (int)rb.Profession;
            row.EnemyId = rb.EnemyId;
            row.EnemyCount = rb.EnemyCount;
            row.Seed = rb.Seed.ToString();
            row.TargetSeconds = rb.TargetDurationSeconds;
            row.SimulatedSeconds = rb.Clock.CurrentTime;
            row.UpdatedAtUtc = DateTime.UtcNow;
            row.SnapshotJson = json;

            // â¬‡ï¸ æ–°å¢ï¼šæ ‡è®°ä¸ºè„ï¼Œå»¶è¿Ÿä¿å­˜ï¼ˆé€šè¿‡æ‰¹é‡æŒä¹…åŒ–ï¼‰
            var condition = rb.Completed ? "BattleComplete" : null;
            _persistenceManager.MarkDirty(row, "BattleSnapshot", condition);
            
            // â¬‡ï¸ å¦‚æœæˆ˜æ–—å®Œæˆï¼Œç«‹å³ä¿å­˜
            if (rb.Completed)
            {
                await _persistenceManager.SaveImmediatelyAsync(row, "BattleSnapshot", ct);
            }
        }
    }

    /// <summary>
    /// åˆ é™¤æˆ˜æ–—å¿«ç…§ï¼ˆä¿æŒç«‹å³åˆ é™¤ï¼‰
    /// </summary>
    public async Task DeleteAsync(Guid stepBattleId, CancellationToken ct = default)
    {
        using var scope = _scopeFactory.CreateScope();
        var db = scope.ServiceProvider.GetRequiredService<GameDbContext>();
        
        var row = await db.Set<RunningBattleSnapshotRecord>()
            .FirstOrDefaultAsync(x => x.StepBattleId == stepBattleId, ct);
        
        if (row is not null)
        {
            db.Remove(row);
            // â¬‡ï¸ åˆ é™¤æ“ä½œä¿æŒç«‹å³ä¿å­˜
            await DatabaseRetryPolicy.SaveChangesWithRetryAsync(db, ct);
        }
    }

    // RecoverAllAsync æ–¹æ³•ä¿æŒä¸å˜
}
```

#### Step 5.2: æ›´æ–°å®¿ä¸»æœåŠ¡

**æ–‡ä»¶**: `BlazorIdle.Server/Application/Battles/Step/StepBattleHostedService.cs`

**ä¿®æ”¹ç‚¹**ï¼š

1. ç§»é™¤æ‰‹åŠ¨çš„å®šæ—¶ä¿å­˜é€»è¾‘ï¼ˆç°åœ¨ç”± BatchFlushHostedService å¤„ç†ï¼‰
2. ä¼˜é›…å…³é—­é€»è¾‘ä¿æŒï¼Œä½†ä¾èµ–æ‰¹é‡æŒä¹…åŒ–çš„æœ€ç»ˆåˆ·æ–°

```csharp
// åœ¨ ExecuteAsync çš„ä¸»å¾ªç¯ä¸­ï¼Œç®€åŒ–å¿«ç…§ä¿å­˜é€»è¾‘

// === åŸä»£ç ï¼ˆç§»é™¤ï¼‰ ===
/*
if ((DateTime.UtcNow - lastSnapAt).TotalMilliseconds >= 500)
{
    lastSnapAt = DateTime.UtcNow;
    foreach (var id in _coordinator.InternalIdsSnapshot())
    {
        if (_coordinator.TryGet(id, out var rb) && rb is not null && !rb.Completed)
        {
            if (!SnapshotThrottler.ShouldSkip(...))
            {
                try { await _snapshot.SaveAsync(rb, stoppingToken); }
                catch (Exception ex) { _logger.LogDebug(ex, "Save snapshot failed for {Id}", rb.Id); }
            }
        }
        else if (rb is not null && rb.Completed)
        {
            try { await _snapshot.DeleteAsync(rb.Id, stoppingToken); } 
            catch { }
        }
    }
}
*/

// === æ–°ä»£ç ï¼ˆç®€åŒ–ï¼‰ ===
// å®šæœŸæ£€æŸ¥æˆ˜æ–—å¿«ç…§ï¼Œä½†ä¸å†æ‰‹åŠ¨ä¿å­˜ï¼ˆç”±æ‰¹é‡æŒä¹…åŒ–å¤„ç†ï¼‰
if ((DateTime.UtcNow - lastSnapAt).TotalMilliseconds >= 5000)  // æ”¹ä¸º5ç§’æ£€æŸ¥ä¸€æ¬¡
{
    lastSnapAt = DateTime.UtcNow;
    foreach (var id in _coordinator.InternalIdsSnapshot())
    {
        if (_coordinator.TryGet(id, out var rb) && rb is not null)
        {
            if (!rb.Completed)
            {
                // æ ‡è®°éœ€è¦ä¿å­˜å¿«ç…§ï¼ˆå®é™…ä¿å­˜ç”± BatchFlushHostedService å¤„ç†ï¼‰
                if (!SnapshotThrottler.ShouldSkip(rb.Id, rb.Clock.CurrentTime, SnapshotIntervalSimSeconds))
                {
                    try 
                    { 
                        // â¬‡ï¸ æ–°å¢ï¼šä»…æ„å»ºå¿«ç…§ï¼Œä¸ç«‹å³ä¿å­˜
                        await _snapshot.SaveAsync(rb, stoppingToken); 
                    }
                    catch (Exception ex) 
                    { 
                        _logger.LogDebug(ex, "Mark snapshot dirty failed for {Id}", rb.Id); 
                    }
                }
            }
            else
            {
                // æˆ˜æ–—å®Œæˆï¼Œç«‹å³åˆ é™¤å¿«ç…§ï¼ˆåœ¨ SaveAsync ä¸­å·²å¤„ç†ç«‹å³ä¿å­˜ï¼‰
                try { await _snapshot.DeleteAsync(rb.Id, stoppingToken); } 
                catch { }
            }
        }
    }
}

// === ä¼˜é›…å…³é—­æ–¹æ³•ä¿æŒä¸å˜ ===
// SaveAllRunningBattleSnapshotsAsync æ–¹æ³•ä¿æŒï¼Œä½†å†…éƒ¨ä¼šé€šè¿‡æ‰¹é‡æŒä¹…åŒ–å¤„ç†
```

### 5.4 å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `tests/BlazorIdle.Tests/Application/Battles/Step/StepBattleSnapshotServiceTests.cs`

```csharp
public class StepBattleSnapshotServiceBatchTests
{
    [Fact]
    public async Task SaveAsync_InProgress_ShouldMarkDirty()
    {
        // Arrange
        var persistenceManagerMock = new Mock<IPersistenceManager>();
        var service = CreateService(persistenceManagerMock.Object);
        var rb = CreateRunningBattle(completed: false);

        // Act
        await service.SaveAsync(rb, CancellationToken.None);

        // Assert
        persistenceManagerMock.Verify(
            m => m.MarkDirty(
                It.IsAny<RunningBattleSnapshotRecord>(),
                "BattleSnapshot",
                null),
            Times.Once);
    }

    [Fact]
    public async Task SaveAsync_Completed_ShouldSaveImmediately()
    {
        // Arrange
        var persistenceManagerMock = new Mock<IPersistenceManager>();
        var service = CreateService(persistenceManagerMock.Object);
        var rb = CreateRunningBattle(completed: true);

        // Act
        await service.SaveAsync(rb, CancellationToken.None);

        // Assert
        persistenceManagerMock.Verify(
            m => m.SaveImmediatelyAsync(
                It.IsAny<RunningBattleSnapshotRecord>(),
                "BattleSnapshot",
                It.IsAny<CancellationToken>()),
            Times.Once);
    }

    // æ›´å¤šæµ‹è¯•ç”¨ä¾‹...
}
```

### 5.5 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š10ä¸ªå¹¶å‘æˆ˜æ–—ï¼Œè¿è¡Œ5åˆ†é’Ÿ

**é¢„æœŸç»“æœ**ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ•°æ®åº“å†™å…¥é¢‘ç‡ | 20æ¬¡/ç§’ | 2æ¬¡/ç§’ | â†“ 90% |
| å¿«ç…§ä¿å­˜å»¶è¿Ÿ | 500ms | 5ç§’ | +10å€ï¼ˆå¯æ¥å—ï¼‰ |
| æ•°æ®åº“é”ç­‰å¾… | å¶å‘ | æå°‘ | å¤§å¹…é™ä½ |

### 5.6 éªŒæ”¶æ ‡å‡†

- [ ] æˆ˜æ–—è¿›è¡Œä¸­çš„å¿«ç…§é€šè¿‡æ‰¹é‡æŒä¹…åŒ–ä¿å­˜
- [ ] æˆ˜æ–—å®Œæˆæ—¶å¿«ç…§ç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥90%
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ–°å¢å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥95%
- [ ] æ€§èƒ½æµ‹è¯•è¾¾åˆ°é¢„æœŸç›®æ ‡

---

## Phase 6: è§’è‰²çŠ¶æ€æ‰¹é‡æ›´æ–°

**å·¥ä½œé‡**: 1.5 å¤©  
**ä¼˜å…ˆçº§**: P0  
**é¢„æœŸæ€§èƒ½æå‡**: æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½ 95%

### 6.1 ç°çŠ¶åˆ†æ

**å½“å‰å®ç°** (`CharactersController.cs`)ï¼š

```csharp
[HttpGet("{id}")]
public async Task<IActionResult> GetCharacter(Guid id)
{
    // ...è·å–è§’è‰²...
    
    // âš ï¸ æ¯æ¬¡å¿ƒè·³ï¼ˆ5-10ç§’ï¼‰ç«‹å³æ›´æ–°
    if (character.LastSeenAtUtc.HasValue)
    {
        character.LastSeenAtUtc = DateTime.UtcNow;
        await DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db);  // âš ï¸ ç«‹å³ä¿å­˜
    }
    
    return Ok(...);
}
```

**é—®é¢˜**ï¼š
- 10ä¸ªåœ¨çº¿ç©å®¶ = 1-2æ¬¡/ç§’æ•°æ®åº“å†™å…¥
- å¿ƒè·³ä»…æ›´æ–°æ—¶é—´æˆ³ï¼Œä¸éœ€è¦å®æ—¶æŒä¹…åŒ–

### 6.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆè®¾è®¡

```
åŸæµç¨‹: å¿ƒè·³è¯·æ±‚ â†’ æ›´æ–°æ—¶é—´æˆ³ â†’ ç«‹å³SaveChanges
æ–°æµç¨‹: å¿ƒè·³è¯·æ±‚ â†’ æ›´æ–°æ—¶é—´æˆ³ï¼ˆå†…å­˜ï¼‰ â†’ MarkDirty â†’ (30ç§’å) BatchFlush
```

**å…³é”®è¦ç‚¹**ï¼š
- å¿ƒè·³æ›´æ–°ä¸ç«‹å³ä¿å­˜
- 30ç§’æ‰¹é‡æ›´æ–°æ‰€æœ‰åœ¨çº¿è§’è‰²çŠ¶æ€
- è§’è‰²åˆ›å»º/åˆ é™¤ç­‰å…³é”®æ“ä½œä¿æŒç«‹å³ä¿å­˜

### 6.3 å®æ–½æ­¥éª¤

#### Step 6.1: ä¿®æ”¹è§’è‰²æ§åˆ¶å™¨

**æ–‡ä»¶**: `BlazorIdle.Server/Api/CharactersController.cs`

```csharp
public class CharactersController : ControllerBase
{
    private readonly GameDbContext _db;
    private readonly IPersistenceManager _persistenceManager;  // â¬…ï¸ æ–°å¢
    // ...å…¶ä»–ä¾èµ–...

    public CharactersController(
        GameDbContext db,
        IPersistenceManager persistenceManager,  // â¬…ï¸ æ–°å¢å‚æ•°
        // ...å…¶ä»–å‚æ•°...
        )
    {
        _db = db;
        _persistenceManager = persistenceManager;
        // ...
    }

    /// <summary>
    /// è·å–è§’è‰²ä¿¡æ¯ï¼ˆåŒ…å«å¿ƒè·³æ›´æ–°ï¼‰
    /// </summary>
    [HttpGet("{id}")]
    public async Task<IActionResult> GetCharacter(Guid id)
    {
        var character = await _db.Characters
            .FirstOrDefaultAsync(c => c.Id == id);

        if (character == null)
        {
            return NotFound(new { message = "è§’è‰²ä¸å­˜åœ¨" });
        }

        // ç¦»çº¿ç»“ç®—é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
        if (character.LastSeenAtUtc.HasValue)
        {
            var offlineSeconds = (DateTime.UtcNow - character.LastSeenAtUtc.Value).TotalSeconds;
            
            if (offlineSeconds >= _offlineOptions.OfflineDetectionSeconds)
            {
                await _offlineSettlementService.CheckAndSettleAsync(id);
                character = await _db.Characters.FirstOrDefaultAsync(c => c.Id == id);
                if (character == null) return NotFound();
            }
        }

        // â¬‡ï¸ ä¿®æ”¹ï¼šå¿ƒè·³æ›´æ–°æ”¹ä¸ºæ‰¹é‡æŒä¹…åŒ–
        character.LastSeenAtUtc = DateTime.UtcNow;
        _persistenceManager.MarkDirty(character, "CharacterStatus");
        // âš ï¸ ç§»é™¤ï¼šawait DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db);

        return Ok(new
        {
            character.Id,
            character.Name,
            // ...å…¶ä»–å­—æ®µ...
            timestamp = character.LastSeenAtUtc
        });
    }

    /// <summary>
    /// åˆ›å»ºè§’è‰²ï¼ˆä¿æŒç«‹å³ä¿å­˜ï¼‰
    /// </summary>
    [HttpPost]
    public async Task<IActionResult> CreateCharacter([FromBody] CreateCharacterDto dto)
    {
        // ...éªŒè¯é€»è¾‘...

        var c = new Character
        {
            Id = Guid.NewGuid(),
            UserId = userId,
            // ...å…¶ä»–å­—æ®µ...
        };

        _db.Characters.Add(c);
        // â¬‡ï¸ ä¿æŒç«‹å³ä¿å­˜ï¼ˆå…³é”®æ“ä½œï¼‰
        await DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db);
        
        return Ok(new { c.Id, c.Name, c.RosterOrder });
    }

    /// <summary>
    /// åˆ é™¤è§’è‰²ï¼ˆä¿æŒç«‹å³ä¿å­˜ï¼‰
    /// </summary>
    [HttpDelete("{id}")]
    public async Task<IActionResult> DeleteCharacter(Guid id)
    {
        // ...éªŒè¯å’Œåˆ é™¤é€»è¾‘...
        
        _db.Characters.Remove(character);
        // â¬‡ï¸ ä¿æŒç«‹å³ä¿å­˜ï¼ˆå…³é”®æ“ä½œï¼‰
        await DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db);
        
        return Ok(new { message = "è§’è‰²åˆ é™¤æˆåŠŸ" });
    }

    /// <summary>
    /// æ›´æ–°è§’è‰²æ’åºï¼ˆå¯å»¶è¿Ÿä¿å­˜ï¼‰
    /// </summary>
    [HttpPut("{id}/roster-order")]
    public async Task<IActionResult> UpdateRosterOrder(Guid id, [FromBody] UpdateRosterOrderDto dto)
    {
        // ...éªŒè¯é€»è¾‘...

        character.RosterOrder = dto.RosterOrder;
        
        // â¬‡ï¸ ä¿®æ”¹ï¼šæ”¹ä¸ºæ‰¹é‡æŒä¹…åŒ–ï¼ˆéå…³é”®æ“ä½œï¼‰
        _persistenceManager.MarkDirty(character, "CharacterStatus");
        // âš ï¸ ç§»é™¤ï¼šawait DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db);
        
        return Ok(new { message = "è§’è‰²é¡ºåºè°ƒæ•´æˆåŠŸ" });
    }
}
```

#### Step 6.2: å¤„ç†EF Coreè¿½è¸ªé—®é¢˜

**é—®é¢˜**ï¼š`MarkDirty` çš„å®ä½“å¯èƒ½ä¸åœ¨å½“å‰ DbContext çš„è¿½è¸ªä¸­

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `PersistenceManager` ä¸­å¤„ç†å®ä½“é™„åŠ 

```csharp
// åœ¨ PersistenceManager.SaveCategoryEntriesAsync ä¸­å·²å¤„ç†ï¼š

foreach (var entry in entries)
{
    var entityEntry = db.Entry(entry.Entity);
    if (entityEntry.State == EntityState.Detached)
    {
        db.Attach(entry.Entity);          // é™„åŠ åˆ°ä¸Šä¸‹æ–‡
        entityEntry.State = EntityState.Modified;  // æ ‡è®°ä¸ºå·²ä¿®æ”¹
    }
}
```

### 6.4 å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `tests/BlazorIdle.Tests/Api/CharactersControllerBatchTests.cs`

```csharp
public class CharactersControllerBatchTests
{
    [Fact]
    public async Task GetCharacter_Heartbeat_ShouldMarkDirty()
    {
        // Arrange
        var persistenceManagerMock = new Mock<IPersistenceManager>();
        var controller = CreateController(persistenceManagerMock.Object);
        var characterId = Guid.NewGuid();

        // Act
        await controller.GetCharacter(characterId);

        // Assert
        persistenceManagerMock.Verify(
            m => m.MarkDirty(
                It.IsAny<Character>(),
                "CharacterStatus",
                null),
            Times.Once);
    }

    [Fact]
    public async Task CreateCharacter_ShouldSaveImmediately()
    {
        // Arrange
        var controller = CreateController();
        var dto = new CreateCharacterDto { Name = "TestChar" };

        // Act
        await controller.CreateCharacter(dto);

        // Assert
        // éªŒè¯æ•°æ®åº“ä¸­å­˜åœ¨è§’è‰²
        var character = await _db.Characters.FirstOrDefaultAsync(c => c.Name == "TestChar");
        Assert.NotNull(character);
    }

    // æ›´å¤šæµ‹è¯•ç”¨ä¾‹...
}
```

### 6.5 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š10ä¸ªåœ¨çº¿ç©å®¶ï¼Œæ¯5ç§’å¿ƒè·³ä¸€æ¬¡ï¼Œè¿è¡Œ5åˆ†é’Ÿ

**é¢„æœŸç»“æœ**ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ•°æ®åº“å†™å…¥é¢‘ç‡ | 2æ¬¡/ç§’ | 0.1æ¬¡/ç§’ | â†“ 95% |
| å¿ƒè·³å“åº”å»¶è¿Ÿ | 10ms | 5ms | â†“ 50% |
| è§’è‰²çŠ¶æ€æ›´æ–°å»¶è¿Ÿ | å®æ—¶ | 30ç§’ | +30ç§’ï¼ˆå¯æ¥å—ï¼‰ |

### 6.6 éªŒæ”¶æ ‡å‡†

- [ ] å¿ƒè·³æ›´æ–°ä¸ç«‹å³ä¿å­˜åˆ°æ•°æ®åº“
- [ ] è§’è‰²çŠ¶æ€å®šæœŸæ‰¹é‡æ›´æ–°ï¼ˆ30ç§’ï¼‰
- [ ] è§’è‰²åˆ›å»º/åˆ é™¤ç­‰å…³é”®æ“ä½œä¿æŒç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥95%
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ–°å¢å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥95%

---

## Phase 7: æ´»åŠ¨è®¡åˆ’æ‰¹é‡æŒä¹…åŒ–

**å·¥ä½œé‡**: 1 å¤©  
**ä¼˜å…ˆçº§**: P1  
**é¢„æœŸæ€§èƒ½æå‡**: æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½ 80%

### 7.1 ç°çŠ¶åˆ†æ

**å½“å‰å®ç°** (`ActivityPlanRepository.cs`)ï¼š

```csharp
public async Task UpdateAsync(ActivityPlan plan, CancellationToken ct = default)
{
    _db.ActivityPlans.Update(plan);
    await DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db, ct);  // âš ï¸ ç«‹å³ä¿å­˜
}
```

**é—®é¢˜**ï¼š
- æ´»åŠ¨çŠ¶æ€å˜æ›´ï¼ˆRunning â†’ Completedï¼‰ç«‹å³ä¿å­˜
- é«˜é¢‘æ´»åŠ¨åˆ‡æ¢æ—¶æ•°æ®åº“å‹åŠ›å¤§

### 7.2 ä¼˜åŒ–æ–¹æ¡ˆ

```
åŸæµç¨‹: çŠ¶æ€å˜æ›´ â†’ UpdateAsync â†’ ç«‹å³SaveChanges
æ–°æµç¨‹: çŠ¶æ€å˜æ›´ â†’ UpdateAsync â†’ MarkDirty â†’ (10ç§’å) BatchFlush
```

**ç‰¹æ®Šæƒ…å†µ**ï¼š
- æ´»åŠ¨åˆ›å»ºï¼šç«‹å³ä¿å­˜
- æ´»åŠ¨åˆ é™¤ï¼šç«‹å³ä¿å­˜
- çŠ¶æ€å˜æ›´ï¼šå»¶è¿Ÿä¿å­˜

### 7.3 å®æ–½æ­¥éª¤

#### Step 7.1: ä¿®æ”¹æ´»åŠ¨è®¡åˆ’ä»“å‚¨

**æ–‡ä»¶**: `BlazorIdle.Server/Infrastructure/Persistence/Repositories/ActivityPlanRepository.cs`

```csharp
public class ActivityPlanRepository : IActivityPlanRepository
{
    private readonly GameDbContext _db;
    private readonly IPersistenceManager _persistenceManager;  // â¬…ï¸ æ–°å¢

    public ActivityPlanRepository(
        GameDbContext db,
        IPersistenceManager persistenceManager)  // â¬…ï¸ æ–°å¢å‚æ•°
    {
        _db = db;
        _persistenceManager = persistenceManager;
    }

    /// <summary>
    /// åˆ›å»ºæ´»åŠ¨è®¡åˆ’ï¼ˆä¿æŒç«‹å³ä¿å­˜ï¼‰
    /// </summary>
    public async Task AddAsync(ActivityPlan plan, CancellationToken ct = default)
    {
        _db.ActivityPlans.Add(plan);
        // â¬‡ï¸ ä¿æŒç«‹å³ä¿å­˜ï¼ˆå…³é”®æ“ä½œï¼‰
        await Persistence.DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db, ct);
    }

    /// <summary>
    /// æ›´æ–°æ´»åŠ¨è®¡åˆ’ï¼ˆæ”¹ä¸ºæ‰¹é‡æŒä¹…åŒ–ï¼‰
    /// </summary>
    public async Task UpdateAsync(ActivityPlan plan, CancellationToken ct = default)
    {
        _db.ActivityPlans.Update(plan);
        
        // â¬‡ï¸ ä¿®æ”¹ï¼šæ”¹ä¸ºæ‰¹é‡æŒä¹…åŒ–
        _persistenceManager.MarkDirty(plan, "ActivityPlan");
        
        // âš ï¸ ç§»é™¤ï¼šawait Persistence.DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db, ct);
        
        // æ³¨æ„ï¼šæ–¹æ³•ç­¾åä¿æŒ async Taskï¼Œä»¥ä¿æŒæ¥å£å…¼å®¹æ€§
        await Task.CompletedTask;
    }

    /// <summary>
    /// åˆ é™¤æ´»åŠ¨è®¡åˆ’ï¼ˆä¿æŒç«‹å³ä¿å­˜ï¼‰
    /// </summary>
    public async Task DeleteAsync(Guid id, CancellationToken ct = default)
    {
        var plan = await _db.ActivityPlans.FirstOrDefaultAsync(p => p.Id == id, ct);
        if (plan != null)
        {
            _db.ActivityPlans.Remove(plan);
            // â¬‡ï¸ ä¿æŒç«‹å³ä¿å­˜ï¼ˆå…³é”®æ“ä½œï¼‰
            await Persistence.DatabaseRetryPolicy.SaveChangesWithRetryAsync(_db, ct);
        }
    }

    // å…¶ä»–æŸ¥è¯¢æ–¹æ³•ä¿æŒä¸å˜
}
```

### 7.4 å•å…ƒæµ‹è¯•

```csharp
public class ActivityPlanRepositoryBatchTests
{
    [Fact]
    public async Task UpdateAsync_ShouldMarkDirty()
    {
        // Arrange
        var persistenceManagerMock = new Mock<IPersistenceManager>();
        var repo = CreateRepository(persistenceManagerMock.Object);
        var plan = new ActivityPlan { Id = Guid.NewGuid(), State = ActivityState.Running };

        // Act
        await repo.UpdateAsync(plan);

        // Assert
        persistenceManagerMock.Verify(
            m => m.MarkDirty(plan, "ActivityPlan", null),
            Times.Once);
    }

    // æ›´å¤šæµ‹è¯•ç”¨ä¾‹...
}
```

### 7.5 éªŒæ”¶æ ‡å‡†

- [ ] æ´»åŠ¨è®¡åˆ’çŠ¶æ€æ›´æ–°ä¸ç«‹å³ä¿å­˜
- [ ] æ´»åŠ¨è®¡åˆ’å®šæœŸæ‰¹é‡æ›´æ–°ï¼ˆ10ç§’ï¼‰
- [ ] æ´»åŠ¨åˆ›å»º/åˆ é™¤ä¿æŒç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥80%
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## Phase 8: è£…å¤‡æ“ä½œæ‰¹é‡æŒä¹…åŒ–

**å·¥ä½œé‡**: 0.5 å¤©  
**ä¼˜å…ˆçº§**: P1  
**é¢„æœŸæ€§èƒ½æå‡**: æ‰¹é‡æ“ä½œæ€§èƒ½æå‡ Nå€

### 8.1 ç°çŠ¶åˆ†æ

**å½“å‰å®ç°** (`GearInstanceRepository.cs`)ï¼š

```csharp
public async Task CreateBatchAsync(IEnumerable<GearInstance> instances, CancellationToken ct = default)
{
    var now = DateTime.UtcNow;
    foreach (var instance in instances)
    {
        instance.UpdatedAt = now;
    }
    _db.GearInstances.AddRange(instances);
    await _db.SaveChangesAsync(ct);  // âœ… å·²ç»æ˜¯æ‰¹é‡ä¿å­˜
}

public async Task UpdateAsync(GearInstance instance, CancellationToken ct = default)
{
    instance.UpdatedAt = DateTime.UtcNow;
    _db.GearInstances.Update(instance);
    await _db.SaveChangesAsync(ct);  // âš ï¸ ç«‹å³ä¿å­˜
}
```

**é—®é¢˜**ï¼š
- å•ä¸ªè£…å¤‡æ“ä½œç«‹å³ä¿å­˜
- æ‰¹é‡åˆ›å»ºå·²ä¼˜åŒ–ï¼Œæ— éœ€ä¿®æ”¹

### 8.2 ä¼˜åŒ–æ–¹æ¡ˆ

```
å•ä¸ªæ›´æ–°: MarkDirty â†’ å»¶è¿Ÿä¿å­˜ï¼ˆ5ç§’ï¼‰
å…³é”®æ“ä½œï¼ˆè´­ä¹°ã€åˆ†è§£ï¼‰: SaveImmediately
```

### 8.3 å®æ–½æ­¥éª¤

#### Step 8.1: ä¿®æ”¹è£…å¤‡ä»“å‚¨

**æ–‡ä»¶**: `BlazorIdle.Server/Infrastructure/Persistence/Repositories/GearInstanceRepository.cs`

```csharp
public class GearInstanceRepository : IGearInstanceRepository
{
    private readonly GameDbContext _db;
    private readonly IPersistenceManager _persistenceManager;  // â¬…ï¸ æ–°å¢

    public GearInstanceRepository(
        GameDbContext db,
        IPersistenceManager persistenceManager)
    {
        _db = db;
        _persistenceManager = persistenceManager;
    }

    /// <summary>
    /// åˆ›å»ºå•ä¸ªè£…å¤‡ï¼ˆæ”¹ä¸ºç«‹å³+æ‰¹é‡æ··åˆæ¨¡å¼ï¼‰
    /// </summary>
    public async Task CreateAsync(GearInstance instance, CancellationToken ct = default)
    {
        instance.UpdatedAt = DateTime.UtcNow;
        _db.GearInstances.Add(instance);
        
        // â¬‡ï¸ å…³é”®æ“ä½œï¼Œç«‹å³ä¿å­˜
        await _persistenceManager.SaveImmediatelyAsync(instance, "Equipment", ct);
    }

    /// <summary>
    /// æ›´æ–°è£…å¤‡ï¼ˆæ”¹ä¸ºæ‰¹é‡æŒä¹…åŒ–ï¼‰
    /// </summary>
    public async Task UpdateAsync(GearInstance instance, string? operation = null, CancellationToken ct = default)
    {
        instance.UpdatedAt = DateTime.UtcNow;
        _db.GearInstances.Update(instance);
        
        // â¬‡ï¸ ä¿®æ”¹ï¼šå»¶è¿Ÿä¿å­˜æˆ–ç«‹å³ä¿å­˜ï¼ˆæ ¹æ®æ“ä½œç±»å‹ï¼‰
        if (operation != null && IsImmediateOperation(operation))
        {
            await _persistenceManager.SaveImmediatelyAsync(instance, "Equipment", ct);
        }
        else
        {
            _persistenceManager.MarkDirty(instance, "Equipment", operation);
            await Task.CompletedTask;
        }
    }

    /// <summary>
    /// æ‰¹é‡åˆ›å»ºï¼ˆä¿æŒç°æœ‰å®ç°ï¼Œå·²ä¼˜åŒ–ï¼‰
    /// </summary>
    public async Task CreateBatchAsync(IEnumerable<GearInstance> instances, CancellationToken ct = default)
    {
        var now = DateTime.UtcNow;
        foreach (var instance in instances)
        {
            instance.UpdatedAt = now;
        }
        _db.GearInstances.AddRange(instances);
        await _db.SaveChangesAsync(ct);  // âœ… ä¿æŒæ‰¹é‡ä¿å­˜
    }

    /// <summary>
    /// åˆ é™¤è£…å¤‡ï¼ˆä¿æŒç«‹å³ä¿å­˜ï¼‰
    /// </summary>
    public async Task DeleteAsync(Guid id, CancellationToken ct = default)
    {
        var instance = await _db.GearInstances.FirstOrDefaultAsync(g => g.Id == id, ct);
        if (instance != null)
        {
            _db.GearInstances.Remove(instance);
            await _db.SaveChangesAsync(ct);  // â¬‡ï¸ ä¿æŒç«‹å³ä¿å­˜
        }
    }

    // === ç§æœ‰è¾…åŠ©æ–¹æ³• ===

    private static bool IsImmediateOperation(string operation)
    {
        // æ ¹æ®é…ç½®åˆ¤æ–­æ˜¯å¦éœ€è¦ç«‹å³ä¿å­˜
        return operation is "Purchase" or "Disenchant" or "Reforge";
    }
}
```

#### Step 8.2: æ›´æ–°æ¥å£

**æ–‡ä»¶**: `BlazorIdle.Server/Application/Abstractions/IGearInstanceRepository.cs`

```csharp
public interface IGearInstanceRepository
{
    // ...ç°æœ‰æ–¹æ³•...
    
    /// <summary>
    /// æ›´æ–°è£…å¤‡å®ä¾‹
    /// </summary>
    /// <param name="instance">è£…å¤‡å®ä¾‹</param>
    /// <param name="operation">æ“ä½œç±»å‹ï¼ˆå¯é€‰ï¼Œå¦‚ "Purchase", "Disenchant"ï¼‰</param>
    /// <param name="ct">å–æ¶ˆä»¤ç‰Œ</param>
    Task UpdateAsync(GearInstance instance, string? operation = null, CancellationToken ct = default);  // â¬…ï¸ æ–°å¢ operation å‚æ•°
}
```

### 8.4 éªŒæ”¶æ ‡å‡†

- [ ] è£…å¤‡ç©¿è„±ç­‰å¸¸è§„æ“ä½œå»¶è¿Ÿä¿å­˜
- [ ] è´­ä¹°ã€åˆ†è§£ç­‰å…³é”®æ“ä½œç«‹å³ä¿å­˜
- [ ] æ‰¹é‡åˆ›å»ºè£…å¤‡æ€§èƒ½ä¿æŒï¼ˆå·²ä¼˜åŒ–ï¼‰
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ä¸­ç¯‡æ€»ç»“ä¸éªŒæ”¶

### å®Œæˆæƒ…å†µæ£€æŸ¥æ¸…å•

#### Phase 5: æˆ˜æ–—å¿«ç…§ âœ…
- [ ] æˆ˜æ–—è¿›è¡Œä¸­çš„å¿«ç…§æ‰¹é‡ä¿å­˜
- [ ] æˆ˜æ–—å®Œæˆæ—¶å¿«ç…§ç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥90%
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡

#### Phase 6: è§’è‰²çŠ¶æ€ âœ…
- [ ] å¿ƒè·³æ›´æ–°ä¸ç«‹å³ä¿å­˜
- [ ] è§’è‰²çŠ¶æ€å®šæœŸæ‰¹é‡æ›´æ–°
- [ ] å…³é”®æ“ä½œä¿æŒç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥95%
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

#### Phase 7: æ´»åŠ¨è®¡åˆ’ âœ…
- [ ] æ´»åŠ¨çŠ¶æ€æ›´æ–°å»¶è¿Ÿä¿å­˜
- [ ] æ´»åŠ¨åˆ›å»º/åˆ é™¤ç«‹å³ä¿å­˜
- [ ] æ•°æ®åº“å†™å…¥é¢‘ç‡é™ä½â‰¥80%
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

#### Phase 8: è£…å¤‡æ“ä½œ âœ…
- [ ] å¸¸è§„æ“ä½œå»¶è¿Ÿä¿å­˜
- [ ] å…³é”®æ“ä½œç«‹å³ä¿å­˜
- [ ] æ‰¹é‡æ“ä½œæ€§èƒ½ä¿æŒ
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

### ç»¼åˆæ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š10ä¸ªåœ¨çº¿ç©å®¶ï¼Œå„æœ‰1ä¸ªæˆ˜æ–—ï¼Œè¿è¡Œ10åˆ†é’Ÿ

**é¢„æœŸç»“æœ**ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ€»æ•°æ®åº“å†™å…¥é¢‘ç‡ | 22æ¬¡/ç§’ | 2æ¬¡/ç§’ | â†“ 91% |
| æˆ˜æ–—å¿«ç…§å†™å…¥ | 20æ¬¡/ç§’ | 2æ¬¡/ç§’ | â†“ 90% |
| è§’è‰²çŠ¶æ€å†™å…¥ | 2æ¬¡/ç§’ | 0.1æ¬¡/ç§’ | â†“ 95% |
| æ´»åŠ¨è®¡åˆ’å†™å…¥ | 0.5æ¬¡/ç§’ | 0.1æ¬¡/ç§’ | â†“ 80% |
| æ•°æ®åº“é”ç­‰å¾… | å¶å‘ | æå°‘ | å¤§å¹…é™ä½ |

### æ–‡æ¡£äº¤ä»˜

- [ ] **ä¸­ç¯‡å®æ–½æ€»ç»“.md** - è®°å½•å®æ–½è¿‡ç¨‹å’Œç»éªŒ
- [ ] **ä¸šåŠ¡æ¨¡å—é›†æˆæŒ‡å—.md** - å…¶ä»–æ¨¡å—é›†æˆå‚è€ƒ
- [ ] **æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š.md** - è¯¦ç»†çš„æ€§èƒ½æµ‹è¯•æ•°æ®

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ä¸­ç¯‡å®Œæˆåï¼Œå¯ä»¥è¿›å…¥**ä¸‹ç¯‡**ï¼šä¼˜é›…å…³é—­å¢å¼ºä¸æœ€ç»ˆä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š
- ä¼˜é›…å…³é—­æ—¶æ‰¹é‡æ›´æ–°æ‰€æœ‰è§’è‰²ä¸ºç¦»çº¿çŠ¶æ€
- æ€§èƒ½è°ƒä¼˜å’Œç›‘æ§å¢å¼º
- é…ç½®å‚æ•°è°ƒä¼˜
- æœ€ç»ˆéªŒæ”¶å’Œæ–‡æ¡£å®Œå–„

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-17  
**é¢„è®¡å®Œæˆ**: ä¸­ç¯‡å®æ–½éœ€ 5-7 å·¥ä½œæ—¥  
**çŠ¶æ€**: ğŸ“— å®æ–½æ–¹æ¡ˆå®Œæˆï¼Œå¾…æ‰§è¡Œ
