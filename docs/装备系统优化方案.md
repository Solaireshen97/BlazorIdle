# BlazorIdle è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç±»å‹**: è®¾è®¡æ–¹æ¡ˆ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-10  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰çŠ¶æ€åˆ†æ](#1-å½“å‰çŠ¶æ€åˆ†æ)
2. [è®¾è®¡ç›®æ ‡ä¸åŸåˆ™](#2-è®¾è®¡ç›®æ ‡ä¸åŸåˆ™)
3. [è£…å¤‡ç³»ç»Ÿæ¶æ„è®¾è®¡](#3-è£…å¤‡ç³»ç»Ÿæ¶æ„è®¾è®¡)
4. [è¯¦ç»†æ‰§è¡Œæ­¥éª¤](#4-è¯¦ç»†æ‰§è¡Œæ­¥éª¤)
5. [æ•°æ®æ¨¡å‹è®¾è®¡](#5-æ•°æ®æ¨¡å‹è®¾è®¡)
6. [ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ](#6-ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ)
7. [æŠ€æœ¯å®ç°è¦ç‚¹](#7-æŠ€æœ¯å®ç°è¦ç‚¹)
8. [é£é™©ä¸æŒ‘æˆ˜](#8-é£é™©ä¸æŒ‘æˆ˜)

---

## 1. å½“å‰çŠ¶æ€åˆ†æ

### 1.1 å·²å®Œæˆçš„å·¥ä½œ

æ ¹æ®é¡¹ç›®æ–‡æ¡£åˆ†æï¼Œè£…å¤‡ç³»ç»ŸUIæ¡†æ¶å·²åœ¨ **Step 5** å®Œæˆï¼š

#### âœ… å·²å®ç°éƒ¨åˆ†

1. **å‰ç«¯UIæ¡†æ¶** (`EquipmentPanel.razor`)
   - 9ä¸ªè£…å¤‡æ§½ä½UIï¼ˆå¤´ç›”/æ­¦å™¨/èƒ¸ç”²/å‰¯æ‰‹/è…°å¸¦/è…¿éƒ¨/é‹å­/é¥°å“1/é¥°å“2ï¼‰
   - æ€»å±æ€§å±•ç¤ºé¢æ¿
   - å“è´¨é¢œè‰²ç³»ç»Ÿï¼ˆæ™®é€š/ç¨€æœ‰/å²è¯—/ä¼ è¯´ï¼‰
   - è£…å¤‡æ§½ä½å¸ƒå±€ï¼ˆ3x3ç½‘æ ¼ï¼‰

2. **æ•°æ®æ¨¡å‹å®šä¹‰** (`ApiModels.cs`)
   - `EquipmentResponse`: è£…å¤‡æ å“åº”
   - `EquipmentSlotDto`: è£…å¤‡æ§½
   - `GearInstanceDto`: è£…å¤‡å®ä¾‹
   - `AffixDto`: è£…å¤‡è¯æ¡

3. **APIæ¥å£é¢„ç•™** (`EquipmentController.cs`)
   - `GET /api/equipment/{characterId}` - è·å–è£…å¤‡æ ï¼ˆè¿”å›ç©ºæ§½ï¼‰
   - `POST /api/equipment/{characterId}/{slot}` - è£…å¤‡ç‰©å“ï¼ˆè¿”å›501ï¼‰
   - `DELETE /api/equipment/{characterId}/{slot}` - å¸ä¸‹è£…å¤‡ï¼ˆè¿”å›501ï¼‰
   - `GET /api/equipment/{characterId}/stats` - è·å–è£…å¤‡å±æ€§ï¼ˆè¿”å›é›¶å±æ€§ï¼‰

4. **æµ‹è¯•è¦†ç›–**
   - 18ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
   - è¦†ç›–æ§½ä½ç±»å‹ã€å“è´¨ã€å±æ€§ç­‰æ ¸å¿ƒåŠŸèƒ½

#### âŒ ç¼ºå¤±éƒ¨åˆ†

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬13èŠ‚å’Œç°æœ‰ä»£ç åˆ†æï¼š

1. **é¢†åŸŸæ¨¡å‹å±‚**
   - âŒ è£…å¤‡å®šä¹‰è¡¨ï¼ˆGearDefinitionï¼‰
   - âŒ è£…å¤‡å®ä¾‹è¡¨ï¼ˆGearInstanceï¼‰
   - âŒ è£…å¤‡è¯æ¡ç³»ç»Ÿï¼ˆAffixï¼‰
   - âŒ å¥—è£…ç³»ç»Ÿï¼ˆGearSetï¼‰

2. **æ ¸å¿ƒåŠŸèƒ½**
   - âŒ è£…å¤‡ç”Ÿæˆé€»è¾‘ï¼ˆå“è´¨/Tier/è¯æ¡éšæœºï¼‰
   - âŒ è£…å¤‡æ‰è½ç³»ç»Ÿï¼ˆé›†æˆåˆ°Economyï¼‰
   - âŒ è£…å¤‡/å¸ä¸‹æ“ä½œ
   - âŒ è£…å¤‡å±æ€§è®¡ç®—ä¸æ±‡æ€»
   - âŒ è£…å¤‡å¯¹æ¯”åŠŸèƒ½

3. **å¢å¼ºåŠŸèƒ½**
   - âŒ è£…å¤‡åˆ†è§£ï¼ˆDisenchantServiceï¼‰
   - âŒ è£…å¤‡é‡é“¸ï¼ˆå“çº§æå‡ï¼‰
   - âŒ è¯æ¡é‡ç½®ï¼ˆReroll Affixesï¼‰
   - âŒ å¥—è£…æ•ˆæœè®¡ç®—

4. **æˆ˜æ–—é›†æˆ**
   - âŒ è£…å¤‡å±æ€§æ³¨å…¥åˆ° CharacterStats
   - âŒ è£…å¤‡å±æ€§å‚ä¸æˆ˜æ–—è®¡ç®—
   - âŒ è£…å¤‡ç‰¹æ•ˆ/è§¦å‘æŠ€èƒ½

### 1.2 ç°æœ‰ç³»ç»Ÿèƒ½åŠ›è¯„ä¼°

#### å¯å¤ç”¨çš„ç³»ç»Ÿ

1. **ç»æµç³»ç»Ÿ** (`Domain/Combat/Economy/`)
   - âœ… `EconomyRegistry`: ç‰©å“æ³¨å†Œä¸­å¿ƒ
   - âœ… `LootTable`: æ‰è½è¡¨ç³»ç»Ÿ
   - âœ… `EconomyCalculator`: æ‰è½è®¡ç®—å™¨
   - âœ… `RewardGrantService`: å¥–åŠ±å‘æ”¾æœåŠ¡
   - âœ… `InventoryItem`: èƒŒåŒ…ç‰©å“è¡¨
   - **å¯æ‰©å±•**: å°†è£…å¤‡ä½œä¸ºç‰¹æ®Šç‰©å“ç±»å‹é›†æˆ

2. **æˆ˜æ–—ç³»ç»Ÿ** (`Domain/Combat/`)
   - âœ… `CharacterStats`: è§’è‰²å±æ€§ï¼ˆæ”»å‡»/æš´å‡»/æ€¥é€Ÿ/ç©¿é€ï¼‰
   - âœ… `PlayerCombatant`: ç©å®¶æˆ˜æ–—å•ä½
   - âœ… `StatsBuilder`: å±æ€§æ„å»ºå™¨
   - âœ… `BuffManager`: Buffç®¡ç†ï¼ˆå¯ç”¨äºå¥—è£…æ•ˆæœï¼‰
   - **éœ€é›†æˆ**: è£…å¤‡å±æ€§è®¡ç®—æ³¨å…¥åˆ°å±æ€§æ„å»ºæµç¨‹

3. **è§’è‰²ç³»ç»Ÿ** (`Domain/Characters/`)
   - âœ… `Character`: è§’è‰²å®ä½“ï¼ˆä¸»å±æ€§/ç­‰çº§/èŒä¸šï¼‰
   - âœ… `PrimaryAttributes`: ä¸»å±æ€§ï¼ˆåŠ›é‡/æ•æ·/æ™ºåŠ›/è€åŠ›ï¼‰
   - âœ… `ProfessionBaseStatsRegistry`: èŒä¸šåŸºç¡€å±æ€§
   - **éœ€æ‰©å±•**: å…³è”è£…å¤‡å®ä¾‹

4. **æ•°æ®æŒä¹…åŒ–** (`Infrastructure/Persistence/`)
   - âœ… `GameDbContext`: EF Core æ•°æ®åº“ä¸Šä¸‹æ–‡
   - âœ… é…ç½®ç±»æ¨¡å¼ï¼ˆ`*Configuration.cs`ï¼‰
   - âœ… è¿ç§»æœºåˆ¶
   - **éœ€æ·»åŠ **: è£…å¤‡ç›¸å…³è¡¨é…ç½®

### 1.3 è®¾è®¡å‚è€ƒ

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬13èŠ‚ï¼š

```
## 13. è£…å¤‡ä¸ç‰©å“ç”Ÿæ€ï¼ˆå“çº§ / è¯æ¡ / å¥—è£… / åˆ†è§£ / é‡é“¸ï¼‰

| è®¾è®¡ç‚¹ | å†…å®¹ |
|--------|------|
| GearDefinition | åŸºç¡€å±æ€§èŒƒå›´ / å…è®¸è¯æ¡æ±  / slot / ç¨€æœ‰åº¦æƒé‡ |
| GearInstance | defId + tier(T1/T2/T3) + affixes[] + setId + qualityScore |
| Tier ç³»æ•° | T1=0.8 / T2=1.0 / T3=1.2ï¼ˆå¯é…ç½®ï¼‰ |
| Affix | id, type (Flat/Percent/Proc), rollRange, rarityWeight |
| å¥—è£… | setId + pieceBonuses + activeCount |
| åˆ†è§£ (Disenchant) | è¾“å…¥ï¼šè£…å¤‡ â†’ ææ–™ï¼ˆæŒ‰ tier/rarityï¼‰ |
| å“çº§é‡é“¸ (ReforgeTier) | æ¶ˆè€—ï¼šææ–™+é‡‘å¸ â†’ +Tier |
| è¯æ¡é‡ç½® (Reroll) | é‡ç”Ÿæˆ affixesï¼›æˆæœ¬é€’å¢ / ä¿åº•æœºåˆ¶ |
| è¯æ¡é‡é“¸ (Refine Future) | ç²¾ç‚¼æŒ‡å®š affix å°å¹…æå‡ |
| è£…å¤‡æŠ€èƒ½/ç‰¹æ•ˆ | ç‰¹æ®Šæ ‡ç­¾ï¼šåœ¨äº‹ä»¶é’©å­ (OnHit/OnCast) æ³¨å†Œ |

æ•°å€¼ç®¡çº¿ (é˜²è†¨èƒ€)ï¼š  
final = clamp(((base + Î£Additive) * Î (1+Mult)) + Î£FinalAdd)  
é™åˆ¶ï¼šMult æºæ•°æ§åˆ¶ï¼›æ”»é€Ÿä¸‹é™ï¼›æš´å‡»ä¸Šé™ã€‚
```

---

## 2. è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### 2.1 æ ¸å¿ƒç›®æ ‡

1. **å®Œå–„æœåŠ¡ç«¯è£…å¤‡åŠŸèƒ½**
   - å®ç°è£…å¤‡ç”Ÿæˆã€æ‰è½ã€è£…å¤‡/å¸ä¸‹ã€å±æ€§è®¡ç®—
   - é›†æˆåˆ°æˆ˜æ–—ç³»ç»Ÿå’Œç»æµç³»ç»Ÿ
   - æ”¯æŒè£…å¤‡å¢å¼ºï¼ˆåˆ†è§£/é‡é“¸/è¯æ¡é‡ç½®ï¼‰

2. **å®ç°å‰ç«¯è£…å¤‡ç®¡ç†**
   - å®Œå–„è£…å¤‡é¢æ¿åŠŸèƒ½
   - å®ç°è£…å¤‡å¯¹æ¯”ã€ç­›é€‰ã€æ’åº
   - æä¾›ç›´è§‚çš„è£…å¤‡æ“ä½œç•Œé¢

3. **ä¿æŒç³»ç»Ÿä¸€è‡´æ€§**
   - éµå¾ªç°æœ‰ä»£ç é£æ ¼
   - å¤ç”¨ç°æœ‰ç³»ç»Ÿèƒ½åŠ›
   - ä¿æŒæ•°æ®é©±åŠ¨è®¾è®¡
   - ç»´æŠ¤å‘åå…¼å®¹æ€§

### 2.2 è®¾è®¡åŸåˆ™

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬3èŠ‚æ¶æ„åŸåˆ™ï¼š

1. **æœåŠ¡ç«¯æƒå¨** (Server Authoritative)
   - æ‰€æœ‰è£…å¤‡æ“ä½œåœ¨æœåŠ¡ç«¯éªŒè¯
   - è£…å¤‡å±æ€§è®¡ç®—åœ¨æœåŠ¡ç«¯å®Œæˆ
   - é˜²æ­¢å®¢æˆ·ç«¯ä½œå¼Š

2. **æ•°æ®é©±åŠ¨** (Data-Driven)
   - è£…å¤‡å®šä¹‰é…ç½®åŒ–ï¼ˆJSON/æ•°æ®è¡¨ï¼‰
   - è¯æ¡æ± ã€æ‰è½è¡¨é…ç½®åŒ–
   - ä¾¿äºå¹³è¡¡è°ƒæ•´å’Œå†…å®¹æ‰©å±•

3. **é¢†åŸŸé©±åŠ¨è®¾è®¡** (DDD)
   - æ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œï¼ˆEquipment / Economy / Combatï¼‰
   - èšåˆæ ¹æ¨¡å¼ï¼ˆGearInstance ä½œä¸ºèšåˆæ ¹ï¼‰
   - é¢†åŸŸäº‹ä»¶ä¼ æ’­ï¼ˆEquipmentChanged / StatsRecalculatedï¼‰

4. **å¯æµ‹è¯•æ€§** (Testability)
   - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
   - å¯æ³¨å…¥ä¾èµ–ï¼ˆRNG / Repositoryï¼‰
   - å¹‚ç­‰æ€§ä¿è¯

5. **æ€§èƒ½ä¼˜åŒ–**
   - å±æ€§è®¡ç®—ç¼“å­˜
   - æ‡’åŠ è½½è£…å¤‡æ•°æ®
   - æ‰¹é‡æ“ä½œæ”¯æŒ

6. **å®‰å…¨æ€§**
   - è£…å¤‡æ“ä½œé™é¢‘
   - äº¤æ˜“éªŒè¯ï¼ˆé˜²æ­¢åˆ·è£…å¤‡ï¼‰
   - è£…å¤‡ç»‘å®šæœºåˆ¶

---

## 3. è£…å¤‡ç³»ç»Ÿæ¶æ„è®¾è®¡

### 3.1 æ¨¡å—åˆ’åˆ†

```
BlazorIdle.Server/Domain/Equipment/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ GearDefinition.cs          # è£…å¤‡å®šä¹‰ï¼ˆé…ç½®ï¼‰
â”‚   â”œâ”€â”€ GearInstance.cs            # è£…å¤‡å®ä¾‹ï¼ˆè¿è¡Œæ—¶ï¼‰
â”‚   â”œâ”€â”€ Affix.cs                   # è¯æ¡å®šä¹‰
â”‚   â”œâ”€â”€ AffixInstance.cs           # è¯æ¡å®ä¾‹
â”‚   â”œâ”€â”€ GearSet.cs                 # å¥—è£…å®šä¹‰
â”‚   â””â”€â”€ EquipmentSlot.cs           # è£…å¤‡æ§½æšä¸¾
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ GearGenerationService.cs   # è£…å¤‡ç”ŸæˆæœåŠ¡
â”‚   â”œâ”€â”€ EquipmentService.cs        # è£…å¤‡ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ StatsAggregationService.cs # å±æ€§èšåˆæœåŠ¡
â”‚   â”œâ”€â”€ DisenchantService.cs       # åˆ†è§£æœåŠ¡
â”‚   â”œâ”€â”€ ReforgeService.cs          # é‡é“¸æœåŠ¡
â”‚   â””â”€â”€ SetBonusService.cs         # å¥—è£…åŠ æˆæœåŠ¡
â”‚
â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ IGearDefinitionRepository.cs
â”‚   â”œâ”€â”€ IGearInstanceRepository.cs
â”‚   â””â”€â”€ IAffixRepository.cs
â”‚
â””â”€â”€ ValueObjects/
    â”œâ”€â”€ StatModifier.cs            # å±æ€§ä¿®é¥°ç¬¦
    â”œâ”€â”€ TierLevel.cs               # å“çº§
    â””â”€â”€ Rarity.cs                  # ç¨€æœ‰åº¦
```

### 3.2 æ ¸å¿ƒé¢†åŸŸæ¨¡å‹

#### è£…å¤‡å®šä¹‰ (GearDefinition)

```
GearDefinition (é…ç½®æ•°æ®)
â”œâ”€â”€ Id: string (å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "sword_iron")
â”œâ”€â”€ Name: string (æ˜¾ç¤ºåç§°)
â”œâ”€â”€ Icon: string (å›¾æ ‡)
â”œâ”€â”€ Slot: EquipmentSlot (è£…å¤‡æ§½ä½)
â”œâ”€â”€ RequiredLevel: int (éœ€æ±‚ç­‰çº§)
â”œâ”€â”€ BaseStats: Dictionary<StatType, StatRange> (åŸºç¡€å±æ€§èŒƒå›´)
â”œâ”€â”€ AllowedAffixPool: List<string> (å…è®¸çš„è¯æ¡IDæ± )
â”œâ”€â”€ RarityWeights: Dictionary<Rarity, double> (ç¨€æœ‰åº¦æƒé‡)
â””â”€â”€ SetId: string? (å¥—è£…ID)
```

#### è£…å¤‡å®ä¾‹ (GearInstance)

```
GearInstance (è¿è¡Œæ—¶å®ä¾‹)
â”œâ”€â”€ Id: Guid (å®ä¾‹ID)
â”œâ”€â”€ DefinitionId: string (å…³è”GearDefinition)
â”œâ”€â”€ CharacterId: Guid? (æ‰€å±è§’è‰²ï¼Œnullè¡¨ç¤ºåœ¨èƒŒåŒ…)
â”œâ”€â”€ SlotType: EquipmentSlot? (è£…å¤‡ä½ç½®ï¼Œnullè¡¨ç¤ºæœªè£…å¤‡)
â”œâ”€â”€ Rarity: Rarity (ç¨€æœ‰åº¦ï¼šCommon/Rare/Epic/Legendary)
â”œâ”€â”€ TierLevel: int (å“çº§ï¼š1-3)
â”œâ”€â”€ ItemLevel: int (ç‰©å“ç­‰çº§)
â”œâ”€â”€ RolledStats: Dictionary<StatType, double> (å·²rollçš„åŸºç¡€å±æ€§)
â”œâ”€â”€ Affixes: List<AffixInstance> (è¯æ¡åˆ—è¡¨)
â”œâ”€â”€ QualityScore: int (è£…å¤‡è¯„åˆ†)
â”œâ”€â”€ IsEquipped: bool (æ˜¯å¦å·²è£…å¤‡)
â”œâ”€â”€ IsBound: bool (æ˜¯å¦ç»‘å®š)
â”œâ”€â”€ CreatedAt: DateTime
â””â”€â”€ UpdatedAt: DateTime
```

#### è¯æ¡å®ä¾‹ (AffixInstance)

```
AffixInstance
â”œâ”€â”€ AffixId: string (è¯æ¡å®šä¹‰ID)
â”œâ”€â”€ StatType: StatType (å½±å“çš„å±æ€§)
â”œâ”€â”€ ModifierType: ModifierType (Flat/Percent/Proc)
â”œâ”€â”€ RolledValue: double (å·²rollçš„æ•°å€¼)
â””â”€â”€ DisplayText: string (æ˜¾ç¤ºæ–‡æœ¬ï¼Œå¦‚ "+15 åŠ›é‡")
```

#### å¥—è£…å®šä¹‰ (GearSet)

```
GearSet
â”œâ”€â”€ Id: string (å¥—è£…ID)
â”œâ”€â”€ Name: string (å¥—è£…åç§°)
â”œâ”€â”€ Pieces: List<string> (è£…å¤‡å®šä¹‰IDåˆ—è¡¨)
â””â”€â”€ Bonuses: Dictionary<int, List<StatModifier>> (ä»¶æ•° -> åŠ æˆ)
    ä¾‹å¦‚: { 2: [+100 HP], 4: [+5% Crit], 6: [ç‰¹æ®Šæ•ˆæœ] }
```

### 3.3 è£…å¤‡ç”Ÿæˆæµç¨‹

```
è£…å¤‡ç”Ÿæˆæµç¨‹ (GearGenerationService)
â”œâ”€â”€ 1. é€‰æ‹©è£…å¤‡å®šä¹‰ (GearDefinition)
â”œâ”€â”€ 2. ç¡®å®šç¨€æœ‰åº¦ (æ ¹æ®æƒé‡éšæœº)
â”œâ”€â”€ 3. ç¡®å®šå“çº§ (é»˜è®¤T1ï¼Œåç»­å¯å‡çº§)
â”œâ”€â”€ 4. è®¡ç®—ç‰©å“ç­‰çº§ (åŸºäºè§’è‰²ç­‰çº§ + ç¨€æœ‰åº¦åŠ æˆ)
â”œâ”€â”€ 5. RollåŸºç¡€å±æ€§ (åœ¨èŒƒå›´å†…éšæœºï¼Œå—Tierå½±å“)
â”œâ”€â”€ 6. ç”Ÿæˆè¯æ¡ (æ ¹æ®ç¨€æœ‰åº¦å†³å®šæ•°é‡)
â”‚   â”œâ”€â”€ Common: 0è¯æ¡
â”‚   â”œâ”€â”€ Rare: 1-2è¯æ¡
â”‚   â”œâ”€â”€ Epic: 2-3è¯æ¡
â”‚   â””â”€â”€ Legendary: 3-4è¯æ¡
â”œâ”€â”€ 7. Rollè¯æ¡æ•°å€¼ (åœ¨èŒƒå›´å†…éšæœº)
â”œâ”€â”€ 8. è®¡ç®—è£…å¤‡è¯„åˆ† (QualityScore)
â””â”€â”€ 9. è¿”å›GearInstance
```

### 3.4 è£…å¤‡å±æ€§è®¡ç®—æµç¨‹

```
å±æ€§èšåˆæµç¨‹ (StatsAggregationService)
â”œâ”€â”€ 1. è·å–è§’è‰²æ‰€æœ‰å·²è£…å¤‡çš„GearInstance
â”œâ”€â”€ 2. éå†æ¯ä¸ªè£…å¤‡
â”‚   â”œâ”€â”€ ç´¯åŠ åŸºç¡€å±æ€§ (RolledStats)
â”‚   â””â”€â”€ ç´¯åŠ è¯æ¡å±æ€§ (Affixes)
â”œâ”€â”€ 3. æ£€æŸ¥å¥—è£…æ•ˆæœ
â”‚   â”œâ”€â”€ ç»Ÿè®¡æ¯ä¸ªå¥—è£…çš„è£…å¤‡ä»¶æ•°
â”‚   â””â”€â”€ åº”ç”¨è¾¾æˆçš„å¥—è£…åŠ æˆ
â”œâ”€â”€ 4. åº”ç”¨æ•°å€¼ç®¡çº¿
â”‚   â””â”€â”€ final = clamp(((base + Î£Additive) * Î (1+Mult)) + Î£FinalAdd)
â””â”€â”€ 5. è¿”å›EquipmentStats
```

### 3.5 ä¸æˆ˜æ–—ç³»ç»Ÿé›†æˆ

```
æˆ˜æ–—å±æ€§è®¡ç®—æµç¨‹
â”œâ”€â”€ StatsBuilder.BuildStats(character)
â”‚   â”œâ”€â”€ 1. ä¸»å±æ€§ -> åŸºç¡€å±æ€§è½¬æ¢
â”‚   â”‚   â””â”€â”€ Strength -> AttackPower
â”‚   â”œâ”€â”€ 2. èŒä¸šåŸºç¡€å±æ€§åŠ æˆ
â”‚   â”‚   â””â”€â”€ ProfessionBaseStatsRegistry
â”‚   â”œâ”€â”€ 3. ã€æ–°å¢ã€‘è£…å¤‡å±æ€§æ³¨å…¥
â”‚   â”‚   â””â”€â”€ StatsAggregationService.CalculateEquipmentStats(characterId)
â”‚   â”œâ”€â”€ 4. Buffå±æ€§åŠ æˆ
â”‚   â”‚   â””â”€â”€ BuffManager.ApplyBuffModifiers()
â”‚   â””â”€â”€ 5. è¿”å›æœ€ç»ˆCharacterStats
â””â”€â”€ ä¼ å…¥æˆ˜æ–—ç³»ç»Ÿ
```

---

## 4. è¯¦ç»†æ‰§è¡Œæ­¥éª¤

### Phase 1: æ•°æ®åº“ä¸é¢†åŸŸæ¨¡å‹ (ç¬¬1-2å‘¨)

#### ç›®æ ‡
å»ºç«‹è£…å¤‡ç³»ç»Ÿçš„æ•°æ®åŸºç¡€å’Œé¢†åŸŸæ¨¡å‹

#### ä»»åŠ¡æ¸…å•

**Task 1.1: åˆ›å»ºæ•°æ®åº“è¡¨**
- [ ] åˆ›å»º `GearDefinitions` è¡¨ï¼ˆè£…å¤‡å®šä¹‰é…ç½®ï¼‰
- [ ] åˆ›å»º `GearInstances` è¡¨ï¼ˆè£…å¤‡å®ä¾‹ï¼‰
- [ ] åˆ›å»º `AffixDefinitions` è¡¨ï¼ˆè¯æ¡å®šä¹‰ï¼‰
- [ ] åˆ›å»º `GearSets` è¡¨ï¼ˆå¥—è£…å®šä¹‰ï¼‰
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»

**Task 1.2: å®ç°é¢†åŸŸæ¨¡å‹**
- [ ] åˆ›å»º `Domain/Equipment/Models/` ç›®å½•
- [ ] å®ç° `GearDefinition.cs`
- [ ] å®ç° `GearInstance.cs`
- [ ] å®ç° `Affix.cs` å’Œ `AffixInstance.cs`
- [ ] å®ç° `GearSet.cs`
- [ ] å®ç°æšä¸¾ç±»å‹ (`EquipmentSlot`, `Rarity`, `ModifierType`)

**Task 1.3: EF Coreé…ç½®**
- [ ] åˆ›å»º `GearDefinitionConfiguration.cs`
- [ ] åˆ›å»º `GearInstanceConfiguration.cs`
- [ ] åˆ›å»º `AffixDefinitionConfiguration.cs`
- [ ] åˆ›å»º `GearSetConfiguration.cs`
- [ ] æ›´æ–° `GameDbContext.cs`

**Task 1.4: åˆå§‹åŒ–é…ç½®æ•°æ®**
- [ ] åˆ›å»ºè£…å¤‡å®šä¹‰ç§å­æ•°æ®ï¼ˆå‰‘/ç›¾/æŠ¤ç”²ç­‰ï¼‰
- [ ] åˆ›å»ºè¯æ¡å®šä¹‰ç§å­æ•°æ®ï¼ˆ+åŠ›é‡/+æš´å‡»ç­‰ï¼‰
- [ ] åˆ›å»ºå¥—è£…å®šä¹‰ç§å­æ•°æ®ï¼ˆæˆ˜å£«å¥—è£…ç­‰ï¼‰
- [ ] å®ç°æ•°æ®è¿ç§»è„šæœ¬

**éªŒæ”¶æ ‡å‡†**
- âœ… æ•°æ®åº“è¿ç§»æˆåŠŸæ‰§è¡Œ
- âœ… å¯ä»¥æŸ¥è¯¢å’ŒæŒä¹…åŒ–è£…å¤‡æ•°æ®
- âœ… ç§å­æ•°æ®æ­£ç¡®åŠ è½½
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–å®ä½“éªŒè¯é€»è¾‘

---

### Phase 2: è£…å¤‡ç”Ÿæˆä¸æ‰è½ç³»ç»Ÿ (ç¬¬3-4å‘¨)

#### ç›®æ ‡
å®ç°è£…å¤‡ç”Ÿæˆé€»è¾‘å¹¶é›†æˆåˆ°æ‰è½ç³»ç»Ÿ

#### ä»»åŠ¡æ¸…å•

**Task 2.1: è£…å¤‡ç”ŸæˆæœåŠ¡**
- [ ] åˆ›å»º `GearGenerationService.cs`
- [ ] å®ç°ç¨€æœ‰åº¦éšæœºç®—æ³•ï¼ˆåŠ æƒéšæœºï¼‰
- [ ] å®ç°åŸºç¡€å±æ€§Rollç®—æ³•ï¼ˆèŒƒå›´å†…éšæœºï¼‰
- [ ] å®ç°è¯æ¡ç”Ÿæˆç®—æ³•
  - [ ] æ ¹æ®ç¨€æœ‰åº¦å†³å®šè¯æ¡æ•°é‡
  - [ ] ä»è¯æ¡æ± éšæœºé€‰æ‹©
  - [ ] Rollè¯æ¡æ•°å€¼
  - [ ] é˜²æ­¢é‡å¤è¯æ¡
- [ ] å®ç°è£…å¤‡è¯„åˆ†è®¡ç®—ç®—æ³•
- [ ] å®ç°å“çº§ç³»æ•°åº”ç”¨

**Task 2.2: è£…å¤‡æ³¨å†Œåˆ°ç»æµç³»ç»Ÿ**
- [ ] æ‰©å±• `EconomyRegistry` æ”¯æŒè£…å¤‡ç‰©å“ç±»å‹
- [ ] åˆ›å»ºè£…å¤‡æ‰è½è¡¨ï¼ˆLootTableï¼‰
  - [ ] æ™®é€šæ€ªç‰©æ‰è½è¡¨ï¼ˆä½ç¨€æœ‰åº¦è£…å¤‡ï¼‰
  - [ ] ç²¾è‹±æ€ªç‰©æ‰è½è¡¨ï¼ˆé«˜ç¨€æœ‰åº¦è£…å¤‡ï¼‰
  - [ ] Bossæ‰è½è¡¨ï¼ˆä¼ è¯´è£…å¤‡ï¼‰
- [ ] æ›´æ–° `LootEntry` æ”¯æŒè£…å¤‡ç”Ÿæˆå‚æ•°

**Task 2.3: é›†æˆåˆ°æˆ˜æ–—å¥–åŠ±**
- [ ] ä¿®æ”¹ `EconomyCalculator` å¤„ç†è£…å¤‡æ‰è½
- [ ] ä¿®æ”¹ `RewardGrantService` åˆ›å»ºè£…å¤‡å®ä¾‹
- [ ] è£…å¤‡æ‰è½å†™å…¥èƒŒåŒ…ï¼ˆInventoryItemå…³è”ï¼‰
- [ ] å®ç°è£…å¤‡æ‰è½é€šçŸ¥

**Task 2.4: RNGæ§åˆ¶**
- [ ] ä½¿ç”¨ `RNGContext` ä¿è¯è£…å¤‡ç”Ÿæˆå¯å›æ”¾
- [ ] è®°å½•è£…å¤‡ç”Ÿæˆç§å­
- [ ] å®ç°ä¿åº•æœºåˆ¶ï¼ˆè¿ç»­Næ¬¡æœªæ‰è½ç¨€æœ‰è£…å¤‡æ—¶æå‡æ¦‚ç‡ï¼‰

**éªŒæ”¶æ ‡å‡†**
- âœ… èƒ½ç”Ÿæˆå„ç¨€æœ‰åº¦çš„è£…å¤‡
- âœ… è£…å¤‡å±æ€§åœ¨åˆç†èŒƒå›´å†…
- âœ… è¯æ¡ç”Ÿæˆç¬¦åˆè§„åˆ™
- âœ… è£…å¤‡æ­£ç¡®å†™å…¥èƒŒåŒ…
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç”Ÿæˆé€»è¾‘

---

### Phase 3: è£…å¤‡ç®¡ç†ä¸æ“ä½œ (ç¬¬5-6å‘¨)

#### ç›®æ ‡
å®ç°è£…å¤‡/å¸ä¸‹ã€å±æ€§è®¡ç®—ç­‰æ ¸å¿ƒæ“ä½œ

#### ä»»åŠ¡æ¸…å•

**Task 3.1: è£…å¤‡ç®¡ç†æœåŠ¡**
- [ ] åˆ›å»º `EquipmentService.cs`
- [ ] å®ç° `EquipItem(characterId, gearInstanceId, slot)` æ–¹æ³•
  - [ ] éªŒè¯è£…å¤‡æ§½ä½åŒ¹é…
  - [ ] éªŒè¯ç­‰çº§éœ€æ±‚
  - [ ] éªŒè¯èŒä¸šéœ€æ±‚ï¼ˆå¦‚æœ‰ï¼‰
  - [ ] å¤„ç†å·²æœ‰è£…å¤‡ï¼ˆè‡ªåŠ¨å¸ä¸‹åˆ°èƒŒåŒ…ï¼‰
  - [ ] æ›´æ–°GearInstanceçš„SlotTypeå’ŒIsEquipped
- [ ] å®ç° `UnequipItem(characterId, slot)` æ–¹æ³•
  - [ ] éªŒè¯æ§½ä½æœ‰è£…å¤‡
  - [ ] ç§»é™¤è£…å¤‡ï¼Œæ”¾å›èƒŒåŒ…
  - [ ] æ›´æ–°GearInstanceçŠ¶æ€
- [ ] å®ç° `GetEquippedGear(characterId)` æ–¹æ³•
- [ ] å®ç° `SwapGear(characterId, slot, gearInstanceId)` æ–¹æ³•

**Task 3.2: å±æ€§èšåˆæœåŠ¡**
- [ ] åˆ›å»º `StatsAggregationService.cs`
- [ ] å®ç° `CalculateEquipmentStats(characterId)` æ–¹æ³•
  - [ ] èšåˆæ‰€æœ‰è£…å¤‡çš„åŸºç¡€å±æ€§
  - [ ] èšåˆæ‰€æœ‰è¯æ¡å±æ€§
  - [ ] åº”ç”¨æ•°å€¼ç®¡çº¿ï¼ˆAdditive -> Multiplicative -> FinalAddï¼‰
  - [ ] åº”ç”¨æ•°å€¼ä¸Šé™ï¼ˆæš´å‡»â‰¤100%ï¼Œæ€¥é€Ÿâ‰¥-50%ç­‰ï¼‰
- [ ] å®ç°å±æ€§ç¼“å­˜æœºåˆ¶ï¼ˆè£…å¤‡å˜æ›´æ—¶å¤±æ•ˆï¼‰

**Task 3.3: å¥—è£…åŠ æˆæœåŠ¡**
- [ ] åˆ›å»º `SetBonusService.cs`
- [ ] å®ç° `CalculateSetBonuses(equippedGear)` æ–¹æ³•
  - [ ] ç»Ÿè®¡æ¯ä¸ªå¥—è£…çš„è£…å¤‡ä»¶æ•°
  - [ ] åº”ç”¨è¾¾æˆçš„å¥—è£…åŠ æˆ
  - [ ] è¿”å›å¥—è£…å±æ€§åŠ æˆ
- [ ] é›†æˆåˆ°å±æ€§èšåˆæµç¨‹

**Task 3.4: æˆ˜æ–—ç³»ç»Ÿé›†æˆ**
- [ ] ä¿®æ”¹ `StatsBuilder.BuildStats()` æ³¨å…¥è£…å¤‡å±æ€§
- [ ] æµ‹è¯•è£…å¤‡å±æ€§åœ¨æˆ˜æ–—ä¸­ç”Ÿæ•ˆ
- [ ] éªŒè¯å±æ€§è®¡ç®—æ­£ç¡®æ€§

**Task 3.5: APIå®ç°**
- [ ] æ›´æ–° `EquipmentController.cs` å®ç°çœŸå®é€»è¾‘
  - [ ] `GET /api/equipment/{characterId}` è¿”å›çœŸå®è£…å¤‡
  - [ ] `POST /api/equipment/{characterId}/{slot}` è£…å¤‡ç‰©å“
  - [ ] `DELETE /api/equipment/{characterId}/{slot}` å¸ä¸‹è£…å¤‡
  - [ ] `GET /api/equipment/{characterId}/stats` è¿”å›çœŸå®å±æ€§
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’ŒéªŒè¯
- [ ] æ·»åŠ æ“ä½œæ—¥å¿—

**éªŒæ”¶æ ‡å‡†**
- âœ… èƒ½æ­£ç¡®è£…å¤‡å’Œå¸ä¸‹è£…å¤‡
- âœ… è£…å¤‡å±æ€§æ­£ç¡®è®¡ç®—å¹¶æ³¨å…¥æˆ˜æ–—
- âœ… å¥—è£…æ•ˆæœæ­£ç¡®è§¦å‘
- âœ… APIè¿”å›æ­£ç¡®æ•°æ®
- âœ… å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•é€šè¿‡

---

### Phase 4: å‰ç«¯è£…å¤‡ç®¡ç†ç•Œé¢ (ç¬¬7-8å‘¨)

#### ç›®æ ‡
å®Œå–„å‰ç«¯è£…å¤‡é¢æ¿ï¼Œå®ç°è£…å¤‡æ“ä½œ

#### ä»»åŠ¡æ¸…å•

**Task 4.1: æ›´æ–°å‰ç«¯æ•°æ®æ¨¡å‹**
- [ ] éªŒè¯ `ApiModels.cs` ä¸åç«¯æ¨¡å‹ä¸€è‡´
- [ ] æ·»åŠ ç¼ºå¤±å­—æ®µï¼ˆå¦‚IsBound, CreatedAtç­‰ï¼‰
- [ ] æ›´æ–°DTOè½¬æ¢é€»è¾‘

**Task 4.2: å®Œå–„EquipmentPanelç»„ä»¶**
- [ ] æ˜¾ç¤ºçœŸå®è£…å¤‡æ•°æ®ï¼ˆæ›¿æ¢å ä½æ•°æ®ï¼‰
- [ ] å®ç°è£…å¤‡æ§½ç‚¹å‡»äº‹ä»¶
- [ ] å®ç°è£…å¤‡è¯¦æƒ…tooltip
  - [ ] æ˜¾ç¤ºåŸºç¡€å±æ€§
  - [ ] æ˜¾ç¤ºè¯æ¡åˆ—è¡¨
  - [ ] æ˜¾ç¤ºå¥—è£…ä¿¡æ¯
  - [ ] æ˜¾ç¤ºç‰©å“ç­‰çº§ã€å“çº§ã€è¯„åˆ†
- [ ] å®ç°è£…å¤‡å¯¹æ¯”åŠŸèƒ½
  - [ ] æ˜¾ç¤ºå±æ€§å·®å¼‚
  - [ ] é«˜äº®æ›´å¥½/æ›´å·®çš„å±æ€§
- [ ] å®ç°å¸ä¸‹è£…å¤‡æŒ‰é’®
- [ ] å®ç°è£…å¤‡å“è´¨é¢œè‰²æ˜¾ç¤º

**Task 4.3: åˆ›å»ºèƒŒåŒ…è£…å¤‡åˆ—è¡¨**
- [ ] æ‰©å±• `InventoryPanel.razor` æ˜¾ç¤ºè£…å¤‡
- [ ] å®ç°è£…å¤‡ç­›é€‰ï¼ˆæŒ‰æ§½ä½/å“è´¨/ç­‰çº§ï¼‰
- [ ] å®ç°è£…å¤‡æ’åºï¼ˆæŒ‰è¯„åˆ†/ç­‰çº§/è·å–æ—¶é—´ï¼‰
- [ ] å®ç°è£…å¤‡ç‚¹å‡» -> è£…å¤‡æ“ä½œ
- [ ] æ˜¾ç¤ºå¯è£…å¤‡/ä¸å¯è£…å¤‡æ ‡è¯†

**Task 4.4: è£…å¤‡æ“ä½œäº¤äº’**
- [ ] å®ç°è£…å¤‡æŒ‰é’®åŠŸèƒ½
- [ ] æ·»åŠ æ“ä½œç¡®è®¤å¯¹è¯æ¡†
- [ ] å®ç°æ“ä½œåé¦ˆï¼ˆæˆåŠŸ/å¤±è´¥æç¤ºï¼‰
- [ ] å®ç°ä¹è§‚æ›´æ–°ï¼ˆç«‹å³æ›´æ–°UIï¼Œå¤±è´¥æ—¶å›æ»šï¼‰
- [ ] æ·»åŠ loadingçŠ¶æ€

**Task 4.5: ApiClienté›†æˆ**
- [ ] å®ç° `EquipItemAsync(characterId, gearInstanceId, slot)`
- [ ] å®ç° `UnequipItemAsync(characterId, slot)`
- [ ] å®ç° `GetEquipmentAsync(characterId)` ï¼ˆå·²æœ‰ï¼Œæ›´æ–°ï¼‰
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘

**éªŒæ”¶æ ‡å‡†**
- âœ… è£…å¤‡é¢æ¿æ­£ç¡®æ˜¾ç¤ºè£…å¤‡æ•°æ®
- âœ… è£…å¤‡/å¸ä¸‹æ“ä½œæ­£å¸¸å·¥ä½œ
- âœ… è£…å¤‡å¯¹æ¯”åŠŸèƒ½ç›´è§‚æ˜“ç”¨
- âœ… èƒŒåŒ…è£…å¤‡ç­›é€‰å’Œæ’åºæ­£å¸¸
- âœ… æ“ä½œåé¦ˆå‹å¥½

---

### Phase 5: è£…å¤‡å¢å¼ºç³»ç»Ÿ (ç¬¬9-10å‘¨)

#### ç›®æ ‡
å®ç°è£…å¤‡åˆ†è§£ã€é‡é“¸ã€è¯æ¡é‡ç½®ç­‰é«˜çº§åŠŸèƒ½

#### ä»»åŠ¡æ¸…å•

**Task 5.1: è£…å¤‡åˆ†è§£æœåŠ¡**
- [ ] åˆ›å»º `DisenchantService.cs`
- [ ] å®ç° `Disenchant(gearInstanceId)` æ–¹æ³•
  - [ ] è®¡ç®—åˆ†è§£äº§å‡ºï¼ˆåŸºäºç¨€æœ‰åº¦/å“çº§ï¼‰
  - [ ] åˆ é™¤è£…å¤‡å®ä¾‹
  - [ ] å‘æ”¾ææ–™åˆ°èƒŒåŒ…
  - [ ] è®°å½•ç»æµäº‹ä»¶
- [ ] å®šä¹‰åˆ†è§£ææ–™ï¼ˆmat_essence_common/rare/epic/legendaryï¼‰
- [ ] é…ç½®åˆ†è§£äº§å‡ºè¡¨

**Task 5.2: å“çº§é‡é“¸æœåŠ¡**
- [ ] åˆ›å»º `ReforgeService.cs`
- [ ] å®ç° `ReforgeTier(gearInstanceId)` æ–¹æ³•
  - [ ] éªŒè¯å“çº§æœªè¾¾ä¸Šé™ï¼ˆTier < 3ï¼‰
  - [ ] æ‰£é™¤ææ–™å’Œé‡‘å¸
  - [ ] æå‡å“çº§
  - [ ] é‡æ–°è®¡ç®—åŸºç¡€å±æ€§ï¼ˆåº”ç”¨Tierç³»æ•°ï¼‰
  - [ ] æ›´æ–°è£…å¤‡è¯„åˆ†
- [ ] å®šä¹‰é‡é“¸æˆæœ¬ï¼ˆé€’å¢å…¬å¼ï¼‰
- [ ] å®ç°æˆåŠŸç‡æœºåˆ¶ï¼ˆå¯é€‰ï¼‰

**Task 5.3: è¯æ¡é‡ç½®æœåŠ¡**
- [ ] å®ç° `RerollAffixes(gearInstanceId)` æ–¹æ³•
  - [ ] æ‰£é™¤ææ–™å’Œé‡‘å¸
  - [ ] ä¿ç•™è¯æ¡æ•°é‡
  - [ ] é‡æ–°Rollè¯æ¡ï¼ˆç±»å‹å’Œæ•°å€¼ï¼‰
  - [ ] è®°å½•é‡ç½®æ¬¡æ•°
  - [ ] åº”ç”¨æˆæœ¬é€’å¢
- [ ] å®ç°ä¿åº•æœºåˆ¶ï¼ˆè¿ç»­Næ¬¡æœªå‡ºé«˜æ•°å€¼æ—¶æå‡rollèŒƒå›´ï¼‰
- [ ] å¯é€‰ï¼šé”å®šç‰¹å®šè¯æ¡åŠŸèƒ½

**Task 5.4: APIå®ç°**
- [ ] `POST /api/equipment/{gearInstanceId}/disenchant` - åˆ†è§£
- [ ] `POST /api/equipment/{gearInstanceId}/reforge` - å“çº§é‡é“¸
- [ ] `POST /api/equipment/{gearInstanceId}/reroll-affixes` - è¯æ¡é‡ç½®
- [ ] æ·»åŠ æ“ä½œæˆæœ¬è®¡ç®—API
- [ ] é”™è¯¯å¤„ç†å’ŒéªŒè¯

**Task 5.5: å‰ç«¯å¢å¼ºåŠŸèƒ½ç•Œé¢**
- [ ] åˆ›å»º `GearEnhancementDialog.razor` ç»„ä»¶
- [ ] å®ç°åˆ†è§£ç¡®è®¤ç•Œé¢
  - [ ] æ˜¾ç¤ºåˆ†è§£äº§å‡ºé¢„è§ˆ
  - [ ] æ‰¹é‡åˆ†è§£åŠŸèƒ½
- [ ] å®ç°å“çº§é‡é“¸ç•Œé¢
  - [ ] æ˜¾ç¤ºé‡é“¸æˆæœ¬
  - [ ] æ˜¾ç¤ºå±æ€§æå‡é¢„è§ˆ
  - [ ] æˆåŠŸç‡æ˜¾ç¤ºï¼ˆå¦‚æœ‰ï¼‰
- [ ] å®ç°è¯æ¡é‡ç½®ç•Œé¢
  - [ ] æ˜¾ç¤ºå½“å‰è¯æ¡
  - [ ] æ˜¾ç¤ºé‡ç½®æˆæœ¬
  - [ ] è¯æ¡é”å®šåŠŸèƒ½ï¼ˆå¦‚æœ‰ï¼‰
- [ ] é›†æˆåˆ°è£…å¤‡è¯¦æƒ…ç•Œé¢

**éªŒæ”¶æ ‡å‡†**
- âœ… åˆ†è§£åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œäº§å‡ºæ­£ç¡®
- âœ… å“çº§é‡é“¸æ­£ç¡®æå‡è£…å¤‡
- âœ… è¯æ¡é‡ç½®æ­£ç¡®é‡æ–°ç”Ÿæˆè¯æ¡
- âœ… æˆæœ¬è®¡ç®—æ­£ç¡®
- âœ… å‰ç«¯ç•Œé¢ç›´è§‚æ˜“ç”¨

---

### Phase 6: å¥—è£…ç³»ç»Ÿä¸ä¼˜åŒ– (ç¬¬11-12å‘¨)

#### ç›®æ ‡
å®Œå–„å¥—è£…ç³»ç»Ÿï¼Œä¼˜åŒ–æ•´ä½“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

#### ä»»åŠ¡æ¸…å•

**Task 6.1: å¥—è£…ç³»ç»Ÿå®Œå–„**
- [ ] åˆ›å»ºè‡³å°‘3ä¸ªå®Œæ•´å¥—è£…
  - [ ] æˆ˜å£«å¥—è£…ï¼ˆ6ä»¶ï¼Œç‰©ç†ä¼¤å®³åŠ æˆï¼‰
  - [ ] æ³•å¸ˆå¥—è£…ï¼ˆ6ä»¶ï¼Œæ³•æœ¯ä¼¤å®³åŠ æˆï¼‰
  - [ ] å¦å…‹å¥—è£…ï¼ˆ6ä»¶ï¼Œç”Ÿå­˜åŠ æˆï¼‰
- [ ] å®ç°å¥—è£…ç‰¹æ•ˆï¼ˆOnHit/OnCastè§¦å‘ï¼‰
- [ ] å®ç°å¥—è£…Buffï¼ˆé›†æˆåˆ°BuffManagerï¼‰
- [ ] å‰ç«¯æ˜¾ç¤ºå¥—è£…è¿›åº¦å’Œæ¿€æ´»çŠ¶æ€

**Task 6.2: è£…å¤‡å¯¹æ¯”ä¼˜åŒ–**
- [ ] æ”¹è¿›è£…å¤‡å¯¹æ¯”ç®—æ³•
- [ ] è€ƒè™‘å¥—è£…æ•ˆæœåœ¨å¯¹æ¯”ä¸­çš„å½±å“
- [ ] å®ç°"æ€»è¯„åˆ†"å¯¹æ¯”
- [ ] å®ç°è£…å¤‡æ¨èåŠŸèƒ½

**Task 6.3: æ€§èƒ½ä¼˜åŒ–**
- [ ] å®ç°è£…å¤‡å±æ€§ç¼“å­˜
- [ ] å®ç°è£…å¤‡æ•°æ®æ‡’åŠ è½½
- [ ] ä¼˜åŒ–è£…å¤‡åˆ—è¡¨æ¸²æŸ“ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆæ·»åŠ ç´¢å¼•ï¼‰
- [ ] å®ç°è£…å¤‡é¢„åŠ è½½ç­–ç•¥

**Task 6.4: ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- [ ] æ·»åŠ è£…å¤‡è·å–åŠ¨ç”»å’ŒéŸ³æ•ˆ
- [ ] å®ç°è£…å¤‡å¿«é€Ÿåˆ‡æ¢ï¼ˆå¥—è£…åˆ‡æ¢ï¼‰
- [ ] æ·»åŠ è£…å¤‡é”å®šåŠŸèƒ½ï¼ˆé˜²æ­¢è¯¯åˆ†è§£ï¼‰
- [ ] å®ç°è£…å¤‡æ”¶è—åŠŸèƒ½
- [ ] æ·»åŠ è£…å¤‡æœç´¢åŠŸèƒ½

**Task 6.5: æ•°æ®å¹³è¡¡**
- [ ] è°ƒæ•´è£…å¤‡å±æ€§èŒƒå›´
- [ ] è°ƒæ•´è¯æ¡æ•°å€¼
- [ ] è°ƒæ•´åˆ†è§£äº§å‡º
- [ ] è°ƒæ•´é‡é“¸æˆæœ¬
- [ ] è¿›è¡Œå¹³è¡¡æ€§æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**
- âœ… å¥—è£…ç³»ç»Ÿå®Œæ•´å¯ç”¨
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚ï¼ˆè£…å¤‡åˆ—è¡¨æ¸²æŸ“<100msï¼‰
- âœ… ç”¨æˆ·ä½“éªŒæµç•…
- âœ… æ•°æ®å¹³è¡¡åˆç†

---

### Phase 7: é«˜çº§åŠŸèƒ½ä¸æ‰©å±• (ç¬¬13-14å‘¨ï¼Œå¯é€‰)

#### ç›®æ ‡
å®ç°é«˜çº§åŠŸèƒ½ï¼Œä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡

#### ä»»åŠ¡æ¸…å•

**Task 7.1: è£…å¤‡å¼ºåŒ–ç³»ç»Ÿ**
- [ ] å®ç°è£…å¤‡å¼ºåŒ–ç­‰çº§ï¼ˆ+1 ~ +15ï¼‰
- [ ] å®ç°å¼ºåŒ–å¤±è´¥æƒ©ç½šæœºåˆ¶
- [ ] å®ç°å¼ºåŒ–ä¿æŠ¤é“å…·

**Task 7.2: è£…å¤‡ç²¾ç‚¼ç³»ç»Ÿ**
- [ ] å®ç°å•ä¸ªè¯æ¡ç²¾ç‚¼ï¼ˆå°å¹…æå‡ï¼‰
- [ ] å®ç°ç²¾ç‚¼ä¸Šé™
- [ ] å®ç°ç²¾ç‚¼æˆæœ¬é€’å¢

**Task 7.3: è£…å¤‡ä¼ æ‰¿ç³»ç»Ÿ**
- [ ] å®ç°è£…å¤‡å±æ€§ä¼ æ‰¿ï¼ˆæ—§è£…å¤‡å±æ€§è½¬ç§»åˆ°æ–°è£…å¤‡ï¼‰
- [ ] å®ç°ä¼ æ‰¿æˆæœ¬è®¡ç®—

**Task 7.4: è£…å¤‡ç»‘å®šä¸äº¤æ˜“**
- [ ] å®ç°è£…å¤‡ç»‘å®šæœºåˆ¶ï¼ˆè£…å¤‡åç»‘å®š/æ‹¾å–åç»‘å®šï¼‰
- [ ] é¢„ç•™äº¤æ˜“æ¥å£ï¼ˆç©å®¶é—´äº¤æ˜“/æ‹å–è¡Œï¼‰

**Task 7.5: è£…å¤‡å›¾é‰´ç³»ç»Ÿ**
- [ ] å®ç°è£…å¤‡å›¾é‰´æ”¶é›†
- [ ] å®ç°å›¾é‰´å¥–åŠ±
- [ ] å‰ç«¯å›¾é‰´å±•ç¤ºç•Œé¢

---

### Phase 8: æµ‹è¯•ä¸æ–‡æ¡£ (ç¬¬15-16å‘¨)

#### ç›®æ ‡
å…¨é¢æµ‹è¯•å’Œå®Œå–„æ–‡æ¡£

#### ä»»åŠ¡æ¸…å•

**Task 8.1: å•å…ƒæµ‹è¯•**
- [ ] è£…å¤‡ç”Ÿæˆé€»è¾‘æµ‹è¯•
- [ ] å±æ€§è®¡ç®—æµ‹è¯•
- [ ] å¥—è£…æ•ˆæœæµ‹è¯•
- [ ] åˆ†è§£/é‡é“¸/é‡ç½®æµ‹è¯•
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**Task 8.2: é›†æˆæµ‹è¯•**
- [ ] è£…å¤‡æ‰è½æµç¨‹æµ‹è¯•
- [ ] è£…å¤‡/å¸ä¸‹æµç¨‹æµ‹è¯•
- [ ] è£…å¤‡å¢å¼ºæµç¨‹æµ‹è¯•
- [ ] æˆ˜æ–—é›†æˆæµ‹è¯•

**Task 8.3: æ€§èƒ½æµ‹è¯•**
- [ ] è£…å¤‡ç”Ÿæˆæ€§èƒ½æµ‹è¯•
- [ ] å±æ€§è®¡ç®—æ€§èƒ½æµ‹è¯•
- [ ] æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
- [ ] å‰ç«¯æ¸²æŸ“æ€§èƒ½æµ‹è¯•

**Task 8.4: ç”¨æˆ·éªŒæ”¶æµ‹è¯•**
- [ ] åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
- [ ] æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆ
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

**Task 8.5: æ–‡æ¡£å®Œå–„**
- [ ] è£…å¤‡ç³»ç»Ÿè®¾è®¡æ–‡æ¡£
- [ ] APIæ¥å£æ–‡æ¡£
- [ ] æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [ ] ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
- [ ] å¼€å‘è€…æŒ‡å—

---

## 5. æ•°æ®æ¨¡å‹è®¾è®¡

### 5.1 æ•°æ®åº“è¡¨ç»“æ„

#### GearDefinitionsï¼ˆè£…å¤‡å®šä¹‰è¡¨ï¼‰

```sql
CREATE TABLE GearDefinitions (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "sword_iron"
    Name VARCHAR(200) NOT NULL,               -- æ˜¾ç¤ºåç§°
    Icon VARCHAR(50),                         -- å›¾æ ‡emojiæˆ–URL
    Slot VARCHAR(50) NOT NULL,                -- è£…å¤‡æ§½ä½
    RequiredLevel INT NOT NULL DEFAULT 1,     -- éœ€æ±‚ç­‰çº§
    BaseStatsJson TEXT,                       -- JSON: {"AttackPower": {"Min": 10, "Max": 15}}
    AllowedAffixPoolJson TEXT,                -- JSON: ["affix_strength", "affix_crit"]
    RarityWeightsJson TEXT,                   -- JSON: {"Common": 0.6, "Rare": 0.3, ...}
    SetId VARCHAR(100),                       -- å¥—è£…IDï¼Œå¯ä¸ºnull
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL
);
```

#### GearInstancesï¼ˆè£…å¤‡å®ä¾‹è¡¨ï¼‰

```sql
CREATE TABLE GearInstances (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    DefinitionId VARCHAR(100) NOT NULL,       -- å¤–é”®åˆ°GearDefinitions
    CharacterId UNIQUEIDENTIFIER,             -- å¤–é”®åˆ°Charactersï¼Œnullè¡¨ç¤ºåœ¨èƒŒåŒ…
    SlotType VARCHAR(50),                     -- è£…å¤‡ä½ç½®ï¼Œnullè¡¨ç¤ºæœªè£…å¤‡
    Rarity VARCHAR(50) NOT NULL,              -- Common/Rare/Epic/Legendary
    TierLevel INT NOT NULL DEFAULT 1,         -- å“çº§ 1-3
    ItemLevel INT NOT NULL,                   -- ç‰©å“ç­‰çº§
    RolledStatsJson TEXT NOT NULL,            -- JSON: {"AttackPower": 12.5}
    AffixesJson TEXT NOT NULL,                -- JSON: [{"AffixId": "...", "Value": ...}]
    QualityScore INT NOT NULL,                -- è£…å¤‡è¯„åˆ†
    IsEquipped BIT NOT NULL DEFAULT 0,        -- æ˜¯å¦å·²è£…å¤‡
    IsBound BIT NOT NULL DEFAULT 0,           -- æ˜¯å¦ç»‘å®š
    RerollCount INT NOT NULL DEFAULT 0,       -- è¯æ¡é‡ç½®æ¬¡æ•°
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL,
    
    FOREIGN KEY (DefinitionId) REFERENCES GearDefinitions(Id),
    FOREIGN KEY (CharacterId) REFERENCES Characters(Id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX IX_GearInstances_CharacterId ON GearInstances(CharacterId);
CREATE INDEX IX_GearInstances_IsEquipped ON GearInstances(IsEquipped);
CREATE INDEX IX_GearInstances_Rarity ON GearInstances(Rarity);
```

#### AffixDefinitionsï¼ˆè¯æ¡å®šä¹‰è¡¨ï¼‰

```sql
CREATE TABLE AffixDefinitions (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "affix_strength"
    Name VARCHAR(200) NOT NULL,               -- æ˜¾ç¤ºåç§°ï¼Œå¦‚ "åŠ›é‡"
    StatType VARCHAR(50) NOT NULL,            -- å½±å“çš„å±æ€§ç±»å‹
    ModifierType VARCHAR(50) NOT NULL,        -- Flat/Percent/Proc
    ValueMin FLOAT NOT NULL,                  -- æ•°å€¼èŒƒå›´æœ€å°
    ValueMax FLOAT NOT NULL,                  -- æ•°å€¼èŒƒå›´æœ€å¤§
    RarityWeight FLOAT NOT NULL DEFAULT 1.0,  -- ç¨€æœ‰åº¦æƒé‡ï¼ˆè¶Šä½è¶Šç¨€æœ‰ï¼‰
    AllowedSlots TEXT,                        -- JSON: ["weapon", "chest"] æˆ– nullè¡¨ç¤ºå…¨éƒ¨
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL
);
```

#### GearSetsï¼ˆå¥—è£…å®šä¹‰è¡¨ï¼‰

```sql
CREATE TABLE GearSets (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "set_warrior"
    Name VARCHAR(200) NOT NULL,               -- å¥—è£…åç§°
    PiecesJson TEXT NOT NULL,                 -- JSON: ["gear_def_1", "gear_def_2", ...]
    BonusesJson TEXT NOT NULL,                -- JSON: {"2": [...], "4": [...], "6": [...]}
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL
);
```

### 5.2 DTOæ¨¡å‹ï¼ˆå‰åç«¯é€šä¿¡ï¼‰

å‰ç«¯ `ApiModels.cs` ä¸­å·²å®šä¹‰çš„DTOï¼š
- `EquipmentResponse`
- `EquipmentSlotDto`
- `GearInstanceDto`
- `AffixDto`

éœ€è¦æ·»åŠ çš„DTOï¼š
- `GearEnhancementCostDto`ï¼ˆå¢å¼ºæˆæœ¬ï¼‰
- `SetBonusDto`ï¼ˆå¥—è£…åŠ æˆï¼‰
- `DisenchantResultDto`ï¼ˆåˆ†è§£ç»“æœï¼‰

---

## 6. ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ

### 6.1 ä¸ç»æµç³»ç»Ÿé›†æˆ

```
è£…å¤‡æ‰è½æµç¨‹
â”œâ”€â”€ æˆ˜æ–—ç»“æŸ (BattleRunner / StepBattleEngine)
â”œâ”€â”€ æ”¶é›†killCounts
â”œâ”€â”€ EconomyCalculator.ComputeSampled(killCounts, context)
â”‚   â””â”€â”€ ã€æ‰©å±•ã€‘è¯†åˆ«è£…å¤‡æ‰è½é¡¹ (itemType == "gear")
â”œâ”€â”€ ã€æ–°å¢ã€‘GearGenerationService.Generate(gearDefId, context)
â”œâ”€â”€ åˆ›å»ºGearInstanceå¹¶ä¿å­˜åˆ°æ•°æ®åº“
â”œâ”€â”€ å…³è”åˆ°InventoryItem (ItemId = gearInstanceId.ToString())
â””â”€â”€ RewardGrantService.GrantRewards() å‘æ”¾å¥–åŠ±
```

### 6.2 ä¸æˆ˜æ–—ç³»ç»Ÿé›†æˆ

```
æˆ˜æ–—å±æ€§è®¡ç®—
â”œâ”€â”€ StatsBuilder.BuildStats(character)
â”‚   â”œâ”€â”€ 1. ä¸»å±æ€§ -> åŸºç¡€å±æ€§
â”‚   â”œâ”€â”€ 2. èŒä¸šåŸºç¡€å±æ€§
â”‚   â”œâ”€â”€ 3. ã€æ–°å¢ã€‘è£…å¤‡å±æ€§
â”‚   â”‚   â””â”€â”€ StatsAggregationService.CalculateEquipmentStats(characterId)
â”‚   â”‚       â”œâ”€â”€ æŸ¥è¯¢å·²è£…å¤‡çš„GearInstance
â”‚   â”‚       â”œâ”€â”€ èšåˆåŸºç¡€å±æ€§å’Œè¯æ¡
â”‚   â”‚       â”œâ”€â”€ åº”ç”¨å¥—è£…åŠ æˆ
â”‚   â”‚       â””â”€â”€ è¿”å›EquipmentStats
â”‚   â”œâ”€â”€ 4. Buffå±æ€§
â”‚   â””â”€â”€ 5. æœ€ç»ˆCharacterStats
â””â”€â”€ ä¼ å…¥PlayerCombatant
```

### 6.3 ä¸è§’è‰²ç³»ç»Ÿé›†æˆ

```
Characterå®ä½“æ‰©å±•
â”œâ”€â”€ å¯¼èˆªå±æ€§ï¼špublic ICollection<GearInstance> EquippedGear { get; set; }
â”œâ”€â”€ è®¡ç®—å±æ€§ï¼špublic EquipmentStats CachedEquipmentStats { get; private set; }
â””â”€â”€ æ–¹æ³•ï¼špublic void InvalidateEquipmentCache()
```

### 6.4 ä¸èƒŒåŒ…ç³»ç»Ÿé›†æˆ

```
èƒŒåŒ…ç‰©å“ç±»å‹æ‰©å±•
â”œâ”€â”€ ç°æœ‰ï¼šæ™®é€šç‰©å“ï¼ˆææ–™/æ¶ˆè€—å“ï¼‰
â”œâ”€â”€ ã€æ–°å¢ã€‘è£…å¤‡ç±»å‹
â”‚   â”œâ”€â”€ ItemIdæ ¼å¼ï¼š"gear:{gearInstanceId}"
â”‚   â”œâ”€â”€ Quantityå›ºå®šä¸º1
â”‚   â””â”€â”€ å…³è”åˆ°GearInstanceè¡¨
â””â”€â”€ å‰ç«¯InventoryPanelæ˜¾ç¤ºè£…å¤‡
```

---

## 7. æŠ€æœ¯å®ç°è¦ç‚¹

### 7.1 è£…å¤‡ç”Ÿæˆç®—æ³•

```csharp
public class GearGenerationService
{
    private readonly RNGContext _rng;
    private readonly IGearDefinitionRepository _definitions;
    private readonly IAffixRepository _affixes;

    public GearInstance Generate(string gearDefId, int characterLevel, RNGContext rng)
    {
        var def = _definitions.GetById(gearDefId);
        
        // 1. ç¡®å®šç¨€æœ‰åº¦
        var rarity = RollRarity(def.RarityWeights, rng);
        
        // 2. ç¡®å®šå“çº§ï¼ˆé»˜è®¤T1ï¼‰
        var tier = 1;
        
        // 3. è®¡ç®—ç‰©å“ç­‰çº§
        var itemLevel = characterLevel + GetRarityBonus(rarity);
        
        // 4. RollåŸºç¡€å±æ€§
        var rolledStats = RollBaseStats(def.BaseStats, tier, rng);
        
        // 5. ç”Ÿæˆè¯æ¡
        var affixCount = GetAffixCount(rarity);
        var affixes = GenerateAffixes(def.AllowedAffixPool, affixCount, rng);
        
        // 6. è®¡ç®—è£…å¤‡è¯„åˆ†
        var score = CalculateQualityScore(rolledStats, affixes, rarity, tier);
        
        return new GearInstance
        {
            DefinitionId = gearDefId,
            Rarity = rarity,
            TierLevel = tier,
            ItemLevel = itemLevel,
            RolledStats = rolledStats,
            Affixes = affixes,
            QualityScore = score
        };
    }
}
```

### 7.2 å±æ€§èšåˆç®—æ³•

```csharp
public class StatsAggregationService
{
    public Dictionary<string, double> CalculateEquipmentStats(Guid characterId)
    {
        var equippedGear = _repository.GetEquippedGear(characterId);
        
        var stats = new Dictionary<string, double>();
        
        // 1. èšåˆåŸºç¡€å±æ€§å’Œè¯æ¡
        foreach (var gear in equippedGear)
        {
            // åŸºç¡€å±æ€§
            foreach (var (stat, value) in gear.RolledStats)
            {
                stats[stat] = stats.GetValueOrDefault(stat) + value;
            }
            
            // è¯æ¡å±æ€§
            foreach (var affix in gear.Affixes)
            {
                var value = CalculateAffixValue(affix);
                stats[affix.StatType] = stats.GetValueOrDefault(affix.StatType) + value;
            }
        }
        
        // 2. å¥—è£…åŠ æˆ
        var setBonuses = _setBonusService.CalculateSetBonuses(equippedGear);
        foreach (var (stat, value) in setBonuses)
        {
            stats[stat] = stats.GetValueOrDefault(stat) + value;
        }
        
        // 3. åº”ç”¨æ•°å€¼ä¸Šé™
        ApplyCaps(stats);
        
        return stats;
    }
}
```

### 7.3 æ•°å€¼ç®¡çº¿

```csharp
// æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬13èŠ‚
public double ApplyStatPipeline(
    double baseValue,
    List<StatModifier> additiveModifiers,
    List<StatModifier> multiplicativeModifiers,
    List<StatModifier> finalAdditiveModifiers)
{
    // 1. åŸºç¡€å€¼ + åŠ æ³•ä¿®é¥°ç¬¦
    var afterAdditive = baseValue + additiveModifiers.Sum(m => m.Value);
    
    // 2. ä¹˜æ³•ä¿®é¥°ç¬¦ï¼ˆå ä¹˜ï¼‰
    var afterMultiplicative = afterAdditive;
    foreach (var mod in multiplicativeModifiers)
    {
        afterMultiplicative *= (1.0 + mod.Value);
    }
    
    // 3. æœ€ç»ˆåŠ æ³•ä¿®é¥°ç¬¦
    var final = afterMultiplicative + finalAdditiveModifiers.Sum(m => m.Value);
    
    // 4. åº”ç”¨ä¸Šé™
    return Clamp(final, minValue, maxValue);
}
```

### 7.4 ç¼“å­˜ç­–ç•¥

```csharp
public class EquipmentStatsCache
{
    private readonly ConcurrentDictionary<Guid, (DateTime Timestamp, Dictionary<string, double> Stats)> _cache;
    
    public Dictionary<string, double> GetOrCalculate(Guid characterId, Func<Dictionary<string, double>> calculator)
    {
        if (_cache.TryGetValue(characterId, out var cached))
        {
            // ç¼“å­˜5åˆ†é’Ÿ
            if (DateTime.UtcNow - cached.Timestamp < TimeSpan.FromMinutes(5))
            {
                return cached.Stats;
            }
        }
        
        var stats = calculator();
        _cache[characterId] = (DateTime.UtcNow, stats);
        return stats;
    }
    
    public void Invalidate(Guid characterId)
    {
        _cache.TryRemove(characterId, out _);
    }
}
```

---

## 8. é£é™©ä¸æŒ‘æˆ˜

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| å±æ€§è®¡ç®—æ€§èƒ½é—®é¢˜ | é«˜ | å®ç°ç¼“å­˜æœºåˆ¶ï¼›ä¼˜åŒ–æŸ¥è¯¢ |
| è£…å¤‡ç”Ÿæˆéšæœºæ€§ä¸å¯æ§ | ä¸­ | ä½¿ç”¨RNGContextä¿è¯å¯å›æ”¾ |
| æ•°æ®åº“æŸ¥è¯¢æ…¢ | ä¸­ | æ·»åŠ ç´¢å¼•ï¼›ä½¿ç”¨é¢„åŠ è½½ |
| å‰ç«¯æ¸²æŸ“å¡é¡¿ | ä¸­ | è™šæ‹Ÿæ»šåŠ¨ï¼›æ‡’åŠ è½½ |
| è£…å¤‡æ•°æ®é‡å¤§ | ä½ | å®šæœŸæ¸…ç†ï¼›å½’æ¡£æœºåˆ¶ |

### 8.2 è®¾è®¡é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| æ•°å€¼è†¨èƒ€ | é«˜ | ä¸¥æ ¼æ•°å€¼ç®¡çº¿ï¼›ä¸Šé™æ§åˆ¶ |
| è¯æ¡ç»„åˆä¸å¹³è¡¡ | ä¸­ | æ•°æ®é©±åŠ¨é…ç½®ï¼›çµæ´»è°ƒæ•´ |
| å¥—è£…è¿‡å¼º/è¿‡å¼± | ä¸­ | åˆ†é˜¶æ®µæµ‹è¯•ï¼›é€æ­¥è°ƒæ•´ |
| è£…å¤‡è·å–éš¾åº¦ | ä½ | å¯é…ç½®æ‰è½ç‡ï¼›ä¿åº•æœºåˆ¶ |

### 8.3 å®æ–½é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| å¼€å‘æ—¶é—´è¶…æœŸ | ä¸­ | åˆ†Phaseå®æ–½ï¼›ä¼˜å…ˆæ ¸å¿ƒåŠŸèƒ½ |
| ä¸ç°æœ‰ç³»ç»Ÿå†²çª | ä¸­ | å……åˆ†æµ‹è¯•ï¼›å°æ­¥é›†æˆ |
| æ•°æ®è¿ç§»é—®é¢˜ | ä½ | å‘åå…¼å®¹è®¾è®¡ï¼›è¿ç§»è„šæœ¬ |

---

## 9. æ€»ç»“

### 9.1 æ ¸å¿ƒä»·å€¼

1. **ä¸°å¯Œæ¸¸æˆå†…å®¹**ï¼šè£…å¤‡ç³»ç»Ÿä¸ºç©å®¶æä¾›æ–°çš„æˆé•¿è·¯å¾„
2. **å¢å¼ºæ„ç­‘æ·±åº¦**ï¼šè¯æ¡/å¥—è£…æä¾›å¤šæ ·åŒ–æ„ç­‘é€‰æ‹©
3. **å»¶é•¿æ¸¸æˆå¯¿å‘½**ï¼šè£…å¤‡è¿½æ±‚å’Œä¼˜åŒ–æä¾›é•¿æœŸç›®æ ‡
4. **ç»æµå¾ªç¯å®Œå–„**ï¼šåˆ†è§£/é‡é“¸æ¶ˆè€—é‡‘å¸å’Œææ–™ï¼Œå½¢æˆç»æµå¾ªç¯

### 9.2 å®æ–½å»ºè®®

1. **ä¼˜å…ˆçº§**ï¼šPhase 1-3 æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»å®Œæˆ
2. **è¿­ä»£æ–¹å¼**ï¼šæ¯ä¸ªPhaseå®Œæˆåè¿›è¡Œæµ‹è¯•å’Œè°ƒæ•´
3. **æ•°æ®é©±åŠ¨**ï¼šæ‰€æœ‰æ•°å€¼é…ç½®åŒ–ï¼Œä¾¿äºå¿«é€Ÿè°ƒæ•´å¹³è¡¡æ€§
4. **ç”¨æˆ·åé¦ˆ**ï¼šPhase 4åæ”¶é›†ç”¨æˆ·åé¦ˆï¼ŒæŒ‡å¯¼åç»­å¼€å‘

### 9.3 æˆåŠŸæ ‡å‡†

- âœ… è£…å¤‡ç³»ç»Ÿå®Œæ•´å¯ç”¨ï¼Œæ— é‡å¤§bug
- âœ… è£…å¤‡æ‰è½å’Œç”Ÿæˆæ­£å¸¸å·¥ä½œ
- âœ… è£…å¤‡å±æ€§æ­£ç¡®å½±å“æˆ˜æ–—
- âœ… å‰ç«¯ç•Œé¢ç›´è§‚æ˜“ç”¨
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚ï¼ˆè£…å¤‡æ“ä½œ<500mså“åº”ï¼‰
- âœ… æ•°æ®å¹³è¡¡åˆç†ï¼Œç©å®¶åé¦ˆæ­£é¢

---

## é™„å½•Aï¼šå¿«é€Ÿå‚è€ƒ

### å…³é”®ç±»æ¸…å•

```
åç«¯
â”œâ”€â”€ Domain/Equipment/Models/
â”‚   â”œâ”€â”€ GearDefinition.cs
â”‚   â”œâ”€â”€ GearInstance.cs
â”‚   â”œâ”€â”€ Affix.cs
â”‚   â”œâ”€â”€ AffixInstance.cs
â”‚   â””â”€â”€ GearSet.cs
â”œâ”€â”€ Domain/Equipment/Services/
â”‚   â”œâ”€â”€ GearGenerationService.cs
â”‚   â”œâ”€â”€ EquipmentService.cs
â”‚   â”œâ”€â”€ StatsAggregationService.cs
â”‚   â”œâ”€â”€ DisenchantService.cs
â”‚   â”œâ”€â”€ ReforgeService.cs
â”‚   â””â”€â”€ SetBonusService.cs
â””â”€â”€ Api/
    â””â”€â”€ EquipmentController.cs (æ›´æ–°)

å‰ç«¯
â”œâ”€â”€ Components/
â”‚   â”œâ”€â”€ EquipmentPanel.razor (æ›´æ–°)
â”‚   â”œâ”€â”€ GearEnhancementDialog.razor (æ–°å¢)
â”‚   â””â”€â”€ InventoryPanel.razor (æ›´æ–°)
â””â”€â”€ Services/
    â”œâ”€â”€ ApiModels.cs (æ›´æ–°)
    â””â”€â”€ ApiClient.cs (æ›´æ–°)
```

### APIç«¯ç‚¹æ¸…å•

```
GET    /api/equipment/{characterId}              è·å–è£…å¤‡æ 
POST   /api/equipment/{characterId}/{slot}       è£…å¤‡ç‰©å“
DELETE /api/equipment/{characterId}/{slot}       å¸ä¸‹è£…å¤‡
GET    /api/equipment/{characterId}/stats        è·å–è£…å¤‡æ€»å±æ€§
POST   /api/equipment/{gearId}/disenchant       åˆ†è§£è£…å¤‡
POST   /api/equipment/{gearId}/reforge          å“çº§é‡é“¸
POST   /api/equipment/{gearId}/reroll-affixes   è¯æ¡é‡ç½®
```

---

**æ–‡æ¡£ç»“æŸ**
