# æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ

## æ¦‚è¿°

æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿä¸ºå‰ç«¯æä¾›è¯¦ç»†çš„æˆ˜æ–—æ¶ˆæ¯é€šçŸ¥ï¼Œæ”¯æŒå®Œå…¨å¯é…ç½®çš„æ¶ˆæ¯æ¨¡æ¿ã€‚

## ç‰¹æ€§

âœ… **å®Œå…¨é…ç½®åŒ–** - æ‰€æœ‰æ¶ˆæ¯æ¨¡æ¿éƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ— éœ€ä¿®æ”¹ä»£ç   
âœ… **é«˜å¯æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹å’Œæ¶ˆæ¯æ¨¡æ¿  
âœ… **å‘åå…¼å®¹** - ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨  
âœ… **å…¨é¢æµ‹è¯•** - 9ä¸ªå•å…ƒæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡  
âœ… **è¯¦ç»†æ–‡æ¡£** - åŒ…å«å®æ–½æŠ¥å‘Šå’Œå¿«é€Ÿå¼€å§‹æŒ‡å—

## æ”¯æŒçš„äº‹ä»¶ç±»å‹

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹æ¶ˆæ¯ |
|---------|------|---------|
| **AttackStart** | æ”»å‡»å¼€å§‹ | "å‹‡è€… å¼€å§‹æ”»å‡» å²è±å§†" |
| **DamageDealt** | ä¼¤å®³é€ æˆ | "å‹‡è€… å¯¹ å²è±å§† é€ æˆ 50 ç‚¹ç‰©ç†ä¼¤å®³" |
| **DamageReceived** | ä¼¤å®³æ¥æ”¶ | "å‹‡è€… å—åˆ° å“¥å¸ƒæ— çš„ 15 ç‚¹ç‰©ç†ä¼¤å®³ï¼ˆå‰©ä½™ 85/100ï¼‰" |

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ–‡ä»¶ä½ç½®

ä¸»é…ç½®ï¼š`BlazorIdle.Server/Config/BattleEvents/battle-events-config.json`

### 2. è‡ªå®šä¹‰æ¶ˆæ¯æ¨¡æ¿

```json
{
  "Messages": {
    "AttackStart": {
      "PlayerAttacksEnemy": "âš”ï¸ {attacker} å†²å‘ {target}ï¼"
    },
    "DamageDealt": {
      "Normal": "ğŸ’¥ {attacker} å¯¹ {target} é€ æˆ {damage} ç‚¹{damageType}ä¼¤å®³",
      "Critical": "ğŸ”¥ æš´å‡»ï¼{attacker} å¯¹ {target} é€ æˆ {damage} ç‚¹{damageType}ä¼¤å®³ï¼"
    }
  }
}
```

### 3. å¯ç”¨å ä½ç¬¦

- `{attacker}` - æ”»å‡»è€…åç§°
- `{target}` - ç›®æ ‡åç§°
- `{receiver}` - æ¥æ”¶è€…åç§°
- `{damage}` - ä¼¤å®³å€¼
- `{damageType}` - ä¼¤å®³ç±»å‹ï¼ˆè‡ªåŠ¨ç¿»è¯‘ï¼‰
- `{currentHp}` - å½“å‰è¡€é‡
- `{maxHp}` - æœ€å¤§è¡€é‡

### 4. å¯ç”¨/ç¦ç”¨äº‹ä»¶

åœ¨ `battle-events-config.json` ä¸­ï¼š

```json
{
  "EnableBattleEventMessages": true,
  "Messages": {
    "AttackStart": {
      "Enabled": true
    }
  }
}
```

æˆ–åœ¨ `signalr-config.json` ä¸­ï¼š

```json
{
  "Notification": {
    "EnableAttackStartNotification": true,
    "EnableDamageDealtNotification": true,
    "EnableDamageReceivedNotification": true
  }
}
```

## æ–‡æ¡£å¯¼èˆª

- **[æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå®æ–½æŠ¥å‘Š](./æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå®æ–½æŠ¥å‘Š.md)** - è¯¦ç»†çš„æŠ€æœ¯å®ç°è¯´æ˜
  - ç³»ç»Ÿæ¶æ„è®¾è®¡
  - é…ç½®ç³»ç»Ÿè¯¦è§£
  - ä»£ç å®ç°ç»†èŠ‚
  - æµ‹è¯•è¦†ç›–æŠ¥å‘Š
  - å¯æ‰©å±•æ€§æŒ‡å—

- **[æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå¿«é€Ÿå¼€å§‹](./æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md)** - ä½¿ç”¨æŒ‡å—
  - é…ç½®æ–‡ä»¶è¯´æ˜
  - æ¶ˆæ¯æ¨¡æ¿ç¤ºä¾‹
  - å‰ç«¯é›†æˆç¤ºä¾‹
  - å¸¸è§é—®é¢˜è§£ç­”
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

## æŠ€æœ¯æ ˆ

- **.NET 9.0** - åç«¯æ¡†æ¶
- **SignalR** - å®æ—¶é€šä¿¡
- **xUnit** - å•å…ƒæµ‹è¯•
- **JSON** - é…ç½®æ–‡ä»¶æ ¼å¼

## æ–‡ä»¶ç»“æ„

```
BlazorIdle/
â”œâ”€â”€ BlazorIdle.Server/
â”‚   â”œâ”€â”€ Config/
â”‚   â”‚   â”œâ”€â”€ BattleEvents/
â”‚   â”‚   â”‚   â””â”€â”€ battle-events-config.json         # æˆ˜æ–—äº‹ä»¶é…ç½®
â”‚   â”‚   â”œâ”€â”€ SignalR/
â”‚   â”‚   â”‚   â””â”€â”€ signalr-config.json               # SignalRé…ç½®
â”‚   â”‚   â”œâ”€â”€ BattleEventsOptions.cs                # é…ç½®ç±»å®šä¹‰
â”‚   â”‚   â””â”€â”€ SignalROptions.cs                     # SignalRé€‰é¡¹
â”‚   â”œâ”€â”€ Domain/Combat/
â”‚   â”‚   â”œâ”€â”€ AttackTickEvent.cs                    # ç©å®¶æ”»å‡»äº‹ä»¶ï¼ˆå·²ä¿®æ”¹ï¼‰
â”‚   â”‚   â””â”€â”€ EnemyAttackEvent.cs                   # æ•Œäººæ”»å‡»äº‹ä»¶ï¼ˆå·²ä¿®æ”¹ï¼‰
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ BattleEventMessageFormatter.cs        # æ¶ˆæ¯æ ¼å¼åŒ–æœåŠ¡
â”‚       â””â”€â”€ BattleNotificationService.cs          # é€šçŸ¥æœåŠ¡ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ BlazorIdle.Shared/
â”‚   â””â”€â”€ Models/
â”‚       â””â”€â”€ BattleNotifications.cs                # äº‹ä»¶DTOå®šä¹‰ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ BlazorIdle.Tests/
â”‚       â””â”€â”€ BattleEventNotificationTests.cs       # å•å…ƒæµ‹è¯•
â””â”€â”€ docs/
    â”œâ”€â”€ æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ-README.md                  # æœ¬æ–‡æ¡£
    â”œâ”€â”€ æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå®æ–½æŠ¥å‘Š.md                  # å®æ–½æŠ¥å‘Š
    â””â”€â”€ æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md                  # å¿«é€Ÿå¼€å§‹
```

## æµ‹è¯•ç»“æœ

```
Test Run Successful.
Total tests: 9
     Passed: 9
     Failed: 0
 Total time: 0.9316 Seconds
```

### æµ‹è¯•è¦†ç›–

- âœ… ç©å®¶æ”»å‡»äº‹ä»¶é€šçŸ¥
- âœ… æ•Œäººæ”»å‡»äº‹ä»¶é€šçŸ¥
- âœ… ä¼¤å®³é€ æˆäº‹ä»¶é€šçŸ¥
- âœ… ä¼¤å®³æ¥æ”¶äº‹ä»¶é€šçŸ¥
- âœ… æ¶ˆæ¯æ¨¡æ¿æ ¼å¼åŒ–
- âœ… å ä½ç¬¦æ›¿æ¢
- âœ… æš´å‡»æ¶ˆæ¯å¤„ç†

## ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯ç›‘å¬äº‹ä»¶

```typescript
connection.on("BattleEvent", (eventData) => {
    switch (eventData.eventType) {
        case "AttackStart":
            showMessage(`${eventData.attackerName} å¼€å§‹æ”»å‡» ${eventData.targetName}`);
            break;
        case "DamageDealt":
            const crit = eventData.isCrit ? "æš´å‡»ï¼" : "";
            showMessage(`${crit}é€ æˆ ${eventData.damage} ç‚¹ä¼¤å®³`);
            break;
        case "DamageReceived":
            showMessage(`å—åˆ° ${eventData.damage} ç‚¹ä¼¤å®³ï¼ˆå‰©ä½™ ${eventData.currentHp}/${eventData.maxHp}ï¼‰`, "danger");
            break;
    }
});
```

## æ‰©å±•æ€§

ç³»ç»Ÿæ”¯æŒè½»æ¾æ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹ï¼š

1. åœ¨ `BattleNotifications.cs` ä¸­å®šä¹‰æ–°çš„ DTO
2. åœ¨ `BattleEventsOptions.cs` ä¸­æ·»åŠ é…ç½®ç±»
3. åœ¨ `battle-events-config.json` ä¸­æ·»åŠ æ¨¡æ¿
4. åœ¨äº‹ä»¶è§¦å‘ç‚¹å‘é€é€šçŸ¥
5. åœ¨ `BattleEventMessageFormatter` ä¸­æ·»åŠ æ ¼å¼åŒ–æ–¹æ³•

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ[å®æ–½æŠ¥å‘Š](./æˆ˜æ–—äº‹ä»¶é€šçŸ¥ç³»ç»Ÿå®æ–½æŠ¥å‘Š.md#å¯æ‰©å±•æ€§è®¾è®¡)ã€‚

## æ€§èƒ½ç‰¹ç‚¹

- **å¼‚æ­¥é€šçŸ¥**ï¼šä½¿ç”¨ `_ = Task` ä¸ç­‰å¾…ï¼Œä¸é˜»å¡æˆ˜æ–—é€»è¾‘
- **é…ç½®è¿‡æ»¤**ï¼šé€šè¿‡é…ç½®ç¦ç”¨ä¸éœ€è¦çš„äº‹ä»¶ï¼Œå‡å°‘ç½‘ç»œæµé‡
- **æœ€å°ä¾µå…¥**ï¼šä»…åœ¨äº‹ä»¶è§¦å‘ç‚¹æ·»åŠ é€šçŸ¥ä»£ç ï¼Œä¸å½±å“æ ¸å¿ƒé€»è¾‘

## ç‰ˆæœ¬ä¿¡æ¯

- **åˆå§‹ç‰ˆæœ¬**ï¼š1.0.0
- **å‘å¸ƒæ—¥æœŸ**ï¼š2025-10-14
- **å…¼å®¹æ€§**ï¼šBlazorIdle v2.x+

## åç»­è®¡åˆ’

- [ ] æ·»åŠ æŠ€èƒ½æ–½æ”¾äº‹ä»¶
- [ ] æ·»åŠ Buffç”Ÿæ•ˆ/å¤±æ•ˆäº‹ä»¶
- [ ] æ·»åŠ æ³¢æ¬¡åˆ·æ–°äº‹ä»¶
- [ ] æ”¯æŒå¤šè¯­è¨€æ¶ˆæ¯æ¨¡æ¿
- [ ] å‰ç«¯æˆ˜æ–—æ—¥å¿—ç»„ä»¶

## è´¡çŒ®è€…

- Solaireshen97 - é¡¹ç›®ç»´æŠ¤è€…

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯ã€‚

## ç›¸å…³é“¾æ¥

- [SignalR é›†æˆä¼˜åŒ–æ–¹æ¡ˆ](./SignalRé›†æˆä¼˜åŒ–æ–¹æ¡ˆ.md)
- [SignalR è½»é‡äº‹ä»¶ä¼˜åŒ–æŒ‡å—](./SignalRè½»é‡äº‹ä»¶ä¼˜åŒ–æŒ‡å—.md)
- [æˆ˜æ–—ç³»ç»Ÿ Phase 4 å®ŒæˆæŠ¥å‘Š](./æˆ˜æ–—ç³»ç»ŸPhase4å®ŒæˆæŠ¥å‘Š.md)
