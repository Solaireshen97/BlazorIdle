# æ—¥å¿—è§„èŒƒæ–‡æ¡£

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
**é€‚ç”¨èŒƒå›´**: BlazorIdle.Server é¡¹ç›®  
**æ‰€å±é˜¶æ®µ**: Phase 5ï¼ˆæ—¥å¿—ç³»ç»Ÿè®¾è®¡ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ—¥å¿—çº§åˆ«è§„èŒƒ](#æ—¥å¿—çº§åˆ«è§„èŒƒ)
3. [ç»“æ„åŒ–æ—¥å¿—æ¨¡æ¿](#ç»“æ„åŒ–æ—¥å¿—æ¨¡æ¿)
4. [æ ¸å¿ƒä¸šåŠ¡æ—¥å¿—ç‚¹](#æ ¸å¿ƒä¸šåŠ¡æ—¥å¿—ç‚¹)
5. [æ—¥å¿—é…ç½®](#æ—¥å¿—é…ç½®)
6. [å®æ–½æŒ‡å—](#å®æ–½æŒ‡å—)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [ç¤ºä¾‹ä»£ç ](#ç¤ºä¾‹ä»£ç )

---

## æ¦‚è¿°

### è®¾è®¡åŸåˆ™

æœ¬æ—¥å¿—è§„èŒƒéµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

1. **ç»“æ„åŒ–æ—¥å¿—** - ä½¿ç”¨å‚æ•°åŒ–æ—¥å¿—ï¼Œä¾¿äºæŸ¥è¯¢å’Œåˆ†æ
2. **åˆç†åˆ†çº§** - æŒ‰é‡è¦æ€§å’Œç”¨é€”æ­£ç¡®ä½¿ç”¨æ—¥å¿—çº§åˆ«
3. **æ€§èƒ½è€ƒè™‘** - é¿å…è¿‡åº¦æ—¥å¿—å½±å“æ€§èƒ½
4. **å®‰å…¨æ„è¯†** - ä¸è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€Tokenç­‰ï¼‰
5. **å¯ç»´æŠ¤æ€§** - æ—¥å¿—ä¿¡æ¯æ¸…æ™°ã€ä¸€è‡´ã€æ˜“äºç†è§£

### æ—¥å¿—æ¡†æ¶

é¡¹ç›®ä½¿ç”¨ Microsoft.Extensions.Logging æ¡†æ¶ï¼Œæ”¯æŒï¼š
- âœ… ç»“æ„åŒ–æ—¥å¿—ï¼ˆæ”¯æŒå‚æ•°åŒ–ï¼‰
- âœ… å¤šç§è¾“å‡ºç›®æ ‡ï¼ˆæ§åˆ¶å°ã€æ–‡ä»¶ã€ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰
- âœ… æ—¥å¿—çº§åˆ«è¿‡æ»¤
- âœ… ä¾èµ–æ³¨å…¥é›†æˆ

---

## æ—¥å¿—çº§åˆ«è§„èŒƒ

### çº§åˆ«å®šä¹‰

| çº§åˆ« | æ•°å€¼ | ç”¨é€” | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|------|------|----------|------|
| **Trace** | 0 | æœ€è¯¦ç»†è¿½è¸ª | å¼€å‘è°ƒè¯•ï¼Œè¯¦ç»†æ‰§è¡Œè·¯å¾„ | æ¯ä¸ªäº‹ä»¶çš„è§¦å‘æ—¶é—´ |
| **Debug** | 1 | è°ƒè¯•ä¿¡æ¯ | å¼€å‘ç¯å¢ƒï¼Œä¸­é—´å€¼éªŒè¯ | ä¼¤å®³è®¡ç®—çš„ä¸­é—´æ­¥éª¤ |
| **Information** | 2 | å…³é”®èŠ‚ç‚¹ | ç”Ÿäº§ç¯å¢ƒï¼Œä¸šåŠ¡æµç¨‹æ ‡è®° | æˆ˜æ–—å¼€å§‹ã€äº¤æ˜“å®Œæˆ |
| **Warning** | 3 | å¼‚å¸¸ä½†å¯æ¢å¤ | é…ç½®ç¼ºå¤±ã€èµ„æºä¸è¶³ | æŠ€èƒ½å†·å´ä¸­æ— æ³•é‡Šæ”¾ |
| **Error** | 4 | é”™è¯¯éœ€å¤„ç† | ä¸šåŠ¡é€»è¾‘é”™è¯¯ã€æ•°æ®å¼‚å¸¸ | è£…å¤‡ç©¿æˆ´å¤±è´¥ |
| **Critical** | 5 | ä¸¥é‡è‡´å‘½ | ç³»ç»Ÿå´©æºƒã€æ•°æ®æŸå | æ•°æ®åº“è¿æ¥å¤±è´¥ |

### ä½¿ç”¨æŒ‡å—

#### Trace - è¯¦ç»†è¿½è¸ª
```csharp
// âŒ ä¸æ¨èï¼šç”Ÿäº§ç¯å¢ƒé»˜è®¤å…³é—­ï¼Œä¸åº”ä¾èµ–
_logger.LogTrace("å¼€å§‹è®¡ç®—...");

// âœ… æ¨èï¼šç”¨äºè°ƒè¯•å¤æ‚æµç¨‹
_logger.LogTrace(
    "æˆ˜æ–—äº‹ä»¶è§¦å‘: EventType={EventType}, Time={Time}, Source={Source}",
    eventType,
    triggerTime,
    sourceId
);
```

#### Debug - è°ƒè¯•ä¿¡æ¯
```csharp
// âœ… æ¨èï¼šè®°å½•ä¸­é—´è®¡ç®—ç»“æœ
_logger.LogDebug(
    "ä¼¤å®³è®¡ç®—: Base={Base}, AttackPower={AttackPower}, Final={Final}",
    baseDamage,
    attackPower,
    finalDamage
);

// âœ… æ¨èï¼šè®°å½•ä¸šåŠ¡çŠ¶æ€å˜åŒ–
_logger.LogDebug(
    "è£…å¤‡å±æ€§èšåˆ: SlotCount={SlotCount}, TotalStats={TotalStats}",
    slotCount,
    JsonSerializer.Serialize(totalStats)
);
```

#### Information - å…³é”®èŠ‚ç‚¹
```csharp
// âœ… æ¨èï¼šä¸šåŠ¡æµç¨‹çš„å¼€å§‹å’Œç»“æŸ
_logger.LogInformation(
    "å¼€å§‹æˆ˜æ–—: CharacterId={CharacterId}, EnemyId={EnemyId}, Mode={Mode}",
    characterId,
    enemyId,
    battleMode
);

_logger.LogInformation(
    "æˆ˜æ–—ç»“æŸ: Duration={Duration}s, Victory={Victory}, Rewards={Rewards}",
    duration.TotalSeconds,
    isVictory,
    rewardCount
);

// âœ… æ¨èï¼šé‡è¦çš„çŠ¶æ€å˜æ›´
_logger.LogInformation(
    "è§’è‰²å‡çº§: CharacterId={CharacterId}, OldLevel={OldLevel}, NewLevel={NewLevel}",
    characterId,
    oldLevel,
    newLevel
);
```

#### Warning - å¼‚å¸¸æƒ…å†µ
```csharp
// âœ… æ¨èï¼šå¯æ¢å¤çš„å¼‚å¸¸æƒ…å†µ
_logger.LogWarning(
    "æŠ€èƒ½å†·å´ä¸­: SkillId={SkillId}, RemainingCooldown={Remaining}s",
    skillId,
    remainingCooldown
);

// âœ… æ¨èï¼šé…ç½®ç¼ºå¤±ä½†æœ‰é»˜è®¤å€¼
_logger.LogWarning(
    "é…ç½®é¡¹ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼: Key={Key}, DefaultValue={DefaultValue}",
    configKey,
    defaultValue
);
```

#### Error - é”™è¯¯éœ€å¤„ç†
```csharp
// âœ… æ¨èï¼šæ•è·çš„å¼‚å¸¸
_logger.LogError(
    ex,
    "è£…å¤‡ç©¿æˆ´å¤±è´¥: CharacterId={CharacterId}, EquipmentId={EquipmentId}",
    characterId,
    equipmentId
);

// âœ… æ¨èï¼šä¸šåŠ¡è§„åˆ™è¿å
_logger.LogError(
    "éæ³•æ“ä½œ: å°è¯•è£…å¤‡é”™è¯¯èŒä¸šçš„è£…å¤‡, CharacterId={CharacterId}, EquipmentId={EquipmentId}",
    characterId,
    equipmentId
);
```

#### Critical - ä¸¥é‡è‡´å‘½
```csharp
// âœ… æ¨èï¼šç³»ç»Ÿçº§è‡´å‘½é”™è¯¯
_logger.LogCritical(
    ex,
    "æ•°æ®åº“è¿æ¥å¤±è´¥: ConnectionString={ConnectionString}",
    connectionStringMasked  // æ³¨æ„ï¼šé®è”½æ•æ„Ÿä¿¡æ¯
);
```

---

## ç»“æ„åŒ–æ—¥å¿—æ¨¡æ¿

### åŸºæœ¬æ¨¡æ¿

#### æœåŠ¡å…¥å£æ—¥å¿—
```csharp
_logger.LogInformation(
    "å¼€å§‹å¤„ç† {Operation}ï¼Œå‚æ•°: CharacterId={CharacterId}, Param1={Param1}",
    operationName,
    characterId,
    param1
);
```

#### æœåŠ¡å‡ºå£æ—¥å¿—
```csharp
_logger.LogInformation(
    "å®Œæˆå¤„ç† {Operation}ï¼Œè€—æ—¶: {ElapsedMs}ms, ç»“æœ: {Result}",
    operationName,
    elapsed.TotalMilliseconds,
    result
);
```

#### ä¸šåŠ¡é€»è¾‘æ—¥å¿—
```csharp
_logger.LogDebug(
    "è®¡ç®— {Calculation}: Input={Input}, Multiplier={Multiplier}, Output={Output}",
    calculationType,
    inputValue,
    multiplier,
    outputValue
);
```

#### é”™è¯¯å¤„ç†æ—¥å¿—
```csharp
_logger.LogError(
    ex,
    "å¤„ç† {Operation} å¤±è´¥ï¼Œå‚æ•°: CharacterId={CharacterId}, Reason={Reason}",
    operationName,
    characterId,
    ex.Message
);
```

### å‘½åçº¦å®š

#### å‚æ•°å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|----------|------|
| å®ä½“ID | `{Entity}Id` | CharacterId, EquipmentId |
| è®¡æ•° | `{Entity}Count` | EventCount, RewardCount |
| æŒç»­æ—¶é—´ | `{Action}Duration` / `Elapsed{Unit}` | BattleDuration, ElapsedMs |
| çŠ¶æ€ | `Is{State}` / `Has{Feature}` | IsVictory, HasRewards |
| æ“ä½œå | `Operation` | "è´­ä¹°è£…å¤‡", "æˆ˜æ–—ç»“ç®—" |

#### æ—¥å¿—æ¶ˆæ¯æ ¼å¼

```csharp
// âœ… æ¨èï¼šæ¸…æ™°çš„æ“ä½œæè¿° + ç»“æ„åŒ–å‚æ•°
_logger.LogInformation(
    "è§’è‰²è´­ä¹°å•†å“: CharacterId={CharacterId}, ItemId={ItemId}, Quantity={Quantity}, Cost={Cost}",
    characterId, itemId, quantity, cost
);

// âŒ ä¸æ¨èï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéš¾ä»¥è§£æ
_logger.LogInformation($"è§’è‰²{characterId}è´­ä¹°äº†{quantity}ä¸ª{itemId}ï¼ŒèŠ±è´¹{cost}é‡‘å¸");
```

---

## æ ¸å¿ƒä¸šåŠ¡æ—¥å¿—ç‚¹

### 1. æˆ˜æ–—ç³»ç»Ÿï¼ˆBattleEngineï¼‰

#### 1.1 æˆ˜æ–—ç”Ÿå‘½å‘¨æœŸ

```csharp
// æˆ˜æ–—å¼€å§‹
_logger.LogInformation(
    "æˆ˜æ–—å¼€å§‹: CharacterId={CharacterId}, EnemyId={EnemyId}, EnemyLevel={EnemyLevel}, Mode={Mode}",
    characterId, enemyId, enemyLevel, battleMode
);

// æ³¢æ¬¡åˆ‡æ¢
_logger.LogInformation(
    "æ³¢æ¬¡åˆ‡æ¢: BattleId={BattleId}, OldWave={OldWave}, NewWave={NewWave}, TotalWaves={TotalWaves}",
    battleId, oldWave, newWave, totalWaves
);

// æˆ˜æ–—ç»“æŸ
_logger.LogInformation(
    "æˆ˜æ–—ç»“æŸ: BattleId={BattleId}, Duration={Duration}s, Victory={Victory}, EventCount={EventCount}",
    battleId, duration.TotalSeconds, isVictory, eventCount
);
```

#### 1.2 æˆ˜æ–—äº‹ä»¶

```csharp
// è§’è‰²æ­»äº¡ï¼ˆInformationï¼‰
_logger.LogInformation(
    "è§’è‰²æ­»äº¡: CharacterId={CharacterId}, BattleTime={BattleTime}s, WaveNumber={WaveNumber}",
    characterId, battleTime, waveNumber
);

// è§’è‰²å¤æ´»ï¼ˆInformationï¼‰
_logger.LogInformation(
    "è§’è‰²å¤æ´»: CharacterId={CharacterId}, ReviveTime={ReviveTime}s",
    characterId, reviveTime
);

// æŠ€èƒ½é‡Šæ”¾ï¼ˆDebugï¼‰
_logger.LogDebug(
    "æŠ€èƒ½é‡Šæ”¾: SkillId={SkillId}, CasterId={CasterId}, TargetCount={TargetCount}, Time={Time}s",
    skillId, casterId, targetCount, battleTime
);

// ä¼¤å®³è®¡ç®—ï¼ˆTraceï¼‰
_logger.LogTrace(
    "ä¼¤å®³è®¡ç®—: AttackerId={AttackerId}, TargetId={TargetId}, BaseDamage={BaseDamage}, FinalDamage={FinalDamage}",
    attackerId, targetId, baseDamage, finalDamage
);
```

### 2. ç»æµç³»ç»Ÿï¼ˆRewardGrantServiceï¼‰

```csharp
// å¥–åŠ±å‘æ”¾å¼€å§‹
_logger.LogInformation(
    "å¼€å§‹å‘æ”¾å¥–åŠ±: CharacterId={CharacterId}, RewardType={RewardType}, Source={Source}",
    characterId, rewardType, source
);

// é‡‘å¸å˜æ›´
_logger.LogInformation(
    "é‡‘å¸å˜æ›´: CharacterId={CharacterId}, Delta={Delta}, NewBalance={NewBalance}, Source={Source}",
    characterId, goldDelta, newBalance, source
);

// ç»éªŒå˜æ›´
_logger.LogInformation(
    "ç»éªŒå˜æ›´: CharacterId={CharacterId}, Delta={Delta}, NewExp={NewExp}, LevelUp={LevelUp}",
    characterId, expDelta, newExp, levelUp
);

// å¹‚ç­‰æ€§æ£€æŸ¥
_logger.LogWarning(
    "é‡å¤å¥–åŠ±è¯·æ±‚: CharacterId={CharacterId}, RewardId={RewardId}, å·²å¿½ç•¥",
    characterId, rewardId
);
```

### 3. è£…å¤‡ç³»ç»Ÿï¼ˆEquipmentServiceï¼‰

```csharp
// è£…å¤‡ç©¿æˆ´
_logger.LogInformation(
    "è£…å¤‡ç©¿æˆ´: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Slot={Slot}",
    characterId, equipmentId, slot
);

// è£…å¤‡å¸ä¸‹
_logger.LogInformation(
    "è£…å¤‡å¸ä¸‹: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Slot={Slot}",
    characterId, equipmentId, slot
);

// è£…å¤‡åˆ†è§£
_logger.LogInformation(
    "è£…å¤‡åˆ†è§£: CharacterId={CharacterId}, EquipmentId={EquipmentId}, MaterialsGained={MaterialsGained}",
    characterId, equipmentId, materialsCount
);

// è£…å¤‡é‡é“¸
_logger.LogInformation(
    "è£…å¤‡é‡é“¸: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Cost={Cost}, Success={Success}",
    characterId, equipmentId, cost, success
);

// å±æ€§è®¡ç®—ï¼ˆDebugï¼‰
_logger.LogDebug(
    "å±æ€§èšåˆ: CharacterId={CharacterId}, EquippedCount={EquippedCount}, TotalAttack={TotalAttack}",
    characterId, equippedCount, totalAttack
);

// éªŒè¯å¤±è´¥ï¼ˆWarningï¼‰
_logger.LogWarning(
    "è£…å¤‡éªŒè¯å¤±è´¥: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Reason={Reason}",
    characterId, equipmentId, failureReason
);
```

### 4. æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿï¼ˆActivityPlansControllerï¼‰

```csharp
// è®¡åˆ’åˆ›å»º
_logger.LogInformation(
    "æ´»åŠ¨è®¡åˆ’åˆ›å»º: CharacterId={CharacterId}, PlanId={PlanId}, ActivityType={ActivityType}",
    characterId, planId, activityType
);

// è®¡åˆ’æ‰§è¡Œå¼€å§‹
_logger.LogInformation(
    "æ´»åŠ¨å¼€å§‹æ‰§è¡Œ: PlanId={PlanId}, CharacterId={CharacterId}, ActivityType={ActivityType}",
    planId, characterId, activityType
);

// è®¡åˆ’æ‰§è¡Œå®Œæˆ
_logger.LogInformation(
    "æ´»åŠ¨æ‰§è¡Œå®Œæˆ: PlanId={PlanId}, Duration={Duration}s, Outcome={Outcome}",
    planId, duration.TotalSeconds, outcome
);

// ç¦»çº¿ç»“ç®—
_logger.LogInformation(
    "ç¦»çº¿ç»“ç®—: CharacterId={CharacterId}, OfflineDuration={OfflineDuration}min, RewardsGranted={RewardsGranted}",
    characterId, offlineDuration.TotalMinutes, rewardsCount
);
```

### 5. ç”¨æˆ·è®¤è¯ï¼ˆAuthControllerï¼‰

```csharp
// ç™»å½•æˆåŠŸ
_logger.LogInformation(
    "ç”¨æˆ·ç™»å½•æˆåŠŸ: Username={Username}, IpAddress={IpAddress}",
    username, ipAddress
);

// ç™»å½•å¤±è´¥
_logger.LogWarning(
    "ç”¨æˆ·ç™»å½•å¤±è´¥: Username={Username}, Reason={Reason}, IpAddress={IpAddress}",
    username, failureReason, ipAddress
);

// Tokenç”Ÿæˆ
_logger.LogDebug(
    "ç”ŸæˆJWT Token: UserId={UserId}, ExpiresIn={ExpiresIn}min",
    userId, expiresInMinutes
);

// æƒé™éªŒè¯å¤±è´¥
_logger.LogWarning(
    "æƒé™éªŒè¯å¤±è´¥: UserId={UserId}, RequiredRole={RequiredRole}, Action={Action}",
    userId, requiredRole, action
);
```

---

## æ—¥å¿—é…ç½®

### appsettings.json é…ç½®ç¤ºä¾‹

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.AspNetCore": "Warning",
      "BlazorIdle.Server.Domain.Combat": "Debug",
      "BlazorIdle.Server.Domain.Equipment": "Information",
      "BlazorIdle.Server.Api": "Information"
    }
  }
}
```

### å¼€å‘ç¯å¢ƒé…ç½®

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "BlazorIdle.Server": "Trace"
    }
  }
}
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "BlazorIdle.Server.Domain.Combat.Engine": "Information",
      "BlazorIdle.Server.Domain.Combat.Events": "Warning"
    }
  }
}
```

---

## å®æ–½æŒ‡å—

### æ·»åŠ æ—¥å¿—çš„æ­¥éª¤

1. **æ³¨å…¥ILogger**
```csharp
public class BattleEngine
{
    private readonly ILogger<BattleEngine> _logger;
    
    public BattleEngine(ILogger<BattleEngine> logger)
    {
        _logger = logger;
    }
}
```

2. **ç¡®å®šæ—¥å¿—ç‚¹ä½ç½®**
   - æœåŠ¡æ–¹æ³•å…¥å£å’Œå‡ºå£
   - å…³é”®ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹
   - å¼‚å¸¸å¤„ç†ä»£ç å—
   - æ€§èƒ½æ•æ„Ÿæ“ä½œ

3. **é€‰æ‹©åˆé€‚çš„çº§åˆ«**
   - å‚è€ƒ[æ—¥å¿—çº§åˆ«è§„èŒƒ](#æ—¥å¿—çº§åˆ«è§„èŒƒ)
   - è€ƒè™‘ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—é‡

4. **ç¼–å†™ç»“æ„åŒ–æ—¥å¿—**
   - ä½¿ç”¨å‚æ•°åŒ–æ ¼å¼
   - éµå¾ªå‘½åçº¦å®š
   - åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯

5. **æµ‹è¯•æ—¥å¿—è¾“å‡º**
   - åœ¨å¼€å‘ç¯å¢ƒéªŒè¯
   - æ£€æŸ¥æ—¥å¿—æ ¼å¼å’Œå†…å®¹
   - ç¡®è®¤æ€§èƒ½å½±å“å¯æ¥å—

---

## æœ€ä½³å®è·µ

### DO - æ¨èåšæ³•

âœ… **ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—**
```csharp
_logger.LogInformation(
    "è®¢å•åˆ›å»º: OrderId={OrderId}, Amount={Amount}",
    orderId, amount
);
```

âœ… **è®°å½•å…³é”®ä¸šåŠ¡èŠ‚ç‚¹**
```csharp
_logger.LogInformation("æˆ˜æ–—å¼€å§‹: ...");
// ä¸šåŠ¡é€»è¾‘
_logger.LogInformation("æˆ˜æ–—ç»“æŸ: ...");
```

âœ… **å¼‚å¸¸æ—¶è®°å½•ä¸Šä¸‹æ–‡**
```csharp
try
{
    // æ“ä½œ
}
catch (Exception ex)
{
    _logger.LogError(
        ex,
        "æ“ä½œå¤±è´¥: CharacterId={CharacterId}, Operation={Operation}",
        characterId, operationName
    );
    throw;
}
```

âœ… **ä½¿ç”¨æ¡ä»¶æ—¥å¿—å‡å°‘æ€§èƒ½å½±å“**
```csharp
if (_logger.IsEnabled(LogLevel.Debug))
{
    var detailedInfo = ComputeExpensiveInfo();
    _logger.LogDebug("è¯¦ç»†ä¿¡æ¯: {Info}", detailedInfo);
}
```

### DON'T - é¿å…åšæ³•

âŒ **ä¸è¦è®°å½•æ•æ„Ÿä¿¡æ¯**
```csharp
// âŒ ä¸æ¨è
_logger.LogInformation("ç”¨æˆ·ç™»å½•: Password={Password}", password);

// âœ… æ¨è
_logger.LogInformation("ç”¨æˆ·ç™»å½•: Username={Username}", username);
```

âŒ **ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼**
```csharp
// âŒ ä¸æ¨èï¼šæ— æ³•è§£æç»“æ„åŒ–æ•°æ®
_logger.LogInformation($"ç”¨æˆ·{userId}è´­ä¹°äº†{itemId}");

// âœ… æ¨èï¼šç»“æ„åŒ–å‚æ•°
_logger.LogInformation("ç”¨æˆ·è´­ä¹°: UserId={UserId}, ItemId={ItemId}", userId, itemId);
```

âŒ **ä¸è¦è¿‡åº¦æ—¥å¿—**
```csharp
// âŒ ä¸æ¨èï¼šå¾ªç¯ä¸­çš„å¤§é‡æ—¥å¿—
foreach (var item in largeList)
{
    _logger.LogInformation("å¤„ç†: {Item}", item);  // å¯èƒ½æ•°åƒæ¡
}

// âœ… æ¨èï¼šæ±‡æ€»æ—¥å¿—
_logger.LogInformation("æ‰¹é‡å¤„ç†: ItemCount={Count}", largeList.Count);
```

âŒ **ä¸è¦åœ¨çƒ­è·¯å¾„è®°å½•Debugæ—¥å¿—**
```csharp
// âŒ ä¸æ¨èï¼šé«˜é¢‘è°ƒç”¨
public double CalculateDamage(...)
{
    _logger.LogDebug("è®¡ç®—ä¼¤å®³..."); // æ¯ç§’å¯èƒ½è°ƒç”¨æ•°ç™¾æ¬¡
    return damage;
}

// âœ… æ¨èï¼šä»…åœ¨å¿…è¦æ—¶è®°å½•
public double CalculateDamage(...)
{
    var damage = Calculate();
    if (_logger.IsEnabled(LogLevel.Trace))  // ç”Ÿäº§ç¯å¢ƒé»˜è®¤å…³é—­
    {
        _logger.LogTrace("ä¼¤å®³è®¡ç®—: ...");
    }
    return damage;
}
```

---

## ç¤ºä¾‹ä»£ç 

### å®Œæ•´æœåŠ¡ç±»ç¤ºä¾‹

```csharp
using Microsoft.Extensions.Logging;

namespace BlazorIdle.Server.Domain.Equipment.Services
{
    /// <summary>
    /// è£…å¤‡æœåŠ¡ - åŒ…å«ç»“æ„åŒ–æ—¥å¿—ç¤ºä¾‹
    /// </summary>
    public class EquipmentService
    {
        private readonly ILogger<EquipmentService> _logger;
        private readonly IEquipmentRepository _repository;
        
        public EquipmentService(
            ILogger<EquipmentService> logger,
            IEquipmentRepository repository)
        {
            _logger = logger;
            _repository = repository;
        }
        
        /// <summary>
        /// è£…å¤‡ç©¿æˆ´
        /// </summary>
        public async Task<bool> EquipAsync(Guid characterId, Guid equipmentId, EquipmentSlot slot)
        {
            _logger.LogInformation(
                "å¼€å§‹è£…å¤‡ç©¿æˆ´: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Slot={Slot}",
                characterId, equipmentId, slot
            );
            
            try
            {
                // éªŒè¯
                var equipment = await _repository.GetByIdAsync(equipmentId);
                if (equipment == null)
                {
                    _logger.LogWarning(
                        "è£…å¤‡ä¸å­˜åœ¨: EquipmentId={EquipmentId}",
                        equipmentId
                    );
                    return false;
                }
                
                _logger.LogDebug(
                    "è£…å¤‡éªŒè¯é€šè¿‡: EquipmentId={EquipmentId}, Type={Type}, Level={Level}",
                    equipmentId, equipment.Type, equipment.Level
                );
                
                // æ‰§è¡Œè£…å¤‡
                await _repository.EquipToSlotAsync(characterId, equipmentId, slot);
                
                _logger.LogInformation(
                    "è£…å¤‡ç©¿æˆ´æˆåŠŸ: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Slot={Slot}",
                    characterId, equipmentId, slot
                );
                
                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(
                    ex,
                    "è£…å¤‡ç©¿æˆ´å¤±è´¥: CharacterId={CharacterId}, EquipmentId={EquipmentId}, Slot={Slot}",
                    characterId, equipmentId, slot
                );
                throw;
            }
        }
    }
}
```

---

## é™„å½•

### å‚è€ƒèµ„æ–™

1. [Microsoft.Extensions.Logging å®˜æ–¹æ–‡æ¡£](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/)
2. [Structured Logging æœ€ä½³å®è·µ](https://stackify.com/what-is-structured-logging-and-why-developers-need-it/)
3. [æœåŠ¡ç«¯ä»£ç ä¼˜åŒ–æ–¹æ¡ˆ](./æœåŠ¡ç«¯ä»£ç ä¼˜åŒ–æ–¹æ¡ˆ.md) - Phase 5 è¯¦ç»†è¯´æ˜

### å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | è¯´æ˜ |
|------|------|------|------|
| 1.0 | 2025-10-15 | å¼€å‘å›¢é˜Ÿ | åˆå§‹ç‰ˆæœ¬ - Phase 5 æ—¥å¿—è§„èŒƒ |

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸

*æœ¬æ–‡æ¡£æ˜¯ã€ŠæœåŠ¡ç«¯ä»£ç ä¼˜åŒ–æ–¹æ¡ˆã€‹Phase 5 çš„æ ¸å¿ƒäº¤ä»˜ç‰©*
