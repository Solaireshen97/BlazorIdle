# æœåŠ¡ç«¯ä»£ç ä¼˜åŒ–æ–¹æ¡ˆ

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
**çŠ¶æ€**: éœ€æ±‚åˆ†æä¸æ–¹æ¡ˆè®¾è®¡  
**è´Ÿè´£**: å¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
3. [ä¼˜åŒ–ç›®æ ‡](#ä¼˜åŒ–ç›®æ ‡)
4. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰](#ä¼˜åŒ–æ–¹æ¡ˆä¸Šç¯‡)
5. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸­ç¯‡ï¼‰](#ä¼˜åŒ–æ–¹æ¡ˆä¸­ç¯‡)
6. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰](#ä¼˜åŒ–æ–¹æ¡ˆä¸‹ç¯‡)
7. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
8. [åç»­ç»´æŠ¤å»ºè®®](#åç»­ç»´æŠ¤å»ºè®®)

---

## æ‰§è¡Œæ‘˜è¦

### é¡¹ç›®èƒŒæ™¯

æ ¹æ®å¯¹å½“å‰é¡¹ç›®çš„åˆ†æï¼ŒBlazorIdle é¡¹ç›®å·²ç»å®Œæˆäº†å¤šä¸ªæ ¸å¿ƒç³»ç»Ÿçš„å¼€å‘ï¼š
- âœ… SignalR å®æ—¶é€šä¿¡ç³»ç»Ÿ
- âœ… å•†åº—ç³»ç»Ÿï¼ˆShop Systemï¼‰
- âœ… è£…å¤‡ç³»ç»Ÿï¼ˆEquipment Systemï¼‰
- âœ… æˆ˜æ–—ç³»ç»Ÿï¼ˆCombat Systemï¼‰
- âœ… æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿï¼ˆActivity Plansï¼‰
- âœ… ç¦»çº¿ç»“ç®—ç³»ç»Ÿï¼ˆOffline Settlementï¼‰
- âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆJWT Authenticationï¼‰

å½“å‰æœåŠ¡ç«¯ä»£ç çŠ¶æ€ï¼š
- **æ€»æ–‡ä»¶æ•°**: 280ä¸ª C# æ–‡ä»¶
- **æ€»ä»£ç é‡**: çº¦ 42,000 è¡Œ
- **å·²æœ‰é…ç½®æ–‡ä»¶**: appsettings.jsonï¼ˆå®Œå–„çš„é…ç½®ä½“ç³»ï¼‰
- **ç°æœ‰æ—¥å¿—**: 96 å¤„æ—¥å¿—è°ƒç”¨ï¼ˆåˆ†å¸ƒä¸å‡ï¼‰

### ä¼˜åŒ–éœ€æ±‚

æœ¬æ¬¡ä¼˜åŒ–æ—¨åœ¨æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ï¼Œ**ä¸æ”¹å˜ä»»ä½•åŠŸèƒ½é€»è¾‘**ï¼Œä»…è¿›è¡Œä»£ç æ•´ç†ï¼š

1. **ä»£ç æ•´åˆç®€åŒ–** - è¯†åˆ«å¹¶æ¶ˆé™¤é‡å¤ä»£ç 
2. **å¢åŠ æ³¨é‡Š** - ä¸ºå…³é”®é€»è¾‘æ·»åŠ æ¸…æ™°çš„ä¸­æ–‡æ³¨é‡Š
3. **ä¿®å¤ç¼–ç å¼‚å¸¸** - ä¿®å¤ä¸­æ–‡ç¼–ç é—®é¢˜ï¼ˆå¦‚ Program.csï¼‰
4. **ç”Ÿæˆå¼€å‘æ–‡æ¡£** - ä¸ºæœåŠ¡ç«¯æ ¸å¿ƒæ¨¡å—åˆ›å»ºæ¶æ„æ–‡æ¡£
5. **ä¼˜åŒ–æ—¥å¿—ç³»ç»Ÿ** - å¢å¼ºæ—¥å¿—è¦†ç›–ç‡å’Œæ—¥å¿—è´¨é‡
6. **é…ç½®åŒ–å‚æ•°** - å°†ç¡¬ç¼–ç å¸¸é‡è¿ç§»åˆ°é…ç½®æ–‡ä»¶

### æ ¸å¿ƒä»·å€¼

1. **æå‡å¯ç»´æŠ¤æ€§** - ä»£ç æ›´æ¸…æ™°ï¼Œæ³¨é‡Šå®Œå–„
2. **é™ä½æŠ€æœ¯å€ºåŠ¡** - æ¶ˆé™¤é‡å¤ä»£ç 
3. **æ”¹å–„å¼€å‘ä½“éªŒ** - å®Œå–„çš„æ–‡æ¡£å’Œæ—¥å¿—
4. **å¢å¼ºå¯é…ç½®æ€§** - æ‰€æœ‰å‚æ•°å¯é€šè¿‡é…ç½®è°ƒæ•´

---

## ç°çŠ¶åˆ†æ

### 2.1 ä»£ç ç»“æ„åˆ†æ

#### 2.1.1 é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
BlazorIdle.Server/
â”œâ”€â”€ Api/                    # 13ä¸ªAPIæ§åˆ¶å™¨
â”œâ”€â”€ Application/            # åº”ç”¨å±‚æœåŠ¡
â”œâ”€â”€ Domain/                 # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ Combat/            # æˆ˜æ–—ç³»ç»Ÿï¼ˆæœ€å¤§æ¨¡å—ï¼‰
â”‚   â”‚   â”œâ”€â”€ Engine/        # æˆ˜æ–—å¼•æ“
â”‚   â”‚   â”œâ”€â”€ Buffs/         # Buffç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Skills/        # æŠ€èƒ½ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Damage/        # ä¼¤å®³è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ Professions/   # èŒä¸šç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ Equipment/         # è£…å¤‡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Activities/        # æ´»åŠ¨è®¡åˆ’
â”‚   â””â”€â”€ Characters/        # è§’è‰²ç®¡ç†
â”œâ”€â”€ Infrastructure/        # åŸºç¡€è®¾æ–½
â”œâ”€â”€ Services/              # æœåŠ¡å±‚ï¼ˆSignalRç­‰ï¼‰
â”œâ”€â”€ Hubs/                  # SignalR Hubs
â”œâ”€â”€ Config/                # é…ç½®æ–‡ä»¶ç›®å½•
â””â”€â”€ Program.cs             # å¯åŠ¨å…¥å£ï¼ˆå­˜åœ¨ç¼–ç é—®é¢˜ï¼‰
```

#### 2.1.2 å·²è¯†åˆ«çš„é—®é¢˜

**é—®é¢˜1: ç¼–ç å¼‚å¸¸**
- æ–‡ä»¶ï¼š`Program.cs`
- é—®é¢˜ï¼šä¸­æ–‡æ³¨é‡Šæ˜¾ç¤ºä¸ºä¹±ç ï¼ˆå¦‚ï¼š`ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ü·ï¿½ï¿½ï¿½`ï¼‰
- å½±å“ï¼šä»£ç å¯è¯»æ€§é™ä½

**é—®é¢˜2: ç¡¬ç¼–ç å¸¸é‡**
- ä½ç½®ï¼šå¤šä¸ªæ–‡ä»¶æ•£å¸ƒç¡¬ç¼–ç å€¼
- ç¤ºä¾‹ï¼š
  ```csharp
  const double FAR_FUTURE = 1e10;
  const double SKILL_CHECK_INTERVAL = 0.5;
  const double BUFF_TICK_INTERVAL = 1.0;
  const int baseAttackDamage = 10;
  const double K = 50.0;
  const double C = 400.0;
  ```
- å½±å“ï¼šè°ƒæ•´å‚æ•°éœ€è¦ä¿®æ”¹ä»£ç å¹¶é‡æ–°ç¼–è¯‘

**é—®é¢˜3: é‡å¤ä»£ç **
- å·²è¯†åˆ«æ¡ˆä¾‹ï¼š`EquipmentValidator.GetSlotName()` æ–¹æ³•é‡å¤
- çŠ¶æ€ï¼šéƒ¨åˆ†å·²åœ¨è£…å¤‡ç³»ç»Ÿä¼˜åŒ–ä¸­è§£å†³
- éœ€è¦ï¼šå…¨é¢æ‰«æå…¶ä»–æ¨¡å—

**é—®é¢˜4: æ³¨é‡Šä¸è¶³**
- çŠ¶æ€ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç¼ºå°‘è¯¦ç»†æ³¨é‡Š
- å½±å“ï¼šæ–°å¼€å‘è€…ç†è§£å›°éš¾

**é—®é¢˜5: æ—¥å¿—è¦†ç›–ä¸è¶³**
- å½“å‰ï¼š96å¤„æ—¥å¿—è°ƒç”¨
- é—®é¢˜ï¼šå…³é”®ä¸šåŠ¡æµç¨‹ç¼ºå°‘æ—¥å¿—è·Ÿè¸ª
- å½±å“ï¼šé—®é¢˜æ’æŸ¥å›°éš¾

**é—®é¢˜6: ç¼ºå°‘ç³»ç»Ÿæ–‡æ¡£**
- ç°çŠ¶ï¼šæœ‰éœ€æ±‚æ–‡æ¡£å’Œå®æ–½æŠ¥å‘Šï¼Œç¼ºå°‘æ¶æ„æ–‡æ¡£
- å½±å“ï¼šå¼€å‘è€…éœ€è¦ä»ä»£ç æ¨æ–­è®¾è®¡æ„å›¾

### 2.2 å·²å®Œæˆå·¥ä½œå›é¡¾

æ ¹æ® docs ç›®å½•åˆ†æï¼Œä»¥ä¸‹ç³»ç»Ÿå·²å®Œæˆä¼˜åŒ–ï¼š

#### âœ… SignalR ç³»ç»Ÿ
- é…ç½®å®Œå…¨å¤–éƒ¨åŒ–ï¼ˆ11ä¸ªæ ¸å¿ƒå‚æ•°ï¼‰
- æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
- å®Œæ•´çš„æ–‡æ¡£ä½“ç³»
- **å‚è€ƒæ–‡æ¡£**: `SignalR_æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š.md`

#### âœ… å•†åº—ç³»ç»Ÿ
- 23ä¸ªå‚æ•°å…¨éƒ¨é…ç½®åŒ–
- ä»£ç é£æ ¼ç»Ÿä¸€
- æµ‹è¯•è¦†ç›–ç‡100%
- **å‚è€ƒæ–‡æ¡£**: `å•†åº—ç³»ç»Ÿä¼˜åŒ–æ€»ç»“-Phase1-4å®Œæ•´æŠ¥å‘Š.md`

#### âœ… è£…å¤‡ç³»ç»Ÿ
- ä»£ç é‡æ„ä¼˜åŒ–ï¼ˆæ¶ˆé™¤é‡å¤ä»£ç ï¼‰
- å‚æ•°éªŒè¯å¢å¼º
- å·¥å…·ç±»ç»Ÿä¸€
- **å‚è€ƒæ–‡æ¡£**: `è£…å¤‡ç³»ç»ŸæŒç»­ä¼˜åŒ–æŠ¥å‘Š2025-10-12.md`

### 2.3 å½“å‰é…ç½®åŒ–çŠ¶æ€

#### å·²é…ç½®åŒ–çš„æ¨¡å—
```json
{
  "Economy": {...},           // ç»æµç³»ç»Ÿ
  "Combat": {...},            // æˆ˜æ–—ç³»ç»Ÿ
  "CombatLoop": {...},        // æˆ˜æ–—å¾ªç¯
  "Offline": {...},           // ç¦»çº¿ç³»ç»Ÿ
  "Jwt": {...},               // JWTè®¤è¯
  "SignalR": {...},           // SignalRé…ç½®
  "BattleMessages": {...},    // æˆ˜æ–—æ¶ˆæ¯
  "Shop": {...}               // å•†åº—ç³»ç»Ÿ
}
```

#### âœ… å·²å®Œæˆé…ç½®åŒ–çš„å¸¸é‡

1. **æˆ˜æ–—å¼•æ“å¸¸é‡**ï¼ˆ7ä¸ªï¼‰âœ…
   - `FAR_FUTURE = 1e10` - è¿œæœªæ¥æ—¶é—´æˆ³
   - `SKILL_CHECK_INTERVAL = 0.5` - æŠ€èƒ½æ£€æŸ¥é—´éš”
   - `BUFF_TICK_INTERVAL = 1.0` - Buffåˆ·æ–°é—´éš”
   - `baseAttackDamage = 10` - åŸºç¡€æ”»å‡»ä¼¤å®³
   - `defaultAttackerLevel = 50` - é»˜è®¤æ”»å‡»è€…ç­‰çº§
   - **å‚è€ƒæ–‡æ¡£**: `Phase8-ç¡¬ç¼–ç å¸¸é‡è¿ç§»å®ŒæˆæŠ¥å‘Š.md`

2. **ä¼¤å®³è®¡ç®—å¸¸é‡**ï¼ˆ2ä¸ªï¼‰âœ…
   - `K = 50.0` - ä¼¤å®³è®¡ç®—ç³»æ•°K
   - `C = 400.0` - ä¼¤å®³è®¡ç®—ç³»æ•°C
   - **å‚è€ƒæ–‡æ¡£**: `Phase8-ç¡¬ç¼–ç å¸¸é‡è¿ç§»å®ŒæˆæŠ¥å‘Š.md`

3. **è£…å¤‡ç³»ç»Ÿå¸¸é‡**ï¼ˆ9ä¸ªï¼‰âœ…
   - `ARMOR_CONSTANT = 400.0` - æŠ¤ç”²å‡ä¼¤å¸¸æ•°
   - `MAX_ARMOR_REDUCTION = 0.75` - æœ€å¤§æŠ¤ç”²å‡ä¼¤
   - `ShieldArmorMultiplier = 2.25` - ç›¾ç‰ŒæŠ¤ç”²ç³»æ•°
   - `BASE_BLOCK_CHANCE = 0.05` - åŸºç¡€æ ¼æŒ¡ç‡
   - `BLOCK_DAMAGE_REDUCTION = 0.30` - æ ¼æŒ¡å‡ä¼¤
   - `BLOCK_CHANCE_PER_STRENGTH = 0.001` - åŠ›é‡æ ¼æŒ¡ç‡
   - `BLOCK_CHANCE_PER_ITEMLEVEL = 0.002` - ç‰©å“ç­‰çº§æ ¼æŒ¡ç‡
   - `MAX_BLOCK_CHANCE = 0.50` - æœ€å¤§æ ¼æŒ¡ç‡
   - `offHandDamageCoefficient = 0.85` - å‰¯æ‰‹ä¼¤å®³ç³»æ•°
   - **å‚è€ƒæ–‡æ¡£**: `è£…å¤‡ç³»ç»Ÿé…ç½®åŒ–å®ŒæˆæŠ¥å‘Š.md`

**é…ç½®åŒ–æ€»ç»“**: 16ä¸ªç¡¬ç¼–ç å¸¸é‡å·²å…¨éƒ¨è¿ç§»åˆ°é…ç½®æ–‡ä»¶ âœ…

---

## ä¼˜åŒ–ç›®æ ‡

### 3.1 æ€»ä½“ç›®æ ‡

**æ ¸å¿ƒåŸåˆ™**ï¼š
- âœ… **é›¶åŠŸèƒ½æ”¹åŠ¨** - ä¸ä¿®æ”¹ä»»ä½•ä¸šåŠ¡é€»è¾‘
- âœ… **ç»´æŒä»£ç é£æ ¼** - éµå¾ªç°æœ‰çš„å‘½åå’Œç»„ç»‡è§„èŒƒ
- âœ… **æ¸è¿›å¼ä¼˜åŒ–** - åˆ†é˜¶æ®µå®æ–½ï¼Œæ¯é˜¶æ®µå¯ç‹¬ç«‹éªŒæ”¶
- âœ… **å®Œå–„æ–‡æ¡£** - ç”Ÿæˆå¯ç»´æŠ¤çš„å¼€å‘æ–‡æ¡£

### 3.2 å…·ä½“æŒ‡æ ‡

| ä¼˜åŒ–é¡¹ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | è¡¡é‡æ ‡å‡† |
|--------|----------|----------|----------|
| é‡å¤ä»£ç  | å­˜åœ¨å¤šå¤„ | æ¶ˆé™¤90%+ | é€šè¿‡é™æ€åˆ†æå·¥å…·æ£€æµ‹ |
| æ³¨é‡Šè¦†ç›– | ä¸å®Œæ•´ | æ ¸å¿ƒé€»è¾‘100% | æ‰€æœ‰å…¬å…±APIå’Œæ ¸å¿ƒç®—æ³•æœ‰æ³¨é‡Š |
| ç¼–ç é—®é¢˜ | 1ä¸ªæ–‡ä»¶ä¹±ç  | å…¨éƒ¨UTF-8 | æ‰€æœ‰æ–‡ä»¶é€šè¿‡ç¼–ç æ£€æŸ¥ |
| ç¡¬ç¼–ç å¸¸é‡ | çº¦20ä¸ª | è¿ç§»åˆ°é…ç½® | æ‰€æœ‰é­”æ³•æ•°å­—å¤–éƒ¨åŒ– |
| æ—¥å¿—è¦†ç›– | 96å¤„ | 150+ | å…³é”®ä¸šåŠ¡èŠ‚ç‚¹æœ‰æ—¥å¿— |
| å¼€å‘æ–‡æ¡£ | ç¼ºå¤± | å®Œæ•´ | æ¶æ„å›¾+APIæ–‡æ¡£+å¼€å‘æŒ‡å— |

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰

> **é˜¶æ®µç›®æ ‡**: ä»£ç è´¨é‡æå‡ - é‡å¤ä»£ç æ¶ˆé™¤ã€æ³¨é‡Šå®Œå–„ã€ç¼–ç ä¿®å¤

### Phase 1: ä»£ç å®¡è®¡ä¸é‡å¤ä»£ç è¯†åˆ«

#### 1.1 ä»»åŠ¡æ¸…å•

**ä»»åŠ¡ 1.1.1: å…¨é¢ä»£ç æ‰«æ**
- **å·¥å…·**: ä½¿ç”¨ Roslyn åˆ†æå™¨æˆ–æ‰‹åŠ¨å®¡æŸ¥
- **èŒƒå›´**: BlazorIdle.Server ä¸‹æ‰€æœ‰ .cs æ–‡ä»¶
- **äº§å‡º**: 
  - é‡å¤ä»£ç æ¸…å•ï¼ˆæ–¹æ³•çº§ã€ç±»çº§ï¼‰
  - ç›¸ä¼¼ä»£ç æ¨¡å¼è¯†åˆ«æŠ¥å‘Š
  - å¯æå–å…¬å…±é€»è¾‘çš„å€™é€‰åˆ—è¡¨

**ä»»åŠ¡ 1.1.2: é‡å¤ä»£ç åˆ†ç±»**

| ç±»åˆ« | æè¿° | ç¤ºä¾‹ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| å®Œå…¨é‡å¤ | ä»£ç 100%ç›¸åŒ | GetSlotName() é‡å¤ | P0 |
| é€»è¾‘ç›¸ä¼¼ | ç®—æ³•ç›¸åŒä½†å˜é‡ä¸åŒ | å¤šä¸ªéªŒè¯æ–¹æ³• | P1 |
| æ¨¡å¼é‡å¤ | ä»£ç æ¨¡å¼ç›¸åŒ | Try-Catch æ¨¡å¼ | P2 |

**ä»»åŠ¡ 1.1.3: æå–å…¬å…±å·¥å…·ç±»**

æ ¹æ®è£…å¤‡ç³»ç»Ÿä¼˜åŒ–ç»éªŒï¼Œè®¡åˆ’åˆ›å»ºä»¥ä¸‹å·¥å…·ç±»ï¼š

1. **ValidationHelper** - ç»Ÿä¸€å‚æ•°éªŒè¯
   ```csharp
   public static class ValidationHelper
   {
       public static void ValidateCharacterId(Guid characterId)
       public static void ValidatePositive(int value, string paramName)
       public static void ValidateRange(int value, int min, int max, string paramName)
   }
   ```

2. **LoggingHelper** - ç»Ÿä¸€æ—¥å¿—æ ¼å¼
   ```csharp
   public static class LoggingHelper
   {
       public static void LogServiceEntry(ILogger logger, string methodName, object? parameters)
       public static void LogServiceExit(ILogger logger, string methodName, object? result)
       public static void LogBusinessError(ILogger logger, string operation, Exception ex)
   }
   ```

3. **ConfigurationValidator** - é…ç½®éªŒè¯
   ```csharp
   public static class ConfigurationValidator
   {
       public static void ValidateRequired(string value, string configKey)
       public static void ValidateRange(double value, double min, double max, string configKey)
   }
   ```

#### 1.2 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: ä»£ç æ‰«æï¼ˆ1å¤©ï¼‰
- è¿è¡Œé™æ€åˆ†æå·¥å…·
- ç”Ÿæˆé‡å¤ä»£ç æŠ¥å‘Š
- äººå·¥å®¡æŸ¥å…³é”®æ¨¡å—

**æ­¥éª¤ 2**: å·¥å…·ç±»è®¾è®¡ï¼ˆ0.5å¤©ï¼‰
- è®¾è®¡å…¬å…±å·¥å…·ç±»æ¥å£
- ç¡®å®šå‘½åç©ºé—´å’Œç»„ç»‡ç»“æ„
- Code Review è®¾è®¡æ–¹æ¡ˆ

**æ­¥éª¤ 3**: é‡æ„å®æ–½ï¼ˆ2å¤©ï¼‰
- åˆ›å»ºå·¥å…·ç±»
- é€ä¸ªæ¨¡å—æ›¿æ¢é‡å¤ä»£ç 
- æ›´æ–°å•å…ƒæµ‹è¯•

**æ­¥éª¤ 4**: æµ‹è¯•éªŒè¯ï¼ˆ1å¤©ï¼‰
- è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- éªŒè¯åŠŸèƒ½æœªæ”¹å˜
- æ€§èƒ½åŸºå‡†æµ‹è¯•

#### 1.3 éªŒæ”¶æ ‡å‡†

- [ ] ç”Ÿæˆã€Šé‡å¤ä»£ç åˆ†ææŠ¥å‘Šã€‹
- [ ] åˆ›å»ºè‡³å°‘3ä¸ªå…¬å…±å·¥å…·ç±»
- [ ] æ¶ˆé™¤è‡³å°‘15å¤„é‡å¤ä»£ç 
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ä¸é™ä½

### Phase 2: æ³¨é‡Šå®Œå–„ä¸ä»£ç æ–‡æ¡£

#### 2.1 æ³¨é‡Šè§„èŒƒ

**ä¸­æ–‡æ³¨é‡Šæ ‡å‡†**ï¼š
```csharp
/// <summary>
/// æˆ˜æ–—å¼•æ“ - æ ¸å¿ƒæˆ˜æ–—å¾ªç¯å¤„ç†å™¨
/// </summary>
/// <remarks>
/// èŒè´£ï¼š
/// 1. é©±åŠ¨äº‹ä»¶è°ƒåº¦å™¨æ¨è¿›æˆ˜æ–—æ—¶é—´
/// 2. å¤„ç†æ”»å‡»ã€æŠ€èƒ½ã€Buffç­‰æˆ˜æ–—äº‹ä»¶
/// 3. ç®¡ç†æ•Œäººç”Ÿæˆå’Œæ³¢æ¬¡åˆ‡æ¢
/// </remarks>
public sealed class BattleEngine
{
    /// <summary>
    /// æ¨è¿›æˆ˜æ–—åˆ°æŒ‡å®šæ—¶é—´ç‚¹
    /// </summary>
    /// <param name="targetTime">ç›®æ ‡æ—¶é—´ï¼ˆç§’ï¼‰</param>
    /// <returns>æ˜¯å¦æˆ˜æ–—ç»“æŸ</returns>
    /// <exception cref="InvalidOperationException">å½“æˆ˜æ–—å·²ç»“æŸæ—¶æŠ›å‡º</exception>
    public bool AdvanceTo(double targetTime)
    {
        // 1. éªŒè¯æˆ˜æ–—çŠ¶æ€
        if (Completed) 
            throw new InvalidOperationException("æˆ˜æ–—å·²ç»“æŸ");
        
        // 2. å¤„ç†äº‹ä»¶é˜Ÿåˆ—
        while (Scheduler.HasEvents && Scheduler.NextEventTime <= targetTime)
        {
            var evt = Scheduler.Dequeue();
            evt.Execute(Context);  // æ‰§è¡Œäº‹ä»¶é€»è¾‘
        }
        
        // 3. æ›´æ–°æ—¶é’Ÿ
        Clock.AdvanceTo(targetTime);
        
        return Completed;
    }
}
```

**æ³¨é‡Šå±‚çº§**ï¼š
1. **ç±»çº§æ³¨é‡Š** - èŒè´£ã€æ ¸å¿ƒæ¦‚å¿µã€ä½¿ç”¨åœºæ™¯
2. **æ–¹æ³•çº§æ³¨é‡Š** - åŠŸèƒ½ã€å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸
3. **ç®—æ³•æ³¨é‡Š** - å¤æ‚é€»è¾‘çš„åˆ†æ­¥è¯´æ˜
4. **TODOæ³¨é‡Š** - æ ‡è®°å¾…ä¼˜åŒ–æˆ–å¾…å®ç°åŠŸèƒ½

#### 2.2 éœ€è¦æ³¨é‡Šçš„ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»£ç ç±»å‹ | é¢„è®¡æ•°é‡ | ç¤ºä¾‹ |
|--------|----------|----------|------|
| P0 | å…¬å…±APIï¼ˆControllersï¼‰ | 13ä¸ªæ–‡ä»¶ | CharactersController |
| P0 | æ ¸å¿ƒå¼•æ“ï¼ˆBattleEngineç­‰ï¼‰ | 5ä¸ªæ–‡ä»¶ | BattleEngine.cs |
| P1 | é¢†åŸŸæœåŠ¡ï¼ˆServicesï¼‰ | 30ä¸ªæ–‡ä»¶ | RewardGrantService |
| P1 | å¤æ‚ç®—æ³•ï¼ˆDamageCalculatorç­‰ï¼‰ | 10ä¸ªæ–‡ä»¶ | DamageCalculator.cs |
| P2 | æ•°æ®æ¨¡å‹ï¼ˆModelsï¼‰ | 50ä¸ªæ–‡ä»¶ | Character.cs |
| P3 | ç®€å•å·¥å…·ç±» | å…¶ä½™æ–‡ä»¶ | - |

#### 2.3 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: åˆ¶å®šæ³¨é‡Šæ¨¡æ¿ï¼ˆ0.5å¤©ï¼‰
- åˆ›å»ºæ ‡å‡†æ³¨é‡Šæ¨¡æ¿
- æä¾›ç¤ºä¾‹ä»£ç 
- å›¢é˜ŸåŸ¹è®­

**æ­¥éª¤ 2**: P0çº§åˆ«æ³¨é‡Šï¼ˆ2å¤©ï¼‰
- API Controllers å®Œæ•´æ³¨é‡Š
- æ ¸å¿ƒå¼•æ“ç±»æ³¨é‡Š
- ç”Ÿæˆ API æ–‡æ¡£

**æ­¥éª¤ 3**: P1çº§åˆ«æ³¨é‡Šï¼ˆ3å¤©ï¼‰
- é¢†åŸŸæœåŠ¡æ³¨é‡Š
- å¤æ‚ç®—æ³•æ³¨é‡Š
- ç”Ÿæˆæ¶æ„æ–‡æ¡£

**æ­¥éª¤ 4**: P2/P3çº§åˆ«æ³¨é‡Šï¼ˆ2å¤©ï¼‰
- æ•°æ®æ¨¡å‹æ³¨é‡Š
- å·¥å…·ç±»æ³¨é‡Š
- è¡¥å……é—æ¼éƒ¨åˆ†

#### 2.4 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ API Controller æœ‰å®Œæ•´ XML æ³¨é‡Š
- [ ] æ ¸å¿ƒå¼•æ“ç±»ï¼ˆBattleEngineç­‰ï¼‰æœ‰è¯¦ç»†æ³¨é‡Š
- [ ] å¤æ‚ç®—æ³•æœ‰åˆ†æ­¥éª¤æ³¨é‡Š
- [ ] ç”Ÿæˆã€Šä»£ç æ³¨é‡Šè§„èŒƒæ–‡æ¡£ã€‹
- [ ] Swagger UI æ˜¾ç¤ºå®Œæ•´ API æ–‡æ¡£

### Phase 3: ç¼–ç ä¿®å¤

#### 3.1 é—®é¢˜æ–‡ä»¶æ¸…å•

**å·²è¯†åˆ«é—®é¢˜**ï¼š
1. `Program.cs` - UTF-8 BOM é—®é¢˜å¯¼è‡´ä¹±ç 

**æ‰«æè®¡åˆ’**ï¼š
- å…¨é¢æ‰«ææ‰€æœ‰ .cs æ–‡ä»¶
- è¯†åˆ«é UTF-8 ç¼–ç æ–‡ä»¶
- æ£€æŸ¥ä¸­æ–‡å­—ç¬¦æ˜¾ç¤º

#### 3.2 ä¿®å¤æ–¹æ¡ˆ

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ‰«æéUTF-8æ–‡ä»¶
find . -name "*.cs" -exec file {} \; | grep -v "UTF-8"

# 2. è½¬æ¢ç¼–ç 
iconv -f GB2312 -t UTF-8 Program.cs > Program.cs.new
mv Program.cs.new Program.cs

# 3. éªŒè¯ä¿®å¤
file Program.cs  # åº”æ˜¾ç¤º "UTF-8 Unicode text"
```

**æ‰‹åŠ¨éªŒè¯**ï¼š
- åœ¨ VS Code ä¸­æ‰“å¼€æ–‡ä»¶
- æ£€æŸ¥ä¸­æ–‡æ³¨é‡Šæ˜¾ç¤ºæ­£å¸¸
- ç¡®ä¿æ²¡æœ‰ä¹±ç 

#### 3.3 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: ç¼–ç æ‰«æï¼ˆ0.5å¤©ï¼‰
- è¿è¡Œç¼–ç æ£€æµ‹è„šæœ¬
- ç”Ÿæˆé—®é¢˜æ–‡ä»¶åˆ—è¡¨
- è¯„ä¼°ä¿®å¤èŒƒå›´

**æ­¥éª¤ 2**: æ‰¹é‡ä¿®å¤ï¼ˆ0.5å¤©ï¼‰
- è½¬æ¢é—®é¢˜æ–‡ä»¶ç¼–ç 
- éªŒè¯ä¸­æ–‡æ˜¾ç¤º
- æäº¤ä¿®å¤

**æ­¥éª¤ 3**: é¢„é˜²æªæ–½ï¼ˆ0.5å¤©ï¼‰
- é…ç½® Git å±æ€§ï¼ˆ.gitattributesï¼‰
- é…ç½®ç¼–è¾‘å™¨é»˜è®¤ç¼–ç 
- æ›´æ–°å¼€å‘è§„èŒƒ

#### 3.4 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ .cs æ–‡ä»¶ä¸º UTF-8 ç¼–ç 
- [ ] ä¸­æ–‡æ³¨é‡Šæ˜¾ç¤ºæ­£å¸¸
- [ ] é…ç½® .gitattributes é˜²æ­¢å†æ¬¡å‡ºç°
- [ ] æ›´æ–°ã€Šå¼€å‘è§„èŒƒæ–‡æ¡£ã€‹

### Phase 4: é˜¶æ®µæ€§æµ‹è¯•ä¸æ–‡æ¡£

#### 4.1 æµ‹è¯•æ¸…å•

**å•å…ƒæµ‹è¯•**ï¼š
- [ ] æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ä¸é™ä½
- [ ] æ–°å¢å·¥å…·ç±»çš„æµ‹è¯•

**é›†æˆæµ‹è¯•**ï¼š
- [ ] API ç«¯ç‚¹æµ‹è¯•
- [ ] æˆ˜æ–—ç³»ç»Ÿé›†æˆæµ‹è¯•
- [ ] ç¦»çº¿ç»“ç®—æµ‹è¯•

**å›å½’æµ‹è¯•**ï¼š
- [ ] æ‰‹åŠ¨æµ‹è¯•æ ¸å¿ƒæµç¨‹
- [ ] æ€§èƒ½åŸºå‡†å¯¹æ¯”
- [ ] æ—¥å¿—è¾“å‡ºéªŒè¯

#### 4.2 æ–‡æ¡£äº§å‡º

1. **ã€Šé‡å¤ä»£ç åˆ†ææŠ¥å‘Šã€‹**
   - è¯†åˆ«çš„é‡å¤ä»£ç æ¸…å•
   - é‡æ„å‰åå¯¹æ¯”
   - ä»£ç è¡Œæ•°å‡å°‘ç»Ÿè®¡

2. **ã€Šä»£ç æ³¨é‡Šè§„èŒƒã€‹**
   - æ³¨é‡Šæ ‡å‡†å’Œæ¨¡æ¿
   - ç¤ºä¾‹ä»£ç 
   - æ³¨é‡Šæ£€æŸ¥æ¸…å•

3. **ã€Šä¸Šç¯‡å®æ–½æ€»ç»“ã€‹**
   - å®Œæˆçš„ä»»åŠ¡æ¸…å•
   - é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
   - æµ‹è¯•ç»“æœ
   - ä»£ç è´¨é‡æŒ‡æ ‡å¯¹æ¯”

#### 4.3 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆå•å…ƒ+é›†æˆ+å›å½’ï¼‰
- [ ] ç”Ÿæˆ3ä»½æ–‡æ¡£
- [ ] Code Review é€šè¿‡
- [ ] æ€§èƒ½æ— å›é€€

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸­ç¯‡ï¼‰

> **é˜¶æ®µç›®æ ‡**: æ—¥å¿—ä¼˜åŒ–ä¸ç›‘æ§å¢å¼º

### Phase 5: æ—¥å¿—ç³»ç»Ÿè®¾è®¡

#### 5.1 æ—¥å¿—è§„èŒƒè®¾è®¡

**æ—¥å¿—çº§åˆ«è§„èŒƒ**ï¼š

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹åœºæ™¯ |
|------|------|----------|
| Trace | è¯¦ç»†è¿½è¸ª | æˆ˜æ–—æ¯ä¸ªäº‹ä»¶çš„æ‰§è¡Œ |
| Debug | è°ƒè¯•ä¿¡æ¯ | ä¸­é—´å˜é‡å€¼ã€è®¡ç®—è¿‡ç¨‹ |
| Information | å…³é”®èŠ‚ç‚¹ | æœåŠ¡å¯åŠ¨ã€æˆ˜æ–—å¼€å§‹/ç»“æŸã€äº¤æ˜“å®Œæˆ |
| Warning | å¼‚å¸¸æƒ…å†µ | èµ„æºä¸è¶³ã€é…ç½®ç¼ºå¤±ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰ |
| Error | é”™è¯¯ | ä¸šåŠ¡é€»è¾‘é”™è¯¯ã€æ•°æ®åº“é”™è¯¯ |
| Critical | è‡´å‘½é”™è¯¯ | ç³»ç»Ÿå´©æºƒã€æ•°æ®æŸå |

**ç»“æ„åŒ–æ—¥å¿—æ¨¡æ¿**ï¼š
```csharp
// æœåŠ¡å…¥å£æ—¥å¿—
_logger.LogInformation(
    "å¼€å§‹å¤„ç† {Operation}ï¼Œå‚æ•°: CharacterId={CharacterId}, Amount={Amount}",
    "è´­ä¹°å•†å“",
    characterId,
    amount
);

// ä¸šåŠ¡é€»è¾‘æ—¥å¿—
_logger.LogDebug(
    "è®¡ç®—ä¼¤å®³: BaseDamage={Base}, Multiplier={Mult}, FinalDamage={Final}",
    baseDamage,
    multiplier,
    finalDamage
);

// é”™è¯¯æ—¥å¿—
_logger.LogError(
    ex,
    "å¤„ç† {Operation} å¤±è´¥ï¼ŒCharacterId={CharacterId}",
    "è£…å¤‡ç©¿æˆ´",
    characterId
);

// æ€§èƒ½æ—¥å¿—
_logger.LogInformation(
    "æˆ˜æ–—ç»“ç®—å®Œæˆï¼Œè€—æ—¶={Elapsed}ms, EventCount={Count}",
    elapsed.TotalMilliseconds,
    eventCount
);
```

#### 5.2 æ—¥å¿—è¦†ç›–è®¡åˆ’

**æ ¸å¿ƒä¸šåŠ¡æµç¨‹æ—¥å¿—ç‚¹**ï¼š

1. **æˆ˜æ–—ç³»ç»Ÿ**ï¼ˆBattleEngineï¼‰
   - æˆ˜æ–—å¼€å§‹/ç»“æŸ
   - æ¯æ³¢æ¬¡åˆ‡æ¢
   - è§’è‰²æ­»äº¡/å¤æ´»
   - æŠ€èƒ½é‡Šæ”¾ï¼ˆDebugçº§åˆ«ï¼‰
   - ä¼¤å®³è®¡ç®—ï¼ˆTraceçº§åˆ«ï¼‰

2. **ç»æµç³»ç»Ÿ**ï¼ˆRewardGrantServiceï¼‰
   - å¥–åŠ±å‘æ”¾å¼€å§‹/ç»“æŸ
   - é‡‘å¸/ç»éªŒå˜æ›´
   - ç»æµäº‹ä»¶è®°å½•
   - å¹‚ç­‰æ€§æ£€æŸ¥

3. **è£…å¤‡ç³»ç»Ÿ**ï¼ˆEquipmentServiceï¼‰
   - è£…å¤‡ç©¿æˆ´/å¸ä¸‹
   - è£…å¤‡åˆ†è§£/é‡é“¸
   - å±æ€§è®¡ç®—
   - éªŒè¯å¤±è´¥

4. **æ´»åŠ¨è®¡åˆ’**ï¼ˆActivityPlansControllerï¼‰
   - è®¡åˆ’åˆ›å»º/æ›´æ–°/åˆ é™¤
   - è®¡åˆ’æ‰§è¡Œå¼€å§‹/ç»“æŸ
   - ç¦»çº¿ç»“ç®—

5. **ç”¨æˆ·è®¤è¯**ï¼ˆAuthControllerï¼‰
   - ç™»å½•æˆåŠŸ/å¤±è´¥
   - Token ç”Ÿæˆ
   - æƒé™éªŒè¯å¤±è´¥

#### 5.3 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: è®¾è®¡æ—¥å¿—è§„èŒƒï¼ˆ1å¤©ï¼‰
- åˆ¶å®šæ—¥å¿—æ ‡å‡†
- è®¾è®¡æ—¥å¿—æ¨¡æ¿
- ç¡®å®šæ—¥å¿—ç‚¹ä½ç½®

**æ­¥éª¤ 2**: æˆ˜æ–—ç³»ç»Ÿæ—¥å¿—ï¼ˆ2å¤©ï¼‰
- BattleEngine æ ¸å¿ƒæ—¥å¿—
- äº‹ä»¶å¤„ç†æ—¥å¿—
- æ€§èƒ½ç›‘æ§æ—¥å¿—

**æ­¥éª¤ 3**: ä¸šåŠ¡ç³»ç»Ÿæ—¥å¿—ï¼ˆ2å¤©ï¼‰
- ç»æµç³»ç»Ÿæ—¥å¿—
- è£…å¤‡ç³»ç»Ÿæ—¥å¿—
- æ´»åŠ¨è®¡åˆ’æ—¥å¿—

**æ­¥éª¤ 4**: APIå±‚æ—¥å¿—ï¼ˆ1å¤©ï¼‰
- Controller å…¥å£/å‡ºå£æ—¥å¿—
- å‚æ•°éªŒè¯æ—¥å¿—
- å¼‚å¸¸å¤„ç†æ—¥å¿—

**æ­¥éª¤ 5**: æ—¥å¿—æµ‹è¯•ï¼ˆ1å¤©ï¼‰
- éªŒè¯æ—¥å¿—è¾“å‡º
- æµ‹è¯•ä¸åŒçº§åˆ«
- æ£€æŸ¥ç»“æ„åŒ–æ•°æ®

#### 5.4 éªŒæ”¶æ ‡å‡†

- [ ] åˆ¶å®šã€Šæ—¥å¿—è§„èŒƒæ–‡æ¡£ã€‹
- [ ] æ ¸å¿ƒä¸šåŠ¡æµç¨‹æœ‰ Information çº§åˆ«æ—¥å¿—
- [ ] å…³é”®è®¡ç®—æœ‰ Debug çº§åˆ«æ—¥å¿—
- [ ] æ‰€æœ‰å¼‚å¸¸æœ‰ Error çº§åˆ«æ—¥å¿—
- [ ] æ—¥å¿—æ€»æ•°è¾¾åˆ° 150+
- [ ] æ—¥å¿—å¯é€šè¿‡ Serilog/NLog è¾“å‡ºåˆ°æ–‡ä»¶

### Phase 6: æ€§èƒ½ç›‘æ§ä¸æŒ‡æ ‡

#### 6.1 ç›‘æ§æŒ‡æ ‡è®¾è®¡

**ä¸šåŠ¡æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | å•ä½ | ç”¨é€” |
|----------|----------|------|------|
| æˆ˜æ–— | æˆ˜æ–—æ—¶é•¿ | ç§’ | å¹³è¡¡æ€§è°ƒæ•´ |
| æˆ˜æ–— | æ¯ç§’äº‹ä»¶æ•° | count/s | æ€§èƒ½ç›‘æ§ |
| æˆ˜æ–— | å¹³å‡ä¼¤å®³ | HP | æ•°å€¼å¹³è¡¡ |
| ç»æµ | é‡‘å¸äº§å‡º/æ¶ˆè€—æ¯” | ratio | ç»æµå¹³è¡¡ |
| ç»æµ | å¥–åŠ±å‘æ”¾é¢‘ç‡ | count/min | äº§å‡ºç›‘æ§ |
| è£…å¤‡ | åˆ†è§£é¢‘ç‡ | count/hour | ç©å®¶è¡Œä¸º |
| è£…å¤‡ | é‡é“¸æˆåŠŸç‡ | % | ç³»ç»Ÿå¹³è¡¡ |
| API | è¯·æ±‚å“åº”æ—¶é—´ | ms | æ€§èƒ½ç›‘æ§ |
| API | é”™è¯¯ç‡ | % | ç¨³å®šæ€§ |

**æŠ€æœ¯æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | å•ä½ | ç”¨é€” |
|----------|----------|------|------|
| æ•°æ®åº“ | æŸ¥è¯¢è€—æ—¶ | ms | æ€§èƒ½ä¼˜åŒ– |
| å†…å­˜ | GC é¢‘ç‡ | count/min | å†…å­˜æ³„æ¼æ£€æµ‹ |
| ç¼“å­˜ | å‘½ä¸­ç‡ | % | ç¼“å­˜ä¼˜åŒ– |
| SignalR | è¿æ¥æ•° | count | å¹¶å‘ç›‘æ§ |

#### 6.2 å®æ–½æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: å†…ç½®ç›‘æ§æœåŠ¡**

åˆ›å»º `MetricsCollectorService`ï¼š
```csharp
public class MetricsCollectorService
{
    private readonly ILogger<MetricsCollectorService> _logger;
    
    // æˆ˜æ–—æŒ‡æ ‡
    public void RecordBattleDuration(double seconds) { }
    public void RecordBattleEvents(int eventCount) { }
    
    // ç»æµæŒ‡æ ‡
    public void RecordGoldChange(int characterId, int delta, string source) { }
    
    // æ€§èƒ½æŒ‡æ ‡
    public void RecordApiDuration(string endpoint, double ms) { }
}
```

**æ–¹æ¡ˆ2: ä¸­é—´ä»¶é›†æˆ**

åˆ›å»º `MetricsMiddleware`ï¼š
```csharp
public class MetricsMiddleware
{
    public async Task InvokeAsync(HttpContext context)
    {
        var sw = Stopwatch.StartNew();
        await _next(context);
        sw.Stop();
        
        _metrics.RecordApiDuration(
            context.Request.Path, 
            sw.Elapsed.TotalMilliseconds
        );
    }
}
```

#### 6.3 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: è®¾è®¡ç›‘æ§æ¶æ„ï¼ˆ1å¤©ï¼‰
- ç¡®å®šç›‘æ§æŒ‡æ ‡
- è®¾è®¡æ•°æ®æ”¶é›†æ–¹æ¡ˆ
- é€‰æ‹©å­˜å‚¨æ–¹å¼

**æ­¥éª¤ 2**: å®ç°ç›‘æ§æœåŠ¡ï¼ˆ2å¤©ï¼‰
- åˆ›å»º MetricsCollectorService
- å®ç°å„ç±»æŒ‡æ ‡æ”¶é›†
- é…ç½®æ—¥å¿—è¾“å‡º

**æ­¥éª¤ 3**: é›†æˆåˆ°ä¸šåŠ¡ä»£ç ï¼ˆ2å¤©ï¼‰
- æˆ˜æ–—ç³»ç»Ÿé›†æˆ
- ç»æµç³»ç»Ÿé›†æˆ
- APIä¸­é—´ä»¶é›†æˆ

**æ­¥éª¤ 4**: ç›‘æ§é¢æ¿ï¼ˆ1å¤©ï¼‰
- è®¾è®¡ç®€å•çš„ç›‘æ§æŸ¥è¯¢API
- ç”Ÿæˆç›‘æ§æŠ¥å‘Š
- é…ç½®å‘Šè­¦è§„åˆ™ï¼ˆå¯é€‰ï¼‰

#### 6.4 éªŒæ”¶æ ‡å‡†

- [ ] åˆ›å»º MetricsCollectorService
- [ ] æ”¶é›†è‡³å°‘10ä¸ªä¸šåŠ¡æŒ‡æ ‡
- [ ] ç›‘æ§æ•°æ®å¯é€šè¿‡æ—¥å¿—æŸ¥çœ‹
- [ ] ç”Ÿæˆã€Šç›‘æ§æŒ‡æ ‡æ–‡æ¡£ã€‹
- [ ] æä¾›ç¤ºä¾‹ç›‘æ§æŸ¥è¯¢

### Phase 7: é˜¶æ®µæ€§æµ‹è¯•ä¸æ–‡æ¡£

#### 7.1 æµ‹è¯•æ¸…å•

**æ—¥å¿—æµ‹è¯•**ï¼š
- [ ] éªŒè¯æ‰€æœ‰æ—¥å¿—çº§åˆ«æ­£å¸¸è¾“å‡º
- [ ] æ£€æŸ¥ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- [ ] æµ‹è¯•æ—¥å¿—æ–‡ä»¶è½®è½¬

**ç›‘æ§æµ‹è¯•**ï¼š
- [ ] éªŒè¯æŒ‡æ ‡æ­£ç¡®æ”¶é›†
- [ ] æµ‹è¯•é«˜å¹¶å‘åœºæ™¯
- [ ] æ£€æŸ¥æ€§èƒ½å½±å“

**å›å½’æµ‹è¯•**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

#### 7.2 æ–‡æ¡£äº§å‡º

1. **ã€Šæ—¥å¿—è§„èŒƒæ–‡æ¡£ã€‹**
   - æ—¥å¿—çº§åˆ«å®šä¹‰
   - æ—¥å¿—æ¨¡æ¿
   - æ—¥å¿—é…ç½®æŒ‡å—

2. **ã€Šç›‘æ§æŒ‡æ ‡æ–‡æ¡£ã€‹**
   - æŒ‡æ ‡å®šä¹‰
   - æ”¶é›†æ–¹å¼
   - æŸ¥è¯¢æ–¹æ³•
   - å‘Šè­¦è§„åˆ™

3. **ã€Šä¸­ç¯‡å®æ–½æ€»ç»“ã€‹**
   - æ–°å¢æ—¥å¿—ç»Ÿè®¡
   - ç›‘æ§æŒ‡æ ‡æ¸…å•
   - æ€§èƒ½å½±å“åˆ†æ
   - æµ‹è¯•ç»“æœ

#### 7.3 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç”Ÿæˆ3ä»½æ–‡æ¡£
- [ ] æ—¥å¿—ç³»ç»Ÿå¯é…ç½®
- [ ] ç›‘æ§æ•°æ®å¯æŸ¥è¯¢

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰

> **é˜¶æ®µç›®æ ‡**: é…ç½®åŒ–ä¸å¼€å‘æ–‡æ¡£

### Phase 8: ç¡¬ç¼–ç å¸¸é‡è¿ç§» âœ…

> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **å®Œæˆæ—¥æœŸ**: 2025-10-15  
> **å‚è€ƒæ–‡æ¡£**: 
> - `Phase8-ç¡¬ç¼–ç å¸¸é‡è¿ç§»å®ŒæˆæŠ¥å‘Š.md`ï¼ˆæˆ˜æ–—å¼•æ“é…ç½®åŒ–ï¼‰
> - `è£…å¤‡ç³»ç»Ÿé…ç½®åŒ–å®ŒæˆæŠ¥å‘Š.md`ï¼ˆè£…å¤‡ç³»ç»Ÿé…ç½®åŒ–ï¼‰

#### 8.1 å¸¸é‡æ¸…å•ä¸åˆ†ç±»

**å·²è¯†åˆ«çš„ç¡¬ç¼–ç å¸¸é‡**ï¼š

**æˆ˜æ–—å¼•æ“å¸¸é‡**ï¼š
```csharp
// Domain/Combat/Engine/BattleEngine.cs
const double FAR_FUTURE = 1e10;                  // è¿œæœªæ¥æ—¶é—´æˆ³
const double SKILL_CHECK_INTERVAL = 0.5;         // æŠ€èƒ½æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
const double BUFF_TICK_INTERVAL = 1.0;           // Buffåˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰

// Domain/Combat/AttackTickEvent.cs
const int baseAttackDamage = 10;                 // åŸºç¡€æ”»å‡»ä¼¤å®³

// Domain/Combat/PlayerDeathEvent.cs
const double FAR_FUTURE = 1e10;                  // è¿œæœªæ¥æ—¶é—´æˆ³ï¼ˆé‡å¤ï¼‰
```

**ä¼¤å®³è®¡ç®—å¸¸é‡**ï¼š
```csharp
// Domain/Combat/Damage/DamageCalculator.cs
private const double K = 50.0;                   // ä¼¤å®³å‡å…ç³»æ•°K
private const double C = 400.0;                  // ä¼¤å®³å‡å…å¸¸é‡C
```

**è£…å¤‡ç³»ç»Ÿå¸¸é‡**ï¼š
```csharp
// Domain/Equipment/Services/ArmorCalculator.cs
private const double ARMOR_CONSTANT = 400.0;
private const double MAX_ARMOR_REDUCTION = 0.75;

// Domain/Equipment/Services/BlockCalculator.cs
private const double BASE_BLOCK_CHANCE = 0.05;
private const double BLOCK_DAMAGE_REDUCTION = 0.30;
private const double BLOCK_CHANCE_PER_STRENGTH = 0.001;
private const double BLOCK_CHANCE_PER_ITEMLEVEL = 0.002;
private const double MAX_BLOCK_CHANCE = 0.50;

// Domain/Equipment/Services/WeaponDamageCalculator.cs
const double offHandDamageCoefficient = 0.85;
```

**æˆ˜æ–—äººå‘˜å¸¸é‡**ï¼š
```csharp
// Domain/Combat/Combatants/PlayerCombatant.cs
const int defaultAttackerLevel = 50;             // é»˜è®¤æ”»å‡»è€…ç­‰çº§
```

#### 8.2 é…ç½®æ–‡ä»¶è®¾è®¡

**æ–°å¢é…ç½®èŠ‚ï¼šCombatEngine**
```json
{
  "CombatEngine": {
    "FarFutureTimestamp": 1e10,
    "SkillCheckIntervalSeconds": 0.5,
    "BuffTickIntervalSeconds": 1.0,
    "BaseAttackDamage": 10,
    "DefaultAttackerLevel": 50,
    "DamageReduction": {
      "CoefficientK": 50.0,
      "ConstantC": 400.0
    }
  }
}
```

**æ–°å¢é…ç½®èŠ‚ï¼šEquipment**
```json
{
  "Equipment": {
    "ArmorCalculation": {
      "ArmorConstant": 400.0,
      "MaxArmorReduction": 0.75,
      "ShieldArmorMultiplier": 2.25
    },
    "BlockCalculation": {
      "BaseBlockChance": 0.05,
      "BlockDamageReduction": 0.30,
      "BlockChancePerStrength": 0.001,
      "BlockChancePerItemLevel": 0.002,
      "MaxBlockChance": 0.50
    },
    "WeaponDamage": {
      "OffHandDamageCoefficient": 0.85
    }
  }
}
```

**é…ç½®ç±»è®¾è®¡**ï¼š
```csharp
public class CombatEngineOptions
{
    /// <summary>
    /// è¿œæœªæ¥æ—¶é—´æˆ³ï¼Œç”¨äºæ ‡è®°æœªæ¿€æ´»çš„äº‹ä»¶
    /// </summary>
    public double FarFutureTimestamp { get; set; } = 1e10;
    
    /// <summary>
    /// æŠ€èƒ½æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    /// </summary>
    public double SkillCheckIntervalSeconds { get; set; } = 0.5;
    
    /// <summary>
    /// Buffåˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
    /// </summary>
    public double BuffTickIntervalSeconds { get; set; } = 1.0;
    
    /// <summary>
    /// åŸºç¡€æ”»å‡»ä¼¤å®³
    /// </summary>
    public int BaseAttackDamage { get; set; } = 10;
    
    /// <summary>
    /// é»˜è®¤æ”»å‡»è€…ç­‰çº§
    /// </summary>
    public int DefaultAttackerLevel { get; set; } = 50;
    
    /// <summary>
    /// ä¼¤å®³å‡å…å‚æ•°
    /// </summary>
    public DamageReductionOptions DamageReduction { get; set; } = new();
}

public class DamageReductionOptions
{
    /// <summary>
    /// ä¼¤å®³å‡å…ç³»æ•°K
    /// </summary>
    public double CoefficientK { get; set; } = 50.0;
    
    /// <summary>
    /// ä¼¤å®³å‡å…å¸¸é‡C
    /// </summary>
    public double ConstantC { get; set; } = 400.0;
}
```

#### 8.3 è¿ç§»æ­¥éª¤

**æ­¥éª¤ 1**: è®¾è®¡é…ç½®ç»“æ„ï¼ˆ1å¤©ï¼‰
- åˆ†ææ‰€æœ‰ç¡¬ç¼–ç å¸¸é‡
- è®¾è®¡é…ç½®ç±»ç»“æ„
- ç¡®å®šé»˜è®¤å€¼

**æ­¥éª¤ 2**: åˆ›å»ºé…ç½®ç±»ï¼ˆ1å¤©ï¼‰
- å®ç° Options ç±»
- æ·»åŠ éªŒè¯é€»è¾‘
- é…ç½®ä¾èµ–æ³¨å…¥

**æ­¥éª¤ 3**: ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼ˆ2å¤©ï¼‰
- æ›¿æ¢ç¡¬ç¼–ç ä¸ºé…ç½®æ³¨å…¥
- ä¿æŒå‘åå…¼å®¹
- æ›´æ–°ç›¸å…³æµ‹è¯•

**æ­¥éª¤ 4**: é…ç½®æ–‡ä»¶æ›´æ–°ï¼ˆ0.5å¤©ï¼‰
- æ›´æ–° appsettings.json
- æ›´æ–° Development/Production é…ç½®
- æ·»åŠ é…ç½®è¯´æ˜æ³¨é‡Š

**æ­¥éª¤ 5**: æµ‹è¯•éªŒè¯ï¼ˆ1å¤©ï¼‰
- æµ‹è¯•é»˜è®¤é…ç½®
- æµ‹è¯•è‡ªå®šä¹‰é…ç½®
- éªŒè¯é…ç½®éªŒè¯é€»è¾‘

#### 8.4 éªŒæ”¶æ ‡å‡†

- [x] æ‰€æœ‰é­”æ³•æ•°å­—è¿ç§»åˆ°é…ç½®ï¼ˆ16ä¸ªå¸¸é‡å·²è¿ç§»ï¼‰âœ…
- [x] é…ç½®ç±»æœ‰å®Œæ•´æ³¨é‡Šï¼ˆCombatEngineOptions, EquipmentSystemOptionsï¼‰âœ…
- [x] é…ç½®éªŒè¯é€»è¾‘å®Œå–„ï¼ˆæä¾›åˆç†é»˜è®¤å€¼ï¼Œå‘åå…¼å®¹ï¼‰âœ…
- [x] ç”Ÿæˆã€Šé…ç½®å‚æ•°æ–‡æ¡£ã€‹ï¼ˆPhase8å®ŒæˆæŠ¥å‘Šã€è£…å¤‡ç³»ç»Ÿé…ç½®åŒ–å®ŒæˆæŠ¥å‘Šï¼‰âœ…
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆæˆ˜æ–—å¼•æ“æµ‹è¯•ã€è£…å¤‡ç³»ç»Ÿæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰âœ…

**å®æ–½æ€»ç»“**ï¼š
- **æˆ˜æ–—å¼•æ“é…ç½®åŒ–**ï¼ˆ7ä¸ªå¸¸é‡ï¼‰- å·²å®Œæˆ âœ…
- **è£…å¤‡ç³»ç»Ÿé…ç½®åŒ–**ï¼ˆ9ä¸ªå¸¸é‡ï¼‰- å·²å®Œæˆ âœ…
- **æ€»è®¡**ï¼š16ä¸ªç¡¬ç¼–ç å¸¸é‡å…¨éƒ¨è¿ç§»åˆ°é…ç½®æ–‡ä»¶ âœ…
- **æµ‹è¯•è¦†ç›–**ï¼šæ–°å¢10ä¸ªé…ç½®éªŒè¯æµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ âœ…
- **æ–‡æ¡£äº§å‡º**ï¼š2ä»½è¯¦ç»†çš„å®ŒæˆæŠ¥å‘Š âœ…

### Phase 9: å¼€å‘æ–‡æ¡£ç¼–å†™

#### 9.1 æ–‡æ¡£ä½“ç³»è®¾è®¡

**æ–‡æ¡£ç»“æ„**ï¼š
```
docs/
â”œâ”€â”€ å¼€å‘æ–‡æ¡£/
â”‚   â”œâ”€â”€ 01-æ¶æ„æ¦‚è§ˆ.md
â”‚   â”œâ”€â”€ 02-é¢†åŸŸæ¨¡å‹.md
â”‚   â”œâ”€â”€ 03-æˆ˜æ–—ç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ 04-è£…å¤‡ç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ 05-ç»æµç³»ç»Ÿ.md
â”‚   â”œâ”€â”€ 06-APIæ–‡æ¡£.md
â”‚   â”œâ”€â”€ 07-é…ç½®æŒ‡å—.md
â”‚   â”œâ”€â”€ 08-æ—¥å¿—ä¸ç›‘æ§.md
â”‚   â”œâ”€â”€ 09-å¼€å‘è§„èŒƒ.md
â”‚   â””â”€â”€ 10-å¸¸è§é—®é¢˜.md
â””â”€â”€ APIæ–‡æ¡£/
    â””â”€â”€ swagger.jsonï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

#### 9.2 æ ¸å¿ƒæ–‡æ¡£å†…å®¹

**01-æ¶æ„æ¦‚è§ˆ.md**ï¼š
- ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾
- æŠ€æœ¯æ ˆè¯´æ˜
- é¡¹ç›®ç»“æ„
- æ¨¡å—å…³ç³»å›¾
- æ•°æ®æµå›¾

**02-é¢†åŸŸæ¨¡å‹.md**ï¼š
- æ ¸å¿ƒå®ä½“å…³ç³»å›¾
- èšåˆæ ¹è¯´æ˜
- é¢†åŸŸäº‹ä»¶
- å€¼å¯¹è±¡

**03-æˆ˜æ–—ç³»ç»Ÿ.md**ï¼š
- æˆ˜æ–—æµç¨‹å›¾
- BattleEngine å·¥ä½œåŸç†
- äº‹ä»¶è°ƒåº¦æœºåˆ¶
- æŠ€èƒ½ç³»ç»Ÿ
- Buffç³»ç»Ÿ
- ä¼¤å®³è®¡ç®—å…¬å¼

**04-è£…å¤‡ç³»ç»Ÿ.md**ï¼š
- è£…å¤‡ç±»å‹å’Œæ§½ä½
- å“çº§å’Œè¯æ¡
- è£…å¤‡ç”Ÿæˆæµç¨‹
- åˆ†è§£å’Œé‡é“¸æœºåˆ¶

**05-ç»æµç³»ç»Ÿ.md**ï¼š
- è´§å¸ç³»ç»Ÿ
- å¥–åŠ±å‘æ”¾æœºåˆ¶
- ç»æµäº‹ä»¶è®°å½•
- å¹‚ç­‰æ€§ä¿è¯

**06-APIæ–‡æ¡£.md**ï¼š
- API ç«¯ç‚¹åˆ—è¡¨
- è¯·æ±‚/å“åº”ç¤ºä¾‹
- é”™è¯¯ç è¯´æ˜
- è®¤è¯æœºåˆ¶

**07-é…ç½®æŒ‡å—.md**ï¼š
- æ‰€æœ‰é…ç½®é¡¹è¯´æ˜
- ç¯å¢ƒç‰¹å®šé…ç½®
- é…ç½®éªŒè¯è§„åˆ™
- æœ€ä½³å®è·µ

**08-æ—¥å¿—ä¸ç›‘æ§.md**ï¼š
- æ—¥å¿—çº§åˆ«è¯´æ˜
- æ—¥å¿—æŸ¥è¯¢æ–¹æ³•
- ç›‘æ§æŒ‡æ ‡åˆ—è¡¨
- æ€§èƒ½è°ƒä¼˜å»ºè®®

**09-å¼€å‘è§„èŒƒ.md**ï¼š
- ä»£ç é£æ ¼
- å‘½åçº¦å®š
- æ³¨é‡Šè§„èŒƒ
- Gitæäº¤è§„èŒƒ
- Code Reviewæ¸…å•

**10-å¸¸è§é—®é¢˜.md**ï¼š
- å¼€å‘ç¯å¢ƒæ­å»º
- å¸¸è§é”™è¯¯è§£å†³
- æ€§èƒ½é—®é¢˜æ’æŸ¥
- æµ‹è¯•æŒ‡å—

#### 9.3 å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: æ¶æ„æ–‡æ¡£ï¼ˆ2å¤©ï¼‰
- ç»˜åˆ¶æ¶æ„å›¾
- ç¼–å†™æ¶æ„æ¦‚è§ˆ
- é¢†åŸŸæ¨¡å‹æ–‡æ¡£

**æ­¥éª¤ 2**: ç³»ç»Ÿæ–‡æ¡£ï¼ˆ3å¤©ï¼‰
- æˆ˜æ–—ç³»ç»Ÿæ–‡æ¡£
- è£…å¤‡ç³»ç»Ÿæ–‡æ¡£
- ç»æµç³»ç»Ÿæ–‡æ¡£

**æ­¥éª¤ 3**: æ“ä½œæ–‡æ¡£ï¼ˆ2å¤©ï¼‰
- APIæ–‡æ¡£ï¼ˆåŸºäºSwaggerï¼‰
- é…ç½®æŒ‡å—
- æ—¥å¿—ä¸ç›‘æ§æ–‡æ¡£

**æ­¥éª¤ 4**: è§„èŒƒæ–‡æ¡£ï¼ˆ1å¤©ï¼‰
- å¼€å‘è§„èŒƒ
- å¸¸è§é—®é¢˜

**æ­¥éª¤ 5**: æ–‡æ¡£å®¡æ ¸ï¼ˆ1å¤©ï¼‰
- æŠ€æœ¯å®¡æ ¸
- å†…å®¹å®Œæ•´æ€§æ£€æŸ¥
- ç¤ºä¾‹ä»£ç éªŒè¯

#### 9.4 æ–‡æ¡£æ¨¡æ¿

**ç³»ç»Ÿæ–‡æ¡£æ¨¡æ¿**ï¼š
```markdown
# [ç³»ç»Ÿåç§°]

## æ¦‚è¿°
ç®€è¦ä»‹ç»ç³»ç»Ÿçš„èŒè´£å’Œæ ¸å¿ƒåŠŸèƒ½ã€‚

## æ ¸å¿ƒæ¦‚å¿µ
- æ¦‚å¿µ1ï¼šå®šä¹‰å’Œä½œç”¨
- æ¦‚å¿µ2ï¼šå®šä¹‰å’Œä½œç”¨

## æ¶æ„è®¾è®¡
### ç±»å›¾
[ç±»å›¾]

### æ—¶åºå›¾
[å…³é”®æµç¨‹çš„æ—¶åºå›¾]

## æ ¸å¿ƒæµç¨‹
### æµç¨‹1
1. æ­¥éª¤1
2. æ­¥éª¤2
3. æ­¥éª¤3

### æµç¨‹2
...

## å…³é”®ä»£ç 
```csharp
// ä»£ç ç¤ºä¾‹å’Œè¯´æ˜
```

## é…ç½®å‚æ•°

### Phase 8 å·²å®Œæˆçš„é…ç½®å‚æ•°

**CombatEngine é…ç½®èŠ‚**

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| FarFutureTimestamp | double | 1e10 | è¿œæœªæ¥æ—¶é—´æˆ³ï¼Œç”¨äºæ ‡è®°æœªæ¿€æ´»çš„äº‹ä»¶ |
| SkillCheckIntervalSeconds | double | 0.5 | æŠ€èƒ½æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ï¼Œæ§åˆ¶æ•ŒäººæŠ€èƒ½è§¦å‘æ£€æŸ¥é¢‘ç‡ |
| BuffTickIntervalSeconds | double | 1.0 | Buffåˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ï¼Œæ§åˆ¶DoT/HoTç­‰å‘¨æœŸæ•ˆæœçš„åˆ·æ–°é¢‘ç‡ |
| BaseAttackDamage | int | 10 | åŸºç¡€æ”»å‡»ä¼¤å®³ï¼Œç©å®¶æ”»å‡»çš„åŸºç¡€ä¼¤å®³å€¼ |
| DefaultAttackerLevel | int | 50 | é»˜è®¤æ”»å‡»è€…ç­‰çº§ï¼Œç”¨äºæŠ¤ç”²å‡ä¼¤è®¡ç®— |
| DamageReduction.CoefficientK | double | 50.0 | ä¼¤å®³å‡å…ç³»æ•°Kï¼Œç”¨äºæŠ¤ç”²å‡ä¼¤å…¬å¼ |
| DamageReduction.ConstantC | double | 400.0 | ä¼¤å®³å‡å…å¸¸é‡Cï¼Œç”¨äºæŠ¤ç”²å‡ä¼¤å…¬å¼ |

è¯¦è§ï¼š`docs/Phase8-ç¡¬ç¼–ç å¸¸é‡è¿ç§»å®ŒæˆæŠ¥å‘Š.md`

## å¸¸è§é—®é¢˜

Q: Phase 8 çš„é…ç½®å‚æ•°åœ¨å“ªé‡Œä¿®æ”¹ï¼Ÿ  
A: åœ¨ `appsettings.json` çš„ `CombatEngine` é…ç½®èŠ‚ä¸­ä¿®æ”¹ã€‚æ‰€æœ‰å‚æ•°éƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸æä¾›é…ç½®æ—¶ä½¿ç”¨é»˜è®¤å€¼ã€‚

Q: ä¿®æ”¹é…ç½®å‚æ•°éœ€è¦é‡æ–°ç¼–è¯‘å—ï¼Ÿ  
A: ä¸éœ€è¦ã€‚åªéœ€ä¿®æ”¹ `appsettings.json` å¹¶é‡å¯åº”ç”¨å³å¯ã€‚

## ç›¸å…³æ–‡æ¡£
- [ç›¸å…³æ–‡æ¡£1](é“¾æ¥)
- [ç›¸å…³æ–‡æ¡£2](é“¾æ¥)
```

#### 9.5 éªŒæ”¶æ ‡å‡†

- [ ] å®Œæˆ10ä»½æ ¸å¿ƒæ–‡æ¡£
- [ ] æ‰€æœ‰æ–‡æ¡£æœ‰æ¶æ„å›¾/æµç¨‹å›¾
- [ ] ä»£ç ç¤ºä¾‹ç»è¿‡éªŒè¯
- [ ] æ–‡æ¡£ç»è¿‡æŠ€æœ¯å®¡æ ¸
- [ ] å»ºç«‹æ–‡æ¡£ç´¢å¼•

### Phase 10: æœ€ç»ˆæµ‹è¯•ä¸äº¤ä»˜

#### 10.1 ç»¼åˆæµ‹è¯•

**åŠŸèƒ½æµ‹è¯•**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ>95%è¦†ç›–ç‡ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] E2Eæµ‹è¯•é€šè¿‡
- [ ] å›å½’æµ‹è¯•é€šè¿‡

**æ€§èƒ½æµ‹è¯•**ï¼š
- [ ] API å“åº”æ—¶é—´åŸºå‡†æµ‹è¯•
- [ ] æˆ˜æ–—å¼•æ“æ€§èƒ½æµ‹è¯•
- [ ] æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
- [ ] å†…å­˜ä½¿ç”¨æµ‹è¯•

**é…ç½®æµ‹è¯•**ï¼š
- [ ] é»˜è®¤é…ç½®æµ‹è¯•
- [ ] è‡ªå®šä¹‰é…ç½®æµ‹è¯•
- [ ] é…ç½®éªŒè¯æµ‹è¯•
- [ ] ç¯å¢ƒç‰¹å®šé…ç½®æµ‹è¯•

**æ—¥å¿—æµ‹è¯•**ï¼š
- [ ] å„çº§åˆ«æ—¥å¿—è¾“å‡ºæµ‹è¯•
- [ ] ç»“æ„åŒ–æ—¥å¿—æ ¼å¼æµ‹è¯•
- [ ] æ—¥å¿—æ–‡ä»¶è½®è½¬æµ‹è¯•
- [ ] å¼‚å¸¸æ—¥å¿—æµ‹è¯•

**æ–‡æ¡£æµ‹è¯•**ï¼š
- [ ] ä»£ç ç¤ºä¾‹å¯è¿è¡Œ
- [ ] é…ç½®ç¤ºä¾‹æœ‰æ•ˆ
- [ ] é“¾æ¥å®Œæ•´æ€§æ£€æŸ¥
- [ ] æ–‡æ¡£ç‰ˆæœ¬ä¸€è‡´æ€§

#### 10.2 ä»£ç è´¨é‡æ£€æŸ¥

**é™æ€åˆ†æ**ï¼š
- [ ] æ— ç¼–è¯‘è­¦å‘Š
- [ ] æ— ä»£ç åˆ†æè­¦å‘Š
- [ ] æ— å®‰å…¨æ¼æ´
- [ ] ä»£ç é‡å¤åº¦ < 5%

**Code Review**ï¼š
- [ ] æ‰€æœ‰PRç»è¿‡å®¡æ ¸
- [ ] æ³¨é‡Šå®Œæ•´æ€§æ£€æŸ¥
- [ ] å‘½åè§„èŒƒæ£€æŸ¥
- [ ] æ¶æ„ä¸€è‡´æ€§æ£€æŸ¥

#### 10.3 äº¤ä»˜æ¸…å•

**ä»£ç äº¤ä»˜**ï¼š
- [ ] æºä»£ç ï¼ˆåŒ…å«æ‰€æœ‰ä¼˜åŒ–ï¼‰
- [ ] é…ç½®æ–‡ä»¶ï¼ˆå®Œæ•´ä¸”æœ‰æ³¨é‡Šï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡>95%ï¼‰
- [ ] é›†æˆæµ‹è¯•

**æ–‡æ¡£äº¤ä»˜**ï¼š
- [ ] 10ä»½å¼€å‘æ–‡æ¡£
- [ ] æœ¬ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£
- [ ] éªŒæ”¶æ–‡æ¡£ï¼ˆè§ä¸‹èŠ‚ï¼‰
- [ ] æ›´æ–°æ—¥å¿—ï¼ˆChangelogï¼‰

**é…ç½®äº¤ä»˜**ï¼š
- [ ] appsettings.jsonï¼ˆå®Œæ•´é…ç½®ï¼‰
- [ ] appsettings.Development.json
- [ ] appsettings.Production.example.json
- [ ] é…ç½®è¯´æ˜æ–‡æ¡£

**å·¥å…·äº¤ä»˜**ï¼š
- [ ] æ—¥å¿—æŸ¥è¯¢è„šæœ¬
- [ ] ç›‘æ§æŒ‡æ ‡æŸ¥è¯¢API
- [ ] é…ç½®éªŒè¯å·¥å…·

#### 10.4 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç è´¨é‡è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] äº¤ä»˜æ¸…å•å®Œæ•´
- [ ] å®¢æˆ·éªŒæ”¶é€šè¿‡

---

## é£é™©è¯„ä¼°

### 7.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| é‡æ„å¼•å…¥Bug | é«˜ | ä½ | å®Œå–„æµ‹è¯•è¦†ç›–ã€å°æ­¥è¿­ä»£ã€å……åˆ†æµ‹è¯• |
| æ€§èƒ½ä¸‹é™ | ä¸­ | ä½ | é…ç½®æ³¨å…¥ç¼“å­˜ã€æ€§èƒ½åŸºå‡†æµ‹è¯• |
| ç¼–ç è½¬æ¢é”™è¯¯ | ä½ | ä½ | å¤‡ä»½åŸæ–‡ä»¶ã€å°èŒƒå›´è¯•éªŒ |
| æ—¥å¿—å½±å“æ€§èƒ½ | ä¸­ | ä¸­ | å¼‚æ­¥æ—¥å¿—ã€æ—¥å¿—çº§åˆ«æ§åˆ¶ |

### 7.2 é¡¹ç›®é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| å·¥æœŸå»¶è¯¯ | ä¸­ | ä¸­ | é¢„ç•™ç¼“å†²æ—¶é—´ã€ä¼˜å…ˆçº§æ’åº |
| èµ„æºä¸è¶³ | ä¸­ | ä½ | é˜¶æ®µæ€§äº¤ä»˜ã€åˆç†åˆ†å·¥ |
| éœ€æ±‚å˜æ›´ | ä½ | ä½ | æ˜ç¡®éœ€æ±‚èŒƒå›´ã€å˜æ›´æ§åˆ¶ |

### 7.3 è´¨é‡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| æ–‡æ¡£è¿‡æ—¶ | ä¸­ | ä¸­ | ç‰ˆæœ¬ç®¡ç†ã€å®šæœŸå®¡æ ¸ |
| æ³¨é‡Šè´¨é‡ä½ | ä½ | ä¸­ | Code Reviewã€æ³¨é‡Šæ¨¡æ¿ |
| é…ç½®é”™è¯¯ | é«˜ | ä½ | é…ç½®éªŒè¯ã€é»˜è®¤å€¼å…œåº• |

---

## åç»­ç»´æŠ¤å»ºè®®

### 8.1 æŒç»­æ”¹è¿›

1. **å®šæœŸä»£ç å®¡æŸ¥**
   - æ¯æœˆè¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥
   - è¯†åˆ«æ–°çš„é‡å¤ä»£ç 
   - æ›´æ–°å¼€å‘è§„èŒƒ

2. **æ–‡æ¡£ç»´æŠ¤**
   - ä»£ç å˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
   - æ¯å­£åº¦å®¡æŸ¥æ–‡æ¡£å‡†ç¡®æ€§
   - æ”¶é›†å¼€å‘è€…åé¦ˆ

3. **ç›‘æ§ä¼˜åŒ–**
   - æ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´é…ç½®
   - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
   - ä¼˜åŒ–æ…¢æŸ¥è¯¢

4. **æ—¥å¿—ä¼˜åŒ–**
   - æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´æ—¥å¿—çº§åˆ«
   - ä¼˜åŒ–æ—¥å¿—æ ¼å¼
   - æ¸…ç†æ— ç”¨æ—¥å¿—

### 8.2 å·¥å…·æ”¯æŒ

1. **å¼€å‘å·¥å…·**
   - é…ç½® EditorConfigï¼ˆç»Ÿä¸€ç¼–ç ï¼‰
   - é…ç½® Roslyn åˆ†æå™¨ï¼ˆä»£ç è´¨é‡ï¼‰
   - é…ç½® Git hooksï¼ˆæäº¤æ£€æŸ¥ï¼‰

2. **CI/CDé›†æˆ**
   - è‡ªåŠ¨è¿è¡Œæµ‹è¯•
   - è‡ªåŠ¨ä»£ç åˆ†æ
   - è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£

3. **ç›‘æ§å·¥å…·**
   - é›†æˆ Application Insightsï¼ˆå¯é€‰ï¼‰
   - é…ç½®æ—¥å¿—èšåˆï¼ˆå¦‚ELKï¼‰
   - é…ç½®å‘Šè­¦è§„åˆ™

### 8.3 åŸ¹è®­è®¡åˆ’

1. **æ–°å¼€å‘è€…åŸ¹è®­**
   - æ¶æ„æ¦‚è§ˆåŸ¹è®­
   - å¼€å‘è§„èŒƒåŸ¹è®­
   - å·¥å…·ä½¿ç”¨åŸ¹è®­

2. **çŸ¥è¯†åˆ†äº«**
   - å®šæœŸæŠ€æœ¯åˆ†äº«ä¼š
   - æœ€ä½³å®è·µåˆ†äº«
   - é—®é¢˜æ¡ˆä¾‹åˆ†æ

---

## é™„å½•

### A. å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– |
|------|------|----------|------|
| **ä¸Šç¯‡** | | **9å¤©** | |
| Phase 1 | ä»£ç å®¡è®¡ä¸é‡å¤ä»£ç è¯†åˆ« | 4.5å¤© | - |
| Phase 2 | æ³¨é‡Šå®Œå–„ | 7.5å¤© | Phase 1 |
| Phase 3 | ç¼–ç ä¿®å¤ | 1.5å¤© | - |
| Phase 4 | æµ‹è¯•ä¸æ–‡æ¡£ | 1å¤© | Phase 1-3 |
| **ä¸­ç¯‡** | | **8å¤©** | |
| Phase 5 | æ—¥å¿—ç³»ç»Ÿè®¾è®¡ | 7å¤© | Phase 4 |
| Phase 6 | æ€§èƒ½ç›‘æ§ | 6å¤© | Phase 5 |
| Phase 7 | æµ‹è¯•ä¸æ–‡æ¡£ | 1å¤© | Phase 5-6 |
| **ä¸‹ç¯‡** | | **10å¤©** | |
| Phase 8 | ç¡¬ç¼–ç å¸¸é‡è¿ç§» | 5.5å¤© | Phase 7 |
| Phase 9 | å¼€å‘æ–‡æ¡£ç¼–å†™ | 9å¤© | Phase 8 |
| Phase 10 | æœ€ç»ˆæµ‹è¯•ä¸äº¤ä»˜ | 2å¤© | Phase 9 |
| **æ€»è®¡** | | **27å¤©** | |

> æ³¨ï¼šä»¥ä¸Šä¸ºå•äººå·¥æ—¶ä¼°ç®—ï¼Œå®é™…å¯æ ¹æ®å›¢é˜Ÿè§„æ¨¡è°ƒæ•´

### B. é‡Œç¨‹ç¢‘è®¡åˆ’

| é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© | é¢„è®¡å®Œæˆæ—¥æœŸ |
|--------|--------|--------------|
| M1: ä¸Šç¯‡å®Œæˆ | ä»£ç æ•´åˆã€æ³¨é‡Šã€ç¼–ç ä¿®å¤ | +9å¤© |
| M2: ä¸­ç¯‡å®Œæˆ | æ—¥å¿—ä¼˜åŒ–ã€ç›‘æ§å¢å¼º | +17å¤© |
| M3: ä¸‹ç¯‡å®Œæˆ | é…ç½®åŒ–ã€å¼€å‘æ–‡æ¡£ | +27å¤© |
| M4: æœ€ç»ˆéªŒæ”¶ | å®Œæ•´äº¤ä»˜åŒ… | +28å¤© |

### C. å…³é”®å†³ç­–è®°å½•

| ç¼–å· | å†³ç­– | åŸå›  | æ—¥æœŸ |
|------|------|------|------|
| D01 | é‡‡ç”¨ä¸‰é˜¶æ®µä¼˜åŒ–æ–¹æ¡ˆ | é£é™©å¯æ§ã€å¯ç‹¬ç«‹éªŒæ”¶ | 2025-10-15 |
| D02 | ä¼˜å…ˆæ¶ˆé™¤é‡å¤ä»£ç  | é™ä½ç»´æŠ¤æˆæœ¬ | 2025-10-15 |
| D03 | ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š | ç¬¦åˆå›¢é˜Ÿä¹ æƒ¯ | 2025-10-15 |
| D04 | é…ç½®ç±»ä½¿ç”¨ Options æ¨¡å¼ | ASP.NET Core æ ‡å‡† | 2025-10-15 |
| D05 | æ—¥å¿—ä½¿ç”¨ç»“æ„åŒ–æ ¼å¼ | ä¾¿äºæŸ¥è¯¢åˆ†æ | 2025-10-15 |

### D. å‚è€ƒæ–‡æ¡£

1. **å·²æœ‰é¡¹ç›®æ–‡æ¡£**ï¼š
   - `æ•´åˆè®¾è®¡æ€»ç»“.txt` - ç³»ç»Ÿæ¶æ„
   - `SignalR_æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š.md` - SignalRå®æ–½
   - `å•†åº—ç³»ç»Ÿä¼˜åŒ–æ€»ç»“-Phase1-4å®Œæ•´æŠ¥å‘Š.md` - å•†åº—ç³»ç»Ÿ
   - `è£…å¤‡ç³»ç»ŸæŒç»­ä¼˜åŒ–æŠ¥å‘Š2025-10-12.md` - è£…å¤‡ç³»ç»Ÿ
   - `æˆ˜æ–—æ¶ˆæ¯ç³»ç»Ÿå®ç°æ€»ç»“.md` - æˆ˜æ–—ç³»ç»Ÿ

2. **æŠ€æœ¯å‚è€ƒ**ï¼š
   - ASP.NET Core æ–‡æ¡£
   - C# ç¼–ç è§„èŒƒ
   - Clean Code åŸåˆ™
   - DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰

---

**æ–‡æ¡£çŠ¶æ€**: âœ… éœ€æ±‚åˆ†æå®Œæˆ  
**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-15
