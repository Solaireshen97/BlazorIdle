# BlazorIdle è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰
## æµ‹è¯•éªŒè¯ä¸æ‰©å±•è®¾è®¡

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ - æ•´åˆå®Œæˆ  
**ä½œè€…**: ç³»ç»Ÿæ¶æ„è®¾è®¡å›¢é˜Ÿ  

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸ºã€Šè£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆã€‹çš„ä¸‹ç¯‡ï¼Œä¸“æ³¨äºæµ‹è¯•ç­–ç•¥ã€æ•°å€¼å¹³è¡¡ã€å‰ç«¯éªŒè¯å’Œæ‰©å±•æ€§è®¾è®¡ã€‚

### ä¸ä¸Šä¸­ç¯‡çš„å…³ç³»

- **ä¸Šç¯‡**: ç³»ç»Ÿåˆ†æä¸æ¶æ„è®¾è®¡ â† ç†è®ºåŸºç¡€
- **ä¸­ç¯‡**: æ‰§è¡Œè®¡åˆ’ä¸æŠ€æœ¯è§„èŒƒ â† å®æ–½æ–¹æ³•
- **ä¸‹ç¯‡**ï¼ˆæœ¬æ–‡æ¡£ï¼‰: æµ‹è¯•éªŒè¯ä¸æ‰©å±•è®¾è®¡ â† è´¨é‡ä¿è¯ä¸æœªæ¥

---

## ç›®å½•

1. [æµ‹è¯•ç­–ç•¥æ€»è§ˆ](#1-æµ‹è¯•ç­–ç•¥æ€»è§ˆ)
2. [å•å…ƒæµ‹è¯•è§„èŒƒ](#2-å•å…ƒæµ‹è¯•è§„èŒƒ)
3. [é›†æˆæµ‹è¯•è§„èŒƒ](#3-é›†æˆæµ‹è¯•è§„èŒƒ)
4. [E2Eæµ‹è¯•è§„èŒƒ](#4-e2eæµ‹è¯•è§„èŒƒ)
5. [å‰ç«¯éªŒè¯æ–¹æ¡ˆ](#5-å‰ç«¯éªŒè¯æ–¹æ¡ˆ)
6. [æ•°å€¼å¹³è¡¡è®¾è®¡](#6-æ•°å€¼å¹³è¡¡è®¾è®¡)
7. [æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–](#7-æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–)
8. [æ‰©å±•æ€§è®¾è®¡](#8-æ‰©å±•æ€§è®¾è®¡)
9. [é£é™©è¯„ä¼°ä¸åº”å¯¹](#9-é£é™©è¯„ä¼°ä¸åº”å¯¹)
10. [ä¸Šçº¿è®¡åˆ’ä¸ç›‘æ§](#10-ä¸Šçº¿è®¡åˆ’ä¸ç›‘æ§)

---

## 1. æµ‹è¯•ç­–ç•¥æ€»è§ˆ

### 1.1 æµ‹è¯•é‡‘å­—å¡”

```
                    /\
                   /  \
                  / E2E \        20ä¸ªç”¨ä¾‹ (10%)
                 /________\
                /          \
               /  é›†æˆæµ‹è¯•  \    50ä¸ªç”¨ä¾‹ (20%)
              /______________\
             /                \
            /    å•å…ƒæµ‹è¯•      \  150ä¸ªç”¨ä¾‹ (70%)
           /____________________\
```

### 1.2 æµ‹è¯•è¦†ç›–ç›®æ ‡

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | ç”¨ä¾‹æ•°é‡ | æ‰§è¡Œé¢‘ç‡ |
|---------|----------|---------|---------|
| å•å…ƒæµ‹è¯• | â‰¥ 90% | ~150 | æ¯æ¬¡æäº¤ |
| é›†æˆæµ‹è¯• | â‰¥ 70% | ~50 | æ¯æ¬¡æäº¤ |
| E2Eæµ‹è¯• | å…³é”®æµç¨‹ | ~20 | æ¯æ—¥æ„å»º |
| æ€§èƒ½æµ‹è¯• | å…³é”®æŒ‡æ ‡ | ~10 | æ¯å‘¨ |
| å‹åŠ›æµ‹è¯• | æé™åœºæ™¯ | ~5 | å‘å¸ƒå‰ |

### 1.3 æµ‹è¯•å·¥å…·æ ˆ

| æµ‹è¯•ç±»å‹ | å·¥å…· | ç”¨é€” |
|---------|------|------|
| å•å…ƒæµ‹è¯• | xUnit + FluentAssertions | C#ä»£ç æµ‹è¯• |
| Mock | Moq | ä¾èµ–éš”ç¦» |
| è¦†ç›–ç‡ | Coverlet | ä»£ç è¦†ç›–ç‡åˆ†æ |
| é›†æˆæµ‹è¯• | xUnit + TestServer | APIé›†æˆæµ‹è¯• |
| E2Eæµ‹è¯• | Playwright | å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯• |
| æ€§èƒ½æµ‹è¯• | BenchmarkDotNet | æ€§èƒ½åŸºå‡†æµ‹è¯• |
| è´Ÿè½½æµ‹è¯• | K6 | HTTPè´Ÿè½½æµ‹è¯• |

---

## 2. å•å…ƒæµ‹è¯•è§„èŒƒ

### 2.1 æµ‹è¯•ç»„ç»‡ç»“æ„

```
Tests/
â””â”€â”€ Equipment/
    â”œâ”€â”€ Models/
    â”‚   â”œâ”€â”€ GearInstanceTests.cs
    â”‚   â”œâ”€â”€ AffixTests.cs
    â”‚   â””â”€â”€ GearSetTests.cs
    â”œâ”€â”€ Services/
    â”‚   â”œâ”€â”€ GearGenerationServiceTests.cs
    â”‚   â”œâ”€â”€ EquipmentServiceTests.cs
    â”‚   â”œâ”€â”€ StatsAggregationServiceTests.cs
    â”‚   â”œâ”€â”€ DisenchantServiceTests.cs
    â”‚   â””â”€â”€ ReforgeServiceTests.cs
    â”œâ”€â”€ Calculators/
    â”‚   â”œâ”€â”€ ArmorCalculatorTests.cs
    â”‚   â””â”€â”€ BlockCalculatorTests.cs
    â””â”€â”€ Validators/
        â””â”€â”€ EquipmentValidatorTests.cs
```

### 2.2 å•å…ƒæµ‹è¯•ç¤ºä¾‹

#### 2.2.1 è£…å¤‡ç”Ÿæˆæµ‹è¯•

```csharp
public class GearGenerationServiceTests
{
    private readonly Mock<IGearDefinitionRepository> _mockGearDefRepo;
    private readonly Mock<IAffixRepository> _mockAffixRepo;
    private readonly GearGenerationService _service;
    
    public GearGenerationServiceTests()
    {
        _mockGearDefRepo = new Mock<IGearDefinitionRepository>();
        _mockAffixRepo = new Mock<IAffixRepository>();
        _service = new GearGenerationService(
            _mockGearDefRepo.Object,
            _mockAffixRepo.Object);
    }
    
    [Fact]
    public void Generate_ShouldCreateGearWithCorrectRarity()
    {
        // Arrange
        var gearDef = CreateTestGearDefinition();
        _mockGearDefRepo.Setup(r => r.GetByIdAsync("sword_iron"))
            .ReturnsAsync(gearDef);
        
        var rng = new RNGContext(12345);
        
        // Act
        var gear = _service.Generate("sword_iron", 10, rng);
        
        // Assert
        gear.Should().NotBeNull();
        gear.Rarity.Should().BeOneOf(Rarity.Common, Rarity.Rare, Rarity.Epic, Rarity.Legendary);
        gear.TierLevel.Should().Be(1);
        gear.ItemLevel.Should().BeGreaterThan(0);
    }
    
    [Theory]
    [InlineData(Rarity.Common, 0)]
    [InlineData(Rarity.Rare, 1)]
    [InlineData(Rarity.Epic, 2)]
    [InlineData(Rarity.Legendary, 3)]
    public void Generate_ShouldCreateAffixesBasedOnRarity(Rarity rarity, int minAffixes)
    {
        // Arrange
        var gearDef = CreateTestGearDefinition();
        gearDef.RarityWeights = new Dictionary<Rarity, double>
        {
            { rarity, 1.0 }
        };
        _mockGearDefRepo.Setup(r => r.GetByIdAsync("sword_iron"))
            .ReturnsAsync(gearDef);
        
        var affixes = CreateTestAffixes();
        _mockAffixRepo.Setup(r => r.GetByPoolAsync(It.IsAny<List<string>>()))
            .ReturnsAsync(affixes);
        
        var rng = new RNGContext(12345);
        
        // Act
        var gear = _service.Generate("sword_iron", 10, rng);
        
        // Assert
        gear.Affixes.Count.Should().BeGreaterOrEqualTo(minAffixes);
    }
    
    [Fact]
    public void Generate_ShouldApplyTierMultiplier()
    {
        // Arrange
        var gearDef = CreateTestGearDefinition();
        gearDef.BaseStats = new Dictionary<StatType, StatRange>
        {
            { StatType.AttackPower, new StatRange { Min = 10, Max = 15 } }
        };
        _mockGearDefRepo.Setup(r => r.GetByIdAsync("sword_iron"))
            .ReturnsAsync(gearDef);
        
        var rng = new RNGContext(12345);
        
        // Act
        var gear = _service.Generate("sword_iron", 10, rng);
        
        // Assert - Tier 1 åº”ç”¨ 0.8 ç³»æ•°
        gear.RolledStats[StatType.AttackPower].Should().BeInRange(8, 12);
    }
}
```

#### 2.2.2 å±æ€§èšåˆæµ‹è¯•

```csharp
public class StatsAggregationServiceTests
{
    [Fact]
    public async Task CalculateEquipmentStats_ShouldAggregateBaseStats()
    {
        // Arrange
        var characterId = Guid.NewGuid();
        var gear1 = CreateGearWithStats(new Dictionary<StatType, double>
        {
            { StatType.AttackPower, 10 },
            { StatType.CritChance, 0.05 }
        });
        var gear2 = CreateGearWithStats(new Dictionary<StatType, double>
        {
            { StatType.AttackPower, 15 },
            { StatType.CritChance, 0.03 }
        });
        
        var mockRepo = new Mock<IGearInstanceRepository>();
        mockRepo.Setup(r => r.GetEquippedGearAsync(characterId))
            .ReturnsAsync(new List<GearInstance> { gear1, gear2 });
        
        var service = new StatsAggregationService(mockRepo.Object);
        
        // Act
        var stats = await service.CalculateEquipmentStatsAsync(characterId);
        
        // Assert
        stats[StatType.AttackPower].Should().Be(25);
        stats[StatType.CritChance].Should().Be(0.08);
    }
    
    [Fact]
    public async Task CalculateEquipmentStats_ShouldApplyPipeline()
    {
        // Arrange
        var characterId = Guid.NewGuid();
        var gear = CreateGearWithAffixes(new List<AffixInstance>
        {
            new() { StatType = StatType.AttackPower, ModifierType = ModifierType.Flat, RolledValue = 100 },
            new() { StatType = StatType.AttackPower, ModifierType = ModifierType.Percent, RolledValue = 0.10 }
        });
        
        var mockRepo = new Mock<IGearInstanceRepository>();
        mockRepo.Setup(r => r.GetEquippedGearAsync(characterId))
            .ReturnsAsync(new List<GearInstance> { gear });
        
        var service = new StatsAggregationService(mockRepo.Object);
        
        // Act
        var stats = await service.CalculateEquipmentStatsAsync(characterId);
        
        // Assert
        // Pipeline: (100 + 0) * (1 + 0.10) = 110
        stats[StatType.AttackPower].Should().Be(110);
    }
}
```

#### 2.2.3 æŠ¤ç”²è®¡ç®—æµ‹è¯•

```csharp
public class ArmorCalculatorTests
{
    [Theory]
    [InlineData(100, 10, 0.20)]   // 100 / (100 + 400*10) = 0.20
    [InlineData(300, 30, 0.20)]   // 300 / (300 + 400*30) = 0.20
    [InlineData(2000, 10, 0.75)]  // è¾¾åˆ°ä¸Šé™75%
    public void CalculateReduction_ShouldReturnCorrectPercentage(
        double armor, 
        int attackerLevel, 
        double expected)
    {
        // Act
        var reduction = ArmorCalculator.CalculateReduction(armor, attackerLevel);
        
        // Assert
        reduction.Should().BeApproximately(expected, 0.01);
    }
    
    [Fact]
    public void CalculateReduction_ShouldCapAt75Percent()
    {
        // Arrange
        double armor = 10000;
        int attackerLevel = 10;
        
        // Act
        var reduction = ArmorCalculator.CalculateReduction(armor, attackerLevel);
        
        // Assert
        reduction.Should().BeLessOrEqualTo(0.75);
    }
}
```

### 2.3 å•å…ƒæµ‹è¯•æ¸…å•

| æ¨¡å— | æµ‹è¯•åœºæ™¯ | ç”¨ä¾‹æ•° |
|------|---------|--------|
| **GearGenerationService** | ç¨€æœ‰åº¦ç”Ÿæˆã€å±æ€§Rollã€è¯æ¡ç”Ÿæˆã€å“çº§åº”ç”¨ | 15 |
| **EquipmentService** | è£…å¤‡/å¸ä¸‹ã€éªŒè¯ã€åŒæ‰‹æ­¦å™¨å¤„ç† | 20 |
| **StatsAggregationService** | å±æ€§èšåˆã€Pipelineã€ç¼“å­˜ | 15 |
| **ArmorCalculator** | æŠ¤ç”²å‡ä¼¤è®¡ç®—ã€ä¸Šé™ | 10 |
| **BlockCalculator** | æ ¼æŒ¡æ¦‚ç‡è®¡ç®—ã€å‡ä¼¤ | 10 |
| **EquipmentValidator** | èŒä¸šé™åˆ¶ã€ç­‰çº§éœ€æ±‚ã€æ§½ä½éªŒè¯ | 15 |
| **DisenchantService** | åˆ†è§£è®¡ç®—ã€ææ–™äº§å‡º | 10 |
| **ReforgeService** | å“çº§é‡é“¸ã€è¯æ¡é‡ç½® | 10 |
| **SetBonusService** | å¥—è£…æ£€æµ‹ã€åŠ æˆè®¡ç®— | 10 |
| **è¾¹ç•Œæ¡ä»¶æµ‹è¯•** | nullå¤„ç†ã€æé™å€¼ã€å¼‚å¸¸ | 35 |

---

## 3. é›†æˆæµ‹è¯•è§„èŒƒ

### 3.1 é›†æˆæµ‹è¯•åœºæ™¯

#### 3.1.1 è£…å¤‡-æˆ˜æ–—é›†æˆæµ‹è¯•

```csharp
public class EquipmentCombatIntegrationTests : IClassFixture<WebApplicationFactory<Program>>
{
    private readonly WebApplicationFactory<Program> _factory;
    private readonly HttpClient _client;
    
    public EquipmentCombatIntegrationTests(WebApplicationFactory<Program> factory)
    {
        _factory = factory;
        _client = factory.CreateClient();
    }
    
    [Fact]
    public async Task EquipWeapon_ShouldAffectCombatDamage()
    {
        // Arrange - åˆ›å»ºè§’è‰²å’Œè£…å¤‡
        var character = await CreateTestCharacter();
        var weapon = await GenerateTestWeapon(attackPower: 50);
        
        // Act 1 - æˆ˜æ–—å‰è®°å½•ä¼¤å®³
        var battleBefore = await StartBattle(character.Id);
        var damageBefore = ExtractAverageDamage(battleBefore);
        
        // Act 2 - è£…å¤‡æ­¦å™¨
        await EquipItem(character.Id, weapon.Id, EquipmentSlot.MainHand);
        
        // Act 3 - æˆ˜æ–—åè®°å½•ä¼¤å®³
        var battleAfter = await StartBattle(character.Id);
        var damageAfter = ExtractAverageDamage(battleAfter);
        
        // Assert - è£…å¤‡åä¼¤å®³åº”è¯¥æå‡
        damageAfter.Should().BeGreaterThan(damageBefore);
        (damageAfter - damageBefore).Should().BeApproximately(50, 10);
    }
    
    [Fact]
    public async Task EquipArmor_ShouldReduceDamageTaken()
    {
        // Arrange
        var character = await CreateTestCharacter();
        var armor = await GenerateTestArmor(armorValue: 300);
        
        // Act 1 - æˆ˜æ–—å‰è®°å½•å—ä¼¤
        var battleBefore = await StartBattle(character.Id);
        var damageTakenBefore = ExtractAverageDamageTaken(battleBefore);
        
        // Act 2 - è£…å¤‡æŠ¤ç”²
        await EquipItem(character.Id, armor.Id, EquipmentSlot.Chest);
        
        // Act 3 - æˆ˜æ–—åè®°å½•å—ä¼¤
        var battleAfter = await StartBattle(character.Id);
        var damageTakenAfter = ExtractAverageDamageTaken(battleAfter);
        
        // Assert - è£…å¤‡æŠ¤ç”²åå—ä¼¤åº”è¯¥å‡å°‘
        damageTakenAfter.Should().BeLessThan(damageTakenBefore);
    }
}
```

#### 3.1.2 è£…å¤‡-æ‰è½é›†æˆæµ‹è¯•

```csharp
public class EquipmentDropIntegrationTests
{
    [Fact]
    public async Task KillMonster_ShouldDropGear()
    {
        // Arrange
        var character = await CreateTestCharacter();
        var monsterWithGearDrop = "test_monster_with_gear";
        
        // Act - å‡»æ€æ€ªç‰©å¤šæ¬¡
        var droppedGear = new List<GearInstance>();
        for (int i = 0; i < 100; i++)
        {
            var battle = await StartBattle(character.Id, monsterWithGearDrop);
            var rewards = await CollectRewards(battle.Id);
            
            droppedGear.AddRange(rewards.Gear);
        }
        
        // Assert
        droppedGear.Should().NotBeEmpty();
        droppedGear.Should().Contain(g => g.Rarity == Rarity.Rare);
    }
}
```

### 3.2 é›†æˆæµ‹è¯•æ¸…å•

| æµ‹è¯•åœºæ™¯ | è¯´æ˜ | ç”¨ä¾‹æ•° |
|---------|------|--------|
| **è£…å¤‡-æˆ˜æ–—é›†æˆ** | è£…å¤‡å±æ€§å½±å“æˆ˜æ–— | 10 |
| **è£…å¤‡-æ‰è½é›†æˆ** | è£…å¤‡æ‰è½æµç¨‹ | 5 |
| **è£…å¤‡-ç»æµé›†æˆ** | è£…å¤‡åˆ†è§£ã€ææ–™è·å– | 8 |
| **è£…å¤‡-å‰ç«¯é›†æˆ** | APIä¸å‰ç«¯äº¤äº’ | 10 |
| **è£…å¤‡-èŒä¸šé›†æˆ** | èŒä¸šé™åˆ¶ç”Ÿæ•ˆ | 7 |
| **è£…å¤‡-å¥—è£…é›†æˆ** | å¥—è£…æ•ˆæœè§¦å‘ | 5 |
| **å¹¶å‘æµ‹è¯•** | å¤šè§’è‰²åŒæ—¶è£…å¤‡ | 5 |

---

## 4. E2Eæµ‹è¯•è§„èŒƒ

### 4.1 E2Eæµ‹è¯•åœºæ™¯

#### 4.1.1 å®Œæ•´è£…å¤‡æµç¨‹

```javascript
// tests/e2e/equipment.spec.ts
import { test, expect } from '@playwright/test';

test('å®Œæ•´è£…å¤‡æµç¨‹ - è·å–è£…å¤‡å¹¶è£…å¤‡', async ({ page }) => {
  // 1. ç™»å½•
  await page.goto('/login');
  await page.fill('input[name="username"]', 'test_user');
  await page.fill('input[name="password"]', 'test_pass');
  await page.click('button[type="submit"]');
  
  // 2. å¯¼èˆªåˆ°è§’è‰²é¡µé¢
  await page.click('text=æˆ‘çš„è§’è‰²');
  await expect(page).toHaveURL(/.*character/);
  
  // 3. å¼€å§‹æˆ˜æ–—è·å–è£…å¤‡
  await page.click('text=å¼€å§‹æˆ˜æ–—');
  await page.waitForSelector('.battle-result', { timeout: 30000 });
  
  // 4. æŸ¥çœ‹èƒŒåŒ…
  await page.click('text=èƒŒåŒ…');
  await expect(page.locator('.inventory-item')).toBeVisible();
  
  // 5. è£…å¤‡ç‰©å“
  const firstGear = page.locator('.inventory-item[data-type="gear"]').first();
  await firstGear.click();
  await page.click('button:has-text("è£…å¤‡")');
  
  // 6. éªŒè¯è£…å¤‡æˆåŠŸ
  await page.click('text=è£…å¤‡é¢æ¿');
  await expect(page.locator('.equipment-slot.equipped')).toBeVisible();
  
  // 7. éªŒè¯å±æ€§å˜åŒ–
  const attackPower = await page.locator('.stat-attack-power').textContent();
  expect(parseInt(attackPower)).toBeGreaterThan(0);
});

test('è£…å¤‡å¯¹æ¯”åŠŸèƒ½', async ({ page }) => {
  await page.goto('/character/equipment');
  
  // 1. é¼ æ ‡æ‚¬åœåœ¨èƒŒåŒ…è£…å¤‡ä¸Š
  const newGear = page.locator('.inventory-item[data-slot="MainHand"]').first();
  await newGear.hover();
  
  // 2. éªŒè¯å¯¹æ¯”Tooltipæ˜¾ç¤º
  await expect(page.locator('.gear-comparison-tooltip')).toBeVisible();
  
  // 3. éªŒè¯å±æ€§å·®å¼‚é«˜äº®
  await expect(page.locator('.stat-increase')).toBeVisible();
});

test('èŒä¸šè£…å¤‡é™åˆ¶æç¤º', async ({ page }) => {
  await page.goto('/character/equipment');
  
  // 1. å°è¯•è£…å¤‡ä¸å…¼å®¹çš„è£…å¤‡
  const plateArmor = page.locator('.inventory-item[data-armor-type="Plate"]').first();
  await plateArmor.click();
  await page.click('button:has-text("è£…å¤‡")');
  
  // 2. éªŒè¯é”™è¯¯æç¤º
  await expect(page.locator('.error-message:has-text("æ— æ³•è£…å¤‡")')).toBeVisible();
});
```

### 4.2 E2Eæµ‹è¯•æ¸…å•

| æµ‹è¯•åœºæ™¯ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|---------|------|--------|
| **å®Œæ•´è£…å¤‡æµç¨‹** | è·å–ã€è£…å¤‡ã€å¸ä¸‹ | â­â­â­â­â­ |
| **è£…å¤‡å¯¹æ¯”** | Tooltipæ˜¾ç¤ºæ­£ç¡® | â­â­â­â­ |
| **èŒä¸šé™åˆ¶** | é™åˆ¶æç¤ºæ­£ç¡® | â­â­â­â­ |
| **è£…å¤‡å¢å¼º** | åˆ†è§£ã€é‡é“¸ã€é‡ç½® | â­â­â­ |
| **å¥—è£…æ¿€æ´»** | å¥—è£…æ•ˆæœæ˜¾ç¤º | â­â­â­ |
| **17æ§½ä½å¸ƒå±€** | æ‰€æœ‰æ§½ä½å¯ç”¨ | â­â­â­â­â­ |
| **åŒæ‰‹æ­¦å™¨** | å ç”¨é€»è¾‘æ­£ç¡® | â­â­â­â­ |
| **ç§»åŠ¨ç«¯é€‚é…** | å“åº”å¼å¸ƒå±€ | â­â­ |

---

## 5. å‰ç«¯éªŒè¯æ–¹æ¡ˆ

### 5.1 éªŒè¯æ£€æŸ¥æ¸…å•

#### 5.1.1 Phase 2éªŒè¯ï¼ˆè£…å¤‡ç”Ÿæˆä¸æ‰è½ï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| è£…å¤‡æ‰è½æ˜¾ç¤º | æˆ˜æ–—åæŸ¥çœ‹èƒŒåŒ… | è£…å¤‡å‡ºç°åœ¨èƒŒåŒ…ä¸­ |
| ç¨€æœ‰åº¦é¢œè‰² | æŸ¥çœ‹è£…å¤‡å“è´¨ | é¢œè‰²æ­£ç¡®ï¼ˆæ™®é€š/ç¨€æœ‰/å²è¯—/ä¼ è¯´ï¼‰ |
| è£…å¤‡å±æ€§ | æŸ¥çœ‹è£…å¤‡è¯¦æƒ… | å±æ€§æ•°å€¼åˆç† |
| è¯æ¡æ˜¾ç¤º | æŸ¥çœ‹ç¨€æœ‰+è£…å¤‡ | è¯æ¡æ­£ç¡®æ˜¾ç¤º |

#### 5.1.2 Phase 3éªŒè¯ï¼ˆè£…å¤‡ç®¡ç†ï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| è£…å¤‡æ“ä½œ | ç‚¹å‡»"è£…å¤‡"æŒ‰é’® | è£…å¤‡æˆåŠŸè£…å¤‡åˆ°æ§½ä½ |
| å¸ä¸‹æ“ä½œ | ç‚¹å‡»"å¸ä¸‹"æŒ‰é’® | è£…å¤‡è¿”å›èƒŒåŒ… |
| å±æ€§å˜åŒ– | è£…å¤‡å‰åå¯¹æ¯”æ€»å±æ€§ | å±æ€§æ•°å€¼æ­£ç¡®å˜åŒ– |
| æˆ˜æ–—å½±å“ | è£…å¤‡åå¼€å§‹æˆ˜æ–— | ä¼¤å®³/é˜²å¾¡å˜åŒ– |

#### 5.1.3 Phase 4éªŒè¯ï¼ˆ17æ§½ä½ä¸æŠ¤ç”²ï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| 17æ§½ä½æ˜¾ç¤º | æŸ¥çœ‹è£…å¤‡é¢æ¿ | 17ä¸ªæ§½ä½å…¨éƒ¨æ˜¾ç¤º |
| æ–°å¢æ§½ä½å¯ç”¨ | è£…å¤‡é¢ˆéƒ¨/è‚©éƒ¨ç­‰ | æ–°æ§½ä½æ­£å¸¸å·¥ä½œ |
| æŠ¤ç”²å‡ä¼¤ | æˆ˜æ–—æ—¥å¿—æŸ¥çœ‹ | å—ä¼¤å‡å°‘ï¼ŒæŠ¤ç”²ç”Ÿæ•ˆ |
| æŠ¤ç”²ç±»å‹æ˜¾ç¤º | è£…å¤‡è¯¦æƒ… | æ˜¾ç¤ºæŠ¤ç”²ç±»å‹ï¼ˆå¸ƒ/çš®/é”/æ¿ï¼‰ |

#### 5.1.4 Phase 5éªŒè¯ï¼ˆæ­¦å™¨ç±»å‹ä¸æˆ˜æ–—ï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| æ”»å‡»é€Ÿåº¦ | è£…å¤‡ä¸åŒæ­¦å™¨ç±»å‹ | æ”»å‡»é—´éš”å˜åŒ– |
| æ­¦å™¨ä¼¤å®³ | è£…å¤‡åŒæ‰‹æ­¦å™¨ | ä¼¤å®³æå‡æ˜æ˜¾ |
| åŒæŒæ•ˆæœ | åŒæ—¶è£…å¤‡ä¸¤æŠŠå•æ‰‹æ­¦å™¨ | æ”»å‡»é€Ÿåº¦å’Œä¼¤å®³è®¡ç®—æ­£ç¡® |
| æ ¼æŒ¡è§¦å‘ | è£…å¤‡ç›¾ç‰Œå¼€æˆ˜ | æˆ˜æ–—æ—¥å¿—æ˜¾ç¤º"æ ¼æŒ¡ï¼" |

#### 5.1.5 Phase 6éªŒè¯ï¼ˆèŒä¸šé™åˆ¶ä¸å‰ç«¯ï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| èŒä¸šé™åˆ¶ | å°è¯•è£…å¤‡ä¸å…¼å®¹è£…å¤‡ | æç¤º"æ— æ³•è£…å¤‡" |
| UIå¸ƒå±€ | æŸ¥çœ‹è£…å¤‡é¢æ¿ | å¸ƒå±€ç¾è§‚ï¼Œå“åº”å¼ |
| è£…å¤‡å¯¹æ¯” | é¼ æ ‡æ‚¬åœè£…å¤‡ | Tooltipæ˜¾ç¤ºå¯¹æ¯”ä¿¡æ¯ |
| è£…å¤‡ç­›é€‰ | ä½¿ç”¨ç­›é€‰åŠŸèƒ½ | ç­›é€‰æ­£ç¡®å·¥ä½œ |

#### 5.1.6 Phase 7éªŒè¯ï¼ˆè£…å¤‡å¢å¼ºï¼‰

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|---------|---------|
| è£…å¤‡åˆ†è§£ | åˆ†è§£ä¸€ä»¶è£…å¤‡ | è·å¾—ææ–™ |
| å“çº§é‡é“¸ | é‡é“¸T1â†’T2 | å±æ€§æå‡ï¼Œå“çº§å˜åŒ– |
| è¯æ¡é‡ç½® | é‡ç½®è¯æ¡ | è¯æ¡é‡æ–°ç”Ÿæˆ |
| æˆæœ¬æ˜¾ç¤º | æŸ¥çœ‹å¢å¼ºæˆæœ¬ | æˆæœ¬æ­£ç¡®æ˜¾ç¤º |

### 5.2 å‰ç«¯éªŒè¯è„šæœ¬

```javascript
// scripts/frontend-validation.js
const scenarios = [
  {
    name: "Phase 2: è£…å¤‡æ‰è½éªŒè¯",
    steps: [
      "ç™»å½•æµ‹è¯•è´¦å·",
      "å¼€å§‹æˆ˜æ–—",
      "ç­‰å¾…æˆ˜æ–—ç»“æŸ",
      "æ‰“å¼€èƒŒåŒ…",
      "æ£€æŸ¥æ˜¯å¦æœ‰æ–°è£…å¤‡",
      "æŸ¥çœ‹è£…å¤‡è¯¦æƒ…"
    ]
  },
  {
    name: "Phase 3: è£…å¤‡ç®¡ç†éªŒè¯",
    steps: [
      "é€‰æ‹©ä¸€ä»¶è£…å¤‡",
      "ç‚¹å‡»'è£…å¤‡'æŒ‰é’®",
      "éªŒè¯è£…å¤‡å‡ºç°åœ¨è£…å¤‡é¢æ¿",
      "æŸ¥çœ‹æ€»å±æ€§æ˜¯å¦å˜åŒ–",
      "ç‚¹å‡»'å¸ä¸‹'æŒ‰é’®",
      "éªŒè¯è£…å¤‡è¿”å›èƒŒåŒ…"
    ]
  },
  // æ›´å¤šåœºæ™¯...
];

async function runValidation(scenario) {
  console.log(`\n=== ${scenario.name} ===`);
  for (const step of scenario.steps) {
    console.log(`[ ] ${step}`);
    // æ‰‹åŠ¨æ‰§è¡Œæˆ–è‡ªåŠ¨åŒ–
    await waitForUserConfirmation();
  }
}
```

---

## 6. æ•°å€¼å¹³è¡¡è®¾è®¡

### 6.1 æŠ¤ç”²å‡ä¼¤å¹³è¡¡è¡¨

#### 6.1.1 ä¸åŒæŠ¤ç”²å€¼çš„å‡ä¼¤æ•ˆæœ

| æŠ¤ç”²å€¼ | vs Lv10 | vs Lv20 | vs Lv30 | vs Lv40 | vs Lv50 | è£…å¤‡å»ºè®® |
|-------|---------|---------|---------|---------|---------|---------|
| 50 | 11.1% | 5.9% | 4.0% | 3.0% | 2.4% | å¸ƒç”²åˆæœŸ |
| 100 | 20.0% | 11.1% | 7.7% | 5.9% | 4.8% | å¸ƒç”²ä¸­æœŸ |
| 200 | 33.3% | 20.0% | 14.3% | 11.1% | 9.1% | çš®ç”²åˆæœŸ |
| 300 | 42.9% | 27.3% | 20.0% | 15.8% | 13.0% | çš®ç”²ä¸­æœŸ |
| 500 | 55.6% | 38.5% | 29.4% | 23.8% | 20.0% | é”ç”²ä¸­æœŸ |
| 800 | 66.7% | 50.0% | 40.0% | 33.3% | 28.6% | é”ç”²åæœŸ |
| 1000 | 71.4% | 55.6% | 45.5% | 38.5% | 33.3% | æ¿ç”²ä¸­æœŸ |
| 1500 | **75%â†‘** | 65.2% | 55.6% | 48.4% | 42.9% | æ¿ç”²åæœŸ |
| 2000 | **75%â†‘** | 71.4% | 62.5% | 55.6% | 50.0% | æ¿ç”²æå“ |

**è®¾è®¡åŸåˆ™**:
1. åŒç­‰çº§æŠ¤ç”²æä¾›çº¦40-50%å‡ä¼¤
2. ä½ç­‰çº§è§’è‰²é«˜æŠ¤ç”²å¯è¾¾ä¸Šé™75%
3. é«˜ç­‰çº§æ•Œäººä½¿æŠ¤ç”²æ•ˆæœé€’å‡
4. é¼“åŠ±æŒç»­å‡çº§è£…å¤‡

### 6.2 æ­¦å™¨DPSå¹³è¡¡è¡¨

#### 6.2.1 å•æ‰‹æ­¦å™¨å¯¹æ¯”

| æ­¦å™¨ç±»å‹ | é€Ÿåº¦ | å€ç‡ | DPS | ç‰¹ç‚¹ | é€‚åˆèŒä¸š |
|---------|------|------|-----|------|---------|
| å‰‘ | 2.5s | 1.00 | 0.40 | åŸºå‡†ï¼Œå¹³è¡¡ | æˆ˜å£«ã€æ¸¸ä¾ ã€ç›—è´¼ |
| åŒ•é¦– | 1.8s | 0.72 | 0.40 | å¿«é€Ÿï¼Œæš´å‡» | ç›—è´¼ |
| æ–§ | 2.8s | 1.12 | 0.40 | æ…¢é€Ÿï¼Œé«˜ä¼¤ | æˆ˜å£« |
| é”¤ | 2.6s | 1.04 | 0.40 | å¹³è¡¡åæ…¢ | æˆ˜å£«ã€è¨æ»¡ |
| æ‹³å¥— | 2.0s | 0.80 | 0.40 | å¿«é€Ÿè¿å‡» | æ­¦åƒ§ |
| é­”æ– | 2.0s | 0.60 | 0.30 | æ³•æœ¯æ­¦å™¨ | æ³•å¸ˆã€ç‰§å¸ˆ |

#### 6.2.2 åŒæ‰‹æ­¦å™¨å¯¹æ¯”

| æ­¦å™¨ç±»å‹ | é€Ÿåº¦ | å€ç‡ | DPS | vså•æ‰‹ | é€‚åˆèŒä¸š |
|---------|------|------|-----|--------|---------|
| åŒæ‰‹å‰‘ | 3.5s | 1.75 | 0.50 | +25% | æˆ˜å£« |
| åŒæ‰‹æ–§ | 3.8s | 1.90 | 0.50 | +25% | æˆ˜å£« |
| åŒæ‰‹é”¤ | 3.6s | 1.80 | 0.50 | +25% | æˆ˜å£«ã€åœ£éª‘å£« |
| æ³•æ– | 3.2s | 1.12 | 0.35 | +17% | æ³•å¸ˆã€å¾·é²ä¼Š |
| é•¿æŸ„ | 3.4s | 1.70 | 0.50 | +25% | æˆ˜å£«ã€çŒäºº |

**è®¾è®¡åŸåˆ™**:
1. DPSç³»æ•°ä¿æŒç›¸è¿‘ï¼ˆå•æ‰‹0.40ï¼ŒåŒæ‰‹0.50ï¼‰
2. åŒæ‰‹æ­¦å™¨DPSæå‡25%ï¼Œè¡¥å¿å¤±å»å‰¯æ‰‹
3. ä¸åŒç±»å‹æä¾›é£æ ¼å·®å¼‚è€Œéæ•°å€¼å·®è·

#### 6.2.3 åŒæŒè®¡ç®—

```
åŒæŒDPSè®¡ç®—:
- ä¸»æ‰‹æ­¦å™¨: å‰‘ 2.5s, å€ç‡1.0
- å‰¯æ‰‹æ­¦å™¨: å‰‘ 2.5s, å€ç‡1.0
- å¹³å‡é€Ÿåº¦: 2.5s
- æ€»æ”»å‡»åŠ›: (1.0 + 1.0) Ã— 0.85 = 1.7
- DPS: 1.7 / 2.5 = 0.68 (+70% vså•æ‰‹å‰‘)
- è€ƒè™‘å‘½ä¸­æƒ©ç½šå: 0.68 Ã— 0.81 = 0.55 (+37.5% vså•æ‰‹å‰‘)
```

### 6.3 èŒä¸šå¹³è¡¡çŸ©é˜µ

| èŒä¸š | ç”Ÿå­˜èƒ½åŠ› | ç‰©ç†DPS | æ³•æœ¯DPS | ç‰¹è‰²æœºåˆ¶ | å¹³è¡¡ç­–ç•¥ |
|-----|---------|---------|---------|---------|---------|
| **æˆ˜å£«** | â­â­â­â­â­ | â­â­â­â­ | â­ | æ¿ç”²+ç›¾ç‰Œæ ¼æŒ¡ | é«˜ç”Ÿå­˜ï¼Œä¸­ä¼¤å®³ |
| **æ¸¸ä¾ ** | â­â­â­ | â­â­â­â­ | â­â­ | è¿œç¨‹æ”»å‡» | ä¸­ç”Ÿå­˜ï¼Œé«˜ç‰©ç†DPS |
| **æ³•å¸ˆ** | â­â­ | â­ | â­â­â­â­â­ | é«˜çˆ†å‘æ³•æœ¯ | ä½ç”Ÿå­˜ï¼Œæé«˜æ³•æœ¯DPS |
| **ç›—è´¼** | â­â­â­ | â­â­â­â­â­ | â­ | åŒæŒæš´å‡» | ä¸­ç”Ÿå­˜ï¼Œæé«˜ç‰©ç†DPS |
| **ç‰§å¸ˆ** | â­â­â­ | â­â­ | â­â­â­â­ | æ²»ç–—+æ³•æœ¯ | ä¸­ç”Ÿå­˜ï¼Œä¸­æ³•æœ¯DPS |
| **è¨æ»¡** | â­â­â­â­ | â­â­â­ | â­â­â­â­ | å…ƒç´ +å¢å¼º | é«˜ç”Ÿå­˜ï¼Œå¹³è¡¡å‹ |
| **åœ£éª‘å£«** | â­â­â­â­â­ | â­â­â­ | â­â­â­ | æ¿ç”²+æ²»ç–— | æé«˜ç”Ÿå­˜ï¼Œä¸­DPS |

### 6.4 æ•°å€¼ç®¡çº¿ç¤ºä¾‹

```
ç¤ºä¾‹ï¼šè®¡ç®—æœ€ç»ˆæ”»å‡»åŠ›
åŸºç¡€æ”»å‡»åŠ›: 100 (ä¸»å±æ€§è½¬æ¢)
è£…å¤‡åŠ æˆ:
  - æ­¦å™¨: +50 (Flat)
  - æ‰‹å¥—: +10 (Flat)
  - è¯æ¡1: +15% (Percent)
  - è¯æ¡2: +8% (Percent)
  - å¥—è£…: +20 (FinalAdd)

è®¡ç®—è¿‡ç¨‹:
1. Additive: 100 + 50 + 10 = 160
2. Multiplicative: 160 Ã— (1 + 0.15) Ã— (1 + 0.08) = 160 Ã— 1.15 Ã— 1.08 = 198.72
3. FinalAdd: 198.72 + 20 = 218.72
4. Final: 218 (å–æ•´)

ä¼¤å®³æå‡: 218 / 100 = 2.18å€
```

---

## 7. æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–

### 7.1 æ€§èƒ½åŸºå‡†

| æ“ä½œ | ç›®æ ‡å“åº”æ—¶é—´ | æµ‹é‡æ–¹æ³• |
|-----|------------|---------|
| è£…å¤‡ç”Ÿæˆ | < 100ms | BenchmarkDotNet |
| è£…å¤‡/å¸ä¸‹ | < 200ms | APIå“åº”æ—¶é—´ |
| å±æ€§è®¡ç®— | < 50ms | BenchmarkDotNet |
| è£…å¤‡åˆ—è¡¨åŠ è½½ | < 500ms | å‰ç«¯æ€§èƒ½åˆ†æ |
| è£…å¤‡æ‰è½ï¼ˆæˆ˜æ–—ï¼‰ | < 100ms | åŒ…å«åœ¨æˆ˜æ–—æ—¶é—´å†… |

### 7.2 æ€§èƒ½æµ‹è¯•ä»£ç 

```csharp
[MemoryDiagnoser]
public class GearGenerationBenchmarks
{
    private GearGenerationService _service;
    private RNGContext _rng;
    
    [GlobalSetup]
    public void Setup()
    {
        // åˆå§‹åŒ–æœåŠ¡
    }
    
    [Benchmark]
    public GearInstance GenerateCommonGear()
    {
        return _service.Generate("sword_iron", 10, _rng);
    }
    
    [Benchmark]
    public GearInstance GenerateLegendaryGear()
    {
        return _service.Generate("sword_legendary", 50, _rng);
    }
}
```

### 7.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 7.3.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

```csharp
// ä½¿ç”¨Includeé¿å…N+1æŸ¥è¯¢
public async Task<List<GearInstance>> GetEquippedGearAsync(Guid characterId)
{
    return await _context.GearInstances
        .Include(g => g.Definition)  // é¢„åŠ è½½è£…å¤‡å®šä¹‰
        .Where(g => g.CharacterId == characterId && g.IsEquipped)
        .ToListAsync();
}

// ä½¿ç”¨ç´¢å¼•
CREATE INDEX IX_GearInstances_CharacterId_IsEquipped 
ON GearInstances(CharacterId, IsEquipped);
```

#### 7.3.2 ç¼“å­˜ä¼˜åŒ–

```csharp
// è£…å¤‡å±æ€§ç¼“å­˜
public class EquipmentStatsCache
{
    private readonly IMemoryCache _cache;
    
    public Dictionary<StatType, double> GetOrCalculate(
        Guid characterId,
        Func<Dictionary<StatType, double>> calculator)
    {
        var key = $"equipment_stats_{characterId}";
        
        return _cache.GetOrCreate(key, entry =>
        {
            entry.SetAbsoluteExpiration(TimeSpan.FromMinutes(5));
            return calculator();
        });
    }
}
```

---

## 8. æ‰©å±•æ€§è®¾è®¡

### 8.1 é¢„ç•™æ¥å£

#### 8.1.1 é™„é­”ç³»ç»Ÿæ¥å£

```csharp
public interface IEnchantment
{
    string Id { get; }
    string Name { get; }
    EquipmentSlot ApplicableSlot { get; }
    Dictionary<StatType, double> BonusStats { get; }
    int RequiredLevel { get; }
    int MaterialCost { get; }
}

public class EnchantmentService
{
    public async Task<bool> ApplyEnchantmentAsync(
        Guid gearInstanceId,
        string enchantmentId)
    {
        // æœªæ¥å®ç°
        throw new NotImplementedException();
    }
}
```

#### 8.1.2 å®çŸ³æ’æ§½æ¥å£

```csharp
public interface IGemSocket
{
    SocketColor Color { get; }
    IGem? InsertedGem { get; }
}

public enum SocketColor
{
    Red,      // åŠ›é‡
    Blue,     // æ™ºåŠ›
    Yellow,   // æ•æ·
    Meta      // ç‰¹æ®Š
}

public interface IGem
{
    string Id { get; }
    string Name { get; }
    SocketColor Color { get; }
    Dictionary<StatType, double> BonusStats { get; }
}
```

#### 8.1.3 è£…å¤‡ç‰¹æ•ˆæ¥å£

```csharp
public interface IEquipmentEffect
{
    string Id { get; }
    string Description { get; }
    EffectTrigger Trigger { get; }
    void Apply(BattleContext context);
}

public enum EffectTrigger
{
    OnEquip,    // è£…å¤‡æ—¶è§¦å‘
    OnHit,      // å‘½ä¸­æ—¶è§¦å‘
    OnCrit,     // æš´å‡»æ—¶è§¦å‘
    OnBlock,    // æ ¼æŒ¡æ—¶è§¦å‘
    OnKill      // å‡»æ€æ—¶è§¦å‘
}
```

### 8.2 éæˆ˜æ–—èŒä¸šè£…å¤‡

#### 8.2.1 é‡‡é›†èŒä¸šè£…å¤‡æ§½ä½

```csharp
public enum GatheringEquipmentSlot
{
    GatheringTool,   // é‡‡é›†å·¥å…·ï¼ˆé•/åˆ€/å‰¥çš®åˆ€ï¼‰
    GatheringArmor,  // å·¥ä½œæœ
    GatheringGoggles // æŠ¤ç›®é•œ
}
```

#### 8.2.2 ç”Ÿäº§èŒä¸šè£…å¤‡æ§½ä½

```csharp
public enum CraftingEquipmentSlot
{
    CraftingTool,    // ç”Ÿäº§å·¥å…·ï¼ˆé”¤/é’ˆ/è¯å‰‚ç“¶ï¼‰
    CraftingApron,   // å›´è£™
    CraftingGloves   // æ‰‹å¥—
}
```

### 8.3 æœªæ¥åŠŸèƒ½é¢„ç•™

| åŠŸèƒ½ | é¢„è®¡Phase | æ¥å£é¢„ç•™ | è¯´æ˜ |
|-----|----------|---------|------|
| **é™„é­”ç³»ç»Ÿ** | Phase 9-10 | IEnchantment | è£…å¤‡é™„åŠ å±æ€§ |
| **å®çŸ³ç³»ç»Ÿ** | Phase 11-12 | IGemSocket, IGem | é•¶åµŒå®çŸ³ |
| **è£…å¤‡å¼ºåŒ–** | Phase 13-14 | IEnhancement | +1åˆ°+15å¼ºåŒ– |
| **è£…å¤‡ä¼ æ‰¿** | Phase 15-16 | ITransfer | å±æ€§è½¬ç§» |
| **è£…å¤‡äº¤æ˜“** | æœªå®š | ITradeable | ç©å®¶é—´äº¤æ˜“ |
| **è£…å¤‡å›¾é‰´** | æœªå®š | ICodex | æ”¶é›†ç³»ç»Ÿ |
| **ç‰¹æ®Šæ•ˆæœ** | Phase 17+ | IEquipmentEffect | PROCè§¦å‘ |

---

## 9. é£é™©è¯„ä¼°ä¸åº”å¯¹

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ | è´Ÿè´£äºº |
|-----|------|------|---------|--------|
| **æ•°æ®åº“è¿ç§»å¤±è´¥** | é«˜ | ä¸­ | 1. ç¼–å†™å›æ»šè„šæœ¬<br>2. åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†æµ‹è¯•<br>3. ç°åº¦è¿ç§» | DBA |
| **æ€§èƒ½ä¸‹é™** | ä¸­ | ä¸­ | 1. æ€§èƒ½æµ‹è¯•<br>2. ä¼˜åŒ–æŸ¥è¯¢<br>3. æ·»åŠ ç¼“å­˜ | åç«¯å¼€å‘ |
| **æˆ˜æ–—å¹³è¡¡é—®é¢˜** | ä¸­ | é«˜ | 1. æ•°å€¼æ¨¡æ‹Ÿ<br>2. ç°åº¦å‘å¸ƒ<br>3. å¿«é€Ÿè°ƒæ•´é…ç½® | æ•°å€¼ç­–åˆ’ |
| **å‰ç«¯å…¼å®¹æ€§** | ä½ | ä½ | 1. æµè§ˆå™¨æµ‹è¯•<br>2. æ¸è¿›å¢å¼º<br>3. Polyfill | å‰ç«¯å¼€å‘ |
| **è£…å¤‡ç”ŸæˆBug** | é«˜ | ä¸­ | 1. å……åˆ†å•å…ƒæµ‹è¯•<br>2. é›†æˆæµ‹è¯•<br>3. æ—¥å¿—è®°å½• | åç«¯å¼€å‘ |

### 9.2 è®¾è®¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| **èŒä¸šä¸å¹³è¡¡** | ä¸­ | é«˜ | 1. æŒç»­ç›‘æ§æ•°æ®<br>2. å®šæœŸè°ƒæ•´ç³»æ•°<br>3. ç©å®¶åé¦ˆæ”¶é›† |
| **è£…å¤‡å¤æ‚åº¦è¿‡é«˜** | ä¸­ | ä¸­ | 1. UIç®€åŒ–<br>2. æä¾›è£…å¤‡æ¨è<br>3. æ–°æ‰‹å¼•å¯¼ |
| **æ•°å€¼è†¨èƒ€** | é«˜ | ä¸­ | 1. ä¸¥æ ¼æ•°å€¼ç®¡çº¿<br>2. ä¸Šé™æ§åˆ¶<br>3. å®šæœŸé‡ç½® |
| **é…ç½®è¿‡äºå¤æ‚** | ä½ | ä¸­ | 1. é…ç½®å·¥å…·<br>2. æ–‡æ¡£å®Œå–„<br>3. éªŒè¯æœºåˆ¶ |

### 9.3 é¡¹ç›®é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| **å¼€å‘æ—¶é—´è¶…æœŸ** | ä¸­ | ä¸­ | 1. åˆ†é˜¶æ®µäº¤ä»˜<br>2. å…³é”®åŠŸèƒ½ä¼˜å…ˆ<br>3. èµ„æºè°ƒé… |
| **éœ€æ±‚å˜æ›´** | ä½ | ä½ | 1. æ¶æ„çµæ´»æ€§<br>2. æ¨¡å—åŒ–è®¾è®¡<br>3. å¿«é€Ÿå“åº” |
| **æµ‹è¯•ä¸å……åˆ†** | é«˜ | ä¸­ | 1. è‡ªåŠ¨åŒ–æµ‹è¯•<br>2. å……è¶³æµ‹è¯•æ—¶é—´<br>3. æµ‹è¯•ä¼˜å…ˆçº§ |
| **å›¢é˜Ÿåä½œé—®é¢˜** | ä¸­ | ä½ | 1. å®šæœŸä¼šè®®<br>2. æ–‡æ¡£å…±äº«<br>3. Code Review |

---

## 10. ä¸Šçº¿è®¡åˆ’ä¸ç›‘æ§

### 10.1 ç°åº¦å‘å¸ƒè®¡åˆ’

#### é˜¶æ®µ1: å†…éƒ¨æµ‹è¯•ï¼ˆç¬¬17å‘¨ï¼‰
- æµ‹è¯•ç¯å¢ƒå…¨é¢æµ‹è¯•
- å†…éƒ¨å›¢é˜Ÿä½“éªŒ
- Bugä¿®å¤

#### é˜¶æ®µ2: å°èŒƒå›´ç°åº¦ï¼ˆç¬¬18å‘¨ç¬¬1å¤©ï¼‰
- 5%ç”¨æˆ·ç°åº¦
- ç›‘æ§æŒ‡æ ‡
- æ”¶é›†åé¦ˆ

#### é˜¶æ®µ3: ä¸­èŒƒå›´ç°åº¦ï¼ˆç¬¬18å‘¨ç¬¬3å¤©ï¼‰
- 20%ç”¨æˆ·ç°åº¦
- æŒç»­ç›‘æ§
- å¿…è¦è°ƒæ•´

#### é˜¶æ®µ4: å…¨é‡ä¸Šçº¿ï¼ˆç¬¬18å‘¨ç¬¬5å¤©ï¼‰
- 100%ç”¨æˆ·ä¸Šçº¿
- å¯†åˆ‡ç›‘æ§
- å¿«é€Ÿå“åº”

### 10.2 ç›‘æ§æŒ‡æ ‡

#### 10.2.1 ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼ |
|-----|--------|---------|---------|
| è£…å¤‡ç›¸å…³æ“ä½œæ¬¡æ•° | +300% | æ¯å°æ—¶ | ä½äº+200% |
| è£…å¤‡æ‰è½ç‡ | 10-15% | æ¯å°æ—¶ | ä½äº8%æˆ–é«˜äº20% |
| å¹³å‡è£…å¤‡è¯„åˆ† | é€æ­¥æå‡ | æ¯æ—¥ | - |
| è£…å¤‡å¢å¼ºæ“ä½œ | >100æ¬¡/å¤© | æ¯æ—¥ | ä½äº50æ¬¡/å¤© |
| ç©å®¶åœ¨çº¿æ—¶é•¿ | +40% | æ¯æ—¥ | ä½äº+20% |

#### 10.2.2 æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼ |
|-----|--------|---------|---------|
| è£…å¤‡ç”Ÿæˆè€—æ—¶ | < 100ms | å®æ—¶ | > 200ms |
| è£…å¤‡æ“ä½œå“åº” | < 200ms | å®æ—¶ | > 500ms |
| å±æ€§è®¡ç®—è€—æ—¶ | < 50ms | å®æ—¶ | > 100ms |
| APIé”™è¯¯ç‡ | < 1% | å®æ—¶ | > 5% |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | < 100ms | å®æ—¶ | > 300ms |

#### 10.2.3 è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼ |
|-----|--------|---------|---------|
| è£…å¤‡Bugæ•°é‡ | < 5ä¸ª/å‘¨ | æ¯å‘¨ | > 10ä¸ª/å‘¨ |
| ç”¨æˆ·æŠ•è¯‰ç‡ | < 2% | æ¯æ—¥ | > 5% |
| å´©æºƒç‡ | < 0.1% | å®æ—¶ | > 1% |
| ç”¨æˆ·æ»¡æ„åº¦ | > 85% | æ¯å‘¨ | < 70% |

### 10.3 ç›‘æ§é¢æ¿

```typescript
// è£…å¤‡ç³»ç»Ÿç›‘æ§Dashboardé…ç½®
const equipmentDashboard = {
  name: "è£…å¤‡ç³»ç»Ÿç›‘æ§",
  panels: [
    {
      title: "è£…å¤‡æ“ä½œæ¬¡æ•°",
      query: "sum(rate(equipment_operations_total[5m]))",
      type: "graph"
    },
    {
      title: "è£…å¤‡ç”Ÿæˆè€—æ—¶",
      query: "histogram_quantile(0.95, equipment_generation_duration_seconds)",
      type: "graph"
    },
    {
      title: "è£…å¤‡æ‰è½ç‡",
      query: "equipment_drops / battles_completed",
      type: "stat"
    },
    {
      title: "APIé”™è¯¯ç‡",
      query: "rate(equipment_api_errors_total[5m])",
      type: "graph"
    }
  ]
};
```

### 10.4 å‘Šè­¦è§„åˆ™

```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: equipment_system
    rules:
      - alert: EquipmentGenerationSlow
        expr: equipment_generation_duration_seconds > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "è£…å¤‡ç”Ÿæˆè¿‡æ…¢"
          description: "è£…å¤‡ç”Ÿæˆè€—æ—¶è¶…è¿‡200ms"
      
      - alert: EquipmentAPIError
        expr: rate(equipment_api_errors_total[5m]) > 0.05
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "è£…å¤‡APIé”™è¯¯ç‡è¿‡é«˜"
          description: "è£…å¤‡APIé”™è¯¯ç‡è¶…è¿‡5%"
      
      - alert: EquipmentDropRateAbnormal
        expr: equipment_drops / battles_completed < 0.08 or equipment_drops / battles_completed > 0.20
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "è£…å¤‡æ‰è½ç‡å¼‚å¸¸"
          description: "è£…å¤‡æ‰è½ç‡ä½äº8%æˆ–é«˜äº20%"
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£ï¼ˆä¸‹ç¯‡ï¼‰å®Œæˆäº†è£…å¤‡ç³»ç»Ÿçš„æµ‹è¯•éªŒè¯ã€æ•°å€¼å¹³è¡¡å’Œæ‰©å±•æ€§è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **å®Œæ•´æµ‹è¯•ç­–ç•¥**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2Eæµ‹è¯•è§„èŒƒå’Œç”¨ä¾‹
2. âœ… **å‰ç«¯éªŒè¯æ–¹æ¡ˆ**: é€PhaseéªŒè¯æ£€æŸ¥æ¸…å•å’ŒéªŒè¯è„šæœ¬
3. âœ… **æ•°å€¼å¹³è¡¡è®¾è®¡**: æŠ¤ç”²å‡ä¼¤ã€æ­¦å™¨DPSã€èŒä¸šå¹³è¡¡çš„è¯¦ç»†æ•°å€¼è¡¨
4. âœ… **æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–**: æ€§èƒ½åŸºå‡†ã€æµ‹è¯•ä»£ç ã€ä¼˜åŒ–ç­–ç•¥
5. âœ… **æ‰©å±•æ€§è®¾è®¡**: é™„é­”ã€å®çŸ³ã€ç‰¹æ•ˆç­‰æœªæ¥åŠŸèƒ½çš„æ¥å£é¢„ç•™
6. âœ… **é£é™©è¯„ä¼°ä¸åº”å¯¹**: æŠ€æœ¯ã€è®¾è®¡ã€é¡¹ç›®é£é™©çš„è¯†åˆ«å’Œåº”å¯¹æªæ–½
7. âœ… **ä¸Šçº¿è®¡åˆ’ä¸ç›‘æ§**: ç°åº¦å‘å¸ƒè®¡åˆ’ã€ç›‘æ§æŒ‡æ ‡ã€å‘Šè­¦è§„åˆ™

---

## ä¸‰ç¯‡æ–‡æ¡£æ€»è§ˆ

### ä¸Šç¯‡ï¼šç³»ç»Ÿåˆ†æä¸æ¶æ„è®¾è®¡ï¼ˆ2170è¡Œï¼‰
- å½“å‰çŠ¶æ€å…¨é¢åˆ†æ
- è®¾è®¡ç›®æ ‡ä¸åŸåˆ™
- å®Œæ•´æ¶æ„è®¾è®¡
- 17æ§½ä½ã€æŠ¤ç”²ã€æ­¦å™¨ã€èŒä¸šç³»ç»Ÿè®¾è®¡
- é¢†åŸŸæ¨¡å‹å’Œæ•°æ®åº“è®¾è®¡

### ä¸­ç¯‡ï¼šæ‰§è¡Œè®¡åˆ’ä¸æŠ€æœ¯è§„èŒƒï¼ˆ1208è¡Œï¼‰
- 8ä¸ªPhaseè¯¦ç»†æ‰§è¡Œè®¡åˆ’
- æ¯ä¸ªPhaseçš„ä»»åŠ¡æ¸…å•å’ŒéªŒæ”¶æ ‡å‡†
- é…ç½®åŒ–è®¾è®¡å®ç°
- ç³»ç»Ÿé›†æˆç»†èŠ‚
- æŠ€æœ¯å®ç°è§„èŒƒ

### ä¸‹ç¯‡ï¼ˆæœ¬æ–‡æ¡£ï¼‰ï¼šæµ‹è¯•éªŒè¯ä¸æ‰©å±•è®¾è®¡ï¼ˆ1270è¡Œï¼‰
- å®Œæ•´æµ‹è¯•ç­–ç•¥å’Œç”¨ä¾‹
- å‰ç«¯éªŒè¯æ–¹æ¡ˆ
- æ•°å€¼å¹³è¡¡è®¾è®¡
- æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–
- æ‰©å±•æ€§è®¾è®¡
- é£é™©è¯„ä¼°ä¸ä¸Šçº¿è®¡åˆ’

---

## å®æ–½å»ºè®®

### ç«‹å³è¡ŒåŠ¨
1. **Review**: å›¢é˜Ÿè¯„å®¡ä¸‰ç¯‡è®¾è®¡æ–‡æ¡£
2. **Confirm**: ç¡®è®¤Phaseæ—¶é—´è¡¨å’Œèµ„æºåˆ†é…
3. **Prepare**: å‡†å¤‡Phase 1å¼€å‘ç¯å¢ƒ

### Phase 1å¯åŠ¨å‰
1. æ­å»ºæµ‹è¯•ç¯å¢ƒ
2. å‡†å¤‡ç§å­æ•°æ®
3. é…ç½®CI/CDæµç¨‹

### æŒç»­è·Ÿè¿›
1. æ¯å‘¨è¿›åº¦åŒæ­¥ä¼šè®®
2. æ¯ä¸ªPhaseç»“æŸåæ€»ç»“å¤ç›˜
3. åŠæ—¶è°ƒæ•´è®¡åˆ’å’Œèµ„æº

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒ

### A. å…³é”®æ–‡ä»¶æ¸…å•

**åç«¯**:
- `Domain/Equipment/Models/` - é¢†åŸŸå®ä½“
- `Domain/Equipment/Services/` - é¢†åŸŸæœåŠ¡
- `Domain/Equipment/Configuration/` - é…ç½®ç±»
- `Infrastructure/Persistence/Configurations/` - EF Coreé…ç½®
- `Api/EquipmentController.cs` - APIæ§åˆ¶å™¨

**å‰ç«¯**:
- `Components/EquipmentPanel.razor` - è£…å¤‡é¢æ¿
- `Components/GearEnhancementDialog.razor` - å¢å¼ºå¯¹è¯æ¡†
- `Services/ApiModels.cs` - DTOå®šä¹‰
- `Services/ApiClient.cs` - APIå®¢æˆ·ç«¯

**é…ç½®**:
- `EquipmentSystemConfig.json` - ä¸»é…ç½®æ–‡ä»¶
- `GearDefinitions.json` - è£…å¤‡å®šä¹‰ï¼ˆå¯é€‰ï¼‰
- `AffixDefinitions.json` - è¯æ¡å®šä¹‰ï¼ˆå¯é€‰ï¼‰

**æµ‹è¯•**:
- `Tests/Equipment/` - å•å…ƒæµ‹è¯•
- `Tests/Integration/` - é›†æˆæµ‹è¯•
- `tests/e2e/` - E2Eæµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**ç»´æŠ¤è´Ÿè´£**: å¼€å‘å›¢é˜Ÿ  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  

**æ€»å­—æ•°**: çº¦3,000è¡Œï¼ˆä¸‰ç¯‡åˆè®¡çº¦6,500è¡Œï¼‰  
**é¢„è®¡é˜…è¯»æ—¶é—´**: 3-4å°æ—¶ï¼ˆä¸‰ç¯‡å®Œæ•´é˜…è¯»ï¼‰

---

## ç»“è¯­

æœ¬è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆæ•´åˆäº†ä¸¤å¥—åŸæœ‰è®¾è®¡æ–¹æ¡ˆçš„ç²¾åï¼Œæä¾›äº†ä»ç†è®ºåˆ°å®è·µçš„å®Œæ•´æŒ‡å¯¼ã€‚

å¸Œæœ›æœ¬æ–¹æ¡ˆèƒ½å¤Ÿå¸®åŠ©å›¢é˜Ÿé«˜æ•ˆã€æœ‰åºåœ°å®Œæˆè£…å¤‡ç³»ç»Ÿçš„ä¼˜åŒ–å‡çº§ï¼Œä¸ºç©å®¶å¸¦æ¥æ›´æ·±åº¦ã€æ›´æœ‰è¶£çš„æ¸¸æˆä½“éªŒã€‚

**ç¥é¡¹ç›®æˆåŠŸï¼** ğŸ‰
