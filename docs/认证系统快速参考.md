# 认证系统快速参考

## 一分钟了解

BlazorIdle 现在支持 JWT 用户认证！用户可以注册账号、登录，创建的角色会自动绑定到账号。

## 核心 API

### 🔑 认证相关

```
注册: POST /api/auth/register
登录: POST /api/auth/login  
改密: POST /api/auth/change-password
```

### 👤 用户管理

```
当前用户: GET /api/users/me
用户信息: GET /api/users/{id}
用户角色: GET /api/users/{id}/characters
更新用户: PUT /api/users/{id}
```

### 🎮 角色管理

```
创建角色: POST /api/characters (带Token自动绑定)
绑定角色: PUT /api/characters/{id}/bind-user
调整顺序: PUT /api/characters/{id}/reorder
```

## 快速示例

### 注册并创建角色
```bash
# 1. 注册
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"player1","email":"p1@game.com","password":"Pass123"}'
  
# 响应包含 token

# 2. 用 token 创建角色（自动绑定）
curl -X POST http://localhost:5000/api/characters \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {你的token}" \
  -d '{"name":"战士","profession":0}'
```

### 登录并查看角色
```bash
# 1. 登录
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"usernameOrEmail":"player1","password":"Pass123"}'

# 2. 查看我的角色
curl -X GET http://localhost:5000/api/users/me \
  -H "Authorization: Bearer {你的token}"
```

## Profession 枚举值

```
0 = Warrior (战士)
1 = Ranger (游侠)
```

## 向后兼容

✅ 不登录也能创建角色（角色不绑定用户）
✅ 现有战斗、背包 API 都不需要登录
✅ 已有角色数据不受影响

## Swagger 使用

1. 打开 http://localhost:5000/swagger
2. 点击 "Authorize" 按钮
3. 输入: `Bearer {你的token}`
4. 测试需要认证的 API

## 配置文件

`appsettings.json`:
```json
{
  "Jwt": {
    "SecretKey": "改成你的强密钥-至少32字符",
    "ExpirationMinutes": 1440
  }
}
```

⚠️ 生产环境必须修改 SecretKey！

## 常见问题

**Q: 创建角色必须登录吗？**
A: 不是！不登录也能创建，但角色不会绑定到用户。

**Q: Token 有效期多久？**
A: 默认 24 小时（1440 分钟），可在配置中调整。

**Q: 忘记密码怎么办？**
A: 目前需要联系管理员。密码重置功能在未来版本实现。

**Q: 401 错误是什么意思？**
A: Token 无效或过期，需要重新登录。

## 完整文档

- [JWT认证系统文档](./JWT认证系统文档.md)
- [API认证示例](./API认证示例.md)
- [用户系统文档](./用户系统文档.md)

---
更新时间: 2024-10-07
