# è®¤è¯ç³»ç»Ÿå¿«é€Ÿå‚è€ƒ

## ä¸€åˆ†é’Ÿäº†è§£

BlazorIdle ç°åœ¨æ”¯æŒ JWT ç”¨æˆ·è®¤è¯ï¼ç”¨æˆ·å¯ä»¥æ³¨å†Œè´¦å·ã€ç™»å½•ï¼Œåˆ›å»ºçš„è§’è‰²ä¼šè‡ªåŠ¨ç»‘å®šåˆ°è´¦å·ã€‚

## æ ¸å¿ƒ API

### ğŸ”‘ è®¤è¯ç›¸å…³

```
æ³¨å†Œ: POST /api/auth/register
ç™»å½•: POST /api/auth/login  
æ”¹å¯†: POST /api/auth/change-password
```

### ğŸ‘¤ ç”¨æˆ·ç®¡ç†

```
å½“å‰ç”¨æˆ·: GET /api/users/me
ç”¨æˆ·ä¿¡æ¯: GET /api/users/{id}
ç”¨æˆ·è§’è‰²: GET /api/users/{id}/characters
æ›´æ–°ç”¨æˆ·: PUT /api/users/{id}
```

### ğŸ® è§’è‰²ç®¡ç†

```
åˆ›å»ºè§’è‰²: POST /api/characters (å¸¦Tokenè‡ªåŠ¨ç»‘å®š)
ç»‘å®šè§’è‰²: PUT /api/characters/{id}/bind-user
è°ƒæ•´é¡ºåº: PUT /api/characters/{id}/reorder
```

## å¿«é€Ÿç¤ºä¾‹

### æ³¨å†Œå¹¶åˆ›å»ºè§’è‰²
```bash
# 1. æ³¨å†Œ
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"player1","email":"p1@game.com","password":"Pass123"}'
  
# å“åº”åŒ…å« token

# 2. ç”¨ token åˆ›å»ºè§’è‰²ï¼ˆè‡ªåŠ¨ç»‘å®šï¼‰
curl -X POST http://localhost:5000/api/characters \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {ä½ çš„token}" \
  -d '{"name":"æˆ˜å£«","profession":0}'
```

### ç™»å½•å¹¶æŸ¥çœ‹è§’è‰²
```bash
# 1. ç™»å½•
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"usernameOrEmail":"player1","password":"Pass123"}'

# 2. æŸ¥çœ‹æˆ‘çš„è§’è‰²
curl -X GET http://localhost:5000/api/users/me \
  -H "Authorization: Bearer {ä½ çš„token}"
```

## Profession æšä¸¾å€¼

```
0 = Warrior (æˆ˜å£«)
1 = Ranger (æ¸¸ä¾ )
```

## å‘åå…¼å®¹

âœ… ä¸ç™»å½•ä¹Ÿèƒ½åˆ›å»ºè§’è‰²ï¼ˆè§’è‰²ä¸ç»‘å®šç”¨æˆ·ï¼‰
âœ… ç°æœ‰æˆ˜æ–—ã€èƒŒåŒ… API éƒ½ä¸éœ€è¦ç™»å½•
âœ… å·²æœ‰è§’è‰²æ•°æ®ä¸å—å½±å“

## Swagger ä½¿ç”¨

1. æ‰“å¼€ http://localhost:5000/swagger
2. ç‚¹å‡» "Authorize" æŒ‰é’®
3. è¾“å…¥: `Bearer {ä½ çš„token}`
4. æµ‹è¯•éœ€è¦è®¤è¯çš„ API

## é…ç½®æ–‡ä»¶

`appsettings.json`:
```json
{
  "Jwt": {
    "SecretKey": "æ”¹æˆä½ çš„å¼ºå¯†é’¥-è‡³å°‘32å­—ç¬¦",
    "ExpirationMinutes": 1440
  }
}
```

âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ SecretKeyï¼

## å¸¸è§é—®é¢˜

**Q: åˆ›å»ºè§’è‰²å¿…é¡»ç™»å½•å—ï¼Ÿ**
A: ä¸æ˜¯ï¼ä¸ç™»å½•ä¹Ÿèƒ½åˆ›å»ºï¼Œä½†è§’è‰²ä¸ä¼šç»‘å®šåˆ°ç”¨æˆ·ã€‚

**Q: Token æœ‰æ•ˆæœŸå¤šä¹…ï¼Ÿ**
A: é»˜è®¤ 24 å°æ—¶ï¼ˆ1440 åˆ†é’Ÿï¼‰ï¼Œå¯åœ¨é…ç½®ä¸­è°ƒæ•´ã€‚

**Q: å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ**
A: ç›®å‰éœ€è¦è”ç³»ç®¡ç†å‘˜ã€‚å¯†ç é‡ç½®åŠŸèƒ½åœ¨æœªæ¥ç‰ˆæœ¬å®ç°ã€‚

**Q: 401 é”™è¯¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ**
A: Token æ— æ•ˆæˆ–è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•ã€‚

## å®Œæ•´æ–‡æ¡£

- [JWTè®¤è¯ç³»ç»Ÿæ–‡æ¡£](./JWTè®¤è¯ç³»ç»Ÿæ–‡æ¡£.md)
- [APIè®¤è¯ç¤ºä¾‹](./APIè®¤è¯ç¤ºä¾‹.md)
- [ç”¨æˆ·ç³»ç»Ÿæ–‡æ¡£](./ç”¨æˆ·ç³»ç»Ÿæ–‡æ¡£.md)

---
æ›´æ–°æ—¶é—´: 2024-10-07
