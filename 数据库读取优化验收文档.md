# BlazorIdle æ•°æ®åº“è¯»å–ä¼˜åŒ–éªŒæ”¶æ–‡æ¡£

**é¡¹ç›®**: BlazorIdle æ•°æ®åº“è¯»å–ä¼˜åŒ–  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-19  
**çŠ¶æ€**: éªŒæ”¶æ ‡å‡†å®šä¹‰

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [éªŒæ”¶èŒƒå›´](#éªŒæ”¶èŒƒå›´)
3. [åŠŸèƒ½éªŒæ”¶æ ‡å‡†](#åŠŸèƒ½éªŒæ”¶æ ‡å‡†)
4. [æ€§èƒ½éªŒæ”¶æ ‡å‡†](#æ€§èƒ½éªŒæ”¶æ ‡å‡†)
5. [è´¨é‡éªŒæ”¶æ ‡å‡†](#è´¨é‡éªŒæ”¶æ ‡å‡†)
6. [å®‰å…¨æ€§éªŒæ”¶æ ‡å‡†](#å®‰å…¨æ€§éªŒæ”¶æ ‡å‡†)
7. [è¿ç»´éªŒæ”¶æ ‡å‡†](#è¿ç»´éªŒæ”¶æ ‡å‡†)
8. [æµ‹è¯•ç”¨ä¾‹æ¸…å•](#æµ‹è¯•ç”¨ä¾‹æ¸…å•)
9. [éªŒæ”¶æµç¨‹](#éªŒæ”¶æµç¨‹)
10. [éªŒæ”¶ç­¾å­—](#éªŒæ”¶ç­¾å­—)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡

å®ç°æ•°æ®åº“è¯»å–ä¼˜åŒ–ï¼Œé‡‡ç”¨å†…å­˜ä¼˜å…ˆç­–ç•¥ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢é¢‘ç‡ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚

### æ ¸å¿ƒéœ€æ±‚

æ ¹æ®åŸå§‹éœ€æ±‚ï¼š
> "å„é¡¹ä¿¡æ¯ä¸åº”è¯¥å®æ—¶è¯»å–æ•°æ®åº“çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­æ“ä½œï¼Œæˆ‘çš„æƒ³æ³•æ˜¯éœ€è¦è¯»å–çš„ä¿¡æ¯åœ¨å†…å­˜ä¸­æ²¡æœ‰çš„æ—¶å€™æ‰è¯»å–æ•°æ®åº“"

### å®æ–½èŒƒå›´

- âœ… **Phase 1**: è¯»å–ç¼“å­˜åŸºç¡€è®¾æ–½ï¼ˆReadThroughCacheManager, ConfigurationCacheServiceï¼‰
- âœ… **Phase 2**: Repository å±‚æ”¹é€ ï¼ˆCharacter, BattleSnapshot, ActivityPlan, GearInstance, é…ç½®æ•°æ®ï¼‰
- âœ… **Phase 3**: ç›‘æ§ä¸è¯Šæ–­ï¼ˆCacheMetricsCollector, å¥åº·æ£€æŸ¥ API, æ€§èƒ½åˆ†æï¼‰

### äº¤ä»˜ç‰©æ¸…å•

| ç±»åˆ« | äº¤ä»˜ç‰© | æ•°é‡ |
|-----|--------|------|
| ä»£ç å®ç° | æ ¸å¿ƒç»„ä»¶ï¼ˆCacheManager, Service, Repositoryï¼‰ | 10+ ä¸ªç±» |
| é…ç½®ç³»ç»Ÿ | é…ç½®ç±»å’Œ appsettings.json é…ç½® | 8 ä¸ªé…ç½®ç±» |
| API ç«¯ç‚¹ | å¥åº·æ£€æŸ¥å’Œè¯Šæ–­ API | 5 ä¸ªç«¯ç‚¹ |
| å•å…ƒæµ‹è¯• | åŠŸèƒ½å’Œé›†æˆæµ‹è¯• | 50+ ä¸ªæµ‹è¯• |
| æ–‡æ¡£ | éœ€æ±‚åˆ†æã€å®æ–½æ–¹æ¡ˆã€éªŒæ”¶æ–‡æ¡£ | 5 ä¸ªæ–‡æ¡£ |

---

## éªŒæ”¶èŒƒå›´

### 1. åŠŸèƒ½å®Œæ•´æ€§

#### 1.1 Phase 1 åŸºç¡€è®¾æ–½ âœ…

- [ ] ReadThroughCacheManager<T> å·²å®ç°
  - [ ] GetByIdAsync - å†…å­˜ä¼˜å…ˆè¯»å–
  - [ ] GetByIdsAsync - æ‰¹é‡è¯»å–
  - [ ] GetListAsync - æŸ¥è¯¢ç»“æœç¼“å­˜
  - [ ] AddOrUpdate - ç¼“å­˜æ›´æ–°
  - [ ] Invalidate - ç¼“å­˜å¤±æ•ˆ
  - [ ] GetStatistics - ç»Ÿè®¡ä¿¡æ¯
  
- [ ] ConfigurationCacheService å·²å®ç°
  - [ ] PreloadAsync - å¯åŠ¨æ—¶é¢„åŠ è½½
  - [ ] ReloadAsync - æ‰‹åŠ¨åˆ·æ–°
  - [ ] Get{EntityType}Async - å„é…ç½®æ•°æ®æŸ¥è¯¢æ–¹æ³•
  - [ ] GetStatistics - ç»Ÿè®¡ä¿¡æ¯
  
- [ ] é…ç½®ç³»ç»Ÿå®Œæ•´
  - [ ] ReadCacheOptions åŠæ‰€æœ‰å­é…ç½®ç±»
  - [ ] DataAnnotations éªŒè¯
  - [ ] appsettings.json é…ç½®é½å…¨

#### 1.2 Phase 2 Repository æ”¹é€  âœ…

- [ ] CharacterRepository å·²æ”¹é€ 
  - [ ] GetAsync ä½¿ç”¨ç¼“å­˜
  - [ ] ä¿æŒæ¥å£ä¸å˜
  
- [ ] ActivityPlanRepository å·²æ”¹é€ 
  - [ ] GetAsync ä½¿ç”¨ç¼“å­˜
  - [ ] GetPendingOrRunningAsync ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜
  - [ ] UpdateAsync åŒæ­¥æ›´æ–°ç¼“å­˜å¹¶å¤±æ•ˆåˆ—è¡¨ç¼“å­˜
  
- [ ] GearInstanceRepository å·²æ”¹é€ 
  - [ ] GetByIdAsync ä½¿ç”¨ç¼“å­˜
  - [ ] GetByCharacterIdAsync ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜
  - [ ] GetEquippedBySlotAsync ä½¿ç”¨ç¼“å­˜
  
- [ ] GearDefinitionRepository å·²æ”¹é€ 
  - [ ] å®Œå…¨ä½¿ç”¨ ConfigurationCacheService
  - [ ] é›¶æ•°æ®åº“æŸ¥è¯¢
  
- [ ] AffixRepository å·²æ”¹é€ 
  - [ ] å®Œå…¨ä½¿ç”¨ ConfigurationCacheService
  
- [ ] GearSetRepository å·²æ”¹é€ 
  - [ ] å®Œå…¨ä½¿ç”¨ ConfigurationCacheService

#### 1.3 Phase 3 ç›‘æ§è¯Šæ–­ âœ…

- [ ] CacheMetricsCollector å·²å®ç°
  - [ ] RecordHit/Miss/Load/Invalidation
  - [ ] GetAllMetrics
  - [ ] GetSummary
  
- [ ] ReadCacheHealthController å·²å®ç°
  - [ ] GET /api/cache/health
  - [ ] GET /api/cache/health/metrics
  - [ ] GET /api/cache/health/metrics/{entityType}
  - [ ] GET /api/cache/health/config-stats
  - [ ] POST /api/cache/health/config-reload
  - [ ] GET /api/cache/health/performance

### 2. å‘åå…¼å®¹æ€§

- [ ] é…ç½®å¼€å…³ `ReadCache:EnableReadCache` å¯ç¦ç”¨ç¼“å­˜
- [ ] ç¦ç”¨ç¼“å­˜æ—¶ç³»ç»ŸåŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰ Repository æ¥å£ç­¾åæœªæ”¹å˜
- [ ] ä¸Šå±‚ Controller å’Œ Service æ— éœ€ä¿®æ”¹

### 3. æ•°æ®ä¸€è‡´æ€§

- [ ] å†™å…¥æ—¶åŒæ­¥æ›´æ–°ç¼“å­˜
- [ ] æ›´æ–°æ—¶å¤±æ•ˆç›¸å…³æŸ¥è¯¢ç¼“å­˜
- [ ] åˆ é™¤æ—¶æ¸…ç†æ‰€æœ‰ç›¸å…³ç¼“å­˜
- [ ] è¯»å†™ä½¿ç”¨ç›¸åŒçš„ MemoryStateManager

---

## åŠŸèƒ½éªŒæ”¶æ ‡å‡†

### éªŒæ”¶æ ‡å‡† F1ï¼šåŸºæœ¬è¯»å–åŠŸèƒ½

**æµ‹è¯•åœºæ™¯**ï¼š
1. å¯ç”¨è¯»å–ç¼“å­˜
2. æŸ¥è¯¢ä¸€ä¸ªå­˜åœ¨çš„å®ä½“ï¼ˆå¦‚ Characterï¼‰
3. å†æ¬¡æŸ¥è¯¢åŒä¸€å®ä½“

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä»æ•°æ®åº“åŠ è½½
- âœ… ç¬¬äºŒæ¬¡æŸ¥è¯¢ä»ç¼“å­˜è¿”å›
- âœ… è¿”å›æ•°æ®ä¸€è‡´
- âœ… ç¬¬äºŒæ¬¡æŸ¥è¯¢å“åº”æ—¶é—´ < 10ms

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// å•å…ƒæµ‹è¯•
var char1 = await _repo.GetAsync(id);  // æ•°æ®åº“åŠ è½½
var char2 = await _repo.GetAsync(id);  // ç¼“å­˜è¿”å›

Assert.Equal(char1.Id, char2.Id);
Assert.Equal(char1.Name, char2.Name);

// æ£€æŸ¥æŒ‡æ ‡
var stats = _cacheManager.GetStatistics();
Assert.Equal(1, stats.HitCount);  // ä¸€æ¬¡å‘½ä¸­
Assert.Equal(1, stats.MissCount); // ä¸€æ¬¡æœªå‘½ä¸­
```

---

### éªŒæ”¶æ ‡å‡† F2ï¼šé…ç½®æ•°æ®é¢„åŠ è½½

**æµ‹è¯•åœºæ™¯**ï¼š
1. åº”ç”¨å¯åŠ¨
2. æŸ¥è¯¢é…ç½®æ•°æ®ï¼ˆGearDefinition, Affix, GearSetï¼‰

**é¢„æœŸç»“æœ**ï¼š
- âœ… å¯åŠ¨æ—¶é¢„åŠ è½½å®Œæˆ
- âœ… æ‰€æœ‰é…ç½®æ•°æ®åœ¨å†…å­˜ä¸­
- âœ… æŸ¥è¯¢é…ç½®æ•°æ®é›¶æ•°æ®åº“æŸ¥è¯¢
- âœ… æŸ¥è¯¢å“åº”æ—¶é—´ < 1ms

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// åº”ç”¨å¯åŠ¨åæ£€æŸ¥
var stats = _configCache.GetStatistics();
Assert.True(stats.GearDefinitionCount > 0);
Assert.True(stats.AffixCount > 0);
Assert.True(stats.GearSetCount > 0);
Assert.NotNull(stats.LastPreloadAt);

// æŸ¥è¯¢ä¸è§¦å‘æ•°æ®åº“
var gearDef = await _configCache.GetGearDefinitionAsync(id);
Assert.NotNull(gearDef);
// éªŒè¯ï¼šæ•°æ®åº“æŸ¥è¯¢æ—¥å¿—æ— æ–°æŸ¥è¯¢
```

---

### éªŒæ”¶æ ‡å‡† F3ï¼šæ•°æ®ä¸€è‡´æ€§ä¿è¯

**æµ‹è¯•åœºæ™¯**ï¼š
1. æŸ¥è¯¢ä¸€ä¸ªå®ä½“ï¼ˆç¼“å­˜ï¼‰
2. æ›´æ–°è¯¥å®ä½“
3. ç«‹å³å†æ¬¡æŸ¥è¯¢

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¬¬ä¸‰æ¬¡æŸ¥è¯¢è¿”å›æ›´æ–°åçš„æ•°æ®
- âœ… ä¸è¯»å–åˆ°"æ—§"æ•°æ®
- âœ… ç›¸å…³åˆ—è¡¨ç¼“å­˜å·²å¤±æ•ˆ

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// 1. æŸ¥è¯¢
var plan = await _repo.GetAsync(id);
Assert.Equal(ActivityPlanStatus.Pending, plan.Status);

// 2. æ›´æ–°
plan.Status = ActivityPlanStatus.Running;
await _repo.UpdateAsync(plan);

// 3. ç«‹å³æŸ¥è¯¢
var updated = await _repo.GetAsync(id);
Assert.Equal(ActivityPlanStatus.Running, updated.Status);  // âœ… æœ€æ–°æ•°æ®

// 4. åˆ—è¡¨æŸ¥è¯¢ä¹Ÿåº”è¯¥åæ˜ å˜æ›´
var pendingPlans = await _repo.GetPendingOrRunningAsync(characterId);
Assert.Contains(pendingPlans, p => p.Id == id && p.Status == ActivityPlanStatus.Running);
```

---

### éªŒæ”¶æ ‡å‡† F4ï¼šæŸ¥è¯¢ç»“æœç¼“å­˜

**æµ‹è¯•åœºæ™¯**ï¼š
1. æ‰§è¡Œåˆ—è¡¨æŸ¥è¯¢ï¼ˆå¦‚ GetByCharacterIdAsyncï¼‰
2. å†æ¬¡æ‰§è¡Œç›¸åŒæŸ¥è¯¢

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä»æ•°æ®åº“åŠ è½½
- âœ… ç¬¬äºŒæ¬¡æŸ¥è¯¢ä»ç¼“å­˜è¿”å›
- âœ… æŸ¥è¯¢ç»“æœä¸€è‡´

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// ç¬¬ä¸€æ¬¡æŸ¥è¯¢
var gear1 = await _repo.GetByCharacterIdAsync(characterId);
var count1 = gear1.Count;

// ç¬¬äºŒæ¬¡æŸ¥è¯¢
var gear2 = await _repo.GetByCharacterIdAsync(characterId);
var count2 = gear2.Count;

Assert.Equal(count1, count2);
// éªŒè¯ï¼šæ•°æ®åº“æŸ¥è¯¢æ—¥å¿—æ˜¾ç¤ºåªæœ‰ä¸€æ¬¡æŸ¥è¯¢
```

---

### éªŒæ”¶æ ‡å‡† F5ï¼šç¼“å­˜å¤±æ•ˆæœºåˆ¶

**æµ‹è¯•åœºæ™¯**ï¼š
1. æŸ¥è¯¢åˆ—è¡¨ï¼ˆç¼“å­˜ï¼‰
2. æ·»åŠ ä¸€ä¸ªæ–°å®ä½“åˆ°è¯¥åˆ—è¡¨
3. å†æ¬¡æŸ¥è¯¢åˆ—è¡¨

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¬¬ä¸‰æ¬¡æŸ¥è¯¢åŒ…å«æ–°å®ä½“
- âœ… åˆ—è¡¨ç¼“å­˜å·²å¤±æ•ˆå¹¶é‡æ–°åŠ è½½

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// 1. æŸ¥è¯¢åˆ—è¡¨
var plans1 = await _repo.GetPendingOrRunningAsync(characterId);
var count1 = plans1.Count;

// 2. æ·»åŠ æ–° plan
var newPlan = new ActivityPlan { CharacterId = characterId, Status = ActivityPlanStatus.Pending };
await _repo.AddAsync(newPlan);

// 3. å†æ¬¡æŸ¥è¯¢åˆ—è¡¨
var plans2 = await _repo.GetPendingOrRunningAsync(characterId);
var count2 = plans2.Count;

Assert.Equal(count1 + 1, count2);  // âœ… æ–°å®ä½“å‡ºç°åœ¨åˆ—è¡¨ä¸­
```

---

## æ€§èƒ½éªŒæ”¶æ ‡å‡†

### éªŒæ”¶æ ‡å‡† P1ï¼šç¼“å­˜å‘½ä¸­ç‡

**æŒ‡æ ‡**: æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ â‰¥ 80%

**æµ‹è¯•æ–¹æ³•**ï¼š
1. è¿è¡Œç³»ç»Ÿ 30 åˆ†é’Ÿï¼Œæ¨¡æ‹Ÿæ­£å¸¸è´Ÿè½½
2. è°ƒç”¨ API: `GET /api/cache/health/metrics?windowMinutes=30`
3. æ£€æŸ¥ `OverallHitRate`

**éªŒæ”¶æ ‡å‡†**ï¼š
```json
{
  "OverallHitRate": 0.85,  // âœ… â‰¥ 0.80
  "EntityMetrics": {
    "Character": { "HitRate": 0.88 },
    "ActivityPlan": { "HitRate": 0.82 },
    "GearInstance": { "HitRate": 0.75 },
    "GearDefinition": { "HitRate": 0.98 },
    "Affix": { "HitRate": 0.98 }
  }
}
```

---

### éªŒæ”¶æ ‡å‡† P2ï¼šæ•°æ®åº“è¯»å–å‡å°‘

**æŒ‡æ ‡**: æ•°æ®åº“è¯»å–æ¬¡æ•°å‡å°‘ â‰¥ 70%

**æµ‹è¯•æ–¹æ³•**ï¼š
1. **ä¼˜åŒ–å‰**ï¼šç¦ç”¨è¯»å–ç¼“å­˜ï¼Œè¿è¡Œ 1 å°æ—¶ï¼Œè®°å½•æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° `Q_before`
2. **ä¼˜åŒ–å**ï¼šå¯ç”¨è¯»å–ç¼“å­˜ï¼Œè¿è¡Œ 1 å°æ—¶ï¼Œè®°å½•æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° `Q_after`
3. è®¡ç®—å‡å°‘æ¯”ä¾‹ï¼š`Reduction% = (Q_before - Q_after) / Q_before`

**éªŒæ”¶æ ‡å‡†**ï¼š
```
å‡è®¾ä¼˜åŒ–å‰ï¼š100,000 æ¬¡/å°æ—¶
ä¼˜åŒ–åï¼šâ‰¤ 30,000 æ¬¡/å°æ—¶
Reduction% = (100,000 - 30,000) / 100,000 = 70%  âœ…
```

**æ•°æ®æ¥æº**ï¼š
- æ•°æ®åº“æŸ¥è¯¢æ—¥å¿—
- åº”ç”¨æ—¥å¿—ä¸­çš„æ•°æ®åº“åŠ è½½è®°å½•
- CacheMetricsCollector ä¸­çš„ LoadCount

---

### éªŒæ”¶æ ‡å‡† P3ï¼šAPI å“åº”æ—¶é—´æ”¹å–„

**æŒ‡æ ‡**: API P95 å“åº”æ—¶é—´æ”¹å–„ â‰¥ 30%

**æµ‹è¯•æ–¹æ³•**ï¼š
1. **ä¼˜åŒ–å‰**ï¼šç¦ç”¨ç¼“å­˜ï¼Œå‹æµ‹å…³é”® APIï¼Œè®°å½• P95 å“åº”æ—¶é—´ `T_before`
2. **ä¼˜åŒ–å**ï¼šå¯ç”¨ç¼“å­˜ï¼Œå‹æµ‹ç›¸åŒ APIï¼Œè®°å½• P95 å“åº”æ—¶é—´ `T_after`
3. è®¡ç®—æ”¹å–„æ¯”ä¾‹ï¼š`Improvement% = (T_before - T_after) / T_before`

**å…³é”® API**ï¼š
- `GET /api/characters/{id}`
- `GET /api/characters/{id}/gear`
- `GET /api/characters/{id}/activity-plans`

**éªŒæ”¶æ ‡å‡†**ï¼š
```
ç¤ºä¾‹ï¼šGET /api/characters/{id}
ä¼˜åŒ–å‰ P95: 80ms
ä¼˜åŒ–å P95: â‰¤ 56ms
Improvement% = (80 - 56) / 80 = 30%  âœ…
```

---

### éªŒæ”¶æ ‡å‡† P4ï¼šå¹¶å‘æ€§èƒ½

**æŒ‡æ ‡**: æ”¯æŒ 100 å¹¶å‘ç”¨æˆ·ï¼Œæ— æ€§èƒ½é€€åŒ–

**æµ‹è¯•æ–¹æ³•**ï¼š
1. ä½¿ç”¨ JMeter æˆ– wrk è¿›è¡Œå‹åŠ›æµ‹è¯•
2. å¹¶å‘ç”¨æˆ·æ•°ï¼š100
3. æµ‹è¯•æ—¶é•¿ï¼š10 åˆ†é’Ÿ
4. è¯·æ±‚ç±»å‹ï¼š70% è¯»å–ï¼Œ30% å†™å…¥

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å¹³å‡å“åº”æ—¶é—´ < 100ms
- âœ… P95 å“åº”æ—¶é—´ < 200ms
- âœ… P99 å“åº”æ—¶é—´ < 500ms
- âœ… é”™è¯¯ç‡ < 0.1%
- âœ… ç¼“å­˜å‘½ä¸­ç‡ > 75%

---

### éªŒæ”¶æ ‡å‡† P5ï¼šå†…å­˜æ¶ˆè€—

**æŒ‡æ ‡**: å†…å­˜å¢é•¿ â‰¤ 150MB

**æµ‹è¯•æ–¹æ³•**ï¼š
1. è®°å½•åº”ç”¨å¯åŠ¨åçš„åŸºå‡†å†…å­˜ä½¿ç”¨ `M_base`
2. è¿è¡Œ 2 å°æ—¶ï¼Œè®°å½•å³°å€¼å†…å­˜ä½¿ç”¨ `M_peak`
3. è®¡ç®—å†…å­˜å¢é•¿ï¼š`Î”M = M_peak - M_base`

**éªŒæ”¶æ ‡å‡†**ï¼š
```
åŸºå‡†å†…å­˜ï¼š200MB
å³°å€¼å†…å­˜ï¼šâ‰¤ 350MB
Î”M = 350 - 200 = 150MB  âœ…
```

---

## è´¨é‡éªŒæ”¶æ ‡å‡†

### éªŒæ”¶æ ‡å‡† Q1ï¼šä»£ç è´¨é‡

**æŒ‡æ ‡**ï¼š
- ç¼–è¯‘é›¶é”™è¯¯
- éµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒ
- è¯¦ç»†çš„ä¸­è‹±æ–‡æ³¨é‡Š
- å®Œæ•´çš„ XML æ–‡æ¡£æ³¨é‡Š

**éªŒæ”¶æ–¹æ³•**ï¼š
- [ ] ç¼–è¯‘æˆåŠŸï¼Œæ— è­¦å‘Šï¼ˆæˆ–åªæœ‰å·²å­˜åœ¨çš„æ— å…³è­¦å‘Šï¼‰
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰å…¬å…±æ¥å£æœ‰ XML æ³¨é‡Š
- [ ] å…³é”®é€»è¾‘æœ‰ä¸­è‹±æ–‡æ³¨é‡Š

---

### éªŒæ”¶æ ‡å‡† Q2ï¼šæµ‹è¯•è¦†ç›–ç‡

**æŒ‡æ ‡**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**æµ‹è¯•èŒƒå›´**ï¼š
- ReadThroughCacheManager
- ConfigurationCacheService
- æ”¹é€ åçš„ Repository
- CacheMetricsCollector

**éªŒæ”¶æ–¹æ³•**ï¼š
```bash
dotnet test --collect:"XPlat Code Coverage"
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
reportgenerator -reports:coverage.cobertura.xml -targetdir:coveragereport
```

**éªŒæ”¶æ ‡å‡†**ï¼š
```
Total Coverage: 85%  âœ… (â‰¥ 80%)
- ReadThroughCacheManager: 90%
- ConfigurationCacheService: 88%
- Repositories: 80%
```

---

### éªŒæ”¶æ ‡å‡† Q3ï¼šé›†æˆæµ‹è¯•

**æŒ‡æ ‡**: æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡

**æµ‹è¯•åœºæ™¯**ï¼š
1. âœ… åº”ç”¨å¯åŠ¨æ—¶é…ç½®ç¼“å­˜é¢„åŠ è½½
2. âœ… è¯»å†™æ··åˆåœºæ™¯æ•°æ®ä¸€è‡´æ€§
3. âœ… é«˜å¹¶å‘è¯»å–æ— ç¼“å­˜é›ªå´©
4. âœ… ç¼“å­˜å¤±æ•ˆæœºåˆ¶æ­£ç¡®è§¦å‘
5. âœ… ç¼“å­˜ç¦ç”¨æ—¶ç³»ç»Ÿæ­£å¸¸å·¥ä½œ

**éªŒæ”¶æ–¹æ³•**ï¼š
```bash
dotnet test --filter "Category=Integration"
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆ0 å¤±è´¥ï¼‰

---

## å®‰å…¨æ€§éªŒæ”¶æ ‡å‡†

### éªŒæ”¶æ ‡å‡† S1ï¼šæ•°æ®å®‰å…¨

**éªŒè¯ç‚¹**ï¼š
- [ ] ç¼“å­˜ä¸­çš„æ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ï¼‰å·²è„±æ•
- [ ] æ— æ•°æ®æ³„æ¼é£é™©
- [ ] ç¼“å­˜å¤±æ•ˆä¸å½±å“æ•°æ®å®Œæ•´æ€§

**éªŒæ”¶æ–¹æ³•**ï¼š
- ä»£ç å®¡æŸ¥ç¡®è®¤æ•æ„Ÿå­—æ®µå¤„ç†
- å®‰å…¨æ‰«æå·¥å…·æ£€æŸ¥

---

### éªŒæ”¶æ ‡å‡† S2ï¼šå¹¶å‘å®‰å…¨

**éªŒè¯ç‚¹**ï¼š
- [ ] ConcurrentDictionary æ­£ç¡®ä½¿ç”¨
- [ ] æ— æ­»é”é£é™©
- [ ] åŠ è½½é”æ­£ç¡®é‡Šæ”¾

**éªŒæ”¶æ–¹æ³•**ï¼š
- ä»£ç å®¡æŸ¥
- å¹¶å‘å‹æµ‹ï¼ˆ100+ å¹¶å‘ï¼‰
- å†…å­˜æ³„æ¼æ£€æµ‹

---

### éªŒæ”¶æ ‡å‡† S3ï¼šå¼‚å¸¸å¤„ç†

**éªŒè¯ç‚¹**ï¼š
- [ ] æ•°æ®åº“è¿æ¥å¤±è´¥æ—¶æœ‰ Fallback
- [ ] ç¼“å­˜æœåŠ¡å¼‚å¸¸ä¸å½±å“ä¸šåŠ¡
- [ ] æ‰€æœ‰å¼‚å¸¸å·²è®°å½•æ—¥å¿—

**éªŒæ”¶æ–¹æ³•**ï¼š
```csharp
// æ¨¡æ‹Ÿæ•°æ®åº“ä¸å¯ç”¨
// éªŒè¯ï¼šç³»ç»Ÿé™çº§ä½†ä¸å´©æºƒ
```

---

## è¿ç»´éªŒæ”¶æ ‡å‡†

### éªŒæ”¶æ ‡å‡† O1ï¼šé…ç½®å®Œæ•´æ€§

**éªŒè¯ç‚¹**ï¼š
- [ ] appsettings.json é…ç½®é½å…¨
- [ ] æ‰€æœ‰é…ç½®æœ‰é»˜è®¤å€¼
- [ ] é…ç½®éªŒè¯ï¼ˆDataAnnotationsï¼‰ç”Ÿæ•ˆ

**éªŒæ”¶æ–¹æ³•**ï¼š
- æ£€æŸ¥ appsettings.json åŒ…å«æ‰€æœ‰å¿…éœ€é…ç½®èŠ‚
- æµ‹è¯•é”™è¯¯é…ç½®å€¼ï¼ˆå¦‚è´Ÿæ•°ï¼‰æ˜¯å¦è¢«æ‹’ç»

---

### éªŒæ”¶æ ‡å‡† O2ï¼šç›‘æ§å¯è§‚æµ‹æ€§

**éªŒè¯ç‚¹**ï¼š
- [ ] å¥åº·æ£€æŸ¥ API æ­£å¸¸å·¥ä½œ
- [ ] æŒ‡æ ‡æ”¶é›†å‡†ç¡®
- [ ] æ—¥å¿—è®°å½•å®Œæ•´

**éªŒæ”¶æ–¹æ³•**ï¼š
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:5000/api/cache/health
# åº”è¿”å›å¥åº·çŠ¶æ€å’Œå…³é”®æŒ‡æ ‡

# è¯¦ç»†æŒ‡æ ‡
curl http://localhost:5000/api/cache/health/metrics
# åº”è¿”å›æ‰€æœ‰å®ä½“ç±»å‹çš„è¯¦ç»†æŒ‡æ ‡

# æ€§èƒ½åˆ†æ
curl http://localhost:5000/api/cache/health/performance
# åº”è¿”å›é—®é¢˜è¯Šæ–­å’Œä¼˜åŒ–å»ºè®®
```

---

### éªŒæ”¶æ ‡å‡† O3ï¼šè¿ç»´æ–‡æ¡£

**éªŒè¯ç‚¹**ï¼š
- [ ] éœ€æ±‚åˆ†ææ–‡æ¡£å®Œæ•´
- [ ] å®æ–½æ–¹æ¡ˆæ–‡æ¡£å®Œæ•´ï¼ˆä¸Šä¸­ä¸‹ç¯‡ï¼‰
- [ ] éªŒæ”¶æ–‡æ¡£å®Œæ•´
- [ ] è°ƒä¼˜æŒ‡å—å®Œæ•´
- [ ] æ•…éšœæ’æŸ¥æŒ‡å—å®Œæ•´

**æ–‡æ¡£æ¸…å•**ï¼š
1. âœ… æ•°æ®åº“è¯»å–ä¼˜åŒ–éœ€æ±‚åˆ†æ.md
2. âœ… æ•°æ®åº“è¯»å–ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ-ä¸Šç¯‡.md
3. âœ… æ•°æ®åº“è¯»å–ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ-ä¸­ç¯‡.md
4. âœ… æ•°æ®åº“è¯»å–ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ-ä¸‹ç¯‡.md
5. âœ… æ•°æ®åº“è¯»å–ä¼˜åŒ–éªŒæ”¶æ–‡æ¡£.md

---

## æµ‹è¯•ç”¨ä¾‹æ¸…å•

### å•å…ƒæµ‹è¯•ï¼ˆ50+ ä¸ªæµ‹è¯•ï¼‰

#### ReadThroughCacheManager æµ‹è¯•ï¼ˆ10 ä¸ªæµ‹è¯•ï¼‰

1. âœ… `GetByIdAsync_CacheHit_ReturnsFromCache`
2. âœ… `GetByIdAsync_CacheMiss_LoadsFromDatabase`
3. âœ… `GetByIdAsync_NullEntity_ReturnsNull`
4. âœ… `GetByIdsAsync_MixedHitMiss_CombinesResults`
5. âœ… `GetListAsync_CachesQueryResults`
6. âœ… `GetListAsync_DisabledCache_QueriesDatabase`
7. âœ… `AddOrUpdate_UpdatesCache`
8. âœ… `Invalidate_RemovesFromCache`
9. âœ… `LoadDeduplication_PreventsDuplicateLoads`
10. âœ… `GetStatistics_ReturnsAccurateMetrics`

#### ConfigurationCacheService æµ‹è¯•ï¼ˆ8 ä¸ªæµ‹è¯•ï¼‰

11. âœ… `PreloadAsync_LoadsAllConfigData`
12. âœ… `GetGearDefinitionAsync_ReturnsFromCache`
13. âœ… `GetGearDefinitionsBySlotAsync_FiltersCorrectly`
14. âœ… `GetAffixAsync_ReturnsFromCache`
15. âœ… `GetAllAffixesAsync_ReturnsAll`
16. âœ… `GetGearSetAsync_ReturnsFromCache`
17. âœ… `ReloadAsync_RefreshesCache`
18. âœ… `GetStatistics_ReturnsAccurateCounts`

#### Repository æµ‹è¯•ï¼ˆ24 ä¸ªæµ‹è¯•ï¼Œæ¯ä¸ª Repository 4 ä¸ªï¼‰

##### CharacterRepository (4)
19. âœ… `GetAsync_WithCacheEnabled_UsesCache`
20. âœ… `GetAsync_WithCacheDisabled_QueriesDatabase`
21. âœ… `GetAsync_CacheMiss_LoadsAndCaches`
22. âœ… `GetAsync_UpdatedEntity_ReturnsLatest`

##### ActivityPlanRepository (4)
23. âœ… `GetAsync_UsesCache`
24. âœ… `GetPendingOrRunningAsync_CachesResults`
25. âœ… `UpdateAsync_InvalidatesListCache`
26. âœ… `DeleteAsync_ClearsRelatedCaches`

##### GearInstanceRepository (4)
27. âœ… `GetByIdAsync_UsesCache`
28. âœ… `GetByCharacterIdAsync_CachesResults`
29. âœ… `GetEquippedBySlotAsync_UsesCache`
30. âœ… `UpdateAsync_SyncsCache`

##### GearDefinitionRepository (4)
31. âœ… `GetByIdAsync_UsesConfigCache`
32. âœ… `GetBySlotAsync_UsesConfigCache`
33. âœ… `GetAllAsync_NeverQueriesDatabase`
34. âœ… `GetBySlotAsync_FiltersCorrectly`

##### AffixRepository (4)
35. âœ… `GetByIdAsync_UsesConfigCache`
36. âœ… `GetAllAsync_UsesConfigCache`
37. âœ… `GetByRarityAsync_FiltersCorrectly`
38. âœ… `GetByRarityAsync_NeverQueriesDatabase`

##### GearSetRepository (4)
39. âœ… `GetByIdAsync_UsesConfigCache`
40. âœ… `GetAllAsync_UsesConfigCache`
41. âœ… `GetByIdAsync_NonExistent_ReturnsNull`
42. âœ… `GetAllAsync_ReturnsAllSets`

#### CacheMetricsCollector æµ‹è¯•ï¼ˆ8 ä¸ªæµ‹è¯•ï¼‰

43. âœ… `RecordHit_IncrementsHitCount`
44. âœ… `RecordMiss_IncrementsMissCount`
45. âœ… `RecordLoad_RecordsLoadTime`
46. âœ… `RecordInvalidation_IncrementsCount`
47. âœ… `GetSummary_ReturnsAccurateMetrics`
48. âœ… `GetSummary_WithTimeWindow_FiltersCorrectly`
49. âœ… `CheckMissRateWarning_LogsWhenExceeded`
50. âœ… `CalculatePercentile_ReturnsCorrectValue`

### é›†æˆæµ‹è¯•ï¼ˆ10 ä¸ªæµ‹è¯•ï¼‰

51. âœ… `ApplicationStartup_PreloadsConfigurationCache`
52. âœ… `ReadWriteMixed_DataConsistency`
53. âœ… `HighConcurrency_NoCacheStampede`
54. âœ… `CacheInvalidation_TriggersCorrectly`
55. âœ… `CacheDisabled_SystemWorksNormally`
56. âœ… `UpdateEntity_ImmediateRead_ReturnsUpdated`
57. âœ… `AddEntity_ListQuery_IncludesNew`
58. âœ… `DeleteEntity_ListQuery_ExcludesDeleted`
59. âœ… `ConfigReload_UpdatesCache`
60. âœ… `HealthAPI_ReturnsCorrectMetrics`

---

## éªŒæ”¶æµç¨‹

### ç¬¬ 1 é˜¶æ®µï¼šå¼€å‘å®Œæˆè‡ªæµ‹ï¼ˆ2 å¤©ï¼‰

**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] æ‰€æœ‰ä»£ç å·²æäº¤åˆ° Git
2. [ ] ç¼–è¯‘æˆåŠŸï¼Œé›¶é”™è¯¯
3. [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
4. [ ] ä»£ç å®¡æŸ¥å®Œæˆ
5. [ ] è‡ªæµ‹æ–‡æ¡£è®°å½•

### ç¬¬ 2 é˜¶æ®µï¼šåŠŸèƒ½éªŒæ”¶æµ‹è¯•ï¼ˆ2 å¤©ï¼‰

**è´Ÿè´£äºº**: QA å›¢é˜Ÿ

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] æ‰§è¡ŒåŠŸèƒ½éªŒæ”¶æµ‹è¯•ç”¨ä¾‹ï¼ˆF1-F5ï¼‰
2. [ ] æ‰€æœ‰åŠŸèƒ½éªŒæ”¶é€šè¿‡
3. [ ] è®°å½•æµ‹è¯•ç»“æœ
4. [ ] ç¼ºé™·è·Ÿè¸ªï¼ˆå¦‚æœ‰ï¼‰

### ç¬¬ 3 é˜¶æ®µï¼šæ€§èƒ½éªŒæ”¶æµ‹è¯•ï¼ˆ2 å¤©ï¼‰

**è´Ÿè´£äºº**: æ€§èƒ½æµ‹è¯•å›¢é˜Ÿ

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] æ‰§è¡Œæ€§èƒ½éªŒæ”¶æµ‹è¯•ï¼ˆP1-P5ï¼‰
2. [ ] æ”¶é›†æ€§èƒ½æŒ‡æ ‡
3. [ ] å¯¹æ¯”ä¼˜åŒ–å‰åæ•°æ®
4. [ ] ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š

### ç¬¬ 4 é˜¶æ®µï¼šè´¨é‡ä¸å®‰å…¨éªŒæ”¶ï¼ˆ1 å¤©ï¼‰

**è´Ÿè´£äºº**: è´¨é‡ä¿è¯å›¢é˜Ÿ + å®‰å…¨å›¢é˜Ÿ

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆQ1-Q3ï¼‰
2. [ ] å®‰å…¨æ€§æ£€æŸ¥ï¼ˆS1-S3ï¼‰
3. [ ] æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
4. [ ] å®‰å…¨æ‰«ææŠ¥å‘Š

### ç¬¬ 5 é˜¶æ®µï¼šè¿ç»´éªŒæ”¶ï¼ˆ1 å¤©ï¼‰

**è´Ÿè´£äºº**: è¿ç»´å›¢é˜Ÿ

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] é…ç½®å®Œæ•´æ€§æ£€æŸ¥ï¼ˆO1ï¼‰
2. [ ] ç›‘æ§ç³»ç»ŸéªŒè¯ï¼ˆO2ï¼‰
3. [ ] æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥ï¼ˆO3ï¼‰
4. [ ] è¿ç»´æ‰‹å†Œå®¡æ ¸

### ç¬¬ 6 é˜¶æ®µï¼šæœ€ç»ˆéªŒæ”¶ï¼ˆ1 å¤©ï¼‰

**è´Ÿè´£äºº**: é¡¹ç›®ç»ç† + äº§å“è´Ÿè´£äºº

**æ£€æŸ¥é¡¹**ï¼š
1. [ ] æ‰€æœ‰é˜¶æ®µéªŒæ”¶é€šè¿‡
2. [ ] å®¡æ ¸éªŒæ”¶æ–‡æ¡£
3. [ ] ç¡®è®¤äº¤ä»˜ç‰©å®Œæ•´
4. [ ] ç­¾ç½²éªŒæ”¶æŠ¥å‘Š

---

## éªŒæ”¶æ ‡å‡†æ€»è§ˆ

### å¿…é¡»æ»¡è¶³ï¼ˆMust Haveï¼‰

| ç¼–å· | éªŒæ”¶æ ‡å‡† | ç›®æ ‡å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|-----|---------|-------|--------|------|
| F1 | åŸºæœ¬è¯»å–åŠŸèƒ½ | æ­£å¸¸å·¥ä½œ | - | â³ |
| F2 | é…ç½®æ•°æ®é¢„åŠ è½½ | æ­£å¸¸å·¥ä½œ | - | â³ |
| F3 | æ•°æ®ä¸€è‡´æ€§ | 100% ä¸€è‡´ | - | â³ |
| P1 | ç¼“å­˜å‘½ä¸­ç‡ | â‰¥ 80% | - | â³ |
| P2 | æ•°æ®åº“è¯»å–å‡å°‘ | â‰¥ 70% | - | â³ |
| P3 | API å“åº”æ—¶é—´æ”¹å–„ | â‰¥ 30% | - | â³ |
| Q2 | æµ‹è¯•è¦†ç›–ç‡ | â‰¥ 80% | - | â³ |
| Q3 | é›†æˆæµ‹è¯• | å…¨éƒ¨é€šè¿‡ | - | â³ |
| O1 | é…ç½®å®Œæ•´æ€§ | é½å…¨ | - | â³ |
| O3 | æ–‡æ¡£å®Œæ•´æ€§ | é½å…¨ | - | â³ |

### åº”è¯¥æ»¡è¶³ï¼ˆShould Haveï¼‰

| ç¼–å· | éªŒæ”¶æ ‡å‡† | ç›®æ ‡å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|-----|---------|-------|--------|------|
| F4 | æŸ¥è¯¢ç»“æœç¼“å­˜ | æ­£å¸¸å·¥ä½œ | - | â³ |
| F5 | ç¼“å­˜å¤±æ•ˆæœºåˆ¶ | æ­£å¸¸å·¥ä½œ | - | â³ |
| P4 | å¹¶å‘æ€§èƒ½ | 100 å¹¶å‘ | - | â³ |
| P5 | å†…å­˜æ¶ˆè€— | â‰¤ 150MB | - | â³ |
| Q1 | ä»£ç è´¨é‡ | ç¬¦åˆè§„èŒƒ | - | â³ |
| S1 | æ•°æ®å®‰å…¨ | æ— æ³„æ¼é£é™© | - | â³ |
| S2 | å¹¶å‘å®‰å…¨ | æ— æ­»é” | - | â³ |
| S3 | å¼‚å¸¸å¤„ç† | å®Œå–„ | - | â³ |
| O2 | ç›‘æ§å¯è§‚æµ‹æ€§ | API æ­£å¸¸ | - | â³ |

---

## éªŒæ”¶ç­¾å­—

### é¡¹ç›®å›¢é˜Ÿ

**å¼€å‘è´Ÿè´£äºº**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

**QA è´Ÿè´£äºº**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

**è¿ç»´è´Ÿè´£äºº**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

**å®‰å…¨è´Ÿè´£äºº**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

### é¡¹ç›®ç®¡ç†

**é¡¹ç›®ç»ç†**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

**äº§å“è´Ÿè´£äºº**ï¼š  
ç­¾å­—ï¼š________________  æ—¥æœŸï¼š________

---

## éªŒæ”¶ç»“è®º

### éªŒæ”¶ç»“æœ

- [ ] âœ… **é€šè¿‡éªŒæ”¶** - æ‰€æœ‰å¿…é¡»æ»¡è¶³çš„æ ‡å‡†å·²è¾¾æˆ
- [ ] âš ï¸ **æ¡ä»¶é€šè¿‡** - å¤§éƒ¨åˆ†æ ‡å‡†è¾¾æˆï¼Œå­˜åœ¨è½»å¾®é—®é¢˜ï¼Œéœ€åœ¨ X å¤©å†…ä¿®å¤
- [ ] âŒ **æœªé€šè¿‡éªŒæ”¶** - å…³é”®æ ‡å‡†æœªè¾¾æˆï¼Œéœ€é‡æ–°å®æ–½å’ŒéªŒæ”¶

### é—ç•™é—®é¢˜ï¼ˆå¦‚æœ‰ï¼‰

| é—®é¢˜ç¼–å· | é—®é¢˜æè¿° | ä¸¥é‡ç¨‹åº¦ | è´£ä»»äºº | è®¡åˆ’ä¿®å¤æ—¥æœŸ |
|---------|---------|---------|-------|-------------|
| - | - | - | - | - |

### å¤‡æ³¨

---

**éªŒæ”¶æ—¥æœŸ**: ________  
**éªŒæ”¶åœ°ç‚¹**: ________  
**éªŒæ”¶äººå‘˜**: ________

---

**æ–‡æ¡£çŠ¶æ€**: âœ… éªŒæ”¶æ–‡æ¡£å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-10-19
