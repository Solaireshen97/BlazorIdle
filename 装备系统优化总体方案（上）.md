# BlazorIdle è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰
## ç³»ç»Ÿåˆ†æä¸æ¶æ„è®¾è®¡

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ - æ•´åˆå®Œæˆ  
**ä½œè€…**: ç³»ç»Ÿæ¶æ„è®¾è®¡å›¢é˜Ÿ  

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸º BlazorIdle è£…å¤‡ç³»ç»Ÿä¼˜åŒ–çš„æ•´åˆæ€»ä½“æ–¹æ¡ˆï¼Œç”±åŸæœ‰çš„ä¸¤å¥—è®¾è®¡æ–¹æ¡ˆï¼ˆã€Šè£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ.mdã€‹å’Œã€Šè£…å¤‡ç³»ç»Ÿä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆ.mdã€‹ï¼‰åˆå¹¶ä¼˜åŒ–è€Œæˆã€‚

### æ–‡æ¡£ç»“æ„

æœ¬æ€»ä½“æ–¹æ¡ˆåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

- **ä¸Šç¯‡ï¼ˆæœ¬æ–‡æ¡£ï¼‰**: ç³»ç»Ÿåˆ†æä¸æ¶æ„è®¾è®¡
  - å½“å‰çŠ¶æ€æ·±åº¦åˆ†æ
  - è®¾è®¡ç›®æ ‡ä¸åŸåˆ™
  - æ ¸å¿ƒæ¶æ„è®¾è®¡
  - é¢†åŸŸæ¨¡å‹è¯¦ç»†è®¾è®¡

- **ä¸­ç¯‡**: æ‰§è¡Œè®¡åˆ’ä¸æŠ€æœ¯è§„èŒƒ
  - è¯¦ç»†çš„Phaseæ‰§è¡Œè®¡åˆ’ï¼ˆPhase 1-8ï¼‰
  - æŠ€æœ¯å®ç°è§„èŒƒ
  - é…ç½®åŒ–è®¾è®¡æ–¹æ¡ˆ
  - ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ

- **ä¸‹ç¯‡**: æµ‹è¯•éªŒè¯ä¸æ‰©å±•è®¾è®¡
  - å®Œæ•´çš„æµ‹è¯•ç­–ç•¥
  - æ•°å€¼å¹³è¡¡è®¾è®¡
  - å‰ç«¯éªŒè¯æ–¹æ¡ˆ
  - æ‰©å±•æ€§è®¾è®¡
  - é£é™©è¯„ä¼°ä¸åº”å¯¹

### æ•´åˆè®¾è®¡åŸåˆ™

æœ¬æ€»ä½“æ–¹æ¡ˆæ•´åˆäº†ä¸¤å¥—åŸæœ‰æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š
1. **æ–¹æ¡ˆä¸€**çš„å®Œæ•´è£…å¤‡ç”Ÿæˆã€æ‰è½ã€å¢å¼ºç³»ç»Ÿè®¾è®¡ï¼ˆ8ä¸ªPhaseï¼‰
2. **æ–¹æ¡ˆäºŒ**çš„17æ§½ä½ç³»ç»Ÿã€æŠ¤ç”²ç±»å‹ã€æ­¦å™¨ç±»å‹ã€æˆ˜æ–—æœºåˆ¶è®¾è®¡ï¼ˆ5ä¸ªPhaseï¼‰

æ•´åˆåçš„æ–¹æ¡ˆå…·å¤‡ï¼š
- âœ… **å®Œæ•´æ€§**: è¦†ç›–ä»åŸºç¡€æ§½ä½åˆ°é«˜çº§å¢å¼ºçš„å…¨æµç¨‹
- âœ… **å¯æ“ä½œæ€§**: åˆ†é˜¶æ®µå®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹éªŒè¯
- âœ… **å‰åç«¯ç»“åˆ**: æ˜ç¡®å‰ç«¯éªŒè¯ç‚¹å’ŒUIå®ç°è¦æ±‚
- âœ… **æ•°æ®é©±åŠ¨**: æ‰€æœ‰é…ç½®å‚æ•°åŒ–ï¼Œæ˜“äºè°ƒæ•´å¹³è¡¡
- âœ… **å‘åå…¼å®¹**: ä¿æŠ¤ç°æœ‰æ•°æ®å’ŒåŠŸèƒ½
- âœ… **ä»£ç é£æ ¼ä¸€è‡´**: éµå¾ªé¡¹ç›®ç°æœ‰è§„èŒƒ

---

## ç›®å½•

1. [æ„¿æ™¯ä¸æ ¸å¿ƒå®šä½](#1-æ„¿æ™¯ä¸æ ¸å¿ƒå®šä½)
2. [å½“å‰çŠ¶æ€å…¨é¢åˆ†æ](#2-å½“å‰çŠ¶æ€å…¨é¢åˆ†æ)
   - 2.1 [å·²å®Œæˆçš„å·¥ä½œ](#21-å·²å®Œæˆçš„å·¥ä½œ)
   - 2.2 [ç°æœ‰ç³»ç»Ÿèƒ½åŠ›è¯„ä¼°](#22-ç°æœ‰ç³»ç»Ÿèƒ½åŠ›è¯„ä¼°)
   - 2.3 [ç¼ºå¤±çš„å…³é”®åŠŸèƒ½](#23-ç¼ºå¤±çš„å…³é”®åŠŸèƒ½)
   - 2.4 [ç³»ç»Ÿæ•´åˆå‚è€ƒ](#24-ç³»ç»Ÿæ•´åˆå‚è€ƒ)
3. [è®¾è®¡ç›®æ ‡ä¸åŸåˆ™](#3-è®¾è®¡ç›®æ ‡ä¸åŸåˆ™)
   - 3.1 [æ ¸å¿ƒç›®æ ‡](#31-æ ¸å¿ƒç›®æ ‡)
   - 3.2 [è®¾è®¡åŸåˆ™](#32-è®¾è®¡åŸåˆ™)
   - 3.3 [æˆåŠŸæ ‡å‡†](#33-æˆåŠŸæ ‡å‡†)
4. [è£…å¤‡ç³»ç»Ÿå®Œæ•´æ¶æ„](#4-è£…å¤‡ç³»ç»Ÿå®Œæ•´æ¶æ„)
   - 4.1 [ç³»ç»Ÿæ¦‚è§ˆ](#41-ç³»ç»Ÿæ¦‚è§ˆ)
   - 4.2 [æ¨¡å—åˆ’åˆ†ä¸èŒè´£](#42-æ¨¡å—åˆ’åˆ†ä¸èŒè´£)
   - 4.3 [æ ¸å¿ƒæµç¨‹è®¾è®¡](#43-æ ¸å¿ƒæµç¨‹è®¾è®¡)
5. [è£…å¤‡æ§½ä½ç³»ç»Ÿè®¾è®¡](#5-è£…å¤‡æ§½ä½ç³»ç»Ÿè®¾è®¡)
   - 5.1 [æ§½ä½æ‰©å±•æ–¹æ¡ˆï¼ˆ9â†’17ä¸ªï¼‰](#51-æ§½ä½æ‰©å±•æ–¹æ¡ˆ917ä¸ª)
   - 5.2 [æ§½ä½é…ç½®ä¸åˆ†ç±»](#52-æ§½ä½é…ç½®ä¸åˆ†ç±»)
   - 5.3 [åŒæ‰‹æ­¦å™¨å ç”¨æœºåˆ¶](#53-åŒæ‰‹æ­¦å™¨å ç”¨æœºåˆ¶)
6. [æŠ¤ç”²ç±»å‹ç³»ç»Ÿè®¾è®¡](#6-æŠ¤ç”²ç±»å‹ç³»ç»Ÿè®¾è®¡)
   - 6.1 [æŠ¤ç”²ç±»å‹å®šä¹‰](#61-æŠ¤ç”²ç±»å‹å®šä¹‰)
   - 6.2 [æŠ¤ç”²ç‰¹æ€§ä¸å¹³è¡¡](#62-æŠ¤ç”²ç‰¹æ€§ä¸å¹³è¡¡)
   - 6.3 [æŠ¤ç”²å‡ä¼¤æœºåˆ¶](#63-æŠ¤ç”²å‡ä¼¤æœºåˆ¶)
7. [æ­¦å™¨ç±»å‹ç³»ç»Ÿè®¾è®¡](#7-æ­¦å™¨ç±»å‹ç³»ç»Ÿè®¾è®¡)
   - 7.1 [æ­¦å™¨ç±»å‹åˆ†ç±»](#71-æ­¦å™¨ç±»å‹åˆ†ç±»)
   - 7.2 [æ”»å‡»é€Ÿåº¦ä¸ä¼¤å®³å€ç‡](#72-æ”»å‡»é€Ÿåº¦ä¸ä¼¤å®³å€ç‡)
   - 7.3 [åŒæŒæœºåˆ¶](#73-åŒæŒæœºåˆ¶)
   - 7.4 [æ ¼æŒ¡æœºåˆ¶ï¼ˆç›¾ç‰Œï¼‰](#74-æ ¼æŒ¡æœºåˆ¶ç›¾ç‰Œ)
8. [èŒä¸šè£…å¤‡é™åˆ¶ç³»ç»Ÿ](#8-èŒä¸šè£…å¤‡é™åˆ¶ç³»ç»Ÿ)
   - 8.1 [èŒä¸š-è£…å¤‡å…¼å®¹æ€§](#81-èŒä¸šè£…å¤‡å…¼å®¹æ€§)
   - 8.2 [è£…å¤‡éªŒè¯æœºåˆ¶](#82-è£…å¤‡éªŒè¯æœºåˆ¶)
9. [é¢†åŸŸæ¨¡å‹è¯¦ç»†è®¾è®¡](#9-é¢†åŸŸæ¨¡å‹è¯¦ç»†è®¾è®¡)
   - 9.1 [è£…å¤‡å®šä¹‰ï¼ˆGearDefinitionï¼‰](#91-è£…å¤‡å®šä¹‰geardefinition)
   - 9.2 [è£…å¤‡å®ä¾‹ï¼ˆGearInstanceï¼‰](#92-è£…å¤‡å®ä¾‹gearinstance)
   - 9.3 [è¯æ¡ç³»ç»Ÿï¼ˆAffixï¼‰](#93-è¯æ¡ç³»ç»Ÿaffix)
   - 9.4 [å¥—è£…ç³»ç»Ÿï¼ˆGearSetï¼‰](#94-å¥—è£…ç³»ç»Ÿgearset)
10. [æ•°æ®åº“è®¾è®¡](#10-æ•°æ®åº“è®¾è®¡)
    - 10.1 [è¡¨ç»“æ„è®¾è®¡](#101-è¡¨ç»“æ„è®¾è®¡)
    - 10.2 [ç´¢å¼•ç­–ç•¥](#102-ç´¢å¼•ç­–ç•¥)
    - 10.3 [æ•°æ®è¿ç§»æ–¹æ¡ˆ](#103-æ•°æ®è¿ç§»æ–¹æ¡ˆ)

---

## 1. æ„¿æ™¯ä¸æ ¸å¿ƒå®šä½

è£…å¤‡ç³»ç»Ÿæ˜¯ BlazorIdle æ ¸å¿ƒç©æ³•çš„åŸºçŸ³ä¹‹ä¸€ï¼Œæœ¬æ¬¡ä¼˜åŒ–æ—¨åœ¨å°†å…¶ä»ç®€åŒ–çš„UIé¢„ç•™æ¡†æ¶ï¼ˆStep 5ï¼‰å‡çº§ä¸ºå®Œæ•´ã€æ·±åº¦ã€å¯æ‰©å±•çš„è£…å¤‡ä½“ç³»ã€‚

### æ ¸å¿ƒæ„¿æ™¯

**æ‰“é€ ä¸€ä¸ª"æ·±åº¦ + ç­–ç•¥ + æˆé•¿"çš„è£…å¤‡ç³»ç»Ÿï¼Œä¸ºç©å®¶æä¾›æŒç»­çš„è£…å¤‡è¿½æ±‚ç›®æ ‡å’Œå¤šæ ·åŒ–çš„æ„ç­‘é€‰æ‹©ã€‚**

### å…³é”®ç‰¹å¾

1. **å®Œæ•´çš„è£…å¤‡æ§½ä½**: 17ä¸ªæ§½ä½ï¼ˆå¯¹æ ‡ç»å…¸MMORPGï¼‰
2. **ç±»å‹åŒ–ç³»ç»Ÿ**: æŠ¤ç”²ç±»å‹ï¼ˆ4ç§ï¼‰+ æ­¦å™¨ç±»å‹ï¼ˆ15ç§ï¼‰
3. **éšæœºæ€§ä¸è¿½æ±‚**: ç¨€æœ‰åº¦ã€å“çº§ã€è¯æ¡ç³»ç»Ÿæä¾›è£…å¤‡è¿›é˜¶è·¯å¾„
4. **èŒä¸šå·®å¼‚åŒ–**: ä¸åŒèŒä¸šæœ‰ä¸åŒçš„è£…å¤‡é™åˆ¶å’Œå±æ€§å€¾å‘
5. **è£…å¤‡æˆé•¿**: åˆ†è§£ã€é‡é“¸ã€è¯æ¡é‡ç½®ç­‰å¢å¼ºç©æ³•
6. **å¥—è£…ç³»ç»Ÿ**: æä¾›æ„ç­‘æ·±åº¦å’Œé•¿æœŸç›®æ ‡
7. **æ•°æ®é©±åŠ¨**: æ‰€æœ‰å‚æ•°é…ç½®åŒ–ï¼Œä¾¿äºå¹³è¡¡è°ƒæ•´

### å¯¹ç©å®¶çš„ä»·å€¼

- **çŸ­æœŸ**: è£…å¤‡æ‰è½çš„å³æ—¶åé¦ˆå’Œå±æ€§æå‡
- **ä¸­æœŸ**: è£…å¤‡ä¼˜åŒ–ã€å¥—è£…æ”¶é›†çš„è¿›é˜¶ç›®æ ‡
- **é•¿æœŸ**: æå“è£…å¤‡è¿½æ±‚ã€å®Œç¾è¯æ¡æ‰“é€ çš„æŒç»­åŠ¨åŠ›

### å¯¹ç³»ç»Ÿçš„ä»·å€¼

- **æˆ˜æ–—æ·±åº¦**: è£…å¤‡å±æ€§ç›´æ¥å½±å“æˆ˜æ–—è¡¨ç°ï¼Œå¢åŠ ç­–ç•¥æ€§
- **ç»æµå¾ªç¯**: è£…å¤‡åˆ†è§£ã€é‡é“¸å½¢æˆææ–™æ¶ˆè€—é—­ç¯
- **å†…å®¹æ‰©å±•**: æ˜“äºæ·»åŠ æ–°è£…å¤‡ã€æ–°å¥—è£…ã€æ–°è¯æ¡
- **æ•°å€¼ç®¡çº¿**: ç»Ÿä¸€çš„å±æ€§è®¡ç®—ä¿è¯å¹³è¡¡æ€§

---

## 2. å½“å‰çŠ¶æ€å…¨é¢åˆ†æ

### 2.1 å·²å®Œæˆçš„å·¥ä½œ

æ ¹æ®é¡¹ç›®æ–‡æ¡£ï¼ˆ`è£…å¤‡ç³»ç»ŸUIå®ŒæˆæŠ¥å‘Š.md`ã€`STEP5_SUMMARY.md`ï¼‰å’Œä»£ç åˆ†æï¼Œè£…å¤‡ç³»ç»Ÿåœ¨ **Step 5** å®Œæˆäº†UIæ¡†æ¶é¢„ç•™ã€‚

#### âœ… å·²å®ç°éƒ¨åˆ†

##### 1. å‰ç«¯UIæ¡†æ¶ (`EquipmentPanel.razor`)

```
å½“å‰è£…å¤‡é¢æ¿å¸ƒå±€ï¼ˆ3x3ç½‘æ ¼ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸª–      â”‚    âš”ï¸     â”‚   ğŸ›¡ï¸      â”‚
â”‚  å¤´ç›”     â”‚   æ­¦å™¨    â”‚   å‰¯æ‰‹    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ§¥      â”‚    âš–ï¸     â”‚   ğŸ¦µ      â”‚
â”‚  èƒ¸ç”²     â”‚   è…°å¸¦    â”‚   è…¿éƒ¨    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ‘Ÿ      â”‚    ğŸ’     â”‚   ğŸ’      â”‚
â”‚  é‹å­     â”‚  é¥°å“1    â”‚  é¥°å“2    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**:
- 9ä¸ªè£…å¤‡æ§½ä½çš„UIå±•ç¤º
- æ€»å±æ€§å±•ç¤ºé¢æ¿
- å“è´¨é¢œè‰²ç³»ç»Ÿï¼ˆæ™®é€š/ç¨€æœ‰/å²è¯—/ä¼ è¯´ï¼‰
- åŸºç¡€çš„æ§½ä½å¸ƒå±€

##### 2. æ•°æ®æ¨¡å‹å®šä¹‰ (`BlazorIdle/Services/ApiModels.cs`)

```csharp
// å·²å®šä¹‰çš„å…³é”®DTO
public sealed class EquipmentResponse
{
    public List<EquipmentSlotDto> Slots { get; set; }
    public Dictionary<string, double> TotalStats { get; set; }
}

public sealed class EquipmentSlotDto
{
    public string SlotType { get; set; }
    public string SlotName { get; set; }
    public GearInstanceDto? Gear { get; set; }
}

public sealed class GearInstanceDto
{
    public Guid Id { get; set; }
    public string DefinitionId { get; set; }
    public string Name { get; set; }
    public string Icon { get; set; }
    public string Rarity { get; set; }        // Common/Rare/Epic/Legendary
    public int Tier { get; set; }             // 1-3
    public int ItemLevel { get; set; }
    public int QualityScore { get; set; }
    public List<AffixDto> Affixes { get; set; }
    public string? SetId { get; set; }
    public Dictionary<string, double> Stats { get; set; }
}

public sealed class AffixDto
{
    public string AffixId { get; set; }
    public string DisplayText { get; set; }
    public double Value { get; set; }
}
```

##### 3. APIæ¥å£é¢„ç•™ (`BlazorIdle.Server/Api/EquipmentController.cs`)

```csharp
// å½“å‰ä¸ºå ä½å®ç°ï¼Œè¿”å›ç©ºæ§½æˆ–501é”™è¯¯
[HttpGet("{characterId:guid}")]
public ActionResult<object> GetEquipment(Guid characterId)
{
    // è¿”å›9ä¸ªç©ºæ§½ä½
}

[HttpPost("{characterId:guid}/{slot}")]
public ActionResult<object> EquipItem(Guid characterId, string slot, [FromBody] object request)
{
    // è¿”å› 501 Not Implemented
}

[HttpDelete("{characterId:guid}/{slot}")]
public ActionResult<object> UnequipItem(Guid characterId, string slot)
{
    // è¿”å› 501 Not Implemented
}
```

##### 4. æµ‹è¯•è¦†ç›–

- **å•å…ƒæµ‹è¯•**: 18ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- **æµ‹è¯•å†…å®¹**: æ§½ä½ç±»å‹ã€å“è´¨æšä¸¾ã€å±æ€§è®¡ç®—ç­‰æ ¸å¿ƒåŠŸèƒ½
- **æµ‹è¯•æ¡†æ¶**: xUnit + FluentAssertions

#### âŒ ç¼ºå¤±éƒ¨åˆ†

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬13èŠ‚"è£…å¤‡ä¸ç‰©å“ç”Ÿæ€"åˆ†æï¼š

##### 1. é¢†åŸŸæ¨¡å‹å±‚

```
ç¼ºå¤±çš„æ ¸å¿ƒå®ä½“:
âŒ Domain/Equipment/Models/
   â”œâ”€â”€ GearDefinition.cs          # è£…å¤‡å®šä¹‰ï¼ˆé…ç½®ï¼‰
   â”œâ”€â”€ GearInstance.cs            # è£…å¤‡å®ä¾‹ï¼ˆæ•°æ®åº“å®ä½“ï¼‰
   â”œâ”€â”€ Affix.cs                   # è¯æ¡å®šä¹‰
   â”œâ”€â”€ AffixInstance.cs           # è¯æ¡å®ä¾‹
   â”œâ”€â”€ GearSet.cs                 # å¥—è£…å®šä¹‰
   â””â”€â”€ EquipmentSlot.cs           # è£…å¤‡æ§½æšä¸¾ï¼ˆæ‰©å±•ç‰ˆï¼‰
```

##### 2. æ ¸å¿ƒæœåŠ¡å±‚

```
ç¼ºå¤±çš„å…³é”®æœåŠ¡:
âŒ Domain/Equipment/Services/
   â”œâ”€â”€ GearGenerationService.cs   # è£…å¤‡ç”Ÿæˆï¼ˆç¨€æœ‰åº¦/å“çº§/è¯æ¡Rollï¼‰
   â”œâ”€â”€ EquipmentService.cs        # è£…å¤‡ç®¡ç†ï¼ˆè£…å¤‡/å¸ä¸‹/éªŒè¯ï¼‰
   â”œâ”€â”€ StatsAggregationService.cs # å±æ€§èšåˆï¼ˆè£…å¤‡â†’æ€»å±æ€§ï¼‰
   â”œâ”€â”€ DisenchantService.cs       # åˆ†è§£æœåŠ¡
   â”œâ”€â”€ ReforgeService.cs          # é‡é“¸æœåŠ¡ï¼ˆå“çº§æå‡ï¼‰
   â””â”€â”€ SetBonusService.cs         # å¥—è£…åŠ æˆè®¡ç®—
```

##### 3. æ•°æ®æŒä¹…åŒ–å±‚

```
ç¼ºå¤±çš„æ•°æ®è¡¨:
âŒ GearDefinitions      # è£…å¤‡å®šä¹‰é…ç½®è¡¨
âŒ GearInstances        # è£…å¤‡å®ä¾‹è¡¨
âŒ AffixDefinitions     # è¯æ¡å®šä¹‰è¡¨
âŒ GearSets             # å¥—è£…å®šä¹‰è¡¨
```

##### 4. æ ¸å¿ƒåŠŸèƒ½

```
âŒ è£…å¤‡ç”Ÿæˆé€»è¾‘
   - ç¨€æœ‰åº¦éšæœºç®—æ³•ï¼ˆåŠ æƒéšæœºï¼‰
   - åŸºç¡€å±æ€§Rollï¼ˆèŒƒå›´å†…éšæœºï¼‰
   - è¯æ¡ç”Ÿæˆç®—æ³•ï¼ˆæ ¹æ®ç¨€æœ‰åº¦å†³å®šæ•°é‡å’Œå“è´¨ï¼‰
   - è£…å¤‡è¯„åˆ†è®¡ç®—
   - å“çº§ç³»æ•°åº”ç”¨

âŒ è£…å¤‡æ‰è½ç³»ç»Ÿ
   - é›†æˆåˆ° EconomyRegistry
   - æ‰è½è¡¨é…ç½®ï¼ˆLootTableï¼‰
   - ä¸æˆ˜æ–—ç³»ç»Ÿé›†æˆ

âŒ è£…å¤‡ç®¡ç†æ“ä½œ
   - è£…å¤‡/å¸ä¸‹åŠŸèƒ½
   - è£…å¤‡éªŒè¯ï¼ˆç­‰çº§/èŒä¸š/æ§½ä½ï¼‰
   - å±æ€§è®¡ç®—ä¸æ±‡æ€»
   - å¥—è£…æ•ˆæœè§¦å‘

âŒ è£…å¤‡å¢å¼ºç³»ç»Ÿ
   - è£…å¤‡åˆ†è§£ï¼ˆè·å–ææ–™ï¼‰
   - å“çº§é‡é“¸ï¼ˆTieræå‡ï¼‰
   - è¯æ¡é‡ç½®ï¼ˆRerollï¼‰
   - æˆæœ¬è®¡ç®—

âŒ æˆ˜æ–—é›†æˆ
   - è£…å¤‡å±æ€§æ³¨å…¥åˆ° CharacterStats
   - è£…å¤‡å±æ€§å‚ä¸æˆ˜æ–—è®¡ç®—
   - è£…å¤‡ç‰¹æ•ˆ/è§¦å‘æŠ€èƒ½ï¼ˆæœªæ¥æ‰©å±•ï¼‰

âŒ 17æ§½ä½ç³»ç»Ÿ
   - æ‰©å±•åˆ°17ä¸ªè£…å¤‡æ§½ä½
   - åŒæ‰‹æ­¦å™¨å ç”¨æœºåˆ¶
   - æŠ¤ç”²ç±»å‹ç³»ç»Ÿ
   - æ­¦å™¨ç±»å‹ç³»ç»Ÿ
   - æ ¼æŒ¡æœºåˆ¶
   - èŒä¸šè£…å¤‡é™åˆ¶
```

---

### 2.2 ç°æœ‰ç³»ç»Ÿèƒ½åŠ›è¯„ä¼°

#### å¯å¤ç”¨çš„ç³»ç»Ÿ

##### 1. ç»æµç³»ç»Ÿ (`Domain/Combat/Economy/`)

```
å·²æœ‰èƒ½åŠ›:
âœ… EconomyRegistry        # ç‰©å“æ³¨å†Œä¸­å¿ƒ
âœ… LootTable              # æ‰è½è¡¨ç³»ç»Ÿ
âœ… EconomyCalculator      # æ‰è½è®¡ç®—å™¨
âœ… RewardGrantService     # å¥–åŠ±å‘æ”¾æœåŠ¡
âœ… InventoryItem          # èƒŒåŒ…ç‰©å“è¡¨

å¤ç”¨æ–¹æ¡ˆ:
- å°†è£…å¤‡ä½œä¸ºç‰¹æ®Šç‰©å“ç±»å‹ï¼ˆItemType = "gear"ï¼‰é›†æˆ
- æ‰©å±• LootEntry æ”¯æŒè£…å¤‡ç”Ÿæˆå‚æ•°
- ä½¿ç”¨ RewardGrantService å‘æ”¾è£…å¤‡åˆ°èƒŒåŒ…
```

##### 2. æˆ˜æ–—ç³»ç»Ÿ (`Domain/Combat/`)

```
å·²æœ‰èƒ½åŠ›:
âœ… CharacterStats         # è§’è‰²å±æ€§ï¼ˆæ”»å‡»/æš´å‡»/æ€¥é€Ÿ/ç©¿é€ï¼‰
âœ… PlayerCombatant        # ç©å®¶æˆ˜æ–—å•ä½
âœ… StatsBuilder           # å±æ€§æ„å»ºå™¨
âœ… BuffManager            # Buffç®¡ç†ï¼ˆå¯ç”¨äºå¥—è£…æ•ˆæœï¼‰

é›†æˆæ–¹æ¡ˆ:
- åœ¨ StatsBuilder.BuildStats() ä¸­æ³¨å…¥è£…å¤‡å±æ€§
- è£…å¤‡å±æ€§é€šè¿‡ StatsAggregationService è®¡ç®—åæ³¨å…¥
- å¥—è£…æ•ˆæœå¯è½¬æ¢ä¸º Buff å½¢å¼åº”ç”¨
```

##### 3. è§’è‰²ç³»ç»Ÿ (`Domain/Characters/`)

```
å·²æœ‰èƒ½åŠ›:
âœ… Character              # è§’è‰²å®ä½“ï¼ˆä¸»å±æ€§/ç­‰çº§/èŒä¸šï¼‰
âœ… PrimaryAttributes      # ä¸»å±æ€§ï¼ˆåŠ›é‡/æ•æ·/æ™ºåŠ›/è€åŠ›ï¼‰
âœ… ProfessionBaseStatsRegistry  # èŒä¸šåŸºç¡€å±æ€§

æ‰©å±•æ–¹æ¡ˆ:
- æ·»åŠ  Character.EquippedGear å¯¼èˆªå±æ€§
- å®ç°è£…å¤‡ä¸è§’è‰²çš„å…³è”æŸ¥è¯¢
- èŒä¸šé™åˆ¶åŸºäº Profession å­—æ®µéªŒè¯
```

##### 4. æ•°æ®æŒä¹…åŒ– (`Infrastructure/Persistence/`)

```
å·²æœ‰èƒ½åŠ›:
âœ… GameDbContext          # EF Core æ•°æ®åº“ä¸Šä¸‹æ–‡
âœ… *Configuration.cs      # å®ä½“é…ç½®æ¨¡å¼
âœ… Migrations             # æ•°æ®åº“è¿ç§»æœºåˆ¶

æ‰©å±•æ–¹æ¡ˆ:
- æ·»åŠ è£…å¤‡ç›¸å…³è¡¨çš„ Configuration ç±»
- åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
- ä½¿ç”¨ç§å­æ•°æ®ï¼ˆSeed Dataï¼‰åˆå§‹åŒ–è£…å¤‡å®šä¹‰
```

##### 5. RNGç³»ç»Ÿ (`Domain/Combat/RNG/`)

```
å·²æœ‰èƒ½åŠ›:
âœ… RNGContext             # éšæœºæ•°ä¸Šä¸‹æ–‡ï¼ˆå¯å›æ”¾ï¼‰
âœ… SeedSequence           # ç§å­åºåˆ—ç®¡ç†

å¤ç”¨æ–¹æ¡ˆ:
- è£…å¤‡ç”Ÿæˆä½¿ç”¨ RNGContext ä¿è¯å¯å›æ”¾
- ç¨€æœ‰åº¦ã€å±æ€§Rollã€è¯æ¡ç”Ÿæˆå‡åŸºäºç§å­
- æ”¯æŒç¦»çº¿è£…å¤‡ç”ŸæˆéªŒè¯
```

---

### 2.3 ç¼ºå¤±çš„å…³é”®åŠŸèƒ½

#### åŠŸèƒ½ç¼ºå¤±æ€»ç»“

| åŠŸèƒ½æ¨¡å— | ç¼ºå¤±ç¨‹åº¦ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|---------|---------|--------|------|
| **è£…å¤‡æ§½ä½æ‰©å±•ï¼ˆ17æ§½ä½ï¼‰** | 100% | â­â­â­â­â­ | ä»9ä¸ªæ‰©å±•åˆ°17ä¸ªï¼Œæ ¸å¿ƒåŸºç¡€ |
| **æŠ¤ç”²ç±»å‹ç³»ç»Ÿ** | 100% | â­â­â­â­â­ | 4ç§æŠ¤ç”²ç±»å‹ï¼Œå½±å“æˆ˜æ–—å¹³è¡¡ |
| **æ­¦å™¨ç±»å‹ç³»ç»Ÿ** | 100% | â­â­â­â­â­ | 15ç§æ­¦å™¨ç±»å‹ï¼Œå†³å®šæ”»å‡»æ–¹å¼ |
| **è£…å¤‡ç”Ÿæˆé€»è¾‘** | 100% | â­â­â­â­â­ | æ ¸å¿ƒç©æ³•ï¼Œæ— æ­¤åˆ™æ— è£…å¤‡ |
| **è£…å¤‡ç®¡ç†æœåŠ¡** | 100% | â­â­â­â­â­ | è£…å¤‡/å¸ä¸‹/éªŒè¯ |
| **å±æ€§èšåˆè®¡ç®—** | 100% | â­â­â­â­â­ | è£…å¤‡â†’æ€»å±æ€§ï¼Œå½±å“æˆ˜æ–— |
| **è£…å¤‡æ‰è½ç³»ç»Ÿ** | 90% | â­â­â­â­ | éœ€é›†æˆåˆ°ç»æµç³»ç»Ÿ |
| **æ ¼æŒ¡æœºåˆ¶** | 100% | â­â­â­â­ | ç›¾ç‰Œç‰¹æ€§ |
| **èŒä¸šè£…å¤‡é™åˆ¶** | 100% | â­â­â­â­ | èŒä¸šå·®å¼‚åŒ– |
| **å¥—è£…ç³»ç»Ÿ** | 100% | â­â­â­ | ä¸­é•¿æœŸç›®æ ‡ |
| **è£…å¤‡åˆ†è§£** | 100% | â­â­â­ | ç»æµå¾ªç¯ |
| **å“çº§é‡é“¸** | 100% | â­â­â­ | è£…å¤‡è¿›é˜¶ |
| **è¯æ¡é‡ç½®** | 100% | â­â­â­ | è£…å¤‡ä¼˜åŒ– |
| **å‰ç«¯17æ§½ä½UI** | 100% | â­â­â­â­ | ç”¨æˆ·ä½“éªŒ |
| **è£…å¤‡å¯¹æ¯”åŠŸèƒ½** | 100% | â­â­â­ | ç”¨æˆ·ä½“éªŒ |

---

### 2.4 ç³»ç»Ÿæ•´åˆå‚è€ƒ

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬13èŠ‚ï¼Œè£…å¤‡ç³»ç»Ÿè®¾è®¡è¦ç‚¹ï¼š

#### è£…å¤‡ä¸ç‰©å“ç”Ÿæ€ï¼ˆå“çº§ / è¯æ¡ / å¥—è£… / åˆ†è§£ / é‡é“¸ï¼‰

| è®¾è®¡ç‚¹ | å†…å®¹ |
|--------|------|
| **GearDefinition** | åŸºç¡€å±æ€§èŒƒå›´ / å…è®¸è¯æ¡æ±  / slot / ç¨€æœ‰åº¦æƒé‡ |
| **GearInstance** | defId + tier(T1/T2/T3) + affixes[] + setId + qualityScore |
| **Tier ç³»æ•°** | T1=0.8 / T2=1.0 / T3=1.2ï¼ˆå¯é…ç½®ï¼‰ |
| **Affix** | id, type (Flat/Percent/Proc), rollRange, rarityWeight |
| **å¥—è£…** | setId + pieceBonuses + activeCount |
| **åˆ†è§£ (Disenchant)** | è¾“å…¥ï¼šè£…å¤‡ â†’ ææ–™ï¼ˆæŒ‰ tier/rarityï¼‰ |
| **å“çº§é‡é“¸ (ReforgeTier)** | æ¶ˆè€—ï¼šææ–™+é‡‘å¸ â†’ +Tier |
| **è¯æ¡é‡ç½® (Reroll)** | é‡ç”Ÿæˆ affixesï¼›æˆæœ¬é€’å¢ / ä¿åº•æœºåˆ¶ |
| **è¯æ¡é‡é“¸ (Refine Future)** | ç²¾ç‚¼æŒ‡å®š affix å°å¹…æå‡ |
| **è£…å¤‡æŠ€èƒ½/ç‰¹æ•ˆ** | ç‰¹æ®Šæ ‡ç­¾ï¼šåœ¨äº‹ä»¶é’©å­ (OnHit/OnCast) æ³¨å†Œ |

#### æ•°å€¼ç®¡çº¿ (é˜²è†¨èƒ€)

```
final = clamp(((base + Î£Additive) * Î (1+Mult)) + Î£FinalAdd)
```

**é™åˆ¶æœºåˆ¶**:
- Mult æºæ•°æ§åˆ¶ï¼ˆä¹˜æ³•ä¿®é¥°ç¬¦ä¸èƒ½æ— é™å åŠ ï¼‰
- æ”»é€Ÿä¸‹é™ï¼ˆé˜²æ­¢æ”»å‡»è¿‡æ…¢ï¼‰
- æš´å‡»ä¸Šé™ï¼ˆ100%å°é¡¶ï¼‰

---

## 3. è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### 3.1 æ ¸å¿ƒç›®æ ‡

#### ç›®æ ‡1: å®Œå–„æœåŠ¡ç«¯è£…å¤‡åŠŸèƒ½

**å®ç°èŒƒå›´**:
- âœ… è£…å¤‡ç”Ÿæˆç³»ç»Ÿï¼ˆç¨€æœ‰åº¦/å“çº§/è¯æ¡ï¼‰
- âœ… è£…å¤‡æ‰è½ç³»ç»Ÿï¼ˆé›†æˆåˆ°ç»æµç³»ç»Ÿï¼‰
- âœ… è£…å¤‡ç®¡ç†æ“ä½œï¼ˆè£…å¤‡/å¸ä¸‹/éªŒè¯ï¼‰
- âœ… å±æ€§è®¡ç®—ç³»ç»Ÿï¼ˆè£…å¤‡â†’æ€»å±æ€§â†’æˆ˜æ–—ï¼‰
- âœ… è£…å¤‡å¢å¼ºç³»ç»Ÿï¼ˆåˆ†è§£/é‡é“¸/è¯æ¡é‡ç½®ï¼‰
- âœ… å¥—è£…ç³»ç»Ÿï¼ˆæ”¶é›†å¥–åŠ±ï¼‰

**æˆåŠŸæŒ‡æ ‡**:
- è£…å¤‡ç”Ÿæˆç®—æ³•ç¨³å®šï¼Œæ•°å€¼åˆç†
- è£…å¤‡å±æ€§æ­£ç¡®å½±å“æˆ˜æ–—ç»“æœ
- è£…å¤‡æ“ä½œå“åº”æ—¶é—´ < 500ms
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

#### ç›®æ ‡2: æ‰©å±•è£…å¤‡ç³»ç»Ÿæ·±åº¦

**å®ç°èŒƒå›´**:
- âœ… 17ä¸ªè£…å¤‡æ§½ä½ï¼ˆå¯¹æ ‡ç»å…¸MMORPGï¼‰
- âœ… 4ç§æŠ¤ç”²ç±»å‹ï¼ˆå¸ƒ/çš®/é”/æ¿ï¼‰
- âœ… 15ç§æ­¦å™¨ç±»å‹ï¼ˆå•æ‰‹/åŒæ‰‹/è¿œç¨‹/ç›¾ç‰Œï¼‰
- âœ… æŠ¤ç”²å‡ä¼¤æœºåˆ¶
- âœ… æ ¼æŒ¡æœºåˆ¶ï¼ˆç›¾ç‰Œç‰¹æ€§ï¼‰
- âœ… èŒä¸šè£…å¤‡é™åˆ¶ï¼ˆèŒä¸šå·®å¼‚åŒ–ï¼‰

**æˆåŠŸæŒ‡æ ‡**:
- ä¸åŒæŠ¤ç”²ç±»å‹æœ‰æ˜æ˜¾å·®å¼‚ï¼ˆâ‰¥30%å±æ€§å·®ï¼‰
- ä¸åŒæ­¦å™¨ç±»å‹æ”»å‡»æ–¹å¼åŒºåˆ«æ˜æ˜¾
- æ ¼æŒ¡æœºåˆ¶æ­£å¸¸è§¦å‘ï¼Œå‡ä¼¤æ•ˆæœåˆç†
- èŒä¸šè£…å¤‡é™åˆ¶æ­£ç¡®ç”Ÿæ•ˆ

#### ç›®æ ‡3: å®ç°å‰ç«¯è£…å¤‡ç®¡ç†

**å®ç°èŒƒå›´**:
- âœ… å®Œå–„è£…å¤‡é¢æ¿ï¼ˆ17æ§½ä½å¸ƒå±€ï¼‰
- âœ… è£…å¤‡è¯¦æƒ…å±•ç¤ºï¼ˆå±æ€§/è¯æ¡/å¥—è£…ï¼‰
- âœ… è£…å¤‡å¯¹æ¯”åŠŸèƒ½
- âœ… è£…å¤‡ç­›é€‰å’Œæ’åº
- âœ… è£…å¤‡å¢å¼ºç•Œé¢ï¼ˆåˆ†è§£/é‡é“¸/é‡ç½®ï¼‰

**æˆåŠŸæŒ‡æ ‡**:
- UIç¾è§‚æ˜“ç”¨ï¼Œç¬¦åˆç©å®¶ä¹ æƒ¯
- è£…å¤‡æ“ä½œæµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- è£…å¤‡å¯¹æ¯”ä¿¡æ¯æ¸…æ™°å‡†ç¡®
- ç”¨æˆ·æ»¡æ„åº¦ â‰¥ 85%

#### ç›®æ ‡4: ä¿æŒç³»ç»Ÿä¸€è‡´æ€§

**å®ç°èŒƒå›´**:
- âœ… éµå¾ªç°æœ‰ä»£ç é£æ ¼
- âœ… å¤ç”¨ç°æœ‰ç³»ç»Ÿèƒ½åŠ›
- âœ… ä¿æŒæ•°æ®é©±åŠ¨è®¾è®¡
- âœ… ç»´æŠ¤å‘åå…¼å®¹æ€§

**æˆåŠŸæŒ‡æ ‡**:
- æ–°ä»£ç é€šè¿‡ Code Review
- ç°æœ‰æµ‹è¯•å…¨éƒ¨é€šè¿‡
- æ— é‡å¤§æ¶æ„è°ƒæ•´
- ç°æœ‰è£…å¤‡æ•°æ®å¯å¹³æ»‘è¿ç§»

---

### 3.2 è®¾è®¡åŸåˆ™

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ç¬¬3èŠ‚æ¶æ„åŸåˆ™å’Œé¡¹ç›®å®è·µï¼š

#### åŸåˆ™1: æœåŠ¡ç«¯æƒå¨ (Server Authoritative)

```
æ‰€æœ‰å…³é”®æ“ä½œåœ¨æœåŠ¡ç«¯æ‰§è¡Œ:
â”œâ”€â”€ è£…å¤‡ç”Ÿæˆ â†’ æœåŠ¡ç«¯Rollå±æ€§
â”œâ”€â”€ è£…å¤‡éªŒè¯ â†’ æœåŠ¡ç«¯æ£€æŸ¥èŒä¸š/ç­‰çº§/æ§½ä½
â”œâ”€â”€ å±æ€§è®¡ç®— â†’ æœåŠ¡ç«¯èšåˆå¹¶æ³¨å…¥æˆ˜æ–—
â”œâ”€â”€ è£…å¤‡å¢å¼º â†’ æœåŠ¡ç«¯æ‰£é™¤ææ–™å¹¶ä¿®æ”¹
â””â”€â”€ æ‰è½è®¡ç®— â†’ æœåŠ¡ç«¯ä½¿ç”¨RNGContext

é˜²æ­¢å®¢æˆ·ç«¯ä½œå¼Š:
- å‰ç«¯ä»…å±•ç¤ºå’Œå‘èµ·è¯·æ±‚
- æ‰€æœ‰æ•°å€¼è®¡ç®—åœ¨æœåŠ¡ç«¯
- ä½¿ç”¨ç§å­åºåˆ—ä¿è¯å¯å›æ”¾å’Œå®¡è®¡
```

#### åŸåˆ™2: æ•°æ®é©±åŠ¨ (Data-Driven)

```
é…ç½®åŒ–è®¾è®¡:
â”œâ”€â”€ è£…å¤‡å®šä¹‰ â†’ GearDefinitions è¡¨/JSON
â”œâ”€â”€ è¯æ¡æ±  â†’ AffixDefinitions è¡¨
â”œâ”€â”€ æ‰è½è¡¨ â†’ LootTable é…ç½®
â”œâ”€â”€ æŠ¤ç”²ç±»å‹ç³»æ•° â†’ ArmorTypeConfig JSON
â”œâ”€â”€ æ­¦å™¨ç±»å‹å‚æ•° â†’ WeaponTypeConfig JSON
â”œâ”€â”€ èŒä¸šé™åˆ¶ â†’ ProfessionEquipmentConfig JSON
â””â”€â”€ æˆ˜æ–—æœºåˆ¶å‚æ•° â†’ CombatMechanicsConfig JSON

ä¼˜åŠ¿:
- ä¾¿äºå¹³è¡¡è°ƒæ•´ï¼ˆæ— éœ€æ”¹ä»£ç ï¼‰
- æ˜“äºæ‰©å±•æ–°å†…å®¹ï¼ˆæ–°å¢é…ç½®è¡Œï¼‰
- æ”¯æŒA/Bæµ‹è¯•ï¼ˆåˆ‡æ¢é…ç½®ç‰ˆæœ¬ï¼‰
- é…ç½®å¯ç‰ˆæœ¬åŒ–ç®¡ç†
```

#### åŸåˆ™3: é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)

```
æ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œ:
Equipment Domain (è£…å¤‡é¢†åŸŸ)
â”œâ”€â”€ Models (å®ä½“)
â”œâ”€â”€ Services (é¢†åŸŸæœåŠ¡)
â”œâ”€â”€ Repositories (ä»“å‚¨æ¥å£)
â””â”€â”€ Events (é¢†åŸŸäº‹ä»¶)

èšåˆæ ¹æ¨¡å¼:
- GearInstance ä½œä¸ºèšåˆæ ¹
- Affix ä½œä¸ºå€¼å¯¹è±¡
- è£…å¤‡æ“ä½œé€šè¿‡èšåˆæ ¹æ–¹æ³•

é¢†åŸŸäº‹ä»¶ä¼ æ’­:
- EquipmentChanged â†’ é€šçŸ¥å±æ€§é‡ç®—
- GearDisenchanted â†’ é€šçŸ¥ç»æµç³»ç»Ÿ
- SetBonusActivated â†’ é€šçŸ¥Buffç³»ç»Ÿ
```

#### åŸåˆ™4: å¯æµ‹è¯•æ€§ (Testability)

```
æµ‹è¯•ç­–ç•¥:
â”œâ”€â”€ å•å…ƒæµ‹è¯• (â‰¥90%è¦†ç›–ç‡)
â”‚   â”œâ”€â”€ è£…å¤‡ç”Ÿæˆç®—æ³•
â”‚   â”œâ”€â”€ å±æ€§è®¡ç®—é€»è¾‘
â”‚   â”œâ”€â”€ éªŒè¯è§„åˆ™
â”‚   â””â”€â”€ æ•°å€¼ç®¡çº¿
â”œâ”€â”€ é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ è£…å¤‡-æˆ˜æ–—é›†æˆ
â”‚   â”œâ”€â”€ è£…å¤‡-ç»æµé›†æˆ
â”‚   â””â”€â”€ è£…å¤‡-å‰ç«¯é›†æˆ
â””â”€â”€ E2Eæµ‹è¯•
    â”œâ”€â”€ å®Œæ•´è£…å¤‡æµç¨‹
    â””â”€â”€ ç”¨æˆ·æ“ä½œåœºæ™¯

å¯æ³¨å…¥ä¾èµ–:
- RNGContext (æµ‹è¯•æ—¶å›ºå®šç§å­)
- Repository (æµ‹è¯•æ—¶ç”¨Mock)
- GameClock (æµ‹è¯•æ—¶å¯æ§åˆ¶æ—¶é—´)
```

#### åŸåˆ™5: æ€§èƒ½ä¼˜åŒ–

```
æ€§èƒ½ç­–ç•¥:
â”œâ”€â”€ è£…å¤‡å±æ€§è®¡ç®—ç¼“å­˜
â”‚   â””â”€â”€ è£…å¤‡å˜æ›´æ—¶å¤±æ•ˆç¼“å­˜
â”œâ”€â”€ è£…å¤‡æ•°æ®æ‡’åŠ è½½
â”‚   â””â”€â”€ ä»…åŠ è½½å½“å‰éœ€è¦çš„è£…å¤‡
â”œâ”€â”€ æ‰¹é‡æ“ä½œæ”¯æŒ
â”‚   â””â”€â”€ æ‰¹é‡åˆ†è§£ã€æ‰¹é‡è£…å¤‡éªŒè¯
â”œâ”€â”€ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
â”‚   â”œâ”€â”€ ä¸ºè£…å¤‡ç±»å‹å­—æ®µæ·»åŠ ç´¢å¼•
â”‚   â”œâ”€â”€ ä½¿ç”¨ Include é¢„åŠ è½½å…³è”æ•°æ®
â”‚   â””â”€â”€ é¿å… N+1 æŸ¥è¯¢
â””â”€â”€ å‰ç«¯æ¸²æŸ“ä¼˜åŒ–
    â”œâ”€â”€ è™šæ‹Ÿæ»šåŠ¨ï¼ˆè£…å¤‡åˆ—è¡¨ï¼‰
    â”œâ”€â”€ å›¾æ ‡æ‡’åŠ è½½
    â””â”€â”€ å±æ€§è®¡ç®—é˜²æŠ–

æ€§èƒ½ç›®æ ‡:
- è£…å¤‡è£…å¤‡/å¸ä¸‹æ“ä½œ < 200ms
- è£…å¤‡åˆ—è¡¨åŠ è½½ < 500ms
- è£…å¤‡å±æ€§è®¡ç®— < 50ms
- è£…å¤‡ç”Ÿæˆ < 100ms
```

#### åŸåˆ™6: å®‰å…¨æ€§

```
å®‰å…¨æªæ–½:
â”œâ”€â”€ è£…å¤‡æ“ä½œé™é¢‘
â”‚   â””â”€â”€ é˜²æ­¢åˆ·è£…å¤‡/åˆ†è§£ä½œå¼Š
â”œâ”€â”€ äº¤æ˜“éªŒè¯
â”‚   â””â”€â”€ é˜²æ­¢è£…å¤‡å¤åˆ¶
â”œâ”€â”€ è£…å¤‡ç»‘å®šæœºåˆ¶
â”‚   â”œâ”€â”€ æ‹¾å–åç»‘å®š
â”‚   â””â”€â”€ è£…å¤‡åç»‘å®š
â””â”€â”€ RNGç§å­ç®¡ç†
    â””â”€â”€ æœåŠ¡ç«¯æ§åˆ¶ï¼Œå®¢æˆ·ç«¯ä¸å¯é¢„æµ‹

å®¡è®¡æœºåˆ¶:
- è®°å½•æ‰€æœ‰è£…å¤‡æ“ä½œ
- è®°å½•è£…å¤‡ç”Ÿæˆç§å­
- è®°å½•è£…å¤‡å¢å¼ºå†å²
```

---

### 3.3 æˆåŠŸæ ‡å‡†

#### åŠŸèƒ½å®Œæ•´æ€§

| æ£€æŸ¥é¡¹ | æ ‡å‡† | éªŒè¯æ–¹å¼ |
|--------|------|---------|
| è£…å¤‡ç”Ÿæˆ | å„ç¨€æœ‰åº¦è£…å¤‡å¯æ­£å¸¸ç”Ÿæˆ | è‡ªåŠ¨åŒ–æµ‹è¯• + æ‰‹åŠ¨éªŒè¯ |
| è£…å¤‡æ‰è½ | æ‰è½ç‡ç¬¦åˆé¢„æœŸ | ç»Ÿè®¡æ•°æ®åˆ†æ |
| è£…å¤‡æ“ä½œ | è£…å¤‡/å¸ä¸‹/éªŒè¯æ­£ç¡® | é›†æˆæµ‹è¯• |
| å±æ€§è®¡ç®— | å±æ€§æ­£ç¡®å½±å“æˆ˜æ–— | æˆ˜æ–—æ—¥å¿—éªŒè¯ |
| è£…å¤‡å¢å¼º | åˆ†è§£/é‡é“¸/é‡ç½®æ­£å¸¸ | åŠŸèƒ½æµ‹è¯• |
| å¥—è£…ç³»ç»Ÿ | å¥—è£…æ•ˆæœæ­£ç¡®è§¦å‘ | æˆ˜æ–—æµ‹è¯• |
| å‰ç«¯UI | 17æ§½ä½æ­£å¸¸æ˜¾ç¤ºå’Œæ“ä½œ | UIæµ‹è¯• |
| èŒä¸šé™åˆ¶ | èŒä¸šé™åˆ¶æ­£ç¡®ç”Ÿæ•ˆ | è¾¹ç•Œæµ‹è¯• |

#### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|--------|---------|
| è£…å¤‡è£…å¤‡/å¸ä¸‹å“åº” | < 200ms | æ€§èƒ½ç›‘æ§ |
| è£…å¤‡åˆ—è¡¨åŠ è½½ | < 500ms | å‰ç«¯æ€§èƒ½åˆ†æ |
| è£…å¤‡å±æ€§è®¡ç®— | < 50ms | æ€§èƒ½æµ‹è¯• |
| è£…å¤‡ç”Ÿæˆ | < 100ms | åŸºå‡†æµ‹è¯• |
| æ•°æ®åº“æŸ¥è¯¢ | < 100ms | SQLæ€§èƒ½åˆ†æ |
| å†…å­˜å ç”¨ | < 100MB (æœåŠ¡ç«¯) | å†…å­˜åˆ†æ |

#### è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|--------|---------|
| å•å…ƒæµ‹è¯•è¦†ç›–ç‡ | â‰¥ 90% | ä»£ç è¦†ç›–ç‡å·¥å…· |
| é›†æˆæµ‹è¯•é€šè¿‡ç‡ | 100% | CI/CD |
| E2Eæµ‹è¯•é€šè¿‡ç‡ | 100% | è‡ªåŠ¨åŒ–æµ‹è¯• |
| ä»£ç Reviewé€šè¿‡ç‡ | 100% | Code Review |
| Bugå¯†åº¦ | < 1 bug / 1000 LOC | ç¼ºé™·è¿½è¸ª |
| æŠ€æœ¯å€ºåŠ¡ | Low | SonarQube |

#### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|--------|---------|
| ç”¨æˆ·æ»¡æ„åº¦ | â‰¥ 85% | é—®å·è°ƒæŸ¥ |
| è£…å¤‡ç›¸å…³æ“ä½œæ¬¡æ•° | +300% | æ•°æ®ç»Ÿè®¡ |
| å¹³å‡æ¸¸æˆæ—¶é•¿ | +40% | ç”¨æˆ·è¡Œä¸ºåˆ†æ |
| ç©å®¶ç•™å­˜ç‡ | +50% | ç•™å­˜åˆ†æ |

---

## 4. è£…å¤‡ç³»ç»Ÿå®Œæ•´æ¶æ„

### 4.1 ç³»ç»Ÿæ¦‚è§ˆ

```
è£…å¤‡ç³»ç»Ÿæ¶æ„å…¨æ™¯å›¾:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‰ç«¯å±‚ (Blazor)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EquipmentPanel.razor     â”‚  InventoryPanel.razor               â”‚
â”‚  GearEnhancementDialog    â”‚  GearComparisonTooltip             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APIå±‚ (Controllers)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EquipmentController      â”‚  InventoryController               â”‚
â”‚  - GetEquipment           â”‚  - GetGearInventory                â”‚
â”‚  - EquipItem              â”‚  - CompareGear                     â”‚
â”‚  - UnequipItem            â”‚  - SortGear                        â”‚
â”‚  - DisenchantGear         â”‚  - FilterGear                      â”‚
â”‚  - ReforgeGear            â”‚                                    â”‚
â”‚  - RerollAffixes          â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ Serviceè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡å±‚ (Services)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EquipmentService         â”‚  GearGenerationService             â”‚
â”‚  - EquipItem              â”‚  - GenerateGear                    â”‚
â”‚  - UnequipItem            â”‚  - RollRarity                      â”‚
â”‚  - ValidateEquipment      â”‚  - RollBaseStats                   â”‚
â”‚  - SwapGear               â”‚  - GenerateAffixes                 â”‚
â”‚                           â”‚  - CalculateQualityScore           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  StatsAggregationService  â”‚  SetBonusService                   â”‚
â”‚  - CalculateEquipmentStatsâ”‚  - CalculateSetBonuses             â”‚
â”‚  - AggregateStats         â”‚  - GetActiveSetCounts              â”‚
â”‚  - ApplyPipeline          â”‚  - ApplySetEffects                 â”‚
â”‚  - CacheResults           â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DisenchantService        â”‚  ReforgeService                    â”‚
â”‚  - Disenchant             â”‚  - ReforgeTier                     â”‚
â”‚  - CalculateMaterials     â”‚  - CalculateCost                   â”‚
â”‚  - GrantMaterials         â”‚  - ApplyTierModifier               â”‚
â”‚                           â”‚  - RerollAffixes                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ Repositoryè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä»“å‚¨å±‚ (Repositories)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IGearDefinitionRepo      â”‚  IGearInstanceRepo                 â”‚
â”‚  - GetById                â”‚  - GetEquippedGear                 â”‚
â”‚  - GetBySlot              â”‚  - GetGearByCharacter              â”‚
â”‚  - GetAll                 â”‚  - Create / Update / Delete        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IAffixRepository         â”‚  IGearSetRepository                â”‚
â”‚  - GetByPool              â”‚  - GetById                         â”‚
â”‚  - GetAll                 â”‚  - GetAll                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ EF Core
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (Database)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GearDefinitions          â”‚  GearInstances                     â”‚
â”‚  AffixDefinitions         â”‚  GearSets                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é›†æˆç‚¹:
â”œâ”€â”€ Economy (æ‰è½) â†’ GearGenerationService
â”œâ”€â”€ Combat (å±æ€§) â†’ StatsAggregationService
â”œâ”€â”€ Characters (èŒä¸š) â†’ EquipmentService (éªŒè¯)
â””â”€â”€ Buff (å¥—è£…æ•ˆæœ) â†’ SetBonusService
```

---

### 4.2 æ¨¡å—åˆ’åˆ†ä¸èŒè´£

#### Equipment Domain æ ¸å¿ƒæ¨¡å—

```
Domain/Equipment/
â”œâ”€â”€ Models/                           # é¢†åŸŸå®ä½“
â”‚   â”œâ”€â”€ GearDefinition.cs             # è£…å¤‡å®šä¹‰ï¼ˆé…ç½®å®ä½“ï¼‰
â”‚   â”œâ”€â”€ GearInstance.cs               # è£…å¤‡å®ä¾‹ï¼ˆè¿è¡Œæ—¶å®ä½“ï¼‰
â”‚   â”œâ”€â”€ Affix.cs                      # è¯æ¡å®šä¹‰
â”‚   â”œâ”€â”€ AffixInstance.cs              # è¯æ¡å®ä¾‹ï¼ˆå€¼å¯¹è±¡ï¼‰
â”‚   â”œâ”€â”€ GearSet.cs                    # å¥—è£…å®šä¹‰
â”‚   â”œâ”€â”€ EquipmentSlot.cs              # è£…å¤‡æ§½æšä¸¾ï¼ˆ17ä¸ªï¼‰
â”‚   â”œâ”€â”€ ArmorType.cs                  # æŠ¤ç”²ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ WeaponType.cs                 # æ­¦å™¨ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ Rarity.cs                     # ç¨€æœ‰åº¦æšä¸¾
â”‚   â””â”€â”€ TierLevel.cs                  # å“çº§å€¼å¯¹è±¡
â”‚
â”œâ”€â”€ Services/                         # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ GearGenerationService.cs      # è£…å¤‡ç”Ÿæˆæ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ EquipmentService.cs           # è£…å¤‡ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ StatsAggregationService.cs    # å±æ€§èšåˆæœåŠ¡
â”‚   â”œâ”€â”€ DisenchantService.cs          # åˆ†è§£æœåŠ¡
â”‚   â”œâ”€â”€ ReforgeService.cs             # é‡é“¸æœåŠ¡
â”‚   â”œâ”€â”€ SetBonusService.cs            # å¥—è£…åŠ æˆæœåŠ¡
â”‚   â”œâ”€â”€ ArmorCalculator.cs            # æŠ¤ç”²å‡ä¼¤è®¡ç®—å™¨
â”‚   â”œâ”€â”€ BlockCalculator.cs            # æ ¼æŒ¡è®¡ç®—å™¨
â”‚   â””â”€â”€ EquipmentValidator.cs         # è£…å¤‡éªŒè¯å™¨
â”‚
â”œâ”€â”€ Repositories/                     # ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IGearDefinitionRepository.cs
â”‚   â”œâ”€â”€ IGearInstanceRepository.cs
â”‚   â”œâ”€â”€ IAffixRepository.cs
â”‚   â””â”€â”€ IGearSetRepository.cs
â”‚
â”œâ”€â”€ ValueObjects/                     # å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ StatModifier.cs               # å±æ€§ä¿®é¥°ç¬¦
â”‚   â”œâ”€â”€ StatRange.cs                  # å±æ€§èŒƒå›´
â”‚   â””â”€â”€ AffixRoll.cs                  # è¯æ¡Rollç»“æœ
â”‚
â”œâ”€â”€ Events/                           # é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ EquipmentChangedEvent.cs
â”‚   â”œâ”€â”€ GearDisenchantedEvent.cs
â”‚   â”œâ”€â”€ GearReforgedEvent.cs
â”‚   â””â”€â”€ SetBonusActivatedEvent.cs
â”‚
â””â”€â”€ Configuration/                    # é…ç½®ç±»
    â”œâ”€â”€ ArmorTypeConfig.cs
    â”œâ”€â”€ WeaponTypeConfig.cs
    â”œâ”€â”€ EquipmentSlotConfig.cs
    â”œâ”€â”€ ProfessionEquipmentConfig.cs
    â””â”€â”€ CombatMechanicsConfig.cs
```

#### èŒè´£çŸ©é˜µ

| æ¨¡å— | èŒè´£ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| **GearGenerationService** | è£…å¤‡ç”Ÿæˆï¼ˆRollå±æ€§/è¯æ¡ï¼‰ | GearDefId, CharLevel, RNG | GearInstance |
| **EquipmentService** | è£…å¤‡ç®¡ç†ï¼ˆè£…å¤‡/å¸ä¸‹/éªŒè¯ï¼‰ | CharacterId, GearId, Slot | Success/Error |
| **StatsAggregationService** | å±æ€§èšåˆï¼ˆè£…å¤‡â†’æ€»å±æ€§ï¼‰ | CharacterId | EquipmentStats |
| **DisenchantService** | è£…å¤‡åˆ†è§£ï¼ˆè·å–ææ–™ï¼‰ | GearInstanceId | Materials[] |
| **ReforgeService** | å“çº§é‡é“¸/è¯æ¡é‡ç½® | GearInstanceId, Cost | UpdatedGear |
| **SetBonusService** | å¥—è£…åŠ æˆè®¡ç®— | EquippedGear[] | SetBonuses |
| **ArmorCalculator** | æŠ¤ç”²å‡ä¼¤è®¡ç®— | Armor, AttackerLevel | DamageReduction% |
| **BlockCalculator** | æ ¼æŒ¡æ¦‚ç‡/å‡ä¼¤è®¡ç®— | Shield, Strength | BlockChance, BlockReduction |
| **EquipmentValidator** | èŒä¸š/ç­‰çº§/æ§½ä½éªŒè¯ | Character, Gear | Valid/Invalid |

---

### 4.3 æ ¸å¿ƒæµç¨‹è®¾è®¡

#### æµç¨‹1: è£…å¤‡ç”Ÿæˆæµç¨‹

```
è£…å¤‡ç”Ÿæˆæµç¨‹ (GearGenerationService.Generate)

è¾“å…¥: GearDefinitionId, CharacterLevel, RNGContext
è¾“å‡º: GearInstance

æ­¥éª¤:
1. [åŠ è½½å®šä¹‰] ä»Repositoryè·å–GearDefinition
   â”œâ”€â”€ éªŒè¯å®šä¹‰å­˜åœ¨
   â””â”€â”€ åŠ è½½å…è®¸çš„è¯æ¡æ± 

2. [ç¡®å®šç¨€æœ‰åº¦] æ ¹æ®æƒé‡éšæœºï¼ˆCommon/Rare/Epic/Legendaryï¼‰
   â”œâ”€â”€ ä½¿ç”¨RNG.NextWeighted(RarityWeights)
   â””â”€â”€ ç¨€æœ‰åº¦å½±å“åç»­è¯æ¡æ•°é‡

3. [ç¡®å®šå“çº§] é»˜è®¤T1ï¼Œåç»­å¯é€šè¿‡é‡é“¸æå‡
   â””â”€â”€ Tier = 1

4. [è®¡ç®—ç‰©å“ç­‰çº§] åŸºäºè§’è‰²ç­‰çº§å’Œç¨€æœ‰åº¦
   â”œâ”€â”€ ItemLevel = CharacterLevel + RarityBonus
   â””â”€â”€ RarityBonus: Common=0, Rare=2, Epic=5, Legendary=10

5. [RollåŸºç¡€å±æ€§] åœ¨èŒƒå›´å†…éšæœºï¼Œå—Tierå½±å“
   â”œâ”€â”€ For each BaseStat in Definition:
   â”‚   â”œâ”€â”€ Min = BaseStat.Min * TierMultiplier
   â”‚   â”œâ”€â”€ Max = BaseStat.Max * TierMultiplier
   â”‚   â””â”€â”€ RolledValue = RNG.NextDouble(Min, Max)
   â””â”€â”€ TierMultiplier: T1=0.8, T2=1.0, T3=1.2

6. [ç”Ÿæˆè¯æ¡] æ ¹æ®ç¨€æœ‰åº¦å†³å®šæ•°é‡
   â”œâ”€â”€ AffixCount = GetAffixCount(Rarity)
   â”‚   â”œâ”€â”€ Common: 0
   â”‚   â”œâ”€â”€ Rare: RNG.Next(1, 2)
   â”‚   â”œâ”€â”€ Epic: RNG.Next(2, 3)
   â”‚   â””â”€â”€ Legendary: RNG.Next(3, 4)
   â”œâ”€â”€ For i = 1 to AffixCount:
   â”‚   â”œâ”€â”€ ä»å…è®¸çš„è¯æ¡æ± éšæœºé€‰æ‹©ï¼ˆé˜²æ­¢é‡å¤ï¼‰
   â”‚   â”œâ”€â”€ Rollè¯æ¡æ•°å€¼ï¼ˆRNG.NextDouble(Min, Max)ï¼‰
   â”‚   â””â”€â”€ æ·»åŠ åˆ°AffixInstanceåˆ—è¡¨
   â””â”€â”€ è¯æ¡æƒé‡å½±å“æŠ½å–æ¦‚ç‡

7. [è®¡ç®—è£…å¤‡è¯„åˆ†] ç»¼åˆè¯„ä¼°è£…å¤‡å“è´¨
   â”œâ”€â”€ BaseScore = Sum(RolledStats) / Sum(MaxStats) * 100
   â”œâ”€â”€ AffixScore = Sum(AffixValues) / Sum(MaxAffixValues) * 100
   â”œâ”€â”€ RarityBonus = Rarityä¹˜æ•°
   â”œâ”€â”€ TierBonus = Tierä¹˜æ•°
   â””â”€â”€ QualityScore = (BaseScore + AffixScore) * RarityBonus * TierBonus

8. [è¿”å›å®ä¾‹] åˆ›å»ºGearInstance
   â””â”€â”€ GearInstance {
       Id = NewGuid(),
       DefinitionId,
       Rarity,
       TierLevel = 1,
       ItemLevel,
       RolledStats,
       Affixes,
       QualityScore,
       IsEquipped = false,
       IsBound = false,
       CreatedAt = Now
   }
```

#### æµç¨‹2: è£…å¤‡è£…å¤‡æµç¨‹

```
è£…å¤‡è£…å¤‡æµç¨‹ (EquipmentService.EquipItem)

è¾“å…¥: CharacterId, GearInstanceId, Slot
è¾“å‡º: Success/Error

æ­¥éª¤:
1. [åŠ è½½æ•°æ®]
   â”œâ”€â”€ Character = GetCharacter(CharacterId)
   â”œâ”€â”€ GearInstance = GetGearInstance(GearInstanceId)
   â””â”€â”€ GearDefinition = GetGearDefinition(GearInstance.DefinitionId)

2. [éªŒè¯å‰ç½®æ¡ä»¶]
   â”œâ”€â”€ [éªŒè¯è£…å¤‡å­˜åœ¨] GearInstance != null
   â”œâ”€â”€ [éªŒè¯æœªè£…å¤‡] GearInstance.IsEquipped == false
   â”œâ”€â”€ [éªŒè¯å½’å±] GearInstance.CharacterId == CharacterId (åœ¨èƒŒåŒ…ä¸­)
   â””â”€â”€ [éªŒè¯æ§½ä½åŒ¹é…] GearDefinition.Slot == Slot

3. [éªŒè¯è£…å¤‡éœ€æ±‚]
   â”œâ”€â”€ [ç­‰çº§éœ€æ±‚] Character.Level >= GearDefinition.RequiredLevel
   â”œâ”€â”€ [èŒä¸šé™åˆ¶] ValidateProfessionRestriction(Character.Profession, GearInstance)
   â”‚   â”œâ”€â”€ æ£€æŸ¥æŠ¤ç”²ç±»å‹é™åˆ¶
   â”‚   â””â”€â”€ æ£€æŸ¥æ­¦å™¨ç±»å‹é™åˆ¶
   â””â”€â”€ [ç‰¹æ®Šè§„åˆ™] éªŒè¯åŒæ‰‹æ­¦å™¨å ç”¨ã€åŒæŒèƒ½åŠ›ç­‰

4. [å¤„ç†å·²è£…å¤‡ç‰©å“]
   â”œâ”€â”€ CurrentGear = GetEquippedGear(CharacterId, Slot)
   â”œâ”€â”€ If CurrentGear != null:
   â”‚   â”œâ”€â”€ CurrentGear.IsEquipped = false
   â”‚   â”œâ”€â”€ CurrentGear.SlotType = null
   â”‚   â””â”€â”€ ç§»å›èƒŒåŒ…

5. [è£…å¤‡æ–°ç‰©å“]
   â”œâ”€â”€ GearInstance.IsEquipped = true
   â”œâ”€â”€ GearInstance.SlotType = Slot
   â”œâ”€â”€ GearInstance.UpdatedAt = Now
   â””â”€â”€ ä¿å­˜åˆ°æ•°æ®åº“

6. [å¤±æ•ˆç¼“å­˜]
   â”œâ”€â”€ InvalidateEquipmentStatsCache(CharacterId)
   â””â”€â”€ è§¦å‘ EquipmentChangedEvent

7. [è¿”å›ç»“æœ]
   â””â”€â”€ Success { UpdatedGear, PreviousGear }
```

#### æµç¨‹3: è£…å¤‡å±æ€§è®¡ç®—æµç¨‹

```
è£…å¤‡å±æ€§è®¡ç®—æµç¨‹ (StatsAggregationService.CalculateEquipmentStats)

è¾“å…¥: CharacterId
è¾“å‡º: Dictionary<StatType, double> (è£…å¤‡æ€»å±æ€§)

æ­¥éª¤:
1. [æ£€æŸ¥ç¼“å­˜]
   â”œâ”€â”€ CachedStats = GetFromCache(CharacterId)
   â”œâ”€â”€ If CachedStats != null && !Expired:
   â”‚   â””â”€â”€ Return CachedStats
   â””â”€â”€ å¦åˆ™ç»§ç»­è®¡ç®—

2. [åŠ è½½è£…å¤‡]
   â”œâ”€â”€ EquippedGear = Repository.GetEquippedGear(CharacterId)
   â””â”€â”€ æŒ‰æ§½ä½ç»„ç»‡è£…å¤‡

3. [èšåˆåŸºç¡€å±æ€§]
   â”œâ”€â”€ Stats = new Dictionary<StatType, double>()
   â”œâ”€â”€ For each Gear in EquippedGear:
   â”‚   â”œâ”€â”€ For each (Stat, Value) in Gear.RolledStats:
   â”‚   â”‚   â””â”€â”€ Stats[Stat] += Value
   â”‚   â””â”€â”€ æŠ¤ç”²ç±»å‹ç‰¹æ®Šå¤„ç†:
   â”‚       â”œâ”€â”€ If Gear.ArmorType != None:
   â”‚       â”‚   â””â”€â”€ Stats["Armor"] += Gear.BaseArmor
   â”‚       â””â”€â”€ æ­¦å™¨ç±»å‹ç‰¹æ®Šå¤„ç†:
   â”‚           â”œâ”€â”€ Stats["AttackSpeed"] = Gear.BaseAttackSpeed
   â”‚           â””â”€â”€ Stats["AttackPowerMult"] = Gear.AttackPowerMultiplier

4. [èšåˆè¯æ¡å±æ€§]
   â”œâ”€â”€ For each Gear in EquippedGear:
   â”‚   â”œâ”€â”€ For each Affix in Gear.Affixes:
   â”‚   â”‚   â”œâ”€â”€ Value = CalculateAffixValue(Affix)
   â”‚   â”‚   â””â”€â”€ ApplyModifier(Stats, Affix.StatType, Affix.ModifierType, Value)
   â””â”€â”€ ModifierTypeåˆ†ç±»å¤„ç†:
       â”œâ”€â”€ Flat: Stats[StatType] += Value
       â”œâ”€â”€ Percent: è®°å½•ä¹˜æ³•ä¿®é¥°ç¬¦
       â””â”€â”€ Proc: è§¦å‘æ•ˆæœï¼ˆæœªæ¥æ‰©å±•ï¼‰

5. [è®¡ç®—å¥—è£…åŠ æˆ]
   â”œâ”€â”€ SetBonuses = SetBonusService.CalculateSetBonuses(EquippedGear)
   â”œâ”€â”€ For each (Stat, Value) in SetBonuses:
   â”‚   â””â”€â”€ ApplyModifier(Stats, Stat, ModifierType, Value)

6. [åº”ç”¨æ•°å€¼ç®¡çº¿]
   â”œâ”€â”€ For each (Stat, BaseValue) in Stats:
   â”‚   â”œâ”€â”€ AdditiveModifiers = GetAdditiveModifiers(Stat)
   â”‚   â”œâ”€â”€ MultiplicativeModifiers = GetMultiplicativeModifiers(Stat)
   â”‚   â”œâ”€â”€ FinalAdditiveModifiers = GetFinalAdditiveModifiers(Stat)
   â”‚   â””â”€â”€ FinalValue = ApplyPipeline(BaseValue, Additive, Mult, FinalAdd)
   â””â”€â”€ Pipelineå…¬å¼: clamp(((base + Î£Add) * Î (1+Mult)) + Î£FinalAdd)

7. [åº”ç”¨æ•°å€¼ä¸Šé™]
   â”œâ”€â”€ CritChance = Min(CritChance, 1.0)        # æš´å‡»â‰¤100%
   â”œâ”€â”€ ArmorReduction = Min(ArmorReduction, 0.75)  # æŠ¤ç”²å‡ä¼¤â‰¤75%
   â”œâ”€â”€ BlockChance = Min(BlockChance, 0.50)     # æ ¼æŒ¡â‰¤50%
   â””â”€â”€ HastePercent = Max(HastePercent, -0.50)  # æ€¥é€Ÿâ‰¥-50%

8. [ç¼“å­˜ç»“æœ]
   â”œâ”€â”€ CacheStats(CharacterId, Stats, TTL=5åˆ†é’Ÿ)
   â””â”€â”€ Return Stats
```

#### æµç¨‹4: è£…å¤‡æ‰è½æµç¨‹

```
è£…å¤‡æ‰è½æµç¨‹ (ç»æµç³»ç»Ÿé›†æˆ)

è§¦å‘ç‚¹: æˆ˜æ–—ç»“æŸ â†’ EconomyCalculator.ComputeSampled

æ­¥éª¤:
1. [è¯†åˆ«è£…å¤‡æ‰è½]
   â”œâ”€â”€ For each LootEntry in LootTable:
   â”‚   â”œâ”€â”€ If LootEntry.ItemType == "gear":
   â”‚   â”‚   â””â”€â”€ æ ‡è®°ä¸ºè£…å¤‡æ‰è½
   â””â”€â”€ ä½¿ç”¨RNGåˆ¤å®šæ˜¯å¦æ‰è½

2. [ç”Ÿæˆè£…å¤‡]
   â”œâ”€â”€ GearDefId = LootEntry.ItemId
   â”œâ”€â”€ CharacterLevel = Character.Level
   â”œâ”€â”€ RNG = Context.RNG
   â””â”€â”€ GearInstance = GearGenerationService.Generate(GearDefId, CharLevel, RNG)

3. [å†™å…¥èƒŒåŒ…]
   â”œâ”€â”€ CreateInventoryItem {
   â”‚   CharacterId,
   â”‚   ItemType = "gear",
   â”‚   ItemId = GearInstance.Id.ToString(),
   â”‚   Quantity = 1,
   â”‚   AcquiredAt = Now
   â”‚ }
   â””â”€â”€ å…³è”GearInstance.CharacterId = CharacterId

4. [é€šçŸ¥ç©å®¶]
   â”œâ”€â”€ å‘é€è£…å¤‡æ‰è½é€šçŸ¥
   â”œâ”€â”€ å±•ç¤ºè£…å¤‡ä¿¡æ¯ï¼ˆç¨€æœ‰åº¦/å±æ€§/è¯æ¡ï¼‰
   â””â”€â”€ å¯é€‰ï¼šç‰¹æ•ˆåŠ¨ç”»ï¼ˆå²è¯—/ä¼ è¯´è£…å¤‡ï¼‰

5. [è®°å½•æ—¥å¿—]
   â””â”€â”€ Log { GearGenerated, GearDefId, Rarity, Seed, CharacterId }
```

---

(ç»§ç»­ä¸‹ä¸€èŠ‚...)

## 5. è£…å¤‡æ§½ä½ç³»ç»Ÿè®¾è®¡

### 5.1 æ§½ä½æ‰©å±•æ–¹æ¡ˆï¼ˆ9â†’17ä¸ªï¼‰

#### å½“å‰æ§½ä½ï¼ˆ9ä¸ªï¼‰

```
ç°æœ‰æ§½ä½:
1. Head (å¤´ç›”)
2. Weapon (æ­¦å™¨)
3. Chest (èƒ¸ç”²)
4. OffHand (å‰¯æ‰‹)
5. Waist (è…°å¸¦)
6. Legs (è…¿éƒ¨)
7. Feet (é‹å­)
8. Trinket1 (é¥°å“1)
9. Trinket2 (é¥°å“2)
```

#### æ‰©å±•åæ§½ä½ï¼ˆ17ä¸ªï¼‰

```csharp
public enum EquipmentSlot
{
    //é˜²å…·æ§½ä½ (10ä¸ª)
    Head,           // å¤´éƒ¨
    Neck,           // é¢ˆéƒ¨ï¼ˆæ–°å¢ï¼‰
    Shoulder,       // è‚©éƒ¨ï¼ˆæ–°å¢ï¼‰
    Back,           // èƒŒéƒ¨ - æŠ«é£ï¼ˆæ–°å¢ï¼‰
    Chest,          // èƒ¸éƒ¨
    Wrist,          // æ‰‹è…• - æŠ¤è…•ï¼ˆæ–°å¢ï¼‰
    Hands,          // æ‰‹éƒ¨ - æ‰‹å¥—ï¼ˆæ–°å¢ï¼‰
    Waist,          // è…°éƒ¨ - è…°å¸¦
    Legs,           // è…¿éƒ¨
    Feet,           // è„šéƒ¨
    
    // é¥°å“æ§½ä½ (4ä¸ª)
    Finger1,        // ç¬¬ä¸€ä¸ªæˆ’æŒ‡ï¼ˆæ‰©å±•Trinket1ï¼‰
    Finger2,        // ç¬¬äºŒä¸ªæˆ’æŒ‡ï¼ˆæ‰©å±•Trinket2ï¼‰
    Trinket1,       // ç¬¬ä¸€ä¸ªé¥°å“
    Trinket2,       // ç¬¬äºŒä¸ªé¥°å“
    
    // æ­¦å™¨æ§½ä½ (3ä¸ª)
    MainHand,       // ä¸»æ‰‹æ­¦å™¨ï¼ˆåŸWeaponï¼‰
    OffHand,        // å‰¯æ‰‹ï¼ˆæ­¦å™¨æˆ–ç›¾ç‰Œï¼‰
    TwoHand         // åŒæ‰‹æ­¦å™¨ï¼ˆè™šæ‹Ÿæ§½ä½ï¼Œå®é™…å ç”¨ä¸»å‰¯æ‰‹ï¼‰
}
```

#### æ§½ä½åˆ†ç±»

| åˆ†ç±» | æ§½ä½ | æ•°é‡ | è¯´æ˜ |
|-----|------|------|------|
| **é˜²å…·** | Head, Neck, Shoulder, Back, Chest, Wrist, Hands, Waist, Legs, Feet | 10 | å—æŠ¤ç”²ç±»å‹é™åˆ¶ |
| **é¥°å“** | Finger1, Finger2, Trinket1, Trinket2 | 4 | æ— æŠ¤ç”²ç±»å‹ï¼Œçº¯å±æ€§ |
| **æ­¦å™¨** | MainHand, OffHand, TwoHand | 3 | å—æ­¦å™¨ç±»å‹å’ŒèŒä¸šé™åˆ¶ |

#### æ§½ä½å¯è§†åŒ–å¸ƒå±€

```
è£…å¤‡é¢æ¿å¸ƒå±€ï¼ˆæ¨èæ–¹æ¡ˆ - å·¦å³åˆ†æ ï¼‰:

å·¦ä¾§é˜²å…·:                        å³ä¾§é˜²å…·:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸª– Head   â”‚                   â”‚ ğŸ’ Back   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¿ Neck   â”‚                   â”‚ ğŸ‘” Chest  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘” Shoulderâ”‚                  â”‚ ğŸ’ª Wrist  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¦å™¨æ§½ä½ï¼ˆä¸­å¤®ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš”ï¸ MainHandâ”‚ ğŸ”° OffHand â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸‹æ–¹é˜²å…·:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤² Hands  â”‚ âš–ï¸ Waist   â”‚ ğŸ¦µ Legs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ğŸ‘Ÿ Feet   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¥°å“æ§½ä½ï¼ˆåº•éƒ¨ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’ Finger1 â”‚ ğŸ’ Finger2 â”‚ ğŸ’ Trinket1â”‚ ğŸ’ Trinket2â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5.2 æ§½ä½é…ç½®ä¸åˆ†ç±»

#### æ§½ä½é…ç½®ç±»

```csharp
public class EquipmentSlotConfig
{
    public EquipmentSlot Slot { get; set; }
    public string SlotId { get; set; }           // "head", "neck", etc.
    public string DisplayName { get; set; }      // "å¤´éƒ¨", "é¢ˆéƒ¨", etc.
    public string DisplayNameEn { get; set; }    // "Head", "Neck", etc.
    public string Icon { get; set; }             // emoji æˆ–å›¾æ ‡è·¯å¾„
    public SlotCategory Category { get; set; }   // Armor/Jewelry/Weapon
    public bool AllowsArmorType { get; set; }    // æ˜¯å¦å—æŠ¤ç”²ç±»å‹é™åˆ¶
    public bool RequiresWeaponType { get; set; } // æ˜¯å¦éœ€è¦æ­¦å™¨ç±»å‹
    public int DisplayOrder { get; set; }        // UIæ˜¾ç¤ºé¡ºåº
}

public enum SlotCategory
{
    Armor,      // é˜²å…·
    Jewelry,    // é¥°å“
    Weapon      // æ­¦å™¨
}
```

#### æ§½ä½ç‰¹æ€§çŸ©é˜µ

| æ§½ä½ | åˆ†ç±» | æŠ¤ç”²é™åˆ¶ | æ­¦å™¨é™åˆ¶ | ä¸»å±æ€§å€¾å‘ | ç‰¹æ®Šæœºåˆ¶ |
|-----|------|---------|---------|-----------|---------|
| Head | Armor | âœ… | âŒ | å…¨éƒ¨ | - |
| Neck | Jewelry | âŒ | âŒ | å…¨éƒ¨ | æ— æŠ¤ç”²å€¼ |
| Shoulder | Armor | âœ… | âŒ | å…¨éƒ¨ | - |
| Back | Armor | âŒ | âŒ | æ¬¡çº§å±æ€§ | æ— æŠ¤ç”²å€¼/ç‰¹æ®Šè¯æ¡ |
| Chest | Armor | âœ… | âŒ | å…¨éƒ¨ | æŠ¤ç”²å€¼æœ€é«˜ |
| Wrist | Armor | âœ… | âŒ | æ¬¡çº§å±æ€§ | - |
| Hands | Armor | âœ… | âŒ | å…¨éƒ¨ | - |
| Waist | Armor | âœ… | âŒ | æ¬¡çº§å±æ€§ | - |
| Legs | Armor | âœ… | âŒ | å…¨éƒ¨ | æŠ¤ç”²å€¼ç¬¬äºŒ |
| Feet | Armor | âœ… | âŒ | ç§»é€ŸåŠ æˆ | - |
| Finger1/2 | Jewelry | âŒ | âŒ | æ¬¡çº§å±æ€§ | æ— æŠ¤ç”²å€¼ |
| Trinket1/2 | Jewelry | âŒ | âŒ | ç‰¹æ®Šæ•ˆæœ | è§¦å‘æŠ€èƒ½/PROC |
| MainHand | Weapon | âŒ | âœ… | æ”»å‡»å±æ€§ | å†³å®šæ”»å‡»é€Ÿåº¦ |
| OffHand | Weapon | âŒ | âœ… | æ”»å‡»/é˜²å¾¡ | å¯è£…å¤‡æ­¦å™¨æˆ–ç›¾ç‰Œ |
| TwoHand | Weapon | âŒ | âœ… | æ”»å‡»å±æ€§ | å ç”¨ä¸»å‰¯æ‰‹ |

---

### 5.3 åŒæ‰‹æ­¦å™¨å ç”¨æœºåˆ¶

#### å ç”¨è§„åˆ™

```csharp
public class EquipmentSlotOccupancy
{
    public EquipmentSlot PrimarySlot { get; set; }
    public List<EquipmentSlot> OccupiedSlots { get; set; }
    
    // åŒæ‰‹æ­¦å™¨é…ç½®
    public static readonly EquipmentSlotOccupancy TwoHandWeapon = new()
    {
        PrimarySlot = EquipmentSlot.TwoHand,
        OccupiedSlots = new List<EquipmentSlot>
        {
            EquipmentSlot.MainHand,
            EquipmentSlot.OffHand
        }
    };
}
```

#### è£…å¤‡åŒæ‰‹æ­¦å™¨æµç¨‹

```
è£…å¤‡åŒæ‰‹æ­¦å™¨:
1. æ£€æŸ¥ä¸»å‰¯æ‰‹æ˜¯å¦æœ‰è£…å¤‡
2. å¦‚æœæœ‰è£…å¤‡:
   â”œâ”€â”€ å¸ä¸‹ä¸»æ‰‹æ­¦å™¨ â†’ èƒŒåŒ…
   â””â”€â”€ å¸ä¸‹å‰¯æ‰‹æ­¦å™¨/ç›¾ç‰Œ â†’ èƒŒåŒ…
3. è£…å¤‡åŒæ‰‹æ­¦å™¨ â†’ MainHand å’Œ OffHand éƒ½æ ‡è®°ä¸ºå ç”¨
4. UIæ˜¾ç¤º: ä¸»æ‰‹æ˜¾ç¤ºæ­¦å™¨å›¾æ ‡ï¼Œå‰¯æ‰‹æ˜¾ç¤º"å·²è¢«åŒæ‰‹æ­¦å™¨å ç”¨"

å¸ä¸‹åŒæ‰‹æ­¦å™¨:
1. ç§»é™¤åŒæ‰‹æ­¦å™¨ â†’ èƒŒåŒ…
2. MainHand å’Œ OffHand æ§½ä½å˜ä¸ºç©ºé—²
3. ç©å®¶å¯åˆ†åˆ«è£…å¤‡ä¸»æ‰‹å’Œå‰¯æ‰‹
```

#### éªŒè¯é€»è¾‘

```csharp
public class TwoHandWeaponValidator
{
    public bool CanEquipTwoHandWeapon(Character character)
    {
        // æ£€æŸ¥ä¸»å‰¯æ‰‹æ˜¯å¦éƒ½ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥è‡ªåŠ¨å¸ä¸‹
        var mainHand = GetEquippedGear(character, EquipmentSlot.MainHand);
        var offHand = GetEquippedGear(character, EquipmentSlot.OffHand);
        
        // èƒŒåŒ…æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³å¸ä¸‹çš„è£…å¤‡
        return HasInventorySpace(character, 2);
    }
    
    public bool CanEquipOffHand(Character character)
    {
        var mainHand = GetEquippedGear(character, EquipmentSlot.MainHand);
        
        // å¦‚æœä¸»æ‰‹æ˜¯åŒæ‰‹æ­¦å™¨ï¼Œä¸èƒ½è£…å¤‡å‰¯æ‰‹
        if (mainHand != null && mainHand.WeaponType.IsTwoHanded)
        {
            return false;
        }
        
        return true;
    }
}
```

---

## 6. æŠ¤ç”²ç±»å‹ç³»ç»Ÿè®¾è®¡

### 6.1 æŠ¤ç”²ç±»å‹å®šä¹‰

```csharp
public enum ArmorType
{
    None,       // æ— ç±»å‹ï¼ˆé¥°å“ã€æŠ«é£ã€é¢ˆéƒ¨ï¼‰
    Cloth,      // å¸ƒç”²
    Leather,    // çš®ç”²
    Mail,       // é”ç”²
    Plate       // æ¿ç”²
}
```

#### æŠ¤ç”²ç±»å‹é€‚ç”¨æ§½ä½

| æ§½ä½ | é€‚ç”¨æŠ¤ç”²ç±»å‹ | è¯´æ˜ |
|-----|------------|------|
| Head, Shoulder, Chest, Wrist, Hands, Waist, Legs, Feet | Cloth/Leather/Mail/Plate | ä¸»è¦é˜²å…· |
| Neck, Back | None | æ— æŠ¤ç”²ç±»å‹ |
| Finger1/2, Trinket1/2 | None | é¥°å“æ— æŠ¤ç”² |
| MainHand, OffHand, TwoHand | None | æ­¦å™¨æ— æŠ¤ç”² |

---

### 6.2 æŠ¤ç”²ç‰¹æ€§ä¸å¹³è¡¡

#### æŠ¤ç”²ç±»å‹é…ç½®

```csharp
public class ArmorTypeConfig
{
    public ArmorType Type { get; set; }
    public string TypeId { get; set; }
    public string DisplayName { get; set; }
    
    // åŸºç¡€å±æ€§ç³»æ•°
    public double BaseArmorMultiplier { get; set; }  // åŸºç¡€æŠ¤ç”²å€ç‡
    public double StaminaMultiplier { get; set; }    // è€åŠ›åŠ æˆå€ç‡
    
    // æ¬¡çº§å±æ€§å€¾å‘ï¼ˆç”¨äºè£…å¤‡ç”Ÿæˆæ—¶æƒé‡ï¼‰
    public Dictionary<string, double> SecondaryStatWeights { get; set; }
    
    // é€‚ç”¨æ§½ä½
    public List<EquipmentSlot> ApplicableSlots { get; set; }
}
```

#### æŠ¤ç”²ç±»å‹ç‰¹æ€§è¡¨

| æŠ¤ç”²ç±»å‹ | æŠ¤ç”²ç³»æ•° | è€åŠ›ç³»æ•° | ä¸»å±æ€§å€¾å‘ | é€‚ç”¨èŒä¸šç¤ºä¾‹ | ç‰¹è‰² |
|---------|---------|---------|-----------|-------------|------|
| **None** | 0.0 | 1.0 | - | æ‰€æœ‰èŒä¸š | é¥°å“ã€æŠ«é£ã€é¢ˆéƒ¨ |
| **Cloth (å¸ƒç”²)** | 0.5 | 1.0 | Intellect é«˜ | æ³•å¸ˆã€ç‰§å¸ˆ | é«˜æ³•æœ¯å¼ºåº¦ï¼Œä½æŠ¤ç”² |
| **Leather (çš®ç”²)** | 1.0 | 1.1 | Agility é«˜ | ç›—è´¼ã€å¾·é²ä¼Š | å¹³è¡¡å‹ï¼Œé—ªé¿åŠ æˆ |
| **Mail (é”ç”²)** | 1.5 | 1.3 | Agility/Intellect | çŒäººã€è¨æ»¡ | ä¸­ç­‰æŠ¤ç”²ï¼Œçµæ´»æ€§ |
| **Plate (æ¿ç”²)** | 2.0 | 1.5 | Strength/Stamina é«˜ | æˆ˜å£«ã€åœ£éª‘å£« | é«˜æŠ¤ç”²ï¼Œé«˜ç”Ÿå­˜ |

#### æŠ¤ç”²ç±»å‹æ¬¡çº§å±æ€§å€¾å‘

```json
{
  "ArmorTypes": [
    {
      "TypeId": "cloth",
      "SecondaryStatWeights": {
        "Intellect": 1.5,
        "SpellPower": 1.3,
        "Spirit": 1.2,
        "CritChance": 1.0
      }
    },
    {
      "TypeId": "leather",
      "SecondaryStatWeights": {
        "Agility": 1.4,
        "AttackPower": 1.2,
        "CritChance": 1.3,
        "Dodge": 1.2
      }
    },
    {
      "TypeId": "mail",
      "SecondaryStatWeights": {
        "Agility": 1.3,
        "Intellect": 1.2,
        "AttackPower": 1.1,
        "SpellPower": 1.1
      }
    },
    {
      "TypeId": "plate",
      "SecondaryStatWeights": {
        "Strength": 1.5,
        "Stamina": 1.4,
        "Block": 1.3,
        "Parry": 1.2
      }
    }
  ]
}
```

---

### 6.3 æŠ¤ç”²å‡ä¼¤æœºåˆ¶

#### æŠ¤ç”²å‡ä¼¤å…¬å¼

```csharp
public class ArmorDamageReduction
{
    /// <summary>
    /// è®¡ç®—æŠ¤ç”²å‡ä¼¤ç™¾åˆ†æ¯”
    /// å…¬å¼: DamageReduction% = Armor / (Armor + K Ã— AttackerLevel)
    /// å…¶ä¸­ K æ˜¯å¸¸æ•°ï¼Œç”¨äºæ§åˆ¶æŠ¤ç”²æ•ˆæœï¼ˆé»˜è®¤400ï¼‰
    /// </summary>
    public static double CalculateReduction(
        double armor, 
        int attackerLevel, 
        double k = 400)
    {
        if (armor <= 0) return 0;
        
        double reduction = armor / (armor + k * attackerLevel);
        
        // æŠ¤ç”²å‡ä¼¤ä¸Šé™ 75%
        return Math.Min(reduction, 0.75);
    }
    
    /// <summary>
    /// åº”ç”¨æŠ¤ç”²å‡ä¼¤åˆ°ä¼¤å®³
    /// </summary>
    public static int ApplyArmorReduction(
        int rawDamage, 
        double armorReduction)
    {
        return (int)Math.Ceiling(rawDamage * (1.0 - armorReduction));
    }
}
```

#### æŠ¤ç”²å‡ä¼¤æ•°å€¼è¡¨

| æŠ¤ç”²å€¼ | vs Lv10æ•Œäºº | vs Lv30æ•Œäºº | vs Lv50æ•Œäºº | è¯´æ˜ |
|-------|------------|------------|------------|------|
| 100 | 20.0% | 11.1% | 4.8% | å¸ƒç”²åˆæœŸ |
| 300 | 42.9% | 27.3% | 13.0% | çš®ç”²ä¸­æœŸ |
| 600 | 60.0% | 42.9% | 23.1% | é”ç”²åæœŸ |
| 1000 | 71.4% | 55.6% | 33.3% | æ¿ç”²ä¸­æœŸ |
| 2000 | **75.0% â†‘** | 71.4% | 50.0% | æ¿ç”²åæœŸï¼ˆè¾¾ä¸Šé™ï¼‰ |

**è®¾è®¡åŸåˆ™**:
- åŒç­‰çº§æŠ¤ç”²çº¦æä¾›40-50%å‡ä¼¤
- é«˜ç­‰çº§æ•Œäººä½¿æŠ¤ç”²æ•ˆæœé€’å‡
- 75%ä¸Šé™é˜²æ­¢æ— æ•Œ
- æŠ¤ç”²ç©¿é€å¯é™ä½æœ‰æ•ˆæŠ¤ç”²

#### æŠ¤ç”²å€¼è®¡ç®—å…¬å¼

```
ç‰©å“æŠ¤ç”²å€¼ = åŸºç¡€æŠ¤ç”²å€¼ Ã— æŠ¤ç”²ç±»å‹ç³»æ•° Ã— ç‰©å“ç­‰çº§ç³»æ•° Ã— å“çº§ç³»æ•°

ä¾‹å¦‚:
- T1å¸ƒç”²èƒ¸ç”²ï¼ˆç‰©å“ç­‰çº§30ï¼‰:
  BaseArmor(10) Ã— Cloth(0.5) Ã— iLvl(30/10) Ã— Tier(0.8) = 12
  
- T2æ¿ç”²èƒ¸ç”²ï¼ˆç‰©å“ç­‰çº§30ï¼‰:
  BaseArmor(10) Ã— Plate(2.0) Ã— iLvl(30/10) Ã— Tier(1.0) = 60
  
- T3æ¿ç”²èƒ¸ç”²ï¼ˆç‰©å“ç­‰çº§50ï¼‰:
  BaseArmor(10) Ã— Plate(2.0) Ã— iLvl(50/10) Ã— Tier(1.2) = 120
```

#### æŠ¤ç”²æ¥æº

1. **è£…å¤‡æŠ¤ç”²**: å„éƒ¨ä½è£…å¤‡æä¾›çš„æŠ¤ç”²å€¼æ€»å’Œ
2. **ä¸»å±æ€§åŠ æˆ**: Agility å¯æä¾›å°‘é‡æŠ¤ç”²ï¼ˆæ¯ç‚¹æ•æ· +0.5æŠ¤ç”²ï¼‰
3. **BuffåŠ æˆ**: æŠ€èƒ½å’ŒBuffå¯ä¸´æ—¶å¢åŠ æŠ¤ç”²
4. **èŒä¸šæŠ€èƒ½**: æŸäº›èŒä¸šæœ‰æŠ¤ç”²åŠ æˆæŠ€èƒ½

#### æœ‰æ•ˆæŠ¤ç”²è®¡ç®—

```
æœ‰æ•ˆæŠ¤ç”² = (æ€»æŠ¤ç”² - å›ºå®šç©¿é€) Ã— (1 - ç™¾åˆ†æ¯”ç©¿é€)

ä¾‹å¦‚:
- æ€»æŠ¤ç”² 1000
- æ•Œäººå›ºå®šç©¿é€ 200
- æ•Œäººç™¾åˆ†æ¯”ç©¿é€ 20%
- æœ‰æ•ˆæŠ¤ç”² = (1000 - 200) Ã— (1 - 0.20) = 640
```

---

## 7. æ­¦å™¨ç±»å‹ç³»ç»Ÿè®¾è®¡

### 7.1 æ­¦å™¨ç±»å‹åˆ†ç±»

```csharp
public enum WeaponType
{
    // æ— ç±»å‹
    None,           // éæ­¦å™¨ï¼ˆé˜²å…·ã€é¥°å“ï¼‰
    
    // å•æ‰‹è¿‘æˆ˜æ­¦å™¨
    Sword,          // å‰‘
    Dagger,         // åŒ•é¦–
    Axe,            // æ–§
    Mace,           // é”¤
    Fist,           // æ‹³å¥—
    
    // è¿œç¨‹å•æ‰‹
    Wand,           // é­”æ–
    
    // åŒæ‰‹æ­¦å™¨
    TwoHandSword,   // åŒæ‰‹å‰‘
    TwoHandAxe,     // åŒæ‰‹æ–§
    TwoHandMace,    // åŒæ‰‹é”¤
    Staff,          // æ³•æ–
    Polearm,        // é•¿æŸ„æ­¦å™¨
    
    // è¿œç¨‹æ­¦å™¨
    Bow,            // å¼“
    Crossbow,       // å¼©
    Gun,            // æª
    
    // å‰¯æ‰‹ä¸“ç”¨
    Shield          // ç›¾ç‰Œ
}
```

---

### 7.2 æ”»å‡»é€Ÿåº¦ä¸ä¼¤å®³å€ç‡

#### æ­¦å™¨ç±»å‹é…ç½®

```csharp
public class WeaponTypeConfig
{
    public WeaponType Type { get; set; }
    public string TypeId { get; set; }
    public string DisplayName { get; set; }
    
    // åŸºç¡€æ”»å‡»å±æ€§
    public double BaseAttackSpeed { get; set; }      // åŸºç¡€æ”»å‡»é€Ÿåº¦ï¼ˆç§’/æ¬¡ï¼‰
    public double AttackPowerMultiplier { get; set; } // æ”»å‡»å€ç‡
    
    // æ­¦å™¨æ§½ä½é™åˆ¶
    public List<EquipmentSlot> AllowedSlots { get; set; }
    
    // ä¼¤å®³ç±»å‹å€¾å‘
    public DamageType PrimaryDamageType { get; set; }
    
    // ç‰¹æ®Šæœºåˆ¶
    public bool AllowsDualWield { get; set; }        // æ˜¯å¦å¯åŒæŒ
    public bool IsRangedWeapon { get; set; }         // æ˜¯å¦è¿œç¨‹æ­¦å™¨
    public bool IsTwoHanded { get; set; }            // æ˜¯å¦åŒæ‰‹æ­¦å™¨
}
```

#### æ­¦å™¨ç±»å‹æ•°å€¼è®¾è®¡

**åŸºå‡†**: æ ‡å‡†å•æ‰‹å‰‘ = æ”»å‡»é€Ÿåº¦ 2.5s/æ¬¡ï¼Œæ”»å‡»å€ç‡ 1.0

| æ­¦å™¨ç±»å‹ | æ”»å‡»é€Ÿåº¦ | æ”»å‡»å€ç‡ | DPSç³»æ•° | ç‰¹ç‚¹ | é€‚ç”¨èŒä¸š |
|---------|---------|---------|---------|------|---------|
| **Sword (å‰‘)** | 2.5s | 1.00 | 0.40 | åŸºå‡†æ­¦å™¨ï¼Œå¹³è¡¡ | æˆ˜å£«ã€æ¸¸ä¾ ã€ç›—è´¼ |
| **Dagger (åŒ•é¦–)** | 1.8s | 0.72 | 0.40 | å¿«é€Ÿï¼Œä½ä¼¤å®³ | ç›—è´¼ |
| **Axe (æ–§)** | 2.8s | 1.12 | 0.40 | æ…¢é€Ÿï¼Œé«˜ä¼¤å®³ | æˆ˜å£« |
| **Mace (é”¤)** | 2.6s | 1.04 | 0.40 | å¹³è¡¡åæ…¢ | æˆ˜å£«ã€ç‰§å¸ˆã€è¨æ»¡ |
| **Fist (æ‹³å¥—)** | 2.0s | 0.80 | 0.40 | å¿«é€Ÿè¿‘æˆ˜ | æ­¦åƒ§ |
| **Wand (é­”æ–)** | 2.0s | 0.60 | 0.30 | æ³•æœ¯æ­¦å™¨ï¼Œä½ç‰©ç†ä¼¤å®³ | æ³•å¸ˆã€ç‰§å¸ˆ |
| **TwoHandSword (åŒæ‰‹å‰‘)** | 3.5s | 1.75 | 0.50 | æ…¢é€Ÿï¼Œé«˜ä¼¤å®³ | æˆ˜å£« |
| **TwoHandAxe (åŒæ‰‹æ–§)** | 3.8s | 1.90 | 0.50 | æœ€æ…¢ï¼Œæœ€é«˜ä¼¤å®³ | æˆ˜å£« |
| **TwoHandMace (åŒæ‰‹é”¤)** | 3.6s | 1.80 | 0.50 | æ…¢é€Ÿå¼ºåŠ› | æˆ˜å£«ã€åœ£éª‘å£« |
| **Staff (æ³•æ–)** | 3.2s | 1.12 | 0.35 | æ³•æœ¯åŒæ‰‹æ­¦å™¨ | æ³•å¸ˆã€å¾·é²ä¼Š |
| **Polearm (é•¿æŸ„)** | 3.4s | 1.70 | 0.50 | è¿œç¨‹åŒæ‰‹æ­¦å™¨ | æˆ˜å£«ã€çŒäºº |
| **Bow (å¼“)** | 3.0s | 1.50 | 0.50 | è¿œç¨‹æ­¦å™¨ | çŒäººã€æ¸¸ä¾  |
| **Crossbow (å¼©)** | 3.6s | 1.80 | 0.50 | æ…¢é€Ÿè¿œç¨‹ | æ¸¸ä¾  |
| **Gun (æª)** | 3.2s | 1.60 | 0.50 | æœºæ¢°è¿œç¨‹ | çŒäºº |
| **Shield (ç›¾ç‰Œ)** | - | - | - | é˜²å¾¡å‰¯æ‰‹ï¼Œæä¾›æ ¼æŒ¡ | æˆ˜å£«ã€åœ£éª‘å£« |

**DPSç³»æ•°** = æ”»å‡»å€ç‡ / æ”»å‡»é€Ÿåº¦  
ä¿æŒç›¸è¿‘ä»¥ç¡®ä¿ä¸åŒæ­¦å™¨ç±»å‹å¹³è¡¡

---

### 7.3 åŒæŒæœºåˆ¶

#### åŒæŒè®¡ç®—å…¬å¼

```csharp
public class DualWieldCalculation
{
    // å¹³å‡æ”»å‡»é€Ÿåº¦
    public double AverageSpeed => (MainHandSpeed + OffHandSpeed) / 2.0;
    
    // æ€»æ”»å‡»åŠ› = (ä¸»æ‰‹ + å‰¯æ‰‹) Ã— åŒæŒç³»æ•°
    public double TotalAttackPower => 
        (MainHandAP + OffHandAP) * DualWieldCoefficient;
    
    // åŒæŒç³»æ•°ï¼ˆé»˜è®¤ 0.85ï¼Œé¿å…åŒæŒè¿‡å¼ºï¼‰
    public const double DualWieldCoefficient = 0.85;
    
    // åŒæŒå‘½ä¸­æƒ©ç½šï¼ˆé¢å¤–19%Missï¼‰
    public const double DualWieldMissPenalty = 0.19;
}
```

#### åŒæŒæ­¦å™¨éªŒè¯

```csharp
public class DualWieldValidator
{
    public bool CanDualWield(Character character)
    {
        // æ£€æŸ¥èŒä¸šæ˜¯å¦å…è®¸åŒæŒ
        var professionConfig = GetProfessionConfig(character.Profession);
        return professionConfig.CanDualWield;
    }
    
    public bool IsValidDualWieldCombination(
        GearInstance mainHand, 
        GearInstance offHand)
    {
        // ä¸»æ‰‹å¿…é¡»æ˜¯å•æ‰‹æ­¦å™¨
        if (mainHand.WeaponType.IsTwoHanded)
            return false;
            
        // å‰¯æ‰‹å¿…é¡»æ˜¯å•æ‰‹æ­¦å™¨ä¸”å…è®¸åŒæŒ
        if (!offHand.WeaponType.AllowsDualWield)
            return false;
            
        // ç›¾ç‰Œä¸èƒ½ä½œä¸ºå‰¯æ‰‹æ­¦å™¨ï¼ˆåŒæŒåœºæ™¯ï¼‰
        if (offHand.WeaponType == WeaponType.Shield)
            return false;
            
        return true;
    }
}
```

---

### 7.4 æ ¼æŒ¡æœºåˆ¶ï¼ˆç›¾ç‰Œï¼‰

#### æ ¼æŒ¡é…ç½®

```csharp
public class BlockMechanicsConfig
{
    // åŸºç¡€æ ¼æŒ¡ç‡ï¼ˆè£…å¤‡ç›¾ç‰Œæ—¶ï¼‰
    public double BaseBlockChance { get; set; } = 0.05;  // 5%
    
    // æ ¼æŒ¡å‡ä¼¤ç™¾åˆ†æ¯”
    public double BlockDamageReduction { get; set; } = 0.30;  // 30%
    
    // å±æ€§åŠ æˆ
    public double BlockChancePerStrength { get; set; } = 0.001;  // æ¯ç‚¹åŠ›é‡ +0.1%
    public double BlockChancePerItemLevel { get; set; } = 0.002; // æ¯ç‚¹è£…ç­‰ +0.2%
    
    // æ ¼æŒ¡ç‡ä¸Šé™
    public double MaxBlockChance { get; set; } = 0.50;  // 50%
}
```

#### æ ¼æŒ¡è®¡ç®—

```csharp
public class BlockCalculator
{
    /// <summary>
    /// è®¡ç®—æ ¼æŒ¡æ¦‚ç‡
    /// </summary>
    public static double CalculateBlockChance(
        bool hasShield,
        double baseBlockChance,
        int strength,
        int shieldItemLevel,
        BlockMechanicsConfig config)
    {
        if (!hasShield) return 0;
        
        double blockChance = baseBlockChance;
        blockChance += strength * config.BlockChancePerStrength;
        blockChance += shieldItemLevel * config.BlockChancePerItemLevel;
        
        return Math.Min(blockChance, config.MaxBlockChance);
    }
    
    /// <summary>
    /// åº”ç”¨æ ¼æŒ¡å‡ä¼¤
    /// </summary>
    public static int ApplyBlockReduction(
        int rawDamage, 
        double blockReduction)
    {
        return (int)Math.Ceiling(rawDamage * (1.0 - blockReduction));
    }
}
```

#### æ ¼æŒ¡è§¦å‘æµç¨‹

```
æˆ˜æ–—ä¼¤å®³è®¡ç®—æµç¨‹ï¼ˆå«æ ¼æŒ¡ï¼‰:
1. æ•Œäººæ”»å‡»å‘½ä¸­
2. åˆ¤å®šæ ¼æŒ¡ï¼ˆRandom < BlockChanceï¼‰
3. If æ ¼æŒ¡æˆåŠŸ:
   â”œâ”€â”€ ä¼¤å®³ Ã— (1 - BlockDamageReduction)
   â”œâ”€â”€ è®°å½•æ ¼æŒ¡äº‹ä»¶åˆ°SegmentCollector
   â””â”€â”€ æ˜¾ç¤º"æ ¼æŒ¡ï¼"æç¤º
4. Else æ ¼æŒ¡å¤±è´¥:
   â””â”€â”€ ç»§ç»­æ­£å¸¸æŠ¤ç”²å‡ä¼¤è®¡ç®—
5. æœ€ç»ˆä¼¤å®³åº”ç”¨
```

---

## 8. èŒä¸šè£…å¤‡é™åˆ¶ç³»ç»Ÿ

### 8.1 èŒä¸š-è£…å¤‡å…¼å®¹æ€§

#### èŒä¸šé…ç½®

```csharp
public class ProfessionEquipmentConfig
{
    public string ProfessionId { get; set; }
    public string DisplayName { get; set; }
    
    // å¯è£…å¤‡çš„æŠ¤ç”²ç±»å‹ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
    public List<ArmorType> AllowedArmorTypes { get; set; }
    
    // å¯è£…å¤‡çš„æ­¦å™¨ç±»å‹
    public List<WeaponType> AllowedWeaponTypes { get; set; }
    
    // æ˜¯å¦å¯åŒæŒ
    public bool CanDualWield { get; set; }
    
    // ç‰¹æ®Šé™åˆ¶
    public Dictionary<string, bool> SpecialRules { get; set; }
}
```

#### èŒä¸šè£…å¤‡å…¼å®¹æ€§çŸ©é˜µ

| èŒä¸š | æŠ¤ç”²ç±»å‹ | å¯ç”¨æ­¦å™¨ | åŒæŒ | ç‰¹æ®Šè§„åˆ™ |
|-----|---------|---------|------|---------|
| **æˆ˜å£« (Warrior)** | Plate, Mail, Leather, Cloth | Sword, Axe, Mace, TwoHandSword, TwoHandAxe, TwoHandMace, Polearm, Shield | âœ… | å¯è£…å¤‡æ‰€æœ‰è¿‘æˆ˜æ­¦å™¨ |
| **æ¸¸ä¾  (Ranger)** | Mail, Leather, Cloth | Sword, Dagger, Axe, Bow, Crossbow, Gun | âœ… | è¿œç¨‹æ­¦å™¨ä¸“ç²¾ |
| **æ³•å¸ˆ (Mage)** | Cloth | Dagger, Wand, Staff | âŒ | ä»…æ³•ç³»æ­¦å™¨ |
| **ç›—è´¼ (Rogue)** | Leather, Cloth | Dagger, Sword, Fist, Bow, Crossbow | âœ… | å¿«é€Ÿæ­¦å™¨ä¸“ç²¾ |
| **ç‰§å¸ˆ (Priest)** | Cloth | Mace, Wand, Staff | âŒ | æ²»ç–—èŒä¸š |
| **è¨æ»¡ (Shaman)** | Mail, Leather, Cloth | Mace, Axe, Staff, Shield | âŒ | å…ƒç´ /å¢å¼ºåŒä¿® |
| **åœ£éª‘å£« (Paladin)** | Plate, Mail, Leather, Cloth | Sword, Mace, TwoHandSword, TwoHandMace, Polearm, Shield | âŒ | ç›¾ç‰Œä¸“ç²¾ |

---

### 8.2 è£…å¤‡éªŒè¯æœºåˆ¶

```csharp
public class EquipmentValidator
{
    /// <summary>
    /// éªŒè¯èŒä¸šæ˜¯å¦å¯è£…å¤‡è¯¥ç‰©å“
    /// </summary>
    public static ValidationResult CanEquip(
        Character character,
        GearInstance gear)
    {
        var config = GetProfessionConfig(character.Profession);
        var gearDef = GetGearDefinition(gear.DefinitionId);
        
        // 1. æ£€æŸ¥ç­‰çº§éœ€æ±‚
        if (character.Level < gearDef.RequiredLevel)
        {
            return ValidationResult.Fail(
                $"éœ€è¦ç­‰çº§ {gearDef.RequiredLevel}");
        }
        
        // 2. æ£€æŸ¥æŠ¤ç”²ç±»å‹é™åˆ¶
        if (gear.ArmorType != ArmorType.None && 
            !config.AllowedArmorTypes.Contains(gear.ArmorType))
        {
            return ValidationResult.Fail(
                $"{config.DisplayName}æ— æ³•è£…å¤‡{gear.ArmorType}ç±»å‹æŠ¤ç”²");
        }
        
        // 3. æ£€æŸ¥æ­¦å™¨ç±»å‹é™åˆ¶
        if (gear.WeaponType != WeaponType.None && 
            !config.AllowedWeaponTypes.Contains(gear.WeaponType))
        {
            return ValidationResult.Fail(
                $"{config.DisplayName}æ— æ³•è£…å¤‡{gear.WeaponType}ç±»å‹æ­¦å™¨");
        }
        
        // 4. æ£€æŸ¥åŒæŒèƒ½åŠ›
        if (IsOffHandWeapon(gear) && 
            !config.CanDualWield)
        {
            return ValidationResult.Fail(
                $"{config.DisplayName}æ— æ³•åŒæŒæ­¦å™¨");
        }
        
        // 5. æ£€æŸ¥æ§½ä½åŒ¹é…
        // (æ­¤å¤„çœç•¥ï¼Œåœ¨EquipmentServiceä¸­å¤„ç†)
        
        return ValidationResult.Success();
    }
}
```

---

## 9. é¢†åŸŸæ¨¡å‹è¯¦ç»†è®¾è®¡

### 9.1 è£…å¤‡å®šä¹‰ï¼ˆGearDefinitionï¼‰

```csharp
/// <summary>
/// è£…å¤‡å®šä¹‰ï¼ˆé…ç½®å®ä½“ï¼‰
/// å­˜å‚¨åœ¨æ•°æ®åº“æˆ–JSONé…ç½®æ–‡ä»¶ä¸­
/// </summary>
public class GearDefinition
{
    public string Id { get; set; }                    // å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "sword_iron"
    public string Name { get; set; }                  // æ˜¾ç¤ºåç§°
    public string Icon { get; set; }                  // å›¾æ ‡emojiæˆ–URL
    public EquipmentSlot Slot { get; set; }           // è£…å¤‡æ§½ä½
    public ArmorType ArmorType { get; set; }          // æŠ¤ç”²ç±»å‹
    public WeaponType WeaponType { get; set; }        // æ­¦å™¨ç±»å‹
    public int RequiredLevel { get; set; }            // éœ€æ±‚ç­‰çº§
    
    // åŸºç¡€å±æ€§èŒƒå›´
    public Dictionary<StatType, StatRange> BaseStats { get; set; }
    
    // å…è®¸çš„è¯æ¡æ± 
    public List<string> AllowedAffixPool { get; set; }
    
    // ç¨€æœ‰åº¦æƒé‡
    public Dictionary<Rarity, double> RarityWeights { get; set; }
    
    // å¥—è£…ID
    public string? SetId { get; set; }
    
    // æ—¶é—´æˆ³
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

/// <summary>
/// å±æ€§èŒƒå›´
/// </summary>
public class StatRange
{
    public double Min { get; set; }
    public double Max { get; set; }
}
```

---

### 9.2 è£…å¤‡å®ä¾‹ï¼ˆGearInstanceï¼‰

```csharp
/// <summary>
/// è£…å¤‡å®ä¾‹ï¼ˆè¿è¡Œæ—¶å®ä½“ï¼‰
/// æ¯ä¸ªè£…å¤‡å®ä¾‹éƒ½æ˜¯å”¯ä¸€çš„ï¼ŒåŒ…å«Rollåçš„å±æ€§
/// </summary>
public class GearInstance
{
    public Guid Id { get; set; }                      // å®ä¾‹ID
    public string DefinitionId { get; set; }          // å…³è”GearDefinition
    public Guid? CharacterId { get; set; }            // æ‰€å±è§’è‰²ï¼Œnullè¡¨ç¤ºåœ¨èƒŒåŒ…
    public EquipmentSlot? SlotType { get; set; }      // è£…å¤‡ä½ç½®ï¼Œnullè¡¨ç¤ºæœªè£…å¤‡
    
    // è£…å¤‡å“è´¨
    public Rarity Rarity { get; set; }                // ç¨€æœ‰åº¦
    public int TierLevel { get; set; }                // å“çº§ï¼ˆ1-3ï¼‰
    public int ItemLevel { get; set; }                // ç‰©å“ç­‰çº§
    
    // å·²Rollçš„å±æ€§
    public Dictionary<StatType, double> RolledStats { get; set; }
    
    // è¯æ¡åˆ—è¡¨
    public List<AffixInstance> Affixes { get; set; }
    
    // è¯„åˆ†
    public int QualityScore { get; set; }             // è£…å¤‡è¯„åˆ†
    
    // çŠ¶æ€
    public bool IsEquipped { get; set; }              // æ˜¯å¦å·²è£…å¤‡
    public bool IsBound { get; set; }                 // æ˜¯å¦ç»‘å®š
    public int RerollCount { get; set; }              // è¯æ¡é‡ç½®æ¬¡æ•°
    
    // æ—¶é—´æˆ³
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    
    // å¯¼èˆªå±æ€§
    public Character? Character { get; set; }
    public GearDefinition Definition { get; set; }
}
```

---

### 9.3 è¯æ¡ç³»ç»Ÿï¼ˆAffixï¼‰

#### è¯æ¡å®šä¹‰

```csharp
/// <summary>
/// è¯æ¡å®šä¹‰ï¼ˆé…ç½®ï¼‰
/// </summary>
public class Affix
{
    public string Id { get; set; }                    // å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "affix_strength"
    public string Name { get; set; }                  // æ˜¾ç¤ºåç§°ï¼Œå¦‚ "åŠ›é‡"
    public StatType StatType { get; set; }            // å½±å“çš„å±æ€§ç±»å‹
    public ModifierType ModifierType { get; set; }    // ä¿®é¥°ç¬¦ç±»å‹
    public double ValueMin { get; set; }              // æ•°å€¼èŒƒå›´æœ€å°
    public double ValueMax { get; set; }              // æ•°å€¼èŒƒå›´æœ€å¤§
    public double RarityWeight { get; set; }          // ç¨€æœ‰åº¦æƒé‡ï¼ˆè¶Šä½è¶Šç¨€æœ‰ï¼‰
    
    // æ§½ä½é™åˆ¶
    public List<EquipmentSlot>? AllowedSlots { get; set; }  // nullè¡¨ç¤ºå…¨éƒ¨
    
    // æ—¶é—´æˆ³
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

/// <summary>
/// ä¿®é¥°ç¬¦ç±»å‹
/// </summary>
public enum ModifierType
{
    Flat,       // å›ºå®šå€¼åŠ æˆï¼Œå¦‚ +15 åŠ›é‡
    Percent,    // ç™¾åˆ†æ¯”åŠ æˆï¼Œå¦‚ +5% æš´å‡»
    Proc        // è§¦å‘æ•ˆæœï¼ˆæœªæ¥æ‰©å±•ï¼‰
}
```

#### è¯æ¡å®ä¾‹

```csharp
/// <summary>
/// è¯æ¡å®ä¾‹ï¼ˆå€¼å¯¹è±¡ï¼‰
/// é™„ç€åœ¨GearInstanceä¸Š
/// </summary>
public class AffixInstance
{
    public string AffixId { get; set; }               // è¯æ¡å®šä¹‰ID
    public StatType StatType { get; set; }            // å½±å“çš„å±æ€§
    public ModifierType ModifierType { get; set; }    // ä¿®é¥°ç¬¦ç±»å‹
    public double RolledValue { get; set; }           // å·²Rollçš„æ•°å€¼
    public string DisplayText { get; set; }           // æ˜¾ç¤ºæ–‡æœ¬ï¼Œå¦‚ "+15 åŠ›é‡"
}
```

---

### 9.4 å¥—è£…ç³»ç»Ÿï¼ˆGearSetï¼‰

```csharp
/// <summary>
/// å¥—è£…å®šä¹‰
/// </summary>
public class GearSet
{
    public string Id { get; set; }                    // å¥—è£…IDï¼Œå¦‚ "set_warrior"
    public string Name { get; set; }                  // å¥—è£…åç§°
    
    // å¥—è£…è£…å¤‡åˆ—è¡¨
    public List<string> Pieces { get; set; }          // è£…å¤‡å®šä¹‰IDåˆ—è¡¨
    
    // å¥—è£…åŠ æˆï¼ˆä»¶æ•° -> åŠ æˆåˆ—è¡¨ï¼‰
    public Dictionary<int, List<StatModifier>> Bonuses { get; set; }
    // ä¾‹å¦‚: { 2: [+100 HP], 4: [+5% Crit], 6: [ç‰¹æ®Šæ•ˆæœ] }
    
    // æ—¶é—´æˆ³
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

/// <summary>
/// å±æ€§ä¿®é¥°ç¬¦ï¼ˆå€¼å¯¹è±¡ï¼‰
/// </summary>
public class StatModifier
{
    public StatType StatType { get; set; }
    public ModifierType ModifierType { get; set; }
    public double Value { get; set; }
}
```

---

## 10. æ•°æ®åº“è®¾è®¡

### 10.1 è¡¨ç»“æ„è®¾è®¡

#### GearDefinitions è¡¨

```sql
CREATE TABLE GearDefinitions (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "sword_iron"
    Name VARCHAR(200) NOT NULL,               -- æ˜¾ç¤ºåç§°
    Icon VARCHAR(50),                         -- å›¾æ ‡
    Slot VARCHAR(50) NOT NULL,                -- è£…å¤‡æ§½ä½
    ArmorType VARCHAR(20),                    -- æŠ¤ç”²ç±»å‹
    WeaponType VARCHAR(30),                   -- æ­¦å™¨ç±»å‹
    RequiredLevel INT NOT NULL DEFAULT 1,     -- éœ€æ±‚ç­‰çº§
    BaseStatsJson TEXT,                       -- JSON: {"AttackPower": {"Min": 10, "Max": 15}}
    AllowedAffixPoolJson TEXT,                -- JSON: ["affix_strength", "affix_crit"]
    RarityWeightsJson TEXT,                   -- JSON: {"Common": 0.6, "Rare": 0.3}
    SetId VARCHAR(100),                       -- å¥—è£…IDï¼Œå¯ä¸ºnull
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL,
    
    INDEX IX_GearDefinitions_Slot (Slot),
    INDEX IX_GearDefinitions_SetId (SetId)
);
```

#### GearInstances è¡¨

```sql
CREATE TABLE GearInstances (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    DefinitionId VARCHAR(100) NOT NULL,       -- å¤–é”®åˆ°GearDefinitions
    CharacterId UNIQUEIDENTIFIER,             -- å¤–é”®åˆ°Charactersï¼Œnullè¡¨ç¤ºåœ¨èƒŒåŒ…
    SlotType VARCHAR(50),                     -- è£…å¤‡ä½ç½®ï¼Œnullè¡¨ç¤ºæœªè£…å¤‡
    Rarity VARCHAR(50) NOT NULL,              -- Common/Rare/Epic/Legendary
    TierLevel INT NOT NULL DEFAULT 1,         -- å“çº§ 1-3
    ItemLevel INT NOT NULL,                   -- ç‰©å“ç­‰çº§
    RolledStatsJson TEXT NOT NULL,            -- JSON: {"AttackPower": 12.5}
    AffixesJson TEXT NOT NULL,                -- JSON: [{"AffixId": "...", "Value": ...}]
    QualityScore INT NOT NULL,                -- è£…å¤‡è¯„åˆ†
    IsEquipped BIT NOT NULL DEFAULT 0,        -- æ˜¯å¦å·²è£…å¤‡
    IsBound BIT NOT NULL DEFAULT 0,           -- æ˜¯å¦ç»‘å®š
    RerollCount INT NOT NULL DEFAULT 0,       -- è¯æ¡é‡ç½®æ¬¡æ•°
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL,
    
    FOREIGN KEY (DefinitionId) REFERENCES GearDefinitions(Id),
    FOREIGN KEY (CharacterId) REFERENCES Characters(Id) ON DELETE CASCADE,
    
    INDEX IX_GearInstances_CharacterId (CharacterId),
    INDEX IX_GearInstances_IsEquipped (IsEquipped),
    INDEX IX_GearInstances_Rarity (Rarity),
    INDEX IX_GearInstances_DefinitionId (DefinitionId)
);
```

#### AffixDefinitions è¡¨

```sql
CREATE TABLE AffixDefinitions (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "affix_strength"
    Name VARCHAR(200) NOT NULL,               -- æ˜¾ç¤ºåç§°
    StatType VARCHAR(50) NOT NULL,            -- å±æ€§ç±»å‹
    ModifierType VARCHAR(50) NOT NULL,        -- Flat/Percent/Proc
    ValueMin FLOAT NOT NULL,                  -- æ•°å€¼èŒƒå›´æœ€å°
    ValueMax FLOAT NOT NULL,                  -- æ•°å€¼èŒƒå›´æœ€å¤§
    RarityWeight FLOAT NOT NULL DEFAULT 1.0,  -- ç¨€æœ‰åº¦æƒé‡
    AllowedSlotsJson TEXT,                    -- JSON: ["weapon", "chest"] æˆ– null
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL,
    
    INDEX IX_AffixDefinitions_StatType (StatType)
);
```

#### GearSets è¡¨

```sql
CREATE TABLE GearSets (
    Id VARCHAR(100) PRIMARY KEY,              -- å¦‚ "set_warrior"
    Name VARCHAR(200) NOT NULL,               -- å¥—è£…åç§°
    PiecesJson TEXT NOT NULL,                 -- JSON: ["gear_def_1", "gear_def_2", ...]
    BonusesJson TEXT NOT NULL,                -- JSON: {"2": [...], "4": [...], "6": [...]}
    CreatedAt DATETIME NOT NULL,
    UpdatedAt DATETIME NOT NULL
);
```

---

### 10.2 ç´¢å¼•ç­–ç•¥

| è¡¨ | ç´¢å¼•å­—æ®µ | ç±»å‹ | ç”¨é€” |
|---|---------|------|------|
| GearInstances | CharacterId | æ™®é€šç´¢å¼• | æŸ¥è¯¢è§’è‰²çš„æ‰€æœ‰è£…å¤‡ |
| GearInstances | IsEquipped | æ™®é€šç´¢å¼• | æŸ¥è¯¢å·²è£…å¤‡/æœªè£…å¤‡çš„è£…å¤‡ |
| GearInstances | Rarity | æ™®é€šç´¢å¼• | æŒ‰ç¨€æœ‰åº¦ç­›é€‰ |
| GearInstances | DefinitionId | æ™®é€šç´¢å¼• | å…³è”è£…å¤‡å®šä¹‰ |
| GearDefinitions | Slot | æ™®é€šç´¢å¼• | æŒ‰æ§½ä½æŸ¥è¯¢å®šä¹‰ |
| GearDefinitions | SetId | æ™®é€šç´¢å¼• | æŸ¥è¯¢å¥—è£…è£…å¤‡ |
| AffixDefinitions | StatType | æ™®é€šç´¢å¼• | æŒ‰å±æ€§ç±»å‹æŸ¥è¯¢è¯æ¡ |

---

### 10.3 æ•°æ®è¿ç§»æ–¹æ¡ˆ

#### è¿ç§»ç­–ç•¥

```
Phase 1: æ–°å¢è¡¨ï¼ˆæ— å½±å“ï¼‰
â”œâ”€â”€ åˆ›å»º GearDefinitions è¡¨
â”œâ”€â”€ åˆ›å»º GearInstances è¡¨
â”œâ”€â”€ åˆ›å»º AffixDefinitions è¡¨
â””â”€â”€ åˆ›å»º GearSets è¡¨

Phase 2: æ‰©å±•å­—æ®µï¼ˆå…¼å®¹ï¼‰
â”œâ”€â”€ æ‰©å±• GearInstanceDto æ·»åŠ æ–°å­—æ®µ
â”œâ”€â”€ æ‰©å±• EquipmentSlotDto æ”¯æŒ17æ§½ä½
â””â”€â”€ APIä¿æŒå‘åå…¼å®¹ï¼ˆæ—§æ§½ä½æ˜ å°„åˆ°æ–°æ§½ä½ï¼‰

Phase 3: æ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ å¦‚æœæœ‰ç°æœ‰è£…å¤‡æ•°æ®ï¼ˆå½“å‰ä¸ºç©ºï¼‰
â”œâ”€â”€ ç¼–å†™è¿ç§»è„šæœ¬å°†æ—§æ•°æ®è½¬æ¢ä¸ºæ–°æ ¼å¼
â””â”€â”€ éªŒè¯è¿ç§»ç»“æœ

Phase 4: å‰ç«¯æ›´æ–°
â”œâ”€â”€ æ›´æ–°å‰ç«¯ä½¿ç”¨æ–°çš„æ§½ä½æšä¸¾
â”œâ”€â”€ æ›´æ–°UIå¸ƒå±€ä¸º17æ§½ä½
â””â”€â”€ æ¸è¿›å¼å‡çº§ï¼ˆæ—§ç‰ˆæœ¬ä»å¯ä½¿ç”¨ï¼‰
```

#### è¿ç§»è„šæœ¬ç¤ºä¾‹

```csharp
public class EquipmentMigrationScript
{
    // æ—§æ§½ä½ -> æ–°æ§½ä½æ˜ å°„
    private static readonly Dictionary<string, string> SlotMapping = new()
    {
        { "head", "Head" },
        { "weapon", "MainHand" },
        { "chest", "Chest" },
        { "offhand", "OffHand" },
        { "waist", "Waist" },
        { "legs", "Legs" },
        { "feet", "Feet" },
        { "trinket1", "Trinket1" },
        { "trinket2", "Trinket2" }
    };
    
    public async Task MigrateOldEquipmentData()
    {
        // å¦‚æœæœ‰æ—§æ•°æ®éœ€è¦è¿ç§»
        // å½“å‰ç³»ç»Ÿæ— æ—§æ•°æ®ï¼Œæ­¤æ–¹æ³•ä¸ºé¢„ç•™
    }
}
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£ï¼ˆä¸Šç¯‡ï¼‰å®Œæˆäº† BlazorIdle è£…å¤‡ç³»ç»Ÿä¼˜åŒ–çš„æ ¸å¿ƒåˆ†æä¸æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **å½“å‰çŠ¶æ€å…¨é¢åˆ†æ**: å·²å®Œæˆå·¥ä½œã€ç°æœ‰èƒ½åŠ›ã€ç¼ºå¤±åŠŸèƒ½
2. âœ… **è®¾è®¡ç›®æ ‡ä¸åŸåˆ™**: æ ¸å¿ƒç›®æ ‡ã€è®¾è®¡åŸåˆ™ã€æˆåŠŸæ ‡å‡†
3. âœ… **å®Œæ•´æ¶æ„è®¾è®¡**: ç³»ç»Ÿæ¦‚è§ˆã€æ¨¡å—åˆ’åˆ†ã€æ ¸å¿ƒæµç¨‹
4. âœ… **17æ§½ä½ç³»ç»Ÿè®¾è®¡**: æ§½ä½æ‰©å±•ã€é…ç½®ã€åŒæ‰‹æ­¦å™¨æœºåˆ¶
5. âœ… **æŠ¤ç”²ç±»å‹ç³»ç»Ÿ**: 4ç§æŠ¤ç”²ç±»å‹ã€å‡ä¼¤æœºåˆ¶ã€å¹³è¡¡è®¾è®¡
6. âœ… **æ­¦å™¨ç±»å‹ç³»ç»Ÿ**: 15ç§æ­¦å™¨ç±»å‹ã€æ”»å‡»é€Ÿåº¦ã€åŒæŒã€æ ¼æŒ¡
7. âœ… **èŒä¸šè£…å¤‡é™åˆ¶**: èŒä¸šå…¼å®¹æ€§ã€éªŒè¯æœºåˆ¶
8. âœ… **é¢†åŸŸæ¨¡å‹è®¾è®¡**: GearDefinition, GearInstance, Affix, GearSet
9. âœ… **æ•°æ®åº“è®¾è®¡**: è¡¨ç»“æ„ã€ç´¢å¼•ã€è¿ç§»æ–¹æ¡ˆ

---

## ä¸‹ä¸€æ­¥

è¯·å‚é˜…ï¼š
- **ã€Šè£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆï¼ˆä¸­ï¼‰ã€‹**: è¯¦ç»†çš„Phaseæ‰§è¡Œè®¡åˆ’ã€æŠ€æœ¯å®ç°è§„èŒƒã€é…ç½®åŒ–è®¾è®¡
- **ã€Šè£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ€»ä½“æ–¹æ¡ˆï¼ˆä¸‹ï¼‰ã€‹**: æµ‹è¯•ç­–ç•¥ã€æ•°å€¼å¹³è¡¡ã€å‰ç«¯éªŒè¯ã€æ‰©å±•æ€§è®¾è®¡

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**ç»´æŠ¤è´Ÿè´£**: å¼€å‘å›¢é˜Ÿ  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---
