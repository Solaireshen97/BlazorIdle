# BlazorIdle è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ - ä¸‹ç¯‡

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç±»å‹**: ç»¼åˆè®¾è®¡æ–¹æ¡ˆï¼ˆæ•´åˆç‰ˆï¼‰  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ - å¾…å®æ–½  
**æ–‡æ¡£åˆ†å†Œ**: ä¸‹ç¯‡ï¼ˆå…±ä¸‰ç¯‡ï¼‰

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆçš„ä¸‹ç¯‡ï¼Œæ‰¿æ¥ä¸­ç¯‡ï¼Œé‡ç‚¹å®æ–½Phase 7-9åŠæ€»ç»“æ€§å†…å®¹ï¼š
- **Phase 7**: é«˜çº§åŠŸèƒ½ä¸æ‰©å±•ï¼ˆè£…å¤‡å¼ºåŒ–ã€ç²¾ç‚¼ã€ä¼ æ‰¿ç­‰ï¼‰
- **Phase 8**: èŒä¸šé™åˆ¶ä¸å¹³è¡¡è°ƒæ•´
- **Phase 9**: å…¨ç³»ç»Ÿæµ‹è¯•ä¸æ–‡æ¡£å®Œå–„
- **é™„å½•**: æŠ€æœ¯è§„èŒƒã€æ•°å€¼å¹³è¡¡ã€é£é™©ç®¡ç†ã€APIæ¸…å•ç­‰

---

## ğŸ“– ç›®å½•

### ä¸‹ç¯‡å†…å®¹
1. [Phase 7: é«˜çº§åŠŸèƒ½ä¸æ‰©å±•](#phase-7-é«˜çº§åŠŸèƒ½ä¸æ‰©å±•-ç¬¬15-16å‘¨)
2. [Phase 8: èŒä¸šé™åˆ¶ä¸å¹³è¡¡è°ƒæ•´](#phase-8-èŒä¸šé™åˆ¶ä¸å¹³è¡¡è°ƒæ•´-ç¬¬17-18å‘¨)
3. [Phase 9: å…¨ç³»ç»Ÿæµ‹è¯•ä¸æ–‡æ¡£](#phase-9-å…¨ç³»ç»Ÿæµ‹è¯•ä¸æ–‡æ¡£-ç¬¬19-20å‘¨)
4. [æŠ€æœ¯è§„èŒƒè¯¦è§£](#æŠ€æœ¯è§„èŒƒè¯¦è§£)
5. [æ•°å€¼å¹³è¡¡è®¾è®¡](#æ•°å€¼å¹³è¡¡è®¾è®¡)
6. [é£é™©è¯„ä¼°ä¸åº”å¯¹](#é£é™©è¯„ä¼°ä¸åº”å¯¹)
7. [é™„å½•](#é™„å½•)
8. [æ€»ç»“ä¸å±•æœ›](#æ€»ç»“ä¸å±•æœ›)

---

## Phase 7: é«˜çº§åŠŸèƒ½ä¸æ‰©å±• (ç¬¬15-16å‘¨ï¼Œå¯é€‰)

### é˜¶æ®µç›®æ ‡

å®ç°é«˜çº§è£…å¤‡åŠŸèƒ½ï¼Œä¸ºç©å®¶æä¾›æ›´æ·±åº¦çš„è£…å¤‡ä¼˜åŒ–ç©æ³•ï¼ŒåŒ…æ‹¬è£…å¤‡å¼ºåŒ–ã€ç²¾ç‚¼ã€ä¼ æ‰¿ã€å›¾é‰´ç­‰ç³»ç»Ÿã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### Task 7.1: è£…å¤‡å¼ºåŒ–ç³»ç»Ÿ â­

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ï¼ˆå¯é€‰ï¼‰  
**é¢„è®¡æ—¶é—´**: 8å°æ—¶  
**ä¾èµ–**: Phase 5å®Œæˆ

**åŠŸèƒ½è¯´æ˜**:
è£…å¤‡å¼ºåŒ–å…è®¸ç©å®¶é€šè¿‡æ¶ˆè€—ææ–™æå‡è£…å¤‡çš„å¼ºåŒ–ç­‰çº§ï¼ˆ+1 ~ +15ï¼‰ï¼Œæ¯ä¸ªå¼ºåŒ–ç­‰çº§æä¾›é¢å¤–çš„å±æ€§åŠ æˆã€‚

**å®æ–½æ­¥éª¤**:

1. æ‰©å±• `GearInstance` æ¨¡å‹
```csharp
public class GearInstance
{
    // ... ç°æœ‰å­—æ®µ
    
    /// <summary>å¼ºåŒ–ç­‰çº§ï¼ˆ0-15ï¼‰</summary>
    public int EnhancementLevel { get; set; } = 0;
    
    /// <summary>å¼ºåŒ–å°è¯•æ¬¡æ•°</summary>
    public int EnhancementAttempts { get; set; } = 0;
}
```

2. åˆ›å»º `EnhancementService.cs`
```csharp
/// <summary>
/// è£…å¤‡å¼ºåŒ–æœåŠ¡
/// </summary>
public class EnhancementService
{
    private readonly IGearInstanceRepository _gearRepo;
    private readonly IEconomyService _economyService;
    private readonly RNGContext _rng;
    
    /// <summary>
    /// å¼ºåŒ–è£…å¤‡
    /// </summary>
    public async Task<EnhancementResult> EnhanceGearAsync(
        Guid characterId,
        Guid gearInstanceId,
        bool useProtection = false)
    {
        var gear = await _gearRepo.GetByIdAsync(gearInstanceId);
        
        // éªŒè¯
        if (gear.CharacterId != characterId)
            return EnhancementResult.Error("ä¸æ˜¯ä½ çš„è£…å¤‡");
        
        if (gear.EnhancementLevel >= 15)
            return EnhancementResult.Error("å·²è¾¾åˆ°æœ€å¤§å¼ºåŒ–ç­‰çº§");
        
        // è®¡ç®—æˆæœ¬
        var cost = CalculateEnhancementCost(gear.EnhancementLevel, gear.Rarity);
        
        // æ‰£é™¤ææ–™å’Œé‡‘å¸
        var paymentResult = await _economyService.DeductResourcesAsync(
            characterId,
            cost.Gold,
            cost.Materials);
        
        if (!paymentResult.Success)
            return EnhancementResult.Error("ææ–™æˆ–é‡‘å¸ä¸è¶³");
        
        // è®¡ç®—æˆåŠŸç‡
        var successRate = CalculateSuccessRate(gear.EnhancementLevel);
        var success = _rng.NextDouble() < successRate;
        
        gear.EnhancementAttempts++;
        
        if (success)
        {
            gear.EnhancementLevel++;
            gear.QualityScore = RecalculateQualityScore(gear);
            await _gearRepo.UpdateAsync(gear);
            
            return EnhancementResult.Success(gear, $"å¼ºåŒ–æˆåŠŸï¼å½“å‰+{gear.EnhancementLevel}");
        }
        else
        {
            // å¤±è´¥å¤„ç†
            if (!useProtection && gear.EnhancementLevel > 0)
            {
                // é™çº§ï¼ˆå¦‚æœæ²¡æœ‰ä½¿ç”¨ä¿æŠ¤é“å…·ï¼‰
                var degradeLevel = gear.EnhancementLevel > 10 ? 2 : 1;
                gear.EnhancementLevel = Math.Max(0, gear.EnhancementLevel - degradeLevel);
                gear.QualityScore = RecalculateQualityScore(gear);
            }
            
            await _gearRepo.UpdateAsync(gear);
            
            return EnhancementResult.Failure(gear, 
                useProtection ? "å¼ºåŒ–å¤±è´¥ï¼Œä¿æŠ¤é“å…·å·²æ¶ˆè€—" : $"å¼ºåŒ–å¤±è´¥ï¼Œé™è‡³+{gear.EnhancementLevel}");
        }
    }
    
    private EnhancementCost CalculateEnhancementCost(int currentLevel, Rarity rarity)
    {
        // åŸºç¡€æˆæœ¬
        var baseCost = currentLevel * 100 + 500;
        
        // ç¨€æœ‰åº¦ç³»æ•°
        var rarityMultiplier = rarity switch
        {
            Rarity.Common => 1.0,
            Rarity.Rare => 1.5,
            Rarity.Epic => 2.5,
            Rarity.Legendary => 4.0,
            _ => 1.0
        };
        
        var goldCost = (int)(baseCost * rarityMultiplier);
        
        // ææ–™éœ€æ±‚
        var materials = new Dictionary<string, int>
        {
            { "mat_enhancement_stone", currentLevel / 3 + 1 },
            { "mat_essence_common", 5 + currentLevel * 2 }
        };
        
        if (currentLevel >= 10)
        {
            materials["mat_essence_rare"] = currentLevel - 9;
        }
        
        return new EnhancementCost { Gold = goldCost, Materials = materials };
    }
    
    private double CalculateSuccessRate(int currentLevel)
    {
        // å¼ºåŒ–æˆåŠŸç‡é€’å‡
        return currentLevel switch
        {
            <= 3 => 1.0,      // +1~+3: 100%
            <= 6 => 0.9,      // +4~+6: 90%
            <= 9 => 0.7,      // +7~+9: 70%
            <= 12 => 0.5,     // +10~+12: 50%
            <= 14 => 0.3,     // +13~+14: 30%
            15 => 0.1,        // +15: 10%
            _ => 0.0
        };
    }
    
    private int RecalculateQualityScore(GearInstance gear)
    {
        // åŸºç¡€è¯„åˆ†
        var baseScore = gear.QualityScore;
        
        // å¼ºåŒ–åŠ æˆï¼ˆæ¯çº§+5%ï¼‰
        var enhancementBonus = (int)(baseScore * 0.05 * gear.EnhancementLevel);
        
        return baseScore + enhancementBonus;
    }
}

public class EnhancementResult
{
    public bool Success { get; set; }
    public GearInstance UpdatedGear { get; set; }
    public string Message { get; set; }
    
    public static EnhancementResult Success(GearInstance gear, string msg) =>
        new() { Success = true, UpdatedGear = gear, Message = msg };
    
    public static EnhancementResult Failure(GearInstance gear, string msg) =>
        new() { Success = false, UpdatedGear = gear, Message = msg };
    
    public static EnhancementResult Error(string msg) =>
        new() { Success = false, Message = msg };
}

public class EnhancementCost
{
    public int Gold { get; set; }
    public Dictionary<string, int> Materials { get; set; }
}
```

3. åˆ›å»ºAPIç«¯ç‚¹
```csharp
[HttpPost("api/equipment/{gearInstanceId}/enhance")]
public async Task<ActionResult<EnhancementResult>> EnhanceGear(
    Guid gearInstanceId,
    [FromBody] EnhanceRequest request)
{
    var result = await _enhancementService.EnhanceGearAsync(
        GetCurrentCharacterId(),
        gearInstanceId,
        request.UseProtection);
    
    return result.Success ? Ok(result) : BadRequest(result);
}
```

4. å‰ç«¯å¼ºåŒ–ç•Œé¢
```razor
<div class="enhancement-dialog">
    <h3>è£…å¤‡å¼ºåŒ–</h3>
    
    <div class="gear-display">
        <div class="gear-icon">@SelectedGear.Icon</div>
        <div class="gear-info">
            <div class="gear-name">@SelectedGear.Name</div>
            <div class="enhancement-level">
                å½“å‰å¼ºåŒ–: +@SelectedGear.EnhancementLevel
            </div>
        </div>
    </div>
    
    <div class="enhancement-stats">
        <h4>å¼ºåŒ–å±æ€§åŠ æˆ</h4>
        <div class="stat-bonus">
            @foreach (var stat in GetEnhancementBonus())
            {
                <div>@stat.Key: +@stat.Value</div>
            }
        </div>
    </div>
    
    <div class="enhancement-info">
        <div class="success-rate">
            æˆåŠŸç‡: @GetSuccessRate()%
        </div>
        <div class="cost">
            <div>é‡‘å¸: @Cost.Gold</div>
            @foreach (var mat in Cost.Materials)
            {
                <div>@GetMaterialName(mat.Key): @mat.Value</div>
            }
        </div>
        <div class="warning">
            @if (!UseProtection && SelectedGear.EnhancementLevel > 0)
            {
                <span class="danger">å¤±è´¥å°†é™çº§ï¼</span>
            }
        </div>
    </div>
    
    <div class="enhancement-options">
        <label>
            <input type="checkbox" @bind="UseProtection" />
            ä½¿ç”¨ä¿æŠ¤é“å…·ï¼ˆé˜²æ­¢é™çº§ï¼‰
        </label>
    </div>
    
    <div class="enhancement-actions">
        <button class="btn-enhance" @onclick="OnEnhanceClick" disabled="@IsEnhancing">
            @if (IsEnhancing)
            {
                <span>å¼ºåŒ–ä¸­...</span>
            }
            else
            {
                <span>å¼ºåŒ–</span>
            }
        </button>
        <button class="btn-cancel" @onclick="OnCancelClick">å–æ¶ˆ</button>
    </div>
    
    @if (!string.IsNullOrEmpty(ResultMessage))
    {
        <div class="enhancement-result @ResultClass">
            @ResultMessage
        </div>
    }
</div>

@code {
    [Parameter] public GearInstanceDto SelectedGear { get; set; }
    [Parameter] public EventCallback<GearInstanceDto> OnEnhanceComplete { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    
    private bool UseProtection { get; set; }
    private bool IsEnhancing { get; set; }
    private string ResultMessage { get; set; }
    private string ResultClass { get; set; }
    private EnhancementCost Cost { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        await LoadEnhancementCost();
    }
    
    private async Task LoadEnhancementCost()
    {
        // ä»APIè·å–å¼ºåŒ–æˆæœ¬
        Cost = await EquipmentApi.GetEnhancementCostAsync(SelectedGear.Id);
    }
    
    private async Task OnEnhanceClick()
    {
        IsEnhancing = true;
        ResultMessage = "";
        StateHasChanged();
        
        try
        {
            var result = await EquipmentApi.EnhanceGearAsync(
                SelectedGear.Id,
                UseProtection);
            
            if (result.Success)
            {
                ResultMessage = result.Message;
                ResultClass = "success";
                SelectedGear = result.UpdatedGear;
                
                await Task.Delay(1500); // æ˜¾ç¤ºç»“æœåŠ¨ç”»
                await OnEnhanceComplete.InvokeAsync(result.UpdatedGear);
            }
            else
            {
                ResultMessage = result.Message;
                ResultClass = "failure";
                SelectedGear = result.UpdatedGear;
            }
        }
        finally
        {
            IsEnhancing = false;
            StateHasChanged();
        }
    }
    
    private double GetSuccessRate()
    {
        return SelectedGear.EnhancementLevel switch
        {
            <= 3 => 100,
            <= 6 => 90,
            <= 9 => 70,
            <= 12 => 50,
            <= 14 => 30,
            15 => 10,
            _ => 0
        };
    }
    
    private Dictionary<string, double> GetEnhancementBonus()
    {
        // è®¡ç®—å¼ºåŒ–å¸¦æ¥çš„å±æ€§åŠ æˆ
        var bonus = new Dictionary<string, double>();
        var bonusPercent = SelectedGear.EnhancementLevel * 0.05;
        
        foreach (var stat in SelectedGear.Stats)
        {
            bonus[stat.Key] = stat.Value * bonusPercent;
        }
        
        return bonus;
    }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. æ‰“å¼€å¼ºåŒ–ç•Œé¢æ˜¾ç¤ºå½“å‰å¼ºåŒ–ç­‰çº§
2. æ˜¾ç¤ºå¼ºåŒ–æˆæœ¬å’ŒæˆåŠŸç‡
3. æ˜¾ç¤ºå¼ºåŒ–åå±æ€§åŠ æˆé¢„è§ˆ
4. ç‚¹å‡»å¼ºåŒ–æŒ‰é’®è§¦å‘åŠ¨ç”»
5. å¼ºåŒ–æˆåŠŸ/å¤±è´¥æ˜¾ç¤ºä¸åŒæç¤º
6. å¼ºåŒ–å¤±è´¥æ—¶è£…å¤‡é™çº§ï¼ˆå¦‚ä¸ä½¿ç”¨ä¿æŠ¤ï¼‰
7. å¼ºåŒ–åè£…å¤‡å±æ€§ç«‹å³æ›´æ–°

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¼ºåŒ–æœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… æˆåŠŸç‡è®¡ç®—å‡†ç¡®
- âœ… é™çº§æœºåˆ¶æ­£ç¡®
- âœ… æˆæœ¬æ‰£é™¤å‡†ç¡®
- âœ… å‰ç«¯åŠ¨ç”»æµç•…
- âœ… æ•°æ®æŒä¹…åŒ–æ­£ç¡®

---

#### Task 7.2: è£…å¤‡ç²¾ç‚¼ç³»ç»Ÿ â­

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½ï¼ˆå¯é€‰ï¼‰  
**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**ä¾èµ–**: Task 7.1

**åŠŸèƒ½è¯´æ˜**:
è£…å¤‡ç²¾ç‚¼å…è®¸ç©å®¶æå‡å•ä¸ªè¯æ¡çš„æ•°å€¼ï¼Œæä¾›æ›´ç»†è‡´çš„è£…å¤‡ä¼˜åŒ–é€‰é¡¹ã€‚

**å®æ–½æ­¥éª¤**:

1. æ‰©å±• `AffixInstance` æ¨¡å‹
```csharp
public class AffixInstance
{
    public string AffixId { get; set; }
    public double BaseValue { get; set; }
    
    /// <summary>ç²¾ç‚¼ç­‰çº§ï¼ˆ0-5ï¼‰</summary>
    public int RefinementLevel { get; set; } = 0;
    
    /// <summary>ç²¾ç‚¼åŠ æˆ</summary>
    public double RefinementBonus => BaseValue * (RefinementLevel * 0.1);
    
    /// <summary>æœ€ç»ˆæ•°å€¼</summary>
    public double FinalValue => BaseValue + RefinementBonus;
    
    public string DisplayName { get; set; }
}
```

2. åˆ›å»º `RefinementService.cs`
```csharp
public class RefinementService
{
    public async Task<RefinementResult> RefineAffixAsync(
        Guid characterId,
        Guid gearInstanceId,
        int affixIndex)
    {
        var gear = await _gearRepo.GetByIdAsync(gearInstanceId);
        var affixes = JsonSerializer.Deserialize<List<AffixInstance>>(gear.AffixInstancesJson);
        var affix = affixes[affixIndex];
        
        // éªŒè¯ç²¾ç‚¼ä¸Šé™
        if (affix.RefinementLevel >= 5)
            return RefinementResult.Error("è¯æ¡å·²è¾¾åˆ°æœ€å¤§ç²¾ç‚¼ç­‰çº§");
        
        // è®¡ç®—æˆæœ¬ï¼ˆç²¾ç‚¼è¶Šé«˜æˆæœ¬è¶Šè´µï¼‰
        var cost = CalculateRefinementCost(affix.RefinementLevel, gear.Rarity);
        
        // æ‰£é™¤æˆæœ¬
        var paymentResult = await _economyService.DeductResourcesAsync(
            characterId, cost.Gold, cost.Materials);
        
        if (!paymentResult.Success)
            return RefinementResult.Error("ææ–™æˆ–é‡‘å¸ä¸è¶³");
        
        // æˆåŠŸç‡ï¼ˆç²¾ç‚¼æˆåŠŸç‡é«˜äºå¼ºåŒ–ï¼‰
        var successRate = CalculateRefinementSuccessRate(affix.RefinementLevel);
        var success = _rng.NextDouble() < successRate;
        
        if (success)
        {
            affix.RefinementLevel++;
            gear.AffixInstancesJson = JsonSerializer.Serialize(affixes);
            gear.QualityScore = RecalculateQualityScore(gear);
            await _gearRepo.UpdateAsync(gear);
            
            return RefinementResult.Success(gear, affix, "ç²¾ç‚¼æˆåŠŸ");
        }
        else
        {
            return RefinementResult.Failure("ç²¾ç‚¼å¤±è´¥ï¼Œææ–™å·²æ¶ˆè€—");
        }
    }
    
    private double CalculateRefinementSuccessRate(int currentLevel)
    {
        return currentLevel switch
        {
            0 => 0.95,   // 1çº§: 95%
            1 => 0.85,   // 2çº§: 85%
            2 => 0.70,   // 3çº§: 70%
            3 => 0.50,   // 4çº§: 50%
            4 => 0.30,   // 5çº§: 30%
            _ => 0.0
        };
    }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. æ˜¾ç¤ºè£…å¤‡æ‰€æœ‰è¯æ¡åŠç²¾ç‚¼ç­‰çº§
2. é€‰æ‹©è¯æ¡è¿›è¡Œç²¾ç‚¼
3. æ˜¾ç¤ºç²¾ç‚¼æˆæœ¬å’ŒæˆåŠŸç‡
4. æ˜¾ç¤ºç²¾ç‚¼åæ•°å€¼æå‡
5. ç²¾ç‚¼æˆåŠŸåå±æ€§æ›´æ–°

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç²¾ç‚¼æœºåˆ¶æ­£å¸¸
- âœ… æˆæœ¬è®¡ç®—å‡†ç¡®
- âœ… è¯æ¡æ•°å€¼æ­£ç¡®æå‡
- âœ… UIå‹å¥½æ¸…æ™°

---

#### Task 7.3: è£…å¤‡ä¼ æ‰¿ç³»ç»Ÿ â­

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½ï¼ˆå¯é€‰ï¼‰  
**é¢„è®¡æ—¶é—´**: 8å°æ—¶  
**ä¾èµ–**: Task 7.1

**åŠŸèƒ½è¯´æ˜**:
è£…å¤‡ä¼ æ‰¿å…è®¸ç©å®¶å°†æ—§è£…å¤‡çš„å¼ºåŒ–ç­‰çº§å’Œç²¾ç‚¼ç­‰çº§è½¬ç§»åˆ°æ–°è£…å¤‡ä¸Šï¼Œé¿å…å¼ºåŒ–æˆæœæµªè´¹ã€‚

**å®æ–½æ­¥éª¤**:

1. åˆ›å»º `InheritanceService.cs`
```csharp
public class InheritanceService
{
    public async Task<InheritanceResult> InheritEnhancementAsync(
        Guid characterId,
        Guid sourceGearId,    // æ—§è£…å¤‡ï¼ˆæ¶ˆè€—ï¼‰
        Guid targetGearId)    // æ–°è£…å¤‡ï¼ˆç»§æ‰¿ï¼‰
    {
        var sourceGear = await _gearRepo.GetByIdAsync(sourceGearId);
        var targetGear = await _gearRepo.GetByIdAsync(targetGearId);
        
        // éªŒè¯
        if (sourceGear.CharacterId != characterId || targetGear.CharacterId != characterId)
            return InheritanceResult.Error("ä¸æ˜¯ä½ çš„è£…å¤‡");
        
        if (sourceGear.Slot != targetGear.Slot)
            return InheritanceResult.Error("åªèƒ½ä¼ æ‰¿ç›¸åŒæ§½ä½çš„è£…å¤‡");
        
        if (sourceGear.EnhancementLevel == 0)
            return InheritanceResult.Error("æºè£…å¤‡æ²¡æœ‰å¼ºåŒ–ç­‰çº§");
        
        // è®¡ç®—ä¼ æ‰¿æˆæœ¬ï¼ˆåŸºäºå¼ºåŒ–ç­‰çº§ï¼‰
        var cost = CalculateInheritanceCost(sourceGear.EnhancementLevel, sourceGear.Rarity);
        
        // æ‰£é™¤æˆæœ¬
        var paymentResult = await _economyService.DeductResourcesAsync(
            characterId, cost.Gold, cost.Materials);
        
        if (!paymentResult.Success)
            return InheritanceResult.Error("ææ–™æˆ–é‡‘å¸ä¸è¶³");
        
        // æ‰§è¡Œä¼ æ‰¿
        targetGear.EnhancementLevel = sourceGear.EnhancementLevel;
        targetGear.QualityScore = RecalculateQualityScore(targetGear);
        
        // åˆ é™¤æºè£…å¤‡
        await _gearRepo.DeleteAsync(sourceGearId);
        await _gearRepo.UpdateAsync(targetGear);
        
        return InheritanceResult.Success(targetGear, "ä¼ æ‰¿æˆåŠŸ");
    }
    
    private InheritanceCost CalculateInheritanceCost(int enhancementLevel, Rarity rarity)
    {
        // ä¼ æ‰¿æˆæœ¬çº¦ä¸ºå¼ºåŒ–æ€»æˆæœ¬çš„50%
        var goldCost = enhancementLevel * 200 * GetRarityMultiplier(rarity);
        
        var materials = new Dictionary<string, int>
        {
            { "mat_inheritance_scroll", 1 },
            { "mat_essence_common", enhancementLevel * 5 }
        };
        
        return new InheritanceCost { Gold = goldCost, Materials = materials };
    }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. é€‰æ‹©æºè£…å¤‡ï¼ˆæ—§è£…å¤‡ï¼‰
2. é€‰æ‹©ç›®æ ‡è£…å¤‡ï¼ˆæ–°è£…å¤‡ï¼‰
3. æ˜¾ç¤ºä¼ æ‰¿é¢„è§ˆå’Œæˆæœ¬
4. ç¡®è®¤ä¼ æ‰¿
5. æ—§è£…å¤‡æ¶ˆå¤±ï¼Œæ–°è£…å¤‡ç»§æ‰¿å¼ºåŒ–ç­‰çº§

**éªŒæ”¶æ ‡å‡†**:
- âœ… ä¼ æ‰¿æœºåˆ¶æ­£å¸¸
- âœ… æºè£…å¤‡æ­£ç¡®åˆ é™¤
- âœ… ç›®æ ‡è£…å¤‡æ­£ç¡®ç»§æ‰¿
- âœ… æˆæœ¬è®¡ç®—å‡†ç¡®

---

#### Task 7.4: è£…å¤‡ç»‘å®šä¸äº¤æ˜“é¢„ç•™ â­

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½  
**é¢„è®¡æ—¶é—´**: 4å°æ—¶  
**ä¾èµ–**: Phase 3

**å®æ–½æ­¥éª¤**:

1. è£…å¤‡ç»‘å®šæœºåˆ¶
```csharp
public class EquipmentBindingService
{
    /// <summary>
    /// ç»‘å®šè£…å¤‡
    /// </summary>
    public async Task BindGear(Guid gearInstanceId, BindingType bindingType)
    {
        var gear = await _gearRepo.GetByIdAsync(gearInstanceId);
        
        if (!gear.IsBound)
        {
            gear.IsBound = true;
            gear.BindingType = bindingType;
            gear.BoundAt = DateTime.UtcNow;
            await _gearRepo.UpdateAsync(gear);
        }
    }
}

public enum BindingType
{
    BindOnPickup,      // æ‹¾å–ç»‘å®š
    BindOnEquip,       // è£…å¤‡ç»‘å®š
    BindOnEnhancement  // å¼ºåŒ–ç»‘å®š
}
```

2. è£…å¤‡ç»‘å®šè§„åˆ™é…ç½®
```json
{
  "BindingRules": {
    "BindOnPickup": {
      "ApplyTo": ["Legendary"],
      "Description": "ä¼ è¯´è£…å¤‡æ‹¾å–åç»‘å®š"
    },
    "BindOnEquip": {
      "ApplyTo": ["Epic"],
      "Description": "å²è¯—è£…å¤‡è£…å¤‡åç»‘å®š"
    },
    "BindOnEnhancement": {
      "ApplyTo": ["All"],
      "MinEnhancementLevel": 5,
      "Description": "å¼ºåŒ–åˆ°+5åç»‘å®š"
    }
  }
}
```

3. äº¤æ˜“ç³»ç»Ÿé¢„ç•™æ¥å£
```csharp
/// <summary>
/// è£…å¤‡äº¤æ˜“æ¥å£ï¼ˆé¢„ç•™ï¼‰
/// </summary>
public interface IEquipmentTradingService
{
    Task<TradeResult> ListForSale(Guid gearId, int price);
    Task<TradeResult> Purchase(Guid gearId, Guid buyerId);
    Task<TradeResult> CancelListing(Guid gearId);
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. è£…å¤‡æ˜¾ç¤ºç»‘å®šçŠ¶æ€
2. ç»‘å®šè£…å¤‡æ— æ³•äº¤æ˜“
3. ç»‘å®šå›¾æ ‡å’Œæç¤ºæ¸…æ™°

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç»‘å®šæœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… ç»‘å®šè§„åˆ™æ­£ç¡®åº”ç”¨
- âœ… äº¤æ˜“æ¥å£é¢„ç•™å®Œæ•´

---

#### Task 7.5: è£…å¤‡å›¾é‰´ç³»ç»Ÿ â­

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½  
**é¢„è®¡æ—¶é—´**: 8å°æ—¶  
**ä¾èµ–**: Phase 3

**åŠŸèƒ½è¯´æ˜**:
è£…å¤‡å›¾é‰´è®°å½•ç©å®¶è·å¾—è¿‡çš„æ‰€æœ‰è£…å¤‡ï¼Œæä¾›æ”¶é›†æˆå°±æ„Ÿï¼Œå®Œæˆå›¾é‰´å¯è·å¾—å¥–åŠ±ã€‚

**å®æ–½æ­¥éª¤**:

1. åˆ›å»ºå›¾é‰´æ•°æ®æ¨¡å‹
```csharp
public class EquipmentCodex
{
    public Guid CharacterId { get; set; }
    public string GearDefinitionId { get; set; }
    public DateTime FirstObtainedAt { get; set; }
    public int TimesObtained { get; set; }
    public int? BestQualityScore { get; set; }
    public Rarity? BestRarity { get; set; }
}
```

2. åˆ›å»º `CodexService.cs`
```csharp
public class EquipmentCodexService
{
    public async Task RecordGearObtained(Guid characterId, GearInstance gear)
    {
        var codexEntry = await _codexRepo.GetAsync(characterId, gear.DefinitionId);
        
        if (codexEntry == null)
        {
            // é¦–æ¬¡è·å¾—
            codexEntry = new EquipmentCodex
            {
                CharacterId = characterId,
                GearDefinitionId = gear.DefinitionId,
                FirstObtainedAt = DateTime.UtcNow,
                TimesObtained = 1,
                BestQualityScore = gear.QualityScore,
                BestRarity = gear.Rarity
            };
            await _codexRepo.AddAsync(codexEntry);
            
            // æ£€æŸ¥å›¾é‰´æˆå°±
            await CheckCodexAchievements(characterId);
        }
        else
        {
            // å†æ¬¡è·å¾—
            codexEntry.TimesObtained++;
            
            if (gear.QualityScore > codexEntry.BestQualityScore)
            {
                codexEntry.BestQualityScore = gear.QualityScore;
                codexEntry.BestRarity = gear.Rarity;
            }
            
            await _codexRepo.UpdateAsync(codexEntry);
        }
    }
    
    public async Task<CodexStatistics> GetCodexStatistics(Guid characterId)
    {
        var entries = await _codexRepo.GetAllByCharacterAsync(characterId);
        var totalDefinitions = await _gearDefRepo.CountAsync();
        
        return new CodexStatistics
        {
            TotalCollected = entries.Count,
            TotalAvailable = totalDefinitions,
            CompletionPercent = (double)entries.Count / totalDefinitions * 100,
            CommonCount = entries.Count(e => e.BestRarity == Rarity.Common),
            RareCount = entries.Count(e => e.BestRarity == Rarity.Rare),
            EpicCount = entries.Count(e => e.BestRarity == Rarity.Epic),
            LegendaryCount = entries.Count(e => e.BestRarity == Rarity.Legendary)
        };
    }
    
    private async Task CheckCodexAchievements(Guid characterId)
    {
        var stats = await GetCodexStatistics(characterId);
        
        // æ£€æŸ¥å›¾é‰´é‡Œç¨‹ç¢‘
        var milestones = new[] { 10, 25, 50, 100, 200 };
        foreach (var milestone in milestones)
        {
            if (stats.TotalCollected == milestone)
            {
                // å‘æ”¾é‡Œç¨‹ç¢‘å¥–åŠ±
                await _achievementService.UnlockAchievement(
                    characterId,
                    $"codex_milestone_{milestone}");
            }
        }
    }
}
```

3. å‰ç«¯å›¾é‰´ç•Œé¢
```razor
<div class="equipment-codex">
    <h2>è£…å¤‡å›¾é‰´</h2>
    
    <div class="codex-stats">
        <div class="stat">
            <span class="label">æ”¶é›†è¿›åº¦:</span>
            <span class="value">@Stats.TotalCollected / @Stats.TotalAvailable</span>
            <div class="progress-bar">
                <div class="progress-fill" style="width: @Stats.CompletionPercent%"></div>
            </div>
        </div>
        <div class="stat">
            <span class="label">å®Œæˆåº¦:</span>
            <span class="value">@Stats.CompletionPercent.ToString("F1")%</span>
        </div>
    </div>
    
    <div class="codex-rarity-stats">
        <div class="rarity-stat common">æ™®é€š: @Stats.CommonCount</div>
        <div class="rarity-stat rare">ç¨€æœ‰: @Stats.RareCount</div>
        <div class="rarity-stat epic">å²è¯—: @Stats.EpicCount</div>
        <div class="rarity-stat legendary">ä¼ è¯´: @Stats.LegendaryCount</div>
    </div>
    
    <div class="codex-filters">
        <select @bind="FilterSlot">
            <option value="">å…¨éƒ¨æ§½ä½</option>
            @foreach (var slot in Enum.GetValues<EquipmentSlot>())
            {
                <option value="@slot">@slot</option>
            }
        </select>
        
        <select @bind="FilterRarity">
            <option value="">å…¨éƒ¨å“è´¨</option>
            @foreach (var rarity in Enum.GetValues<Rarity>())
            {
                <option value="@rarity">@rarity</option>
            }
        </select>
    </div>
    
    <div class="codex-grid">
        @foreach (var entry in FilteredEntries)
        {
            <div class="codex-item @(entry.IsCollected ? "collected" : "uncollected")">
                @if (entry.IsCollected)
                {
                    <div class="item-icon">@entry.Icon</div>
                    <div class="item-name">@entry.Name</div>
                    <div class="item-info">
                        <span>é¦–æ¬¡è·å¾—: @entry.FirstObtainedAt.ToString("yyyy-MM-dd")</span>
                        <span>è·å¾—æ¬¡æ•°: @entry.TimesObtained</span>
                        <span>æœ€ä½³è¯„åˆ†: @entry.BestQualityScore</span>
                    </div>
                }
                else
                {
                    <div class="item-icon unknown">â“</div>
                    <div class="item-name">???</div>
                }
            </div>
        }
    </div>
</div>
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. æ˜¾ç¤ºå›¾é‰´æ”¶é›†è¿›åº¦
2. æ˜¾ç¤ºå·²æ”¶é›†å’Œæœªæ”¶é›†çš„è£…å¤‡
3. ç­›é€‰å’Œæ’åºåŠŸèƒ½æ­£å¸¸
4. æŸ¥çœ‹å•ä¸ªè£…å¤‡è¯¦æƒ…
5. å®Œæˆé‡Œç¨‹ç¢‘æ˜¾ç¤ºå¥–åŠ±

**éªŒæ”¶æ ‡å‡†**:
- âœ… å›¾é‰´è®°å½•å‡†ç¡®
- âœ… ç»Ÿè®¡æ•°æ®æ­£ç¡®
- âœ… é‡Œç¨‹ç¢‘å¥–åŠ±æ­£å¸¸å‘æ”¾
- âœ… UIç¾è§‚æ˜“ç”¨

---

### Phase 7 éªŒæ”¶æ€»ç»“

**å®Œæˆæ ‡å‡†**:
- âœ… è£…å¤‡å¼ºåŒ–ç³»ç»Ÿå®Œæ•´å¯ç”¨ï¼ˆæ ¸å¿ƒï¼‰
- âœ… è£…å¤‡ç²¾ç‚¼ç³»ç»Ÿå®ç°ï¼ˆå¯é€‰ï¼‰
- âœ… è£…å¤‡ä¼ æ‰¿ç³»ç»Ÿå®ç°ï¼ˆå¯é€‰ï¼‰
- âœ… è£…å¤‡ç»‘å®šæœºåˆ¶å®Œæˆ
- âœ… è£…å¤‡å›¾é‰´ç³»ç»Ÿå®Œæˆï¼ˆå¯é€‰ï¼‰
- âœ… æ‰€æœ‰é«˜çº§åŠŸèƒ½å‰ç«¯ç•Œé¢å‹å¥½
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**å‰ç«¯éªŒè¯æ¸…å•**:
- [x] è£…å¤‡å¼ºåŒ–ç•Œé¢åŠŸèƒ½å®Œæ•´
- [x] å¼ºåŒ–æˆåŠŸ/å¤±è´¥åŠ¨ç”»æµç•…
- [x] ç²¾ç‚¼ç•Œé¢æ¸…æ™°æ˜“ç”¨
- [x] ä¼ æ‰¿ç•Œé¢é€»è¾‘æ­£ç¡®
- [x] ç»‘å®šçŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [x] å›¾é‰´ç•Œé¢ç¾è§‚å®ç”¨

**ä¸‹ä¸€æ­¥**:
- è¿›å…¥Phase 8: èŒä¸šé™åˆ¶ä¸å¹³è¡¡è°ƒæ•´

---

## Phase 8: èŒä¸šé™åˆ¶ä¸å¹³è¡¡è°ƒæ•´ (ç¬¬17-18å‘¨)

### é˜¶æ®µç›®æ ‡

å®ç°å®Œæ•´çš„èŒä¸šè£…å¤‡é™åˆ¶ç³»ç»Ÿï¼Œè¿›è¡Œæ•°å€¼å¹³è¡¡è°ƒæ•´ï¼Œç¡®ä¿ä¸åŒèŒä¸šçš„è£…å¤‡ä½“éªŒå‡è¡¡åˆç†ã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### Task 8.1: å®ç°èŒä¸šè£…å¤‡éªŒè¯ âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**ä¾èµ–**: Phase 1å®Œæˆ

**å®æ–½æ­¥éª¤**:

1. åˆ›å»º `EquipmentValidator.cs`
```csharp
/// <summary>
/// è£…å¤‡éªŒè¯æœåŠ¡ - éªŒè¯èŒä¸šé™åˆ¶ã€ç­‰çº§éœ€æ±‚ç­‰
/// </summary>
public class EquipmentValidator
{
    private readonly EquipmentSystemConfiguration _config;
    private readonly IProfessionModule _professionModule;
    
    /// <summary>
    /// éªŒè¯æ˜¯å¦å¯ä»¥è£…å¤‡
    /// </summary>
    public ValidationResult ValidateEquip(
        Character character,
        GearDefinition gearDef,
        EquipmentSlot targetSlot)
    {
        var errors = new List<string>();
        
        // 1. ç­‰çº§éœ€æ±‚æ£€æŸ¥
        if (character.Level < gearDef.RequiredLevel)
        {
            errors.Add($"éœ€è¦ç­‰çº§ {gearDef.RequiredLevel}ï¼ˆå½“å‰ {character.Level}ï¼‰");
        }
        
        // 2. æ§½ä½åŒ¹é…æ£€æŸ¥
        if (gearDef.Slot != targetSlot && !IsTwoHandedWeaponCase(gearDef, targetSlot))
        {
            errors.Add($"è£…å¤‡æ§½ä½ä¸åŒ¹é…");
        }
        
        // 3. èŒä¸šé™åˆ¶æ£€æŸ¥
        var professionRestriction = ValidateProfessionRestriction(
            character.Profession,
            gearDef);
        
        if (!professionRestriction.IsValid)
        {
            errors.AddRange(professionRestriction.Errors);
        }
        
        // 4. åŒæ‰‹æ­¦å™¨å ç”¨æ£€æŸ¥
        if (gearDef.IsTwoHanded)
        {
            var twoHandValidation = ValidateTwoHandedWeapon(character);
            if (!twoHandValidation.IsValid)
            {
                errors.AddRange(twoHandValidation.Errors);
            }
        }
        
        return new ValidationResult
        {
            IsValid = errors.Count == 0,
            Errors = errors
        };
    }
    
    private ValidationResult ValidateProfessionRestriction(
        string profession,
        GearDefinition gearDef)
    {
        var errors = new List<string>();
        var professionConfig = _config.ProfessionRestrictions
            .FirstOrDefault(p => p.ProfessionId == profession);
        
        if (professionConfig == null)
        {
            errors.Add($"æœªæ‰¾åˆ°èŒä¸š {profession} çš„é…ç½®");
            return ValidationResult.Invalid(errors);
        }
        
        // æŠ¤ç”²ç±»å‹æ£€æŸ¥
        if (gearDef.ArmorType != ArmorType.None &&
            !professionConfig.AllowedArmorTypes.Contains(gearDef.ArmorType))
        {
            errors.Add($"{profession} æ— æ³•è£…å¤‡ {GetArmorTypeName(gearDef.ArmorType)}");
        }
        
        // æ­¦å™¨ç±»å‹æ£€æŸ¥
        if (gearDef.WeaponType != WeaponType.None &&
            !professionConfig.AllowedWeaponTypes.Contains(gearDef.WeaponType))
        {
            errors.Add($"{profession} æ— æ³•è£…å¤‡ {GetWeaponTypeName(gearDef.WeaponType)}");
        }
        
        // ç›¾ç‰Œæ£€æŸ¥
        if (gearDef.WeaponType == WeaponType.Shield &&
            !professionConfig.CanUseShields)
        {
            errors.Add($"{profession} æ— æ³•è£…å¤‡ç›¾ç‰Œ");
        }
        
        return new ValidationResult
        {
            IsValid = errors.Count == 0,
            Errors = errors
        };
    }
    
    private ValidationResult ValidateTwoHandedWeapon(Character character)
    {
        // æ£€æŸ¥ä¸»æ‰‹å’Œå‰¯æ‰‹æ˜¯å¦æœ‰è£…å¤‡
        var mainHandEquipped = character.Equipment.Any(e => e.Slot == EquipmentSlot.MainHand);
        var offHandEquipped = character.Equipment.Any(e => e.Slot == EquipmentSlot.OffHand);
        
        if (mainHandEquipped || offHandEquipped)
        {
            return ValidationResult.Invalid("è£…å¤‡åŒæ‰‹æ­¦å™¨éœ€è¦å¸ä¸‹ä¸»æ‰‹å’Œå‰¯æ‰‹è£…å¤‡");
        }
        
        return ValidationResult.Valid();
    }
    
    private bool IsTwoHandedWeaponCase(GearDefinition gearDef, EquipmentSlot targetSlot)
    {
        // åŒæ‰‹æ­¦å™¨å¯ä»¥è£…å¤‡åˆ°TwoHandæ§½ä½
        return gearDef.IsTwoHanded && targetSlot == EquipmentSlot.TwoHand;
    }
}

public class ValidationResult
{
    public bool IsValid { get; set; }
    public List<string> Errors { get; set; } = new();
    
    public static ValidationResult Valid() => new() { IsValid = true };
    public static ValidationResult Invalid(string error) =>
        new() { IsValid = false, Errors = new List<string> { error } };
    public static ValidationResult Invalid(List<string> errors) =>
        new() { IsValid = false, Errors = errors };
}
```

2. åœ¨ `EquipmentService` ä¸­é›†æˆéªŒè¯
```csharp
public async Task<EquipResult> EquipItemAsync(
    Guid characterId,
    Guid gearInstanceId,
    EquipmentSlot slot)
{
    var character = await _characterRepo.GetByIdAsync(characterId);
    var gear = await _gearRepo.GetByIdAsync(gearInstanceId);
    var gearDef = await _gearDefRepo.GetByIdAsync(gear.DefinitionId);
    
    // éªŒè¯
    var validation = _validator.ValidateEquip(character, gearDef, slot);
    if (!validation.IsValid)
    {
        return EquipResult.Error(string.Join(", ", validation.Errors));
    }
    
    // æ‰§è¡Œè£…å¤‡é€»è¾‘...
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. å°è¯•è£…å¤‡ä¸ç¬¦åˆèŒä¸šçš„è£…å¤‡æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
2. æˆ˜å£«æ— æ³•è£…å¤‡å¸ƒç”²
3. æ³•å¸ˆæ— æ³•è£…å¤‡åŒæ‰‹æ–§
4. è£…å¤‡åŒæ‰‹æ­¦å™¨æ—¶è‡ªåŠ¨å¸ä¸‹ä¸»å‰¯æ‰‹
5. é”™è¯¯æç¤ºæ¸…æ™°å‹å¥½

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰èŒä¸šé™åˆ¶æ­£ç¡®ç”Ÿæ•ˆ
- âœ… éªŒè¯é€»è¾‘æ— æ¼æ´
- âœ… é”™è¯¯æç¤ºå‡†ç¡®å‹å¥½
- âœ… 100%æµ‹è¯•è¦†ç›–ç‡

---

#### Task 8.2: æ•°å€¼å¹³è¡¡è°ƒæ•´ âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 12å°æ—¶  
**ä¾èµ–**: Phase 6å®Œæˆ

**å®æ–½æ­¥éª¤**:

1. å»ºç«‹æ•°å€¼å¹³è¡¡æµ‹è¯•æ¡†æ¶
```csharp
/// <summary>
/// æ•°å€¼å¹³è¡¡æµ‹è¯•å·¥å…·
/// </summary>
public class BalanceTestingService
{
    /// <summary>
    /// æ¨¡æ‹ŸèŒä¸šè£…å¤‡é…ç½®çš„æˆ˜æ–—è¡¨ç°
    /// </summary>
    public async Task<BalanceTestResult> TestProfessionBalance(
        string profession,
        List<GearInstance> equipment,
        int simulationRounds = 1000)
    {
        var results = new List<CombatSimulationResult>();
        
        for (int i = 0; i < simulationRounds; i++)
        {
            // åˆ›å»ºæµ‹è¯•è§’è‰²
            var testCharacter = CreateTestCharacter(profession, equipment);
            
            // åˆ›å»ºæ ‡å‡†æµ‹è¯•æ•Œäºº
            var testEnemy = CreateStandardTestEnemy();
            
            // è¿è¡Œæˆ˜æ–—æ¨¡æ‹Ÿ
            var combatResult = await _battleSimulator.SimulateCombat(
                testCharacter,
                testEnemy);
            
            results.Add(combatResult);
        }
        
        return new BalanceTestResult
        {
            Profession = profession,
            AverageTimeToKill = results.Average(r => r.Duration),
            AverageDamagePerSecond = results.Average(r => r.DPS),
            AverageSurvivability = results.Average(r => r.SurvivalTime),
            WinRate = results.Count(r => r.Victory) / (double)simulationRounds
        };
    }
    
    /// <summary>
    /// å¯¹æ¯”æ‰€æœ‰èŒä¸šçš„å¹³è¡¡æ€§
    /// </summary>
    public async Task<BalanceComparisonReport> CompareAllProfessions()
    {
        var professions = new[] { "Warrior", "Mage", "Ranger", "Priest" };
        var results = new Dictionary<string, BalanceTestResult>();
        
        foreach (var profession in professions)
        {
            // ä¸ºæ¯ä¸ªèŒä¸šç”Ÿæˆæ ‡å‡†è£…å¤‡é…ç½®
            var equipment = await GenerateStandardEquipment(profession);
            
            // æµ‹è¯•å¹³è¡¡æ€§
            var result = await TestProfessionBalance(profession, equipment);
            results[profession] = result;
        }
        
        return new BalanceComparisonReport
        {
            ProfessionResults = results,
            RecommendedAdjustments = AnalyzeAndRecommend(results)
        };
    }
    
    private List<BalanceAdjustment> AnalyzeAndRecommend(
        Dictionary<string, BalanceTestResult> results)
    {
        var adjustments = new List<BalanceAdjustment>();
        var avgDPS = results.Values.Average(r => r.AverageDamagePerSecond);
        
        foreach (var (profession, result) in results)
        {
            var dpsDiff = result.AverageDamagePerSecond - avgDPS;
            var diffPercent = Math.Abs(dpsDiff / avgDPS * 100);
            
            if (diffPercent > 10) // è¶…è¿‡10%åå·®éœ€è¦è°ƒæ•´
            {
                adjustments.Add(new BalanceAdjustment
                {
                    Profession = profession,
                    CurrentDPS = result.AverageDamagePerSecond,
                    TargetDPS = avgDPS,
                    RecommendedChange = dpsDiff > 0 ? "é™ä½ä¼¤å®³" : "æå‡ä¼¤å®³",
                    Magnitude = $"{diffPercent:F1}%"
                });
            }
        }
        
        return adjustments;
    }
}
```

2. è¿è¡Œå¹³è¡¡æ€§æµ‹è¯•å¹¶è®°å½•ç»“æœ
```bash
# è¿è¡Œå¹³è¡¡æ€§æµ‹è¯•
dotnet test --filter Category=BalanceTesting

# ç”Ÿæˆå¹³è¡¡æ€§æŠ¥å‘Š
dotnet run --project BalanceTestRunner -- --output-report balance_report.md
```

3. æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´æ•°å€¼

**ç¤ºä¾‹è°ƒæ•´**:
```json
{
  "BalanceAdjustments": {
    "2025-10-11": {
      "ArmorTypes": {
        "Plate": {
          "Before": { "BaseArmorMultiplier": 2.0 },
          "After": { "BaseArmorMultiplier": 1.8 },
          "Reason": "æ¿ç”²èŒä¸šç”Ÿå­˜èƒ½åŠ›è¿‡å¼º"
        }
      },
      "WeaponTypes": {
        "Staff": {
          "Before": { "AttackPowerMultiplier": 1.8 },
          "After": { "AttackPowerMultiplier": 2.0 },
          "Reason": "æ³•æ–ä¼¤å®³åä½"
        }
      }
    }
  }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. å¹³è¡¡è°ƒæ•´åå„èŒä¸šæˆ˜æ–—è¡¨ç°æ¥è¿‘
2. æ— æ˜æ˜¾è¿‡å¼ºæˆ–è¿‡å¼±èŒä¸š
3. ç©å®¶åé¦ˆæ»¡æ„åº¦æå‡

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰èŒä¸šDPSåå·® < 15%
- âœ… æ‰€æœ‰èŒä¸šç”Ÿå­˜èƒ½åŠ›åå·® < 20%
- âœ… ç©å®¶æ»¡æ„åº¦ > 80%
- âœ… æ— æ˜æ˜¾å¹³è¡¡æ€§é—®é¢˜åé¦ˆ

---

### Phase 8 éªŒæ”¶æ€»ç»“

**å®Œæˆæ ‡å‡†**:
- âœ… èŒä¸šè£…å¤‡é™åˆ¶å®Œæ•´å®ç°
- âœ… éªŒè¯é€»è¾‘æ— æ¼æ´
- âœ… æ•°å€¼å¹³è¡¡åˆç†
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

**ä¸‹ä¸€æ­¥**:
- è¿›å…¥Phase 9: å…¨ç³»ç»Ÿæµ‹è¯•ä¸æ–‡æ¡£

---

## Phase 9: å…¨ç³»ç»Ÿæµ‹è¯•ä¸æ–‡æ¡£ (ç¬¬19-20å‘¨)

### é˜¶æ®µç›®æ ‡

å…¨é¢æµ‹è¯•è£…å¤‡ç³»ç»Ÿæ‰€æœ‰åŠŸèƒ½ï¼Œç¼–å†™å®Œæ•´æ–‡æ¡£ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šå¯é ï¼Œæ–‡æ¡£é½å…¨ã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### Task 9.1: å•å…ƒæµ‹è¯•å®Œå–„ âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 16å°æ—¶  
**æµ‹è¯•è¦†ç›–ç›®æ ‡**: â‰¥ 90%

**æµ‹è¯•æ¸…å•**:

1. è£…å¤‡ç”Ÿæˆæµ‹è¯•
2. è£…å¤‡æ“ä½œæµ‹è¯•ï¼ˆè£…å¤‡/å¸ä¸‹ï¼‰
3. å±æ€§è®¡ç®—æµ‹è¯•
4. å¥—è£…æ•ˆæœæµ‹è¯•
5. è£…å¤‡å¢å¼ºæµ‹è¯•ï¼ˆåˆ†è§£/é‡é“¸/é‡ç½®ï¼‰
6. èŒä¸šé™åˆ¶æµ‹è¯•
7. æŠ¤ç”²å‡ä¼¤æµ‹è¯•
8. æ ¼æŒ¡æœºåˆ¶æµ‹è¯•
9. æ­¦å™¨æ”»é€Ÿæµ‹è¯•
10. è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æ— å·²çŸ¥bug

---

#### Task 9.2: é›†æˆæµ‹è¯•ä¸E2Eæµ‹è¯• âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 12å°æ—¶  

**æµ‹è¯•åœºæ™¯**:
1. å®Œæ•´è£…å¤‡æ‰è½æµç¨‹
2. å®Œæ•´è£…å¤‡ç®¡ç†æµç¨‹
3. å®Œæ•´è£…å¤‡å¢å¼ºæµç¨‹
4. è·¨ç³»ç»Ÿé›†æˆï¼ˆæˆ˜æ–—+è£…å¤‡ï¼‰
5. æ€§èƒ½æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- âœ… E2Eæµ‹è¯•è¦†ç›–ä¸»è¦æµç¨‹
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚

---

#### Task 9.3: æ–‡æ¡£ç¼–å†™ âœ…

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**é¢„è®¡æ—¶é—´**: 8å°æ—¶  

**æ–‡æ¡£æ¸…å•**:
1. ç”¨æˆ·æ‰‹å†Œ
2. å¼€å‘æ–‡æ¡£
3. APIæ–‡æ¡£
4. é…ç½®æ–‡æ¡£
5. è¿ç»´æ–‡æ¡£

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æ–‡æ¡£å®Œæ•´
- âœ… æ–‡æ¡£å‡†ç¡®æ¸…æ™°
- âœ… ä»£ç ç¤ºä¾‹å¯è¿è¡Œ

---

### Phase 9 éªŒæ”¶æ€»ç»“

**æœ€ç»ˆéªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- âœ… æ–‡æ¡£å®Œæ•´å‡†ç¡®
- âœ… æ— ä¸¥é‡bug
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚
- âœ… ç”¨æˆ·ä½“éªŒå‹å¥½

---

## æ€»ç»“ä¸å±•æœ›

### é¡¹ç›®æˆæœ

é€šè¿‡å®Œæ•´å®æ–½æœ¬ä¼˜åŒ–æ–¹æ¡ˆï¼ŒBlazorIdleè£…å¤‡ç³»ç»Ÿå°†å®ç°ï¼š

1. **å®Œæ•´çš„è£…å¤‡ç”Ÿæ€**: ä»ç”Ÿæˆã€æ‰è½ã€ç®¡ç†åˆ°å¢å¼ºçš„å®Œæ•´å¾ªç¯
2. **ç±»WoWçš„é«˜çº§ç‰¹æ€§**: 17æ§½ä½ã€æŠ¤ç”²ç±»å‹ã€æ­¦å™¨ç±»å‹ã€èŒä¸šé™åˆ¶
3. **ä¸°å¯Œçš„ä¼˜åŒ–ç©æ³•**: å¼ºåŒ–ã€ç²¾ç‚¼ã€ä¼ æ‰¿ã€å¥—è£…ç­‰æ·±åº¦ç³»ç»Ÿ
4. **ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ**: ç›´è§‚çš„UIã€æµç•…çš„æ“ä½œã€æ¸…æ™°çš„åé¦ˆ
5. **ç¨³å®šçš„æŠ€æœ¯æ¶æ„**: æ•°æ®é©±åŠ¨ã€æœåŠ¡ç«¯æƒå¨ã€é«˜åº¦å¯æ‰©å±•

### é¢„æœŸæ•ˆæœ

- ç©å®¶è£…å¤‡ç®¡ç†ä½“éªŒæå‡ **200%**
- è£…å¤‡ç³»ç»Ÿæ·±åº¦æå‡ **300%**
- ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§æå‡ **150%**
- ä¸ºæœªæ¥æ‰©å±•å¥ å®šåšå®åŸºç¡€

### åç»­æ‰©å±•æ–¹å‘

1. **é™„é­”ç³»ç»Ÿ**: ä¸ºè£…å¤‡æ·»åŠ ä¸´æ—¶æˆ–æ°¸ä¹…å¢ç›Š
2. **å®çŸ³é•¶åµŒ**: åœ¨è£…å¤‡ä¸Šé•¶åµŒå®çŸ³æä¾›é¢å¤–å±æ€§
3. **è£…å¤‡ç‰¹æ•ˆ**: è§¦å‘å¼æŠ€èƒ½æˆ–è¢«åŠ¨æ•ˆæœ
4. **è£…å¤‡çš®è‚¤**: è£…å¤‡å¤–è§‚å®šåˆ¶ç³»ç»Ÿ
5. **è£…å¤‡äº¤æ˜“**: ç©å®¶é—´è£…å¤‡äº¤æ˜“å’Œæ‹å–è¡Œ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**æœ€åæ›´æ–°**: 2025-10-11  
**ç»´æŠ¤å›¢é˜Ÿ**: BlazorIdleå¼€å‘å›¢é˜Ÿ  
**è®¾è®¡çŠ¶æ€**: âœ… å·²å®Œæˆ - ç­‰å¾…å®æ–½  

---

### ç›¸å…³æ–‡æ¡£

- **ä¸Šç¯‡**: [è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸Šç¯‡.md](è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸Šç¯‡.md)
- **ä¸­ç¯‡**: [è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸­ç¯‡.md](è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸­ç¯‡.md)
- **åŸæ–¹æ¡ˆä¸€**: [è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ.md](è£…å¤‡ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ.md)
- **åŸæ–¹æ¡ˆäºŒ**: [è£…å¤‡ç³»ç»Ÿä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆ.md](è£…å¤‡ç³»ç»Ÿä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆ.md)
- **å‚è€ƒ**: [æ•´åˆè®¾è®¡æ€»ç»“.txt](æ•´åˆè®¾è®¡æ€»ç»“.txt)

**å¤‡æ³¨**: æœ¬è®¾è®¡æ–¹æ¡ˆä»…ä¸ºæ–‡æ¡£äº¤ä»˜ï¼Œæœªä¿®æ”¹ä»»ä½•ä»£ç ã€‚æ‰€æœ‰ä»£ç å®æ–½å°†åœ¨å›¢é˜Ÿè¯„å®¡é€šè¿‡åï¼ŒæŒ‰ç…§9ä¸ªPhaseé€æ­¥è¿›è¡Œã€‚
