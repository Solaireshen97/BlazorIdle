# BlazorIdle è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ - ä¸­ç¯‡

**é¡¹ç›®**: BlazorIdle  
**æ–‡æ¡£ç±»å‹**: ç»¼åˆè®¾è®¡æ–¹æ¡ˆï¼ˆæ•´åˆç‰ˆï¼‰  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**ç‰ˆæœ¬**: 2.0 æ•´åˆç‰ˆ  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ - å¾…å®æ–½  
**æ–‡æ¡£åˆ†å†Œ**: ä¸­ç¯‡ï¼ˆå…±ä¸‰ç¯‡ï¼‰

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆçš„ä¸­ç¯‡ï¼Œæ‰¿æ¥ä¸Šç¯‡çš„åŸºç¡€è®¾æ–½å»ºè®¾ï¼Œé‡ç‚¹å®æ–½Phase 4-6ï¼š
- **Phase 4**: å‰ç«¯è£…å¤‡ç®¡ç†ç•Œé¢å®ç°
- **Phase 5**: è£…å¤‡å¢å¼ºç³»ç»Ÿï¼ˆåˆ†è§£/é‡é“¸/è¯æ¡é‡ç½®ï¼‰
- **Phase 6**: å¥—è£…ç³»ç»Ÿä¸æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“– ç›®å½•

### ä¸­ç¯‡å†…å®¹
1. [Phase 4: å‰ç«¯è£…å¤‡ç®¡ç†ç•Œé¢](#phase-4-å‰ç«¯è£…å¤‡ç®¡ç†ç•Œé¢-ç¬¬7-8å‘¨)
2. [Phase 5: è£…å¤‡å¢å¼ºç³»ç»Ÿ](#phase-5-è£…å¤‡å¢å¼ºç³»ç»Ÿ-ç¬¬9-11å‘¨)
3. [Phase 6: å¥—è£…ç³»ç»Ÿä¸ä¼˜åŒ–](#phase-6-å¥—è£…ç³»ç»Ÿä¸ä¼˜åŒ–-ç¬¬12-14å‘¨)
4. [ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ](#ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ)
5. [æŠ€æœ¯å®ç°è¦ç‚¹](#æŠ€æœ¯å®ç°è¦ç‚¹)

---

## Phase 4: å‰ç«¯è£…å¤‡ç®¡ç†ç•Œé¢ (ç¬¬7-8å‘¨)

### é˜¶æ®µç›®æ ‡

å®Œå–„å‰ç«¯è£…å¤‡é¢æ¿ï¼Œå®ç°è£…å¤‡æ“ä½œç•Œé¢ï¼Œè®©ç©å®¶å¯ä»¥ç›´è§‚åœ°ç®¡ç†è£…å¤‡ã€æŸ¥çœ‹å±æ€§ã€è¿›è¡Œè£…å¤‡å¯¹æ¯”ã€‚

### è¯¦ç»†ä»»åŠ¡æ¸…å•

#### Task 4.1: æ‰©å±•è£…å¤‡æ§½ä½åˆ°17ä¸ª âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**ä¾èµ–**: Phase 3å®Œæˆ

**å®æ–½æ­¥éª¤**:

1. æ›´æ–° `EquipmentPanel.razor` å¸ƒå±€

```razor
@* è£…å¤‡æ§½ä½å¸ƒå±€ - çº¸å¨ƒå¨ƒé£æ ¼ *@
<div class="equipment-panel">
    <div class="equipment-slots-left">
        @* å·¦ä¾§è£…å¤‡ *@
        @RenderSlot("head", "å¤´éƒ¨", "ğŸª–", EquipmentSlot.Head)
        @RenderSlot("neck", "é¢ˆéƒ¨", "ğŸ“¿", EquipmentSlot.Neck)
        @RenderSlot("shoulder", "è‚©éƒ¨", "ğŸ–ï¸", EquipmentSlot.Shoulder)
        @RenderSlot("back", "èƒŒéƒ¨", "ğŸ§¥", EquipmentSlot.Back)
        @RenderSlot("chest", "èƒ¸éƒ¨", "ğŸ›¡ï¸", EquipmentSlot.Chest)
        @RenderSlot("wrist", "æ‰‹è…•", "âŒš", EquipmentSlot.Wrist)
        @RenderSlot("hands", "æ‰‹éƒ¨", "ğŸ§¤", EquipmentSlot.Hands)
    </div>
    
    <div class="equipment-slots-center">
        @* ä¸­å¤®è§’è‰²æ¨¡å‹å ä½ *@
        <div class="character-model">
            <span style="font-size: 48px;">ğŸ§™</span>
            <div class="character-name">@CharacterName</div>
        </div>
    </div>
    
    <div class="equipment-slots-right">
        @* å³ä¾§è£…å¤‡ *@
        @RenderSlot("waist", "è…°éƒ¨", "ğŸ—ï¸", EquipmentSlot.Waist)
        @RenderSlot("legs", "è…¿éƒ¨", "ğŸ‘–", EquipmentSlot.Legs)
        @RenderSlot("feet", "è„šéƒ¨", "ğŸ‘¢", EquipmentSlot.Feet)
        @RenderSlot("finger1", "æˆ’æŒ‡1", "ğŸ’", EquipmentSlot.Finger1)
        @RenderSlot("finger2", "æˆ’æŒ‡2", "ğŸ’", EquipmentSlot.Finger2)
        @RenderSlot("trinket1", "é¥°å“1", "âœ¨", EquipmentSlot.Trinket1)
        @RenderSlot("trinket2", "é¥°å“2", "âœ¨", EquipmentSlot.Trinket2)
    </div>
    
    <div class="equipment-slots-weapons">
        @* æ­¦å™¨æ§½ä½ *@
        @RenderSlot("mainhand", "ä¸»æ‰‹", "âš”ï¸", EquipmentSlot.MainHand)
        @RenderSlot("offhand", "å‰¯æ‰‹", "ğŸ”°", EquipmentSlot.OffHand)
        @* åŒæ‰‹æ­¦å™¨å ä½ï¼ˆå¦‚æœè£…å¤‡äº†åŒæ‰‹æ­¦å™¨åˆ™æ˜¾ç¤ºï¼‰ *@
        @if (HasTwoHandedWeapon())
        {
            @RenderSlot("twohand", "åŒæ‰‹", "ğŸ—¡ï¸", EquipmentSlot.TwoHand)
        }
    </div>
</div>
```

2. æ›´æ–°CSSæ ·å¼
```css
.equipment-panel {
    display: grid;
    grid-template-columns: 200px 300px 200px;
    grid-template-rows: auto auto;
    gap: 16px;
    padding: 20px;
}

.equipment-slots-left,
.equipment-slots-right {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.equipment-slots-center {
    display: flex;
    justify-content: center;
    align-items: center;
    grid-row: 1 / 3;
}

.equipment-slots-weapons {
    grid-column: 1 / 4;
    display: flex;
    justify-content: center;
    gap: 16px;
}

.equipment-slot {
    width: 100%;
    height: 60px;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.equipment-slot:hover {
    border-color: #4CAF50;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.equipment-slot.has-item {
    border-color: #66bb6a;
    background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
}

.equipment-slot.rarity-common { border-color: #9e9e9e; }
.equipment-slot.rarity-rare { border-color: #2196F3; }
.equipment-slot.rarity-epic { border-color: #9C27B0; }
.equipment-slot.rarity-legendary { border-color: #FF9800; }
```

3. æ›´æ–° `@code` éƒ¨åˆ†
```csharp
private RenderFragment RenderSlot(string slotId, string slotName, string icon, EquipmentSlot slot) => builder =>
{
    var gearItem = Slots.FirstOrDefault(s => s.Slot == slot)?.Item;
    var hasItem = gearItem != null;
    var rarityClass = hasItem ? $"rarity-{gearItem.Rarity.ToLower()}" : "";
    
    builder.OpenElement(0, "div");
    builder.AddAttribute(1, "class", $"equipment-slot {(hasItem ? "has-item" : "")} {rarityClass}");
    builder.AddAttribute(2, "onclick", EventCallback.Factory.Create(this, () => OnSlotClick(slot)));
    builder.AddAttribute(3, "title", hasItem ? GetItemTooltip(gearItem) : $"ç©ºçš„{slotName}");
    
    // æ§½ä½å›¾æ ‡å’Œåç§°
    builder.OpenElement(4, "div");
    builder.AddAttribute(5, "class", "slot-header");
    builder.AddContent(6, $"{icon} {slotName}");
    builder.CloseElement();
    
    // è£…å¤‡ä¿¡æ¯
    if (hasItem)
    {
        builder.OpenElement(7, "div");
        builder.AddAttribute(8, "class", "item-info");
        builder.AddContent(9, $"{gearItem.Icon} {gearItem.Name}");
        builder.OpenElement(10, "div");
        builder.AddAttribute(11, "class", "item-level");
        builder.AddContent(12, $"iLvl {gearItem.ItemLevel} T{gearItem.Tier}");
        builder.CloseElement();
        builder.CloseElement();
    }
    else
    {
        builder.OpenElement(13, "div");
        builder.AddAttribute(14, "class", "empty-slot");
        builder.AddContent(15, "ç©º");
        builder.CloseElement();
    }
    
    builder.CloseElement();
};

private bool HasTwoHandedWeapon()
{
    return Slots.Any(s => s.Slot == EquipmentSlot.TwoHand && s.Item != null);
}

private string GetItemTooltip(GearInstanceDto item)
{
    var tooltip = $"{item.Name}\n";
    tooltip += $"ç‰©å“ç­‰çº§: {item.ItemLevel}\n";
    tooltip += $"å“çº§: T{item.Tier}\n";
    tooltip += $"è¯„åˆ†: {item.QualityScore}\n";
    
    // åŸºç¡€å±æ€§
    if (item.Stats.Any())
    {
        tooltip += "\nåŸºç¡€å±æ€§:\n";
        foreach (var stat in item.Stats)
        {
            tooltip += $"  {stat.Key}: {stat.Value}\n";
        }
    }
    
    // è¯æ¡
    if (item.Affixes?.Any() == true)
    {
        tooltip += "\nè¯æ¡:\n";
        foreach (var affix in item.Affixes)
        {
            tooltip += $"  {affix.DisplayName}\n";
        }
    }
    
    // å¥—è£…
    if (!string.IsNullOrEmpty(item.SetId))
    {
        tooltip += $"\nå¥—è£…: {item.SetId}\n";
    }
    
    return tooltip;
}

private async Task OnSlotClick(EquipmentSlot slot)
{
    await OnSlotClickCallback.InvokeAsync(slot);
}

[Parameter] public EventCallback<EquipmentSlot> OnSlotClickCallback { get; set; }
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. æ‰“å¼€è£…å¤‡é¢æ¿ï¼Œåº”çœ‹åˆ°17ä¸ªè£…å¤‡æ§½ä½
2. ç©ºæ§½ä½æ˜¾ç¤ºä¸ºç°è‰²ï¼Œå·²è£…å¤‡æ˜¾ç¤ºä¸ºç»¿è‰²
3. ä¸åŒç¨€æœ‰åº¦çš„è£…å¤‡è¾¹æ¡†é¢œè‰²ä¸åŒ
4. é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†çš„è£…å¤‡tooltip
5. ç‚¹å‡»æ§½ä½è§¦å‘äº‹ä»¶

**éªŒæ”¶æ ‡å‡†**:
- âœ… 17ä¸ªè£…å¤‡æ§½ä½å…¨éƒ¨æ˜¾ç¤º
- âœ… å¸ƒå±€ç¾è§‚ï¼Œç¬¦åˆçº¸å¨ƒå¨ƒé£æ ¼
- âœ… è£…å¤‡ä¿¡æ¯æ˜¾ç¤ºå®Œæ•´
- âœ… äº¤äº’æµç•…ï¼Œæ— å¡é¡¿

---

#### Task 4.2: å®ç°è£…å¤‡è¯¦æƒ…Tooltip âœ…

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**é¢„è®¡æ—¶é—´**: 4å°æ—¶  
**ä¾èµ–**: Task 4.1

**å®æ–½æ­¥éª¤**:

1. åˆ›å»º `GearTooltip.razor` ç»„ä»¶

```razor
@* è£…å¤‡è¯¦æƒ…Tooltipç»„ä»¶ *@
<div class="gear-tooltip @RarityClass">
    <div class="tooltip-header">
        <div class="item-name">@Item.Icon @Item.Name</div>
        <div class="item-quality">@Item.Rarity @(Item.IsBound ? "ï¼ˆç»‘å®šï¼‰" : "")</div>
    </div>
    
    <div class="tooltip-body">
        <div class="item-meta">
            <span>ç‰©å“ç­‰çº§: @Item.ItemLevel</span>
            <span>å“çº§: T@Item.Tier</span>
            <span>è¯„åˆ†: @Item.QualityScore</span>
        </div>
        
        @* æŠ¤ç”²/æ­¦å™¨ä¿¡æ¯ *@
        @if (Item.ArmorType != ArmorType.None)
        {
            <div class="armor-info">
                <span>æŠ¤ç”²ç±»å‹: @GetArmorTypeName(Item.ArmorType)</span>
                <span>æŠ¤ç”²å€¼: @Item.BaseArmor</span>
            </div>
        }
        
        @if (Item.WeaponType != WeaponType.None)
        {
            <div class="weapon-info">
                <span>æ­¦å™¨ç±»å‹: @GetWeaponTypeName(Item.WeaponType)</span>
                <span>æ”»å‡»é€Ÿåº¦: @Item.BaseAttackSpeed.ToString("F2")s</span>
                <span>ä¼¤å®³å€ç‡: @Item.AttackPowerMultiplier.ToString("F1")x</span>
            </div>
        }
        
        @if (Item.BlockChance > 0)
        {
            <div class="block-info">
                <span>æ ¼æŒ¡æ¦‚ç‡: @(Item.BlockChance * 100)%</span>
                <span>æ ¼æŒ¡å‡ä¼¤: @(Item.BlockReduction * 100)%</span>
            </div>
        }
        
        @* åŸºç¡€å±æ€§ *@
        @if (Item.Stats.Any())
        {
            <div class="base-stats">
                <div class="section-title">åŸºç¡€å±æ€§</div>
                @foreach (var stat in Item.Stats.OrderByDescending(s => s.Value))
                {
                    <div class="stat-line">
                        <span class="stat-name">@GetStatDisplayName(stat.Key)</span>
                        <span class="stat-value">+@FormatStatValue(stat.Key, stat.Value)</span>
                    </div>
                }
            </div>
        }
        
        @* è¯æ¡ *@
        @if (Item.Affixes?.Any() == true)
        {
            <div class="affixes">
                <div class="section-title">é™„åŠ è¯æ¡</div>
                @foreach (var affix in Item.Affixes)
                {
                    <div class="affix-line @GetAffixQualityClass(affix)">
                        @affix.DisplayName
                    </div>
                }
            </div>
        }
        
        @* å¥—è£…ä¿¡æ¯ *@
        @if (!string.IsNullOrEmpty(Item.SetId))
        {
            <div class="set-info">
                <div class="section-title">å¥—è£…: @SetName</div>
                <div class="set-pieces">@SetPieceCount / @SetTotalPieces</div>
                @foreach (var bonus in SetBonuses)
                {
                    <div class="set-bonus @(bonus.IsActive ? "active" : "inactive")">
                        (@bonus.RequiredPieces) @bonus.Description
                    </div>
                }
            </div>
        }
        
        @* éœ€æ±‚ *@
        <div class="requirements">
            <div class="req-line">éœ€è¦ç­‰çº§: @Item.RequiredLevel</div>
            @if (ProfessionRestrictions?.Any() == true)
            {
                <div class="req-line">é™å®šèŒä¸š: @string.Join(", ", ProfessionRestrictions)</div>
            }
        </div>
        
        @* å¯¹æ¯”ä¿¡æ¯ *@
        @if (ComparisonItem != null)
        {
            <div class="comparison">
                <div class="section-title">ä¸å½“å‰è£…å¤‡å¯¹æ¯”</div>
                @RenderComparison()
            </div>
        }
    </div>
    
    <div class="tooltip-footer">
        <div class="item-source">@Item.CreatedAt.ToString("yyyy-MM-dd HH:mm")</div>
    </div>
</div>

@code {
    [Parameter] public GearInstanceDto Item { get; set; }
    [Parameter] public GearInstanceDto? ComparisonItem { get; set; }
    [Parameter] public string SetName { get; set; }
    [Parameter] public int SetPieceCount { get; set; }
    [Parameter] public int SetTotalPieces { get; set; }
    [Parameter] public List<SetBonusInfo> SetBonuses { get; set; }
    [Parameter] public List<string> ProfessionRestrictions { get; set; }
    
    private string RarityClass => $"rarity-{Item.Rarity.ToString().ToLower()}";
    
    private string GetArmorTypeName(ArmorType type) => type switch
    {
        ArmorType.Cloth => "å¸ƒç”²",
        ArmorType.Leather => "çš®ç”²",
        ArmorType.Mail => "é”ç”²",
        ArmorType.Plate => "æ¿ç”²",
        _ => "æ— "
    };
    
    private string GetWeaponTypeName(WeaponType type) => type switch
    {
        WeaponType.Sword => "å‰‘",
        WeaponType.Dagger => "åŒ•é¦–",
        WeaponType.TwoHandSword => "åŒæ‰‹å‰‘",
        WeaponType.Shield => "ç›¾ç‰Œ",
        // ... å…¶ä»–ç±»å‹
        _ => type.ToString()
    };
    
    private string GetStatDisplayName(string statKey) => statKey switch
    {
        "AttackPower" => "æ”»å‡»å¼ºåº¦",
        "Health" => "ç”Ÿå‘½å€¼",
        "CritChance" => "æš´å‡»å‡ ç‡",
        "Haste" => "æ€¥é€Ÿ",
        "Armor" => "æŠ¤ç”²",
        _ => statKey
    };
    
    private string FormatStatValue(string statKey, double value)
    {
        if (statKey.Contains("Chance") || statKey.Contains("Percent"))
        {
            return $"{(value * 100):F1}%";
        }
        return value.ToString("F0");
    }
    
    private string GetAffixQualityClass(AffixDto affix)
    {
        // æ ¹æ®è¯æ¡æ•°å€¼è´¨é‡è¿”å›CSSç±»
        return "affix-quality-normal";
    }
    
    private RenderFragment RenderComparison() => builder =>
    {
        // å®ç°è£…å¤‡å¯¹æ¯”é€»è¾‘
        // æ˜¾ç¤ºå±æ€§å·®å¼‚ï¼Œç»¿è‰²è¡¨ç¤ºæå‡ï¼Œçº¢è‰²è¡¨ç¤ºé™ä½
    };
    
    public class SetBonusInfo
    {
        public int RequiredPieces { get; set; }
        public string Description { get; set; }
        public bool IsActive { get; set; }
    }
}
```

2. æ·»åŠ CSSæ ·å¼
```css
.gear-tooltip {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    border: 2px solid #3498db;
    border-radius: 8px;
    padding: 16px;
    min-width: 300px;
    max-width: 400px;
    color: #ecf0f1;
    font-family: 'Arial', sans-serif;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.gear-tooltip.rarity-common { border-color: #95a5a6; }
.gear-tooltip.rarity-rare { border-color: #3498db; }
.gear-tooltip.rarity-epic { border-color: #9b59b6; }
.gear-tooltip.rarity-legendary { border-color: #f39c12; }

.tooltip-header {
    border-bottom: 1px solid rgba(255,255,255,0.2);
    padding-bottom: 8px;
    margin-bottom: 12px;
}

.item-name {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 4px;
}

.item-quality {
    font-size: 12px;
    opacity: 0.8;
}

.tooltip-body {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.section-title {
    font-weight: bold;
    color: #f39c12;
    margin-bottom: 4px;
}

.stat-line, .affix-line {
    display: flex;
    justify-content: space-between;
    padding: 2px 0;
}

.stat-value {
    color: #2ecc71;
    font-weight: bold;
}

.affix-line {
    color: #3498db;
}

.set-bonus.active {
    color: #2ecc71;
}

.set-bonus.inactive {
    color: #7f8c8d;
}

.requirements {
    border-top: 1px solid rgba(255,255,255,0.2);
    padding-top: 8px;
    font-size: 12px;
    color: #bdc3c7;
}

.comparison .stat-increase {
    color: #2ecc71;
}

.comparison .stat-decrease {
    color: #e74c3c;
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. é¼ æ ‡æ‚¬åœåœ¨è£…å¤‡ä¸Šæ˜¾ç¤ºè¯¦ç»†Tooltip
2. Tooltipæ˜¾ç¤ºæ‰€æœ‰è£…å¤‡ä¿¡æ¯ï¼ˆå±æ€§ã€è¯æ¡ã€å¥—è£…ã€éœ€æ±‚ï¼‰
3. æŠ¤ç”²ç±»å‹å’Œæ­¦å™¨ç±»å‹æ­£ç¡®æ˜¾ç¤º
4. æ ¼æŒ¡ä¿¡æ¯ï¼ˆå¦‚æœ‰ç›¾ç‰Œï¼‰æ­£ç¡®æ˜¾ç¤º
5. è£…å¤‡å¯¹æ¯”ä¿¡æ¯æ¸…æ™°æ˜“æ‡‚

**éªŒæ”¶æ ‡å‡†**:
- âœ… Tooltipä¿¡æ¯å®Œæ•´å‡†ç¡®
- âœ… ä¸åŒç¨€æœ‰åº¦è¾¹æ¡†é¢œè‰²ä¸åŒ
- âœ… å¸ƒå±€ç¾è§‚ï¼Œæ˜“è¯»æ€§å¼º
- âœ… å¥—è£…ä¿¡æ¯æ­£ç¡®æ˜¾ç¤ºæ¿€æ´»çŠ¶æ€

---

#### Task 4.3: å®ç°èƒŒåŒ…è£…å¤‡åˆ—è¡¨ä¸ç­›é€‰ âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**ä¾èµ–**: Task 4.1

**å®æ–½æ­¥éª¤**:

1. æ‰©å±• `InventoryPanel.razor` æ·»åŠ è£…å¤‡ç­›é€‰

```razor
<div class="inventory-filters">
    <div class="filter-group">
        <label>æ§½ä½ç­›é€‰:</label>
        <select @bind="SelectedSlotFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="Head">å¤´éƒ¨</option>
            <option value="Chest">èƒ¸éƒ¨</option>
            <option value="Weapon">æ­¦å™¨</option>
            @* ... å…¶ä»–æ§½ä½ *@
        </select>
    </div>
    
    <div class="filter-group">
        <label>å“è´¨ç­›é€‰:</label>
        <select @bind="SelectedRarityFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="Common">æ™®é€š</option>
            <option value="Rare">ç¨€æœ‰</option>
            <option value="Epic">å²è¯—</option>
            <option value="Legendary">ä¼ è¯´</option>
        </select>
    </div>
    
    <div class="filter-group">
        <label>å¯è£…å¤‡:</label>
        <input type="checkbox" @bind="ShowEquippableOnly" />
    </div>
    
    <div class="filter-group">
        <label>æ’åº:</label>
        <select @bind="SortBy">
            <option value="Score">è¯„åˆ†</option>
            <option value="ItemLevel">ç‰©å“ç­‰çº§</option>
            <option value="Rarity">ç¨€æœ‰åº¦</option>
            <option value="Created">è·å–æ—¶é—´</option>
        </select>
    </div>
    
    <button @onclick="ApplyFilters">åº”ç”¨ç­›é€‰</button>
    <button @onclick="ClearFilters">æ¸…é™¤ç­›é€‰</button>
</div>

<div class="inventory-equipment-list">
    @foreach (var item in FilteredEquipment)
    {
        <div class="equipment-item @GetItemClass(item)" @onclick="() => OnEquipmentClick(item)">
            <div class="item-icon">@item.Icon</div>
            <div class="item-details">
                <div class="item-name @GetRarityClass(item.Rarity)">
                    @item.Name
                </div>
                <div class="item-stats">
                    <span>iLvl @item.ItemLevel</span>
                    <span>T@item.Tier</span>
                    <span>â­@item.QualityScore</span>
                </div>
                <div class="item-slot">@GetSlotDisplayName(item.SlotType)</div>
            </div>
            <div class="item-actions">
                @if (CanEquip(item))
                {
                    <button class="btn-equip" @onclick="() => OnEquipClick(item)" @onclick:stopPropagation="true">
                        è£…å¤‡
                    </button>
                }
                else
                {
                    <span class="cannot-equip">æ— æ³•è£…å¤‡</span>
                }
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public List<GearInstanceDto> AllEquipment { get; set; }
    [Parameter] public string CurrentProfession { get; set; }
    [Parameter] public int CharacterLevel { get; set; }
    [Parameter] public EventCallback<GearInstanceDto> OnEquipCallback { get; set; }
    
    private string SelectedSlotFilter { get; set; } = "";
    private string SelectedRarityFilter { get; set; } = "";
    private bool ShowEquippableOnly { get; set; } = false;
    private string SortBy { get; set; } = "Score";
    
    private List<GearInstanceDto> FilteredEquipment => GetFilteredEquipment();
    
    private List<GearInstanceDto> GetFilteredEquipment()
    {
        var filtered = AllEquipment.AsEnumerable();
        
        // æ§½ä½ç­›é€‰
        if (!string.IsNullOrEmpty(SelectedSlotFilter))
        {
            filtered = filtered.Where(e => e.SlotType.ToString() == SelectedSlotFilter);
        }
        
        // å“è´¨ç­›é€‰
        if (!string.IsNullOrEmpty(SelectedRarityFilter))
        {
            filtered = filtered.Where(e => e.Rarity.ToString() == SelectedRarityFilter);
        }
        
        // å¯è£…å¤‡ç­›é€‰
        if (ShowEquippableOnly)
        {
            filtered = filtered.Where(CanEquip);
        }
        
        // æ’åº
        filtered = SortBy switch
        {
            "Score" => filtered.OrderByDescending(e => e.QualityScore),
            "ItemLevel" => filtered.OrderByDescending(e => e.ItemLevel),
            "Rarity" => filtered.OrderByDescending(e => e.Rarity),
            "Created" => filtered.OrderByDescending(e => e.CreatedAt),
            _ => filtered
        };
        
        return filtered.ToList();
    }
    
    private bool CanEquip(GearInstanceDto item)
    {
        // ç­‰çº§æ£€æŸ¥
        if (item.RequiredLevel > CharacterLevel)
            return false;
        
        // èŒä¸šé™åˆ¶æ£€æŸ¥ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”è°ƒç”¨éªŒè¯æœåŠ¡ï¼‰
        // TODO: è°ƒç”¨ EquipmentValidator è¿›è¡Œå®Œæ•´éªŒè¯
        
        return true;
    }
    
    private string GetItemClass(GearInstanceDto item)
    {
        var classes = new List<string> { "equipment-item" };
        
        if (item.IsEquipped)
            classes.Add("equipped");
        
        if (!CanEquip(item))
            classes.Add("cannot-equip");
        
        return string.Join(" ", classes);
    }
    
    private string GetRarityClass(Rarity rarity)
    {
        return $"rarity-{rarity.ToString().ToLower()}";
    }
    
    private string GetSlotDisplayName(EquipmentSlot slot)
    {
        // æ§½ä½æ˜¾ç¤ºåç§°æ˜ å°„
        return slot.ToString();
    }
    
    private async Task OnEquipmentClick(GearInstanceDto item)
    {
        // æ˜¾ç¤ºè£…å¤‡è¯¦æƒ…
    }
    
    private async Task OnEquipClick(GearInstanceDto item)
    {
        await OnEquipCallback.InvokeAsync(item);
    }
    
    private void ApplyFilters()
    {
        StateHasChanged();
    }
    
    private void ClearFilters()
    {
        SelectedSlotFilter = "";
        SelectedRarityFilter = "";
        ShowEquippableOnly = false;
        SortBy = "Score";
        StateHasChanged();
    }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. èƒŒåŒ…æ˜¾ç¤ºæ‰€æœ‰æœªè£…å¤‡çš„è£…å¤‡
2. æ§½ä½ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
3. å“è´¨ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
4. å¯è£…å¤‡ç­›é€‰æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è£…å¤‡
5. æ’åºåŠŸèƒ½æ­£ç¡®æ’åˆ—è£…å¤‡
6. ç‚¹å‡»"è£…å¤‡"æŒ‰é’®å¯è£…å¤‡ç‰©å“
7. æ— æ³•è£…å¤‡çš„ç‰©å“æ˜¾ç¤ºç¦ç”¨çŠ¶æ€

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç­›é€‰åŠŸèƒ½å‡†ç¡®æ— è¯¯
- âœ… æ’åºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… UIå“åº”æµç•…
- âœ… è£…å¤‡æ“ä½œæˆåŠŸç‡100%

---

#### Task 4.4: å®ç°è£…å¤‡æ“ä½œäº¤äº’ âœ…

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**é¢„è®¡æ—¶é—´**: 5å°æ—¶  
**ä¾èµ–**: Task 4.1, 4.2, 4.3

**å®æ–½æ­¥éª¤**:

1. åˆ›å»º `EquipmentApiClient.cs`

```csharp
namespace BlazorIdle.Client.Services;

/// <summary>
/// è£…å¤‡APIå®¢æˆ·ç«¯
/// </summary>
public class EquipmentApiClient
{
    private readonly HttpClient _httpClient;
    private readonly ILogger<EquipmentApiClient> _logger;
    
    public EquipmentApiClient(HttpClient httpClient, ILogger<EquipmentApiClient> logger)
    {
        _httpClient = httpClient;
        _logger = logger;
    }
    
    /// <summary>
    /// è£…å¤‡ç‰©å“
    /// </summary>
    public async Task<ApiResponse<EquipmentResponse>> EquipItemAsync(
        Guid characterId, 
        Guid gearInstanceId, 
        EquipmentSlot slot)
    {
        try
        {
            var response = await _httpClient.PostAsJsonAsync(
                $"api/equipment/{characterId}/{slot}",
                new { GearInstanceId = gearInstanceId }
            );
            
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<EquipmentResponse>();
                _logger.LogInformation("Successfully equipped item {GearId} to slot {Slot}", 
                    gearInstanceId, slot);
                return ApiResponse<EquipmentResponse>.Success(result);
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                _logger.LogWarning("Failed to equip item: {Error}", error);
                return ApiResponse<EquipmentResponse>.Error(error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Exception while equipping item");
            return ApiResponse<EquipmentResponse>.Error("è£…å¤‡å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
    }
    
    /// <summary>
    /// å¸ä¸‹è£…å¤‡
    /// </summary>
    public async Task<ApiResponse<EquipmentResponse>> UnequipItemAsync(
        Guid characterId, 
        EquipmentSlot slot)
    {
        try
        {
            var response = await _httpClient.DeleteAsync(
                $"api/equipment/{characterId}/{slot}"
            );
            
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<EquipmentResponse>();
                _logger.LogInformation("Successfully unequipped item from slot {Slot}", slot);
                return ApiResponse<EquipmentResponse>.Success(result);
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                _logger.LogWarning("Failed to unequip item: {Error}", error);
                return ApiResponse<EquipmentResponse>.Error(error);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Exception while unequipping item");
            return ApiResponse<EquipmentResponse>.Error("å¸ä¸‹å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
    }
    
    /// <summary>
    /// è·å–è£…å¤‡æ 
    /// </summary>
    public async Task<ApiResponse<EquipmentResponse>> GetEquipmentAsync(Guid characterId)
    {
        try
        {
            var response = await _httpClient.GetAsync($"api/equipment/{characterId}");
            
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<EquipmentResponse>();
                return ApiResponse<EquipmentResponse>.Success(result);
            }
            else
            {
                return ApiResponse<EquipmentResponse>.Error("è·å–è£…å¤‡æ å¤±è´¥");
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Exception while getting equipment");
            return ApiResponse<EquipmentResponse>.Error("è·å–è£…å¤‡æ å¤±è´¥");
        }
    }
    
    /// <summary>
    /// è·å–è£…å¤‡å±æ€§
    /// </summary>
    public async Task<ApiResponse<Dictionary<string, double>>> GetEquipmentStatsAsync(
        Guid characterId)
    {
        try
        {
            var response = await _httpClient.GetAsync($"api/equipment/{characterId}/stats");
            
            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<Dictionary<string, double>>();
                return ApiResponse<Dictionary<string, double>>.Success(result);
            }
            else
            {
                return ApiResponse<Dictionary<string, double>>.Error("è·å–è£…å¤‡å±æ€§å¤±è´¥");
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Exception while getting equipment stats");
            return ApiResponse<Dictionary<string, double>>.Error("è·å–è£…å¤‡å±æ€§å¤±è´¥");
        }
    }
}

public class ApiResponse<T>
{
    public bool Success { get; set; }
    public T Data { get; set; }
    public string ErrorMessage { get; set; }
    
    public static ApiResponse<T> Success(T data) => new() { Success = true, Data = data };
    public static ApiResponse<T> Error(string message) => new() { Success = false, ErrorMessage = message };
}
```

2. æ›´æ–°è£…å¤‡é¢æ¿å®ç°è£…å¤‡æ“ä½œ

```razor
@inject EquipmentApiClient EquipmentApi
@inject IToastService ToastService

@code {
    private bool _isLoading = false;
    
    private async Task OnSlotClick(EquipmentSlot slot)
    {
        var currentItem = Slots.FirstOrDefault(s => s.Slot == slot)?.Item;
        
        if (currentItem != null)
        {
            // å·²æœ‰è£…å¤‡ï¼Œæ˜¾ç¤ºæ“ä½œèœå•ï¼ˆå¸ä¸‹/å¯¹æ¯”/è¯¦æƒ…ï¼‰
            await ShowEquipmentMenu(slot, currentItem);
        }
        else
        {
            // ç©ºæ§½ä½ï¼Œæ˜¾ç¤ºå¯è£…å¤‡çš„ç‰©å“åˆ—è¡¨
            await ShowEquippableItems(slot);
        }
    }
    
    private async Task EquipItem(Guid gearInstanceId, EquipmentSlot slot)
    {
        if (_isLoading) return;
        
        _isLoading = true;
        StateHasChanged();
        
        try
        {
            var response = await EquipmentApi.EquipItemAsync(CharacterId, gearInstanceId, slot);
            
            if (response.Success)
            {
                // æ›´æ–°è£…å¤‡æ 
                Slots = response.Data.Slots;
                TotalStats = response.Data.TotalStats;
                
                await ToastService.ShowSuccess("è£…å¤‡æˆåŠŸ");
                StateHasChanged();
            }
            else
            {
                await ToastService.ShowError($"è£…å¤‡å¤±è´¥: {response.ErrorMessage}");
            }
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }
    
    private async Task UnequipItem(EquipmentSlot slot)
    {
        if (_isLoading) return;
        
        // ç¡®è®¤å¯¹è¯æ¡†
        var confirmed = await JSRuntime.InvokeAsync<bool>("confirm", "ç¡®å®šè¦å¸ä¸‹è¿™ä»¶è£…å¤‡å—ï¼Ÿ");
        if (!confirmed) return;
        
        _isLoading = true;
        StateHasChanged();
        
        try
        {
            var response = await EquipmentApi.UnequipItemAsync(CharacterId, slot);
            
            if (response.Success)
            {
                Slots = response.Data.Slots;
                TotalStats = response.Data.TotalStats;
                
                await ToastService.ShowSuccess("å¸ä¸‹æˆåŠŸ");
                StateHasChanged();
            }
            else
            {
                await ToastService.ShowError($"å¸ä¸‹å¤±è´¥: {response.ErrorMessage}");
            }
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }
}
```

**å‰ç«¯éªŒè¯ç‚¹**:
1. ç‚¹å‡»ç©ºæ§½ä½æ˜¾ç¤ºå¯è£…å¤‡ç‰©å“åˆ—è¡¨
2. ç‚¹å‡»å·²è£…å¤‡æ§½ä½æ˜¾ç¤ºæ“ä½œèœå•
3. è£…å¤‡ç‰©å“æˆåŠŸåï¼Œè£…å¤‡æ ç«‹å³æ›´æ–°
4. å±æ€§é¢æ¿åŒæ­¥æ›´æ–°
5. æ“ä½œå¤±è´¥æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º
6. å¸ä¸‹è£…å¤‡å‰æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
7. æ“ä½œè¿‡ç¨‹ä¸­æ˜¾ç¤ºloadingçŠ¶æ€

**éªŒæ”¶æ ‡å‡†**:
- âœ… è£…å¤‡æ“ä½œæˆåŠŸç‡100%
- âœ… UIæ›´æ–°åŠæ—¶å‡†ç¡®
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… ç”¨æˆ·ä½“éªŒæµç•…

---

### Phase 4 éªŒæ”¶æ€»ç»“

**å®Œæˆæ ‡å‡†**:
- âœ… 17ä¸ªè£…å¤‡æ§½ä½å…¨éƒ¨å®ç°å¹¶å¯ç”¨
- âœ… è£…å¤‡è¯¦æƒ…Tooltipä¿¡æ¯å®Œæ•´å‡†ç¡®
- âœ… èƒŒåŒ…è£…å¤‡ç­›é€‰å’Œæ’åºåŠŸèƒ½æ­£å¸¸
- âœ… è£…å¤‡æ“ä½œï¼ˆè£…å¤‡/å¸ä¸‹ï¼‰æˆåŠŸç‡100%
- âœ… å‰ç«¯UIç¾è§‚å‹å¥½
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚ï¼ˆè£…å¤‡åˆ‡æ¢ < 200msï¼‰

**å‰ç«¯éªŒè¯æ¸…å•**:
- [x] è£…å¤‡é¢æ¿17æ§½ä½æ˜¾ç¤ºæ­£å¸¸
- [x] Tooltipæ˜¾ç¤ºå®Œæ•´è£…å¤‡ä¿¡æ¯
- [x] æŠ¤ç”²ç±»å‹å’Œæ­¦å™¨ç±»å‹æ­£ç¡®æ˜¾ç¤º
- [x] æ ¼æŒ¡ä¿¡æ¯ï¼ˆç›¾ç‰Œï¼‰æ­£ç¡®æ˜¾ç¤º
- [x] èƒŒåŒ…ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [x] è£…å¤‡æ“ä½œæˆåŠŸå¹¶æ›´æ–°UI
- [x] å±æ€§é¢æ¿åŒæ­¥æ›´æ–°
- [x] é”™è¯¯æç¤ºå‹å¥½æ¸…æ™°

**ä¸‹ä¸€æ­¥**:
- è¿›å…¥Phase 5: è£…å¤‡å¢å¼ºç³»ç»Ÿ

---

*(ä¸­ç¯‡å†…å®¹ç»§ç»­...)*

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**æœ€åæ›´æ–°**: 2025-10-11  
**ç»´æŠ¤å›¢é˜Ÿ**: BlazorIdleå¼€å‘å›¢é˜Ÿ  

---

### ç›¸å…³æ–‡æ¡£

- **ä¸Šç¯‡**: [è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸Šç¯‡.md](è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸Šç¯‡.md)
- **ä¸‹ç¯‡**: [è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸‹ç¯‡.md](è£…å¤‡ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ-ä¸‹ç¯‡.md)
