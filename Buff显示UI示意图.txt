╔══════════════════════════════════════════════════════════════════════════════════╗
║                   BlazorIdle - Buff状态显示UI布局示意图                             ║
║                        (Step 3: 已完成实现)                                         ║
╚══════════════════════════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────────────────────────┐
│                              🎮 战斗界面                                          │
└────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────┬──────────────────────────────────┐
│    👤 玩家状态面板                │    🎯 怪物状态面板                │
│                                  │                                  │
│  ⚔️ 战士 玩家名称                 │  🎯 当前目标                      │
│  ⏱️ 已战斗 2m15s                 │  哥布林战士 Lv.20                │
│                                  │                                  │
│  HP: ████████░░ 850/1000 (85%)  │  HP: ████████▒▒ 1250/1500 (83%) │
│                                  │                                  │
│  ⚔️ 攻击节奏                      │  其他敌人 (2):                   │
│  普通攻击: ████████▒▒ 1.2s       │  ├─ 哥布林弓手  ██████░░░░ 60%  │
│  特殊攻击: ██▒▒▒▒▒▒▒▒ 3.8s       │  └─ 哥布林萨满  ████░░░░░░ 40%  │
│                                  │                                  │
└──────────────────────────────────┴──────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│  🎭 增益效果                                                         │ ◄── 新增 (Step 3)
├────────────────────────────────────────────────────────────────────┤
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐                  │
│  │  🛡️   │  │  ⚡   │  │  💪   │  │  ✨   │                  │
│  │   5    │  │   2    │  │   3    │  │   1    │  ◄── 层数（右上角）
│  │ 8.5s   │  │ 12.0s  │  │ 15.0s  │  │ 20.0s  │  ◄── 倒计时（底部）
│  └────────┘  └────────┘  └────────┘  └────────┘                  │
│     破甲        精准        狂暴        奥术                        │
│                                                                    │
│  • 48x48像素Buff卡片                                              │
│  • 绿色边框 (#4caf50) + 浅绿背景 (#e8f5e9)                        │
│  • 悬停显示详细信息（Buff名称、层数、剩余时间、来源）             │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│  😈 减益效果                                                         │ ◄── 新增 (Step 3)
├────────────────────────────────────────────────────────────────────┤
│  ┌────────┐  ┌────────┐                                           │
│  │  🐌   │  │  💀   │                                           │
│  │        │  │   1    │                                           │
│  │ 3.2s   │  │ 5.0s   │                                           │
│  └────────┘  └────────┘                                           │
│     减速        中毒                                               │
│                                                                    │
│  • 红色边框 (#f44336) + 浅红背景 (#ffebee)                        │
│  • 自动区分增益/减益效果                                           │
└────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│  🏰 地下城：新手洞穴                                                │
├────────────────────────────────────────────────────────────────────┤
│  进度: Wave 3/5 | Run 2 | 🎯 Boss即将出现                          │
│  击杀: 12/15 怪物                                                   │
│  收益: 💰 1,250 金币 | ⭐ 3,420 经验                              │
└────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          Buff卡片详细设计                                         ║
╚══════════════════════════════════════════════════════════════════════════════════╝

   增益Buff卡片                           减益Buff卡片
   
   ┌────────┐                             ┌────────┐
   │  🛡️   │ ◄── Emoji图标（20px）        │  🐌   │
   │╔═╗     │                              │╔═╗     │
   │║5║     │ ◄── 层数标记（右上角）       │║ ║     │
   │╚═╝     │     黑色半透明背景           │╚═╝     │
   │        │     白色文字                 │        │
   │ 8.5s   │ ◄── 倒计时（底部）           │ 3.2s   │
   └────────┘     小号字体（9px）          └────────┘
   
   边框: 2px solid #4caf50 (绿色)        边框: 2px solid #f44336 (红色)
   背景: #e8f5e9 (浅绿)                   背景: #ffebee (浅红)
   尺寸: 48x48px                          尺寸: 48x48px
   圆角: 6px                              圆角: 6px
   光标: help (悬停时显示提示)            光标: help


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          悬停提示框内容                                           ║
╚══════════════════════════════════════════════════════════════════════════════════╝

   鼠标悬停在Buff图标上时显示：
   
   ┌─────────────────────┐
   │ 🛡️ 破甲              │
   ├─────────────────────┤
   │ 层数: 5/10          │
   │ 剩余: 8.5秒         │
   │ 来源: 英勇打击      │ ◄── 预留字段（当前为null）
   ├─────────────────────┤
   │ 效果:                │ ◄── 未来可扩展
   │ • 目标护甲 -5% (每层)│
   │ • 总计: -25% 护甲   │
   └─────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════╗
║                       支持的Buff图标映射表（部分）                                 ║
╚══════════════════════════════════════════════════════════════════════════════════╝

战士职业:
  破甲/armor       🛡️   护甲减少效果
  精准/precision   ⚡   命中率提升
  狂暴/fury         💪   攻击力提升
  流血/bleed        💀   持续伤害

法师职业:
  冰霜/frostbite   ❄️   减速+伤害
  燃烧/burn         🔥   持续火焰伤害
  奥术/arcane       ✨   魔法增强

游侠职业:
  中毒/poison       🐍   持续毒伤
  猎人标记/hunter   🏹   伤害增幅
  速度/speed        ⚡   移动速度

通用增益:
  急速/haste        ⏱️   攻击速度
  力量/strength     💪   力量属性
  护盾/shield       🛡️   伤害吸收
  回复/regen        💚   生命恢复

减益效果:
  减速/slow         🐌   移动速度降低
  眩晕/stun         💫   无法行动
  沉默/silence      🤐   无法施法

默认图标:           ✨   未识别的Buff


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          时间格式化规则                                           ║
╚══════════════════════════════════════════════════════════════════════════════════╝

剩余时间 >= 3600秒 (1小时)  →  显示: ∞
剩余时间 >= 60秒 (1分钟)    →  显示: Xm    (如: 3m)
剩余时间 > 0秒              →  显示: X.Xs  (如: 8.5s)
剩余时间 = 0秒              →  显示: 0s


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          响应式布局说明                                           ║
╚══════════════════════════════════════════════════════════════════════════════════╝

Buff图标容器使用 flex-wrap 布局：

宽屏显示（>800px）:
  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐
  
中等屏幕（400-800px）:
  ┌────┐ ┌────┐ ┌────┐ ┌────┐
  ┌────┐ ┌────┐ ┌────┐ ┌────┐
  
窄屏显示（<400px）:
  ┌────┐ ┌────┐
  ┌────┐ ┌────┐
  ┌────┐ ┌────┐
  ┌────┐ ┌────┐

特性:
  • display: flex; flex-wrap: wrap;
  • gap: 8px; (卡片间距)
  • 自动换行适应屏幕宽度
  • 保持视觉一致性


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          数据流程图                                               ║
╚══════════════════════════════════════════════════════════════════════════════════╝

服务端:
  ┌─────────────────┐
  │ BattleContext   │
  │   .Buffs        │ ◄── BuffManager.Active
  └────────┬────────┘
           │
           ▼
  ┌─────────────────┐
  │ GetStatus()     │ ◄── 提取Buff信息
  │   foreach buff  │
  │   - 计算剩余时间 │
  │   - 映射图标     │
  │   - 创建DTO     │
  └────────┬────────┘
           │
           ▼
  ┌─────────────────┐
  │StepBattleStatus │
  │   .PlayerBuffs  │ ◄── List<BuffStatusDto>
  │   .EnemyBuffs   │
  └────────┬────────┘
           │
           │ HTTP Response (JSON)
           ▼
客户端:
  ┌─────────────────┐
  │StepStatusResp   │
  │   .PlayerBuffs  │ ◄── 接收Buff数据
  └────────┬────────┘
           │
           ▼
  ┌─────────────────┐
  │ Characters.razor│ ◄── 条件渲染
  │   @if (buffs)   │
  │   LINQ过滤      │
  └────────┬────────┘
           │
           ▼
  ┌─────────────────┐
  │BuffBarPanel.razor│ ◄── 显示Buff
  │   增益栏        │
  │   减益栏        │
  └─────────────────┘


╔══════════════════════════════════════════════════════════════════════════════════╗
║                          实施检查清单                                             ║
╚══════════════════════════════════════════════════════════════════════════════════╝

后端实现:
  ✅ BuffStatusDto 类定义
  ✅ StepBattleStatusDto 扩展
  ✅ GetBuffIcon() 方法实现
  ✅ GetStatus() Buff提取逻辑
  ✅ 客户端 ApiModels.cs 同步

前端实现:
  ✅ BuffBarPanel.razor 组件创建
  ✅ Buff卡片布局实现
  ✅ 层数和倒计时显示
  ✅ 增益/减益颜色区分
  ✅ 悬停提示功能
  ✅ 时间格式化方法
  ✅ Characters.razor 集成

测试验证:
  ✅ BuffStatusDtoTests.cs 单元测试
  ✅ 3个测试用例全部通过
  ✅ 编译测试通过（0错误）
  ✅ 向后兼容验证

文档完善:
  ✅ 设计方案更新（标记完成）
  ✅ 完成报告创建
  ✅ UI示意图创建（本文件）

待验证（运行时）:
  ⏸️ 实际战斗Buff显示效果
  ⏸️ 倒计时实时更新
  ⏸️ 悬停提示显示
  ⏸️ 响应式布局测试


═══════════════════════════════════════════════════════════════════════════════════
                               文档结束
═══════════════════════════════════════════════════════════════════════════════════
创建日期: 2025-10-10
项目: BlazorIdle
功能: Step 3 - Buff状态显示优化
状态: ✅ 完成
