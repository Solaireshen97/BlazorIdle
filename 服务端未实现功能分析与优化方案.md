# BlazorIdle æœåŠ¡ç«¯æœªå®ç°åŠŸèƒ½åˆ†æä¸ä¼˜åŒ–æ–¹æ¡ˆ

**é¡¹ç›®åç§°**: BlazorIdle - Webæ”¾ç½®RPGæ¸¸æˆ  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
**æ–‡æ¡£ç±»å‹**: éœ€æ±‚åˆ†æä¸å®æ–½æ–¹æ¡ˆ  
**çŠ¶æ€**: å·²å®Œæˆåˆ†æï¼Œå¾…å®¡æ ¸

---

## ğŸ“‹ æ–‡æ¡£ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [é¡¹ç›®ç°çŠ¶æ€»è§ˆ](#é¡¹ç›®ç°çŠ¶æ€»è§ˆ)
3. [è®¾è®¡ç›®æ ‡vså®ç°å¯¹æ¯”çŸ©é˜µ](#è®¾è®¡ç›®æ ‡vså®ç°å¯¹æ¯”çŸ©é˜µ)
4. [æœªå®ç°åŠŸèƒ½è¯¦ç»†åˆ†æ](#æœªå®ç°åŠŸèƒ½è¯¦ç»†åˆ†æ)
5. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰- æˆ˜æ–—ä¸èŒä¸šç³»ç»Ÿå¢å¼º](#ä¼˜åŒ–æ–¹æ¡ˆä¸Šç¯‡)
6. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸­ç¯‡ï¼‰- ç»æµä¸è£…å¤‡ç³»ç»Ÿå®Œå–„](#ä¼˜åŒ–æ–¹æ¡ˆä¸­ç¯‡)
7. [ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰- ç¤¾äº¤ä¸è¿›é˜¶åŠŸèƒ½](#ä¼˜åŒ–æ–¹æ¡ˆä¸‹ç¯‡)
8. [æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®](#æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®)
9. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)
10. [éªŒæ”¶æ–‡æ¡£](#éªŒæ”¶æ–‡æ¡£)

---

## æ‰§è¡Œæ‘˜è¦

### ğŸ“Š é¡¹ç›®åŸºæœ¬ä¿¡æ¯

**ä»£ç è§„æ¨¡**ï¼š
- æœåŠ¡ç«¯C#æ–‡ä»¶ï¼š285ä¸ª
- ä»£ç è¡Œæ•°ï¼šçº¦42,000è¡Œ
- æµ‹è¯•æ–‡ä»¶ï¼šå®Œæ•´çš„å•å…ƒæµ‹è¯•ä½“ç³»
- æ–‡æ¡£æ•°é‡ï¼š180+ä»½è¯¦ç»†æ–‡æ¡£

**æŠ€æœ¯æ ˆ**ï¼š
- åç«¯ï¼šASP.NET Core 9.0 + Entity Framework Core
- å‰ç«¯ï¼šBlazor WebAssembly  
- å®æ—¶é€šä¿¡ï¼šSignalR
- æ•°æ®åº“ï¼šSQLite
- è®¤è¯ï¼šJWT

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒç³»ç»Ÿï¼ˆ10ä¸ªï¼‰

1. **ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆJWTï¼‰** - å®Œæ•´å®ç°ï¼ŒåŒ…å«æ³¨å†Œã€ç™»å½•ã€è§’è‰²ç®¡ç†
2. **è§’è‰²ç®¡ç†ç³»ç»Ÿ** - å¤šè§’è‰²æ”¯æŒï¼Œè§’è‰²åˆ›å»ºã€åˆ é™¤ã€åˆ‡æ¢
3. **æˆ˜æ–—æ ¸å¿ƒå¼•æ“** - äº‹ä»¶é©±åŠ¨æˆ˜æ–—å¾ªç¯ã€æ­¥è¿›æˆ˜æ–—ã€ç¦»çº¿æˆ˜æ–—
4. **æŠ€èƒ½ç³»ç»Ÿ** - æŠ€èƒ½å®šä¹‰ã€è‡ªåŠ¨æ–½æ”¾å¼•æ“ã€å†·å´ç®¡ç†
5. **Buffç³»ç»Ÿ** - Buffå®šä¹‰ã€å åŠ ç­–ç•¥ã€å‘¨æœŸæ€§æ•ˆæœ
6. **è£…å¤‡ç³»ç»Ÿ** - è£…å¤‡ç”Ÿæˆã€å“çº§ç³»ç»Ÿã€è¯æ¡ç³»ç»Ÿã€åˆ†è§£é‡é“¸
7. **å•†åº—ç³»ç»Ÿ** - å•†åº—å®šä¹‰ã€ç‰©å“è´­ä¹°ã€åº“å­˜ç®¡ç†ã€åˆ·æ–°æœºåˆ¶
8. **æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿ** - å¤šæ§½ä½æ´»åŠ¨è®¡åˆ’ã€è‡ªåŠ¨è¡”æ¥ã€çŠ¶æ€ç®¡ç†
9. **ç¦»çº¿ç»“ç®—ç³»ç»Ÿ** - ç¦»çº¿æ—¶é—´è¡¥ç®—ã€å¥–åŠ±å‘æ”¾ã€å¿«è¿›å¼•æ“
10. **SignalRå®æ—¶é€šä¿¡** - æˆ˜æ–—äº‹ä»¶æ¨é€ã€çŠ¶æ€åŒæ­¥ã€è¿æ¥ç®¡ç†

### ğŸ”´ æ ¸å¿ƒç¼ºå¤±åŠŸèƒ½ï¼ˆ15ä¸ªå…³é”®ç³»ç»Ÿï¼‰

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ä¸å½“å‰ä»£ç å¯¹æ¯”ï¼Œè¯†åˆ«å‡ºä»¥ä¸‹å…³é”®æœªå®ç°åŠŸèƒ½ï¼š

#### æˆ˜æ–—ç³»ç»Ÿå±‚é¢ï¼ˆ7ä¸ªï¼‰
1. **åŒè½¨æˆ˜æ–—èŠ‚å¥** - Attack Track + Special Trackåˆ†ç¦»æœºåˆ¶
2. **èµ„æºæ¡¶ç³»ç»Ÿ** - æ€’æ°”ã€ç¢ç‰‡ç­‰èŒä¸šèµ„æºç®¡ç†
3. **èµ„æºæº¢å‡ºç­–ç•¥** - Clamp/Convertæœºåˆ¶
4. **æˆ˜æ–—æ®µèšåˆä¼˜åŒ–** - CombatSegmentäº‹ä»¶å‹ç¼©
5. **èŒä¸šå·®å¼‚åŒ–æœºåˆ¶** - èŒä¸šç‰¹æ€§èµ„æºã€ç‰¹æ®ŠTrackèŠ‚å¥
6. **æ•ŒäººæŠ€èƒ½AIä¼˜åŒ–** - æ™ºèƒ½æŠ€èƒ½é‡Šæ”¾ç­–ç•¥
7. **Procç³»ç»Ÿå¢å¼º** - è£…å¤‡ç‰¹æ•ˆè§¦å‘æœºåˆ¶

#### å†…å®¹ç³»ç»Ÿå±‚é¢ï¼ˆ5ä¸ªï¼‰
8. **åœ°å›¾/åŒºåŸŸç³»ç»Ÿ** - MapRegionã€åŒºåŸŸè§£é”é“¾ã€æ€ªç‰©æ± 
9. **ä»»åŠ¡ç³»ç»Ÿ** - ä¸»çº¿/æ”¯çº¿/æ—¥å¸¸ä»»åŠ¡ã€ä»»åŠ¡é“¾
10. **å£°æœ›ç³»ç»Ÿ** - å¤šæ´¾ç³»å£°æœ›ã€å£°æœ›ç­‰çº§ã€å£°æœ›å¥–åŠ±
11. **æ¡ä»¶/è§£é”DSL** - é€šç”¨æ¡ä»¶è¡¨è¾¾å¼å¼•æ“
12. **æ¶ˆè€—å“ç³»ç»Ÿ** - é£Ÿç‰©/è¯å‰‚è‡ªåŠ¨ä½¿ç”¨ç­–ç•¥

#### ç¤¾äº¤ä¸é«˜çº§åŠŸèƒ½ï¼ˆ3ä¸ªï¼‰
13. **å¤šè§’è‰²Rosterå¢å¼º** - æ§½ä½è§£é”ã€è§’è‰²åˆ‡æ¢ä¼˜åŒ–
14. **ç»„é˜Ÿ/å‰¯æœ¬ç³»ç»Ÿ** - é˜Ÿä¼ç®¡ç†ã€å‰¯æœ¬æŒç»­æŒ‚æœº
15. **ç›‘æ§ä¸è°ƒè¯•ç³»ç»Ÿ** - ç»æµæŒ‡æ ‡ç›‘æ§ã€Debugé¢æ¿

### ğŸ“ˆ ä¼˜åŒ–å»ºè®®æ¦‚è§ˆ

**ä»£ç è´¨é‡æå‡**ï¼š
- æ¶ˆé™¤é‡å¤ä»£ç ï¼šè¯†åˆ«å‡ºçº¦15å¤„å¯åˆå¹¶çš„é‡å¤é€»è¾‘
- å®Œå–„ä¸­æ–‡æ³¨é‡Šï¼šå½“å‰æ³¨é‡Šè¦†ç›–ç‡çº¦60%ï¼Œç›®æ ‡æå‡è‡³90%+
- ä¿®å¤æ½œåœ¨é—®é¢˜ï¼š3ä¸ªnullable warningï¼Œ1ä¸ªæœªä½¿ç”¨å­—æ®µè­¦å‘Š

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- æˆ˜æ–—æ®µå‹ç¼©ï¼šå‡å°‘ç¦»çº¿æˆ˜æ–—å†…å­˜å ç”¨
- æ¡ä»¶è¡¨è¾¾å¼ç¼“å­˜ï¼šæå‡è§£é”åˆ¤å®šæ€§èƒ½
- é…ç½®çƒ­æ›´æ–°ï¼šæ”¯æŒé…ç½®ä¸é‡å¯æ›´æ–°

**æ¶æ„æ”¹è¿›**ï¼š
- å¼•å…¥é¢†åŸŸäº‹ä»¶æ€»çº¿ï¼šé™ä½æ¨¡å—è€¦åˆ
- å®Œå–„ä¾èµ–æ³¨å…¥ï¼šæ‰€æœ‰æœåŠ¡å¯æµ‹è¯•
- åˆ†å±‚æ¸…æ™°åŒ–ï¼šé¢†åŸŸå±‚ã€åº”ç”¨å±‚ã€åŸºç¡€è®¾æ–½å±‚èŒè´£æ˜ç¡®

---

## é¡¹ç›®ç°çŠ¶æ€»è§ˆ

### 2.1 æ•´ä½“æ¶æ„è¯„ä¼°

BlazorIdleé¡¹ç›®é‡‡ç”¨**é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼Œæ¶æ„æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIå±‚ (13ä¸ªController)                    â”‚
â”‚  Auth, Battle, Character, Equipment, Shop, Activityç­‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ (Application Services)                   â”‚
â”‚  - ActivityPlanService        - JwtTokenService             â”‚
â”‚  - BattleNotificationService  - RewardGrantService          â”‚
â”‚  - OfflineFastForwardEngine   - MetricsCollectorService     â”‚
â”‚  - ShopService                - InventoryService            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¢†åŸŸå±‚ (Domain Models)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æˆ˜æ–—é¢†åŸŸ (Combat Domain) - æœ€å¤æ‚çš„å­åŸŸ                â”‚ â”‚
â”‚  â”‚  - BattleEngine          - BattleContext               â”‚ â”‚
â”‚  â”‚  - AutoCastEngine        - BuffManager                 â”‚ â”‚
â”‚  â”‚  - DamageCalculator      - ProcManager                 â”‚ â”‚
â”‚  â”‚  - EnemyRegistry         - SkillDefinition             â”‚ â”‚
â”‚  â”‚  - TrackState (âš ï¸ç®€åŒ–ç‰ˆ) - ResourceSet (âš ï¸åŸºç¡€ç‰ˆ)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è£…å¤‡é¢†åŸŸ (Equipment Domain)                            â”‚ â”‚
â”‚  â”‚  - GearDefinition        - GearInstance                â”‚ â”‚
â”‚  â”‚  - DisenchantService     - ReforgeService              â”‚ â”‚
â”‚  â”‚  - StatsAggregationService                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å•†åº—é¢†åŸŸ (Shop Domain)                                 â”‚ â”‚
â”‚  â”‚  - ShopDefinition        - ShopItem                    â”‚ â”‚
â”‚  â”‚  - ShopService           - ShopCacheService            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                        â”‚
â”‚  - EF Core Repositories      - Configuration Options       â”‚
â”‚  - SQLite DbContext          - DependencyInjection         â”‚
â”‚  - SignalR Hubs              - Logging                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯„ä¼°ç»“è®º**ï¼š
- âœ… **æ¶æ„ä¼˜ç§€**ï¼šæ¸…æ™°çš„åˆ†å±‚ï¼Œè‰¯å¥½çš„ä¾èµ–æ–¹å‘
- âœ… **å¯æµ‹è¯•æ€§é«˜**ï¼šä¾èµ–æ³¨å…¥å®Œå–„ï¼Œæ˜“äºç¼–å†™å•å…ƒæµ‹è¯•
- âœ… **å¯æ‰©å±•æ€§å¼º**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰ä»£ç 
- âš ï¸ **éƒ¨åˆ†åŠŸèƒ½ç®€åŒ–**ï¼šæˆ˜æ–—ç³»ç»Ÿä¸­çš„åŒè½¨ã€èµ„æºæ¡¶ç­‰é«˜çº§ç‰¹æ€§å°šæœªå®ç°
- âš ï¸ **ç¼ºå°‘éƒ¨åˆ†æ¨¡å—**ï¼šåœ°å›¾ã€ä»»åŠ¡ã€å£°æœ›ç­‰å†…å®¹ç³»ç»Ÿå°šæœªå¼€å‘


### 2.2 ä»£ç è´¨é‡åˆ†æ

**ä¼˜ç‚¹**ï¼š
1. **æ³¨é‡Šå®Œå–„**ï¼šæ ¸å¿ƒç±»å¦‚BattleEngineæœ‰è¯¦ç»†çš„XMLæ–‡æ¡£æ³¨é‡Š
2. **å‘½åæ¸…æ™°**ï¼šéµå¾ªC#å‘½åçº¦å®šï¼Œç±»åã€æ–¹æ³•åè¯­ä¹‰æ˜ç¡®
3. **é…ç½®åŒ–ç¨‹åº¦é«˜**ï¼šå¤§é‡å‚æ•°åœ¨appsettings.jsonä¸­å¯é…ç½®
4. **æµ‹è¯•è¦†ç›–**ï¼šæœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•é¡¹ç›®

**å¾…æ”¹è¿›**ï¼š
1. **ç¼–è¯‘è­¦å‘Š**ï¼š5ä¸ªç¼–è¯‘è­¦å‘Šéœ€è¦å¤„ç†
   - `CS0414`: `Characters._isSignalREnabled`å­—æ®µæœªä½¿ç”¨
   - `CS8602`: `BattleContext.cs`å¯èƒ½çš„nullå¼•ç”¨
   - `CS8601`: `ResourceSet.cs`å¯èƒ½çš„nullèµ‹å€¼
   - `CS0219`: æµ‹è¯•ä¸­æœªä½¿ç”¨çš„å˜é‡
   - `CS8625`: æµ‹è¯•ä¸­nullå­—é¢é‡è½¬æ¢é—®é¢˜

2. **é‡å¤ä»£ç **ï¼šéƒ¨åˆ†é€»è¾‘å­˜åœ¨é‡å¤ï¼Œå¯æŠ½å–å…¬å…±æ–¹æ³•
3. **æ—¥å¿—ä¸å‡**ï¼šæ—¥å¿—è¦†ç›–ç‡ä¸å‡åŒ€ï¼Œéƒ¨åˆ†å…³é”®è·¯å¾„ç¼ºå°‘æ—¥å¿—

### 2.3 æŠ€æœ¯å€ºåŠ¡ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥ä½œé‡ |
|------|------|--------|------------|
| ç¼–è¯‘è­¦å‘Š | 5ä¸ª | P1 | 1å°æ—¶ |
| TODOæ³¨é‡Š | 10ä¸ª | P2 | è¯„ä¼°ä¸­ |
| é‡å¤ä»£ç  | ~15å¤„ | P2 | 3å¤© |
| æ€§èƒ½ä¼˜åŒ–ç‚¹ | è‹¥å¹² | P3 | æŒ‰éœ€ |

---

## è®¾è®¡ç›®æ ‡vså®ç°å¯¹æ¯”çŸ©é˜µ

æ ¹æ®ã€Šæ•´åˆè®¾è®¡æ€»ç»“.txtã€‹ä¸­çš„è®¾è®¡ç›®æ ‡ï¼Œå¯¹æ¯”å½“å‰å®ç°çŠ¶æ€ï¼š

### 3.1 æ ¸å¿ƒå¾ªç¯ç³»ç»Ÿå¯¹æ¯”è¡¨

| è®¾è®¡æ¨¡å— | è®¾è®¡è¦ç‚¹ | å®ç°çŠ¶æ€ | å®Œæˆåº¦ | ä»£ç ä½ç½® |
|---------|---------|---------|-------|----------|
| **çŸ­å¾ªç¯ï¼ˆç§’~åˆ†é’Ÿï¼‰** | | | | |
| GameClock | ç»Ÿä¸€æ—¶é—´ç®¡ç† | âœ… å·²å®ç° | 100% | `Domain/Combat/GameClock.cs` |
| EventScheduler | ä¼˜å…ˆé˜Ÿåˆ—äº‹ä»¶è°ƒåº¦ | âœ… å·²å®ç° | 100% | `Domain/Combat/EventScheduler.cs` |
| AttackTrack | æ™®é€šæ”»å‡»è½¨é“ | âš ï¸ éƒ¨åˆ†å®ç° | 60% | `Domain/Combat/TrackState.cs` |
| SpecialTrack | ç‰¹æ®ŠæŠ€èƒ½è½¨é“ | âŒ æœªåˆ†ç¦» | 20% | ä¸AttackTrackæ··åˆ |
| ResourceBucket | èŒä¸šèµ„æºæ¡¶ | âš ï¸ åŸºç¡€å®ç° | 30% | `Domain/Combat/Resources/ResourceSet.cs` |
| OverflowPolicy | èµ„æºæº¢å‡ºç­–ç•¥ | âŒ æœªå®ç° | 0% | æ— ç›¸å…³ä»£ç  |
| AutoCastEngine | æŠ€èƒ½è‡ªåŠ¨æ–½æ”¾ | âœ… å·²å®ç° | 95% | `Domain/Combat/Skills/AutoCastEngine.cs` |
| BuffManager | Buffç®¡ç† | âœ… å·²å®ç° | 90% | `Domain/Combat/Buffs/BuffManager.cs` |
| **ä¸­å¾ªç¯ï¼ˆ0.5~5å°æ—¶ï¼‰** | | | | |
| ActivityPlan | æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿ | âœ… å·²å®ç° | 90% | `Domain/Activities/ActivityPlan.cs` |
| ActivitySlot | å¤šæ§½ä½ç®¡ç† | âœ… å·²å®ç° | 90% | `Application/Activities/ActivityPlanService.cs` |
| ç¦»çº¿å¿«è¿› | OfflineFastForwardEngine | âœ… å·²å®ç° | 85% | `Application/Battles/Offline/` |
| è£…å¤‡è·å–/é‡é“¸ | è£…å¤‡ç”Ÿæ€ | âœ… å·²å®ç° | 80% | `Domain/Equipment/` |
| **é•¿å¾ªç¯ï¼ˆå¤©/å‘¨ï¼‰** | | | | |
| å£°æœ›ç³»ç»Ÿ | å¤šæ´¾ç³»å£°æœ›æ¨è¿› | âŒ æœªå®ç° | 0% | æ— ç›¸å…³ä»£ç  |
| ä»»åŠ¡ç³»ç»Ÿ | æ—¥å¸¸/å‘¨å¸¸ä»»åŠ¡ | âŒ æœªå®ç° | 0% | æ— ç›¸å…³ä»£ç  |
| èŒä¸šè½¬èŒ | èŒä¸šè§£é”é“¾ | âš ï¸ æšä¸¾å­˜åœ¨ | 20% | `Domain/Combat/Professions/ProfessionType.cs` |
| åœ°å›¾è§£é” | MapRegionä½“ç³» | âŒ æœªå®ç° | 0% | æ— ç›¸å…³ä»£ç  |

### 3.2 æˆ˜æ–—ç³»ç»Ÿè¯¦ç»†å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | è®¾è®¡ç›®æ ‡ | å½“å‰å®ç° | å·®è·åˆ†æ |
|---------|---------|---------|---------|
| **åŒè½¨æœºåˆ¶** | | | |
| Attack Track | å—æ”»é€Ÿå½±å“ï¼Œå‘¨æœŸè§¦å‘ | TrackStateå­˜åœ¨ä½†æœªåˆ†ç¦» | éœ€è¦æ‹†åˆ†ä¸ºAttackTrackå’ŒSpecialTrack |
| Special Track | èŒä¸šç‰¹æ®ŠèŠ‚å¥ | æœªåˆ†ç¦» | éœ€è¦ç‹¬ç«‹çš„SpecialPulseEvent |
| **èµ„æºç³»ç»Ÿ** | | | |
| ResourceBucket | å¤šç§èµ„æºï¼ˆæ€’æ°”ã€ç¢ç‰‡ï¼‰ | ResourceSetæœ‰åŸºç¡€ç»“æ„ | éœ€è¦æ‰©å±•ï¼šæ”¯æŒmaxã€overflowç­–ç•¥ |
| OverflowConvert | æº¢å‡ºè½¬æ¢ä¸ºBuff | æ—  | éœ€è¦æ–°å¢OverflowPolicyå’Œè½¬æ¢é€»è¾‘ |
| **æŠ€èƒ½ç³»ç»Ÿ** | | | |
| AutoCast | æŒ‰æ§½ä½ä¼˜å…ˆçº§è‡ªåŠ¨æ–½æ”¾ | âœ… å·²å®ç° | AutoCastEngineå®Œæ•´ |
| SkillCost | å¤åˆæ¶ˆè€—ï¼ˆèµ„æº+å±‚æ•°ï¼‰ | âš ï¸ ç®€åŒ–ç‰ˆ | åªæ”¯æŒManaï¼Œéœ€è¦æ‰©å±• |
| TrackAffinity | æŠ€èƒ½ç»‘å®šTrack | æ—  | éœ€è¦åœ¨SkillDefinitionæ·»åŠ å­—æ®µ |
| **èšåˆä¼˜åŒ–** | | | |
| CombatSegment | äº‹ä»¶èšåˆå‡å°‘å­˜å‚¨ | âš ï¸ æœ‰Segmentæ¦‚å¿µ | èšåˆä¸å……åˆ† |
| SegmentFlush | æŒ‰é˜ˆå€¼flush | éƒ¨åˆ†å®ç° | åªæŒ‰æ—¶é—´ï¼ŒæœªæŒ‰äº‹ä»¶æ•° |

### 3.3 å†…å®¹ç³»ç»Ÿç¼ºå¤±åˆ†æ

| ç³»ç»Ÿæ¨¡å— | è®¾è®¡è¦æ±‚ | å½“å‰çŠ¶æ€ | å½±å“ |
|---------|---------|---------|------|
| **åœ°å›¾ç³»ç»Ÿ** | MapRegionã€åŒºåŸŸè§£é”é“¾ | âŒ å®Œå…¨ç¼ºå¤± | æ— è¿›ç¨‹æ„Ÿï¼Œæ— å†…å®¹å¼•å¯¼ |
| **ä»»åŠ¡ç³»ç»Ÿ** | ä¸»çº¿/æ”¯çº¿/æ—¥å¸¸/å‘¨å¸¸ | âŒ å®Œå…¨ç¼ºå¤± | ç¼ºå°‘å†…å®¹ç›®æ ‡ï¼Œç©å®¶æµå¤± |
| **å£°æœ›ç³»ç»Ÿ** | å¤šæ´¾ç³»ã€ç­‰çº§ã€å¥–åŠ± | âŒ å®Œå…¨ç¼ºå¤± | æ— é•¿æœŸç›®æ ‡ï¼Œé‡å¤æ€§ä¸è¶³ |
| **æ¡ä»¶DSL** | é€šç”¨è§£é”è¡¨è¾¾å¼å¼•æ“ | âŒ å®Œå…¨ç¼ºå¤± | æ— æ³•çµæ´»é…ç½®è§£é”æ¡ä»¶ |
| **æ¶ˆè€—å“ç³»ç»Ÿ** | é£Ÿç‰©/è¯å‰‚è‡ªåŠ¨ä½¿ç”¨ | âŒ å®Œå…¨ç¼ºå¤± | æˆ˜æ–—ç­–ç•¥å•ä¸€ |

---

## æœªå®ç°åŠŸèƒ½è¯¦ç»†åˆ†æ

### 4.1 æˆ˜æ–—ç³»ç»Ÿå¢å¼ºéœ€æ±‚

#### 4.1.1 åŒè½¨æˆ˜æ–—èŠ‚å¥ç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- åˆ†ç¦»AttackTrackï¼ˆæ™®é€šæ”»å‡»ï¼‰å’ŒSpecialTrackï¼ˆèŒä¸šç‰¹æ®ŠèŠ‚å¥ï¼‰
- AttackTrackå—æ”»é€Ÿ/æ€¥é€Ÿå½±å“
- SpecialTrackå›ºå®šå‘¨æœŸï¼Œä¸å—å¸¸è§„æ€¥é€Ÿå½±å“

**å½“å‰çŠ¶æ€**ï¼š
```csharp
// Domain/Combat/TrackState.cs - å½“å‰å®ç°
public class TrackState
{
    public TrackType Type { get; set; }  // æœ‰æšä¸¾ä½†æœªåˆ†ç¦»é€»è¾‘
    public double BaseInterval { get; set; }
    public double NextAt { get; set; }
}
```

**ç¼ºå¤±å†…å®¹**ï¼š
1. AttackTrackå’ŒSpecialTrackæ²¡æœ‰ç‹¬ç«‹çš„é€»è¾‘åˆ†æ”¯
2. SpecialTrackçš„å‘¨æœŸè®¡ç®—æœªä¸AttackTrackåŒºåˆ†
3. ç¼ºå°‘SpecialPulseEventçš„ç‰¹æ®Šå¤„ç†é€»è¾‘
4. èŒä¸šå·®å¼‚åŒ–é…ç½®æœªä½“ç°

**å®ç°éš¾åº¦**ï¼šâ­â­â­ (ä¸­ç­‰)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š3-5å¤©  
**ä¾èµ–**ï¼šéœ€è¦å…ˆå®Œå–„ResourceBucketç³»ç»Ÿ

**å®æ–½å»ºè®®**ï¼š
```csharp
// æ­¥éª¤1: æ‹†åˆ†TrackStateä¸ºä¸¤ä¸ªä¸“ç”¨ç±»
public class AttackTrackState {
    public double BaseAttackSpeed { get; set; }
    public double HasteModifier { get; set; }  // å—æ€¥é€Ÿå½±å“
    public double NextAttackAt { get; set; }
}

public class SpecialTrackState {
    public double BaseInterval { get; set; }  // å›ºå®šå‘¨æœŸ
    public double NextPulseAt { get; set; }
    public bool PauseWhenNoEnemies { get; set; }
}

// æ­¥éª¤2: åœ¨BattleContextä¸­åŒæ—¶ç»´æŠ¤ä¸¤ä¸ªTrack
public class BattleContext {
    public AttackTrackState AttackTrack { get; set; }
    public SpecialTrackState SpecialTrack { get; set; }
}
```

#### 4.1.2 èµ„æºæ¡¶ä¸æº¢å‡ºç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- æ”¯æŒå¤šç§èŒä¸šèµ„æºï¼ˆæ€’æ°”ã€å¯’å†°ç¢ç‰‡ã€ä¸“æ³¨å±‚ç­‰ï¼‰
- æ¯ç§èµ„æºæœ‰maxä¸Šé™
- æº¢å‡ºç­–ç•¥ï¼šClampï¼ˆæˆªæ–­ï¼‰æˆ–Convertï¼ˆè½¬æ¢ä¸ºBuff/å¦ä¸€èµ„æºï¼‰

**å½“å‰çŠ¶æ€**ï¼š
```csharp
// Domain/Combat/Resources/ResourceSet.cs - ç®€åŒ–ç‰ˆ
public class ResourceSet
{
    public int Mana { get; set; }
    public int MaxMana { get; set; }
}
```

**ç¼ºå¤±å†…å®¹**ï¼š
1. æ— ResourceBucketæŠ½è±¡
2. æ— å¤šèµ„æºæ”¯æŒï¼ˆåªæœ‰Manaï¼‰
3. æ— OverflowPolicyæšä¸¾å’Œå¤„ç†é€»è¾‘
4. æ— æº¢å‡ºè½¬æ¢ä¸ºBuffçš„æœºåˆ¶

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­ (è¾ƒé«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š5-7å¤©  
**æŠ€æœ¯è¦ç‚¹**ï¼š
- èµ„æºç±»å‹å¯é…ç½®
- æº¢å‡ºç­–ç•¥å¯é…ç½®
- ä¸Buffç³»ç»Ÿé›†æˆ

**å®æ–½å»ºè®®**ï¼š
```csharp
// æ­¥éª¤1: å®šä¹‰ResourceBucket
public class ResourceBucket {
    public string Id { get; set; }  // "rage", "shard", "focus"
    public int Current { get; set; }
    public int Max { get; set; }
    public OverflowPolicy Policy { get; set; }
    public ConversionRule? ConversionRule { get; set; }
}

public enum OverflowPolicy {
    Clamp,      // æˆªæ–­ï¼Œè¶…å‡ºéƒ¨åˆ†ä¸¢å¼ƒ
    Convert     // è½¬æ¢ä¸ºå¦ä¸€èµ„æºæˆ–Buff
}

public class ConversionRule {
    public string TargetId { get; set; }  // ç›®æ ‡èµ„æºæˆ–Buff ID
    public int Ratio { get; set; }        // è½¬æ¢æ¯”ä¾‹
}

// æ­¥éª¤2: åœ¨ResourceSetä¸­ç®¡ç†å¤šä¸ªBucket
public class ResourceSet {
    private Dictionary<string, ResourceBucket> _buckets = new();
    
    public void Add(string resourceId, int amount) {
        var bucket = _buckets[resourceId];
        int overflow = Math.Max(0, bucket.Current + amount - bucket.Max);
        
        if (overflow > 0 && bucket.Policy == OverflowPolicy.Convert) {
            HandleOverflow(bucket, overflow);
        }
        
        bucket.Current = Math.Min(bucket.Max, bucket.Current + amount);
    }
    
    private void HandleOverflow(ResourceBucket bucket, int overflow) {
        // æº¢å‡ºè½¬æ¢é€»è¾‘
    }
}
```

#### 4.1.3 æˆ˜æ–—æ®µèšåˆä¼˜åŒ–

**è®¾è®¡ç›®æ ‡**ï¼š
- æŒ‰äº‹ä»¶æ•°é˜ˆå€¼ï¼ˆå¦‚200ä¸ªäº‹ä»¶ï¼‰æˆ–æ—¶é—´é˜ˆå€¼ï¼ˆå¦‚5ç§’ï¼‰flush Segment
- Segmentèšåˆä¼¤å®³ã€èµ„æºã€Buffç­‰ç»Ÿè®¡ä¿¡æ¯
- å‡å°‘ç¦»çº¿æˆ˜æ–—çš„å­˜å‚¨å’Œä¼ è¾“æˆæœ¬

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰SegmentCollectorï¼Œä½†èšåˆä¸å……åˆ†
- åªæŒ‰æ—¶é—´flushï¼ŒæœªæŒ‰äº‹ä»¶æ•°
- èšåˆä¿¡æ¯ä¸å¤Ÿä¸°å¯Œ

**ç¼ºå¤±å†…å®¹**ï¼š
1. äº‹ä»¶æ•°é˜ˆå€¼é…ç½®
2. æ›´ä¸°å¯Œçš„èšåˆå­—æ®µï¼ˆdmgBySourceã€resourceFlowã€buffUptimeï¼‰
3. RNGç§å­èŒƒå›´è®°å½•

**å®ç°éš¾åº¦**ï¼šâ­â­ (ç®€å•)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š2-3å¤©

**å®æ–½å»ºè®®**ï¼š
```csharp
// æ­¥éª¤1: æ‰©å±•CombatSegment
public class CombatSegment {
    public double StartTime { get; set; }
    public double EndTime { get; set; }
    public int EventCount { get; set; }
    
    // æ–°å¢èšåˆå­—æ®µ
    public Dictionary<string, int> DamageBySource { get; set; }  // skillId -> totalDmg
    public Dictionary<string, int> ResourceFlow { get; set; }     // resourceId -> gained
    public Dictionary<string, double> BuffUptime { get; set; }    // buffId -> seconds
    public long RngSeedStart { get; set; }
    public long RngSeedEnd { get; set; }
}

// æ­¥éª¤2: åœ¨SegmentCollectorä¸­å¢åŠ äº‹ä»¶è®¡æ•°flush
public class SegmentCollector {
    private const int EVENT_THRESHOLD = 200;  // å¯é…ç½®
    
    public void AddEvent(IGameEvent evt) {
        // ...
        if (_events.Count >= EVENT_THRESHOLD) {
            Flush();
        }
    }
}
```

#### 4.1.4 èŒä¸šå·®å¼‚åŒ–æœºåˆ¶

**è®¾è®¡ç›®æ ‡**ï¼š
- æ¯ä¸ªèŒä¸šæœ‰ç‹¬ç‰¹çš„èµ„æºæœºåˆ¶ï¼ˆæˆ˜å£«-æ€’æ°”ã€æ³•å¸ˆ-ç¢ç‰‡ï¼‰
- SpecialTrackå‘¨æœŸä¸åŒï¼ˆæˆ˜å£«5ç§’ã€æ³•å¸ˆ3ç§’ï¼‰
- èµ„æºç”Ÿæˆæ–¹å¼ä¸åŒï¼ˆAttackç”Ÿæˆæ€’æ°”ã€Specialç”Ÿæˆä¸“æ³¨å±‚ï¼‰

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰ProfessionTypeæšä¸¾
- æ— èŒä¸šé…ç½®ä½“ç³»
- æ— èŒä¸šç‰¹æ®Šé€»è¾‘

**ç¼ºå¤±å†…å®¹**ï¼š
1. ProfessionDefinitioné…ç½®
2. èŒä¸šèµ„æºæ˜ å°„
3. Special Trackå‘¨æœŸé…ç½®
4. èŒä¸šç‰¹æ€§Buff/æ•ˆæœ

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­ (è¾ƒé«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š7-10å¤©  
**ä¾èµ–**ï¼šåŒè½¨ç³»ç»Ÿã€èµ„æºæ¡¶ç³»ç»Ÿ

**å®æ–½å»ºè®®**ï¼š
```csharp
// æ­¥éª¤1: å®šä¹‰èŒä¸šé…ç½®
public class ProfessionDefinition {
    public ProfessionType Type { get; set; }
    public string Name { get; set; }
    
    // èµ„æºé…ç½®
    public string PrimaryResource { get; set; }      // "rage"
    public string SecondaryResource { get; set; }    // "focus_stacks"
    public int PrimaryResourceMax { get; set; }      // 100
    public int SecondaryResourceMax { get; set; }    // 3
    
    // Tracké…ç½®
    public double SpecialTrackInterval { get; set; } // 5.0 for warrior
    public double AttackHasteMod { get; set; }       // 1.0 default
    
    // èµ„æºç”Ÿæˆè§„åˆ™
    public ResourceGeneration AttackGeneration { get; set; }   // +1 rage per attack
    public ResourceGeneration SpecialGeneration { get; set; }  // +1 focus per pulse
    
    // æº¢å‡ºç­–ç•¥
    public OverflowPolicy PrimaryOverflow { get; set; }
    public ConversionRule? PrimaryConversion { get; set; }
}

// æ­¥éª¤2: åœ¨BattleContextä¸­åº”ç”¨èŒä¸šé…ç½®
public class BattleContext {
    private ProfessionDefinition _professionDef;
    
    public void ApplyProfessionSetup() {
        // åˆå§‹åŒ–èµ„æºæ¡¶
        Resources.AddBucket(_professionDef.PrimaryResource, _professionDef.PrimaryResourceMax);
        
        // é…ç½®Special Track
        SpecialTrack.BaseInterval = _professionDef.SpecialTrackInterval;
    }
}
```

### 4.2 å†…å®¹ç³»ç»Ÿéœ€æ±‚

#### 4.2.1 åœ°å›¾/åŒºåŸŸç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- MapRegionå®šä¹‰ï¼šåŒ…å«ç­‰çº§èŒƒå›´ã€æ€ªç‰©æ± ã€è§£é”æ¡ä»¶
- RegionGraphï¼šåŒºåŸŸé—´çš„è§£é”å…³ç³»é“¾
- åŒºåŸŸæŒ‚æœºï¼šä»æ€ªç‰©æ± éšæœºç”Ÿæˆæ•Œäºº

**å½“å‰çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**åŠŸèƒ½ä»·å€¼**ï¼š
- æä¾›å†…å®¹è¿›ç¨‹æ„Ÿ
- å¼•å¯¼ç©å®¶æ¢ç´¢
- å¢åŠ æ¸¸æˆæ·±åº¦

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­â­ (é«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š10-15å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Maps/MapRegion.cs
public class MapRegion {
    public string Id { get; set; }  // "forest_1"
    public string Name { get; set; }  // "å¹½æš—æ£®æ—"
    public int MinLevel { get; set; }
    public int MaxLevel { get; set; }
    
    // æ€ªç‰©æ± 
    public List<MonsterPoolEntry> MonsterPool { get; set; }
    
    // è§£é”æ¡ä»¶
    public string UnlockConditionExpr { get; set; }  // "level>=10 AND quest_completed('main_01')"
    
    // ç›¸é‚»åŒºåŸŸ
    public List<string> AdjacentRegions { get; set; }
}

public class MonsterPoolEntry {
    public string EnemyId { get; set; }
    public int Weight { get; set; }  // æƒé‡éšæœº
}

// Domain/Maps/RegionGraph.cs
public class RegionGraph {
    private Dictionary<string, MapRegion> _regions;
    
    public List<MapRegion> GetUnlockedRegions(Character character) {
        // æ ¹æ®æ¡ä»¶åˆ¤æ–­å“ªäº›åŒºåŸŸå·²è§£é”
    }
    
    public MapRegion? GetRecommendedRegion(int characterLevel) {
        // æ¨èåˆé€‚ç­‰çº§çš„åŒºåŸŸ
    }
}
```

**å®æ–½æ­¥éª¤**ï¼š
1. Phase 1: å®šä¹‰MapRegionæ•°æ®æ¨¡å‹ï¼ˆ2å¤©ï¼‰
2. Phase 2: å®ç°æ¡ä»¶è¡¨è¾¾å¼å¼•æ“ï¼ˆ3å¤©ï¼‰
3. Phase 3: åŒºåŸŸè§£é”é€»è¾‘ï¼ˆ2å¤©ï¼‰
4. Phase 4: æ€ªç‰©æ± éšæœºç”Ÿæˆï¼ˆ2å¤©ï¼‰
5. Phase 5: å‰ç«¯åŒºåŸŸé€‰æ‹©UIï¼ˆ2å¤©ï¼‰
6. Phase 6: æµ‹è¯•ä¸è°ƒä¼˜ï¼ˆ2å¤©ï¼‰

#### 4.2.2 ä»»åŠ¡ç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- ä»»åŠ¡ç±»å‹ï¼šä¸»çº¿ã€æ”¯çº¿ã€æ—¥å¸¸ã€å‘¨å¸¸ã€æˆå°±
- ä»»åŠ¡ç›®æ ‡ï¼šå‡»æ€ã€é‡‡é›†ã€è£…å¤‡ã€ç­‰çº§
- ä»»åŠ¡å¥–åŠ±ï¼šç»éªŒã€é‡‘å¸ã€ç‰©å“ã€å£°æœ›
- æ—¥å¸¸/å‘¨å¸¸è‡ªåŠ¨åˆ·æ–°

**å½“å‰çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**åŠŸèƒ½ä»·å€¼**ï¼š
- æä¾›æ˜ç¡®çš„æ¸¸æˆç›®æ ‡
- å¼•å¯¼ç©å®¶ä½“éªŒå„ç³»ç»Ÿ
- æä¾›æŒç»­çš„å¥–åŠ±æ¿€åŠ±

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­â­ (é«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š15-20å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Quests/Quest.cs
public class Quest {
    public string Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    public QuestType Type { get; set; }  // Main, Side, Daily, Weekly, Achievement
    
    // æ¥å–æ¡ä»¶
    public string AcceptCondition { get; set; }
    
    // ç›®æ ‡åˆ—è¡¨
    public List<QuestObjective> Objectives { get; set; }
    
    // å¥–åŠ±
    public QuestRewards Rewards { get; set; }
    
    // å‰ç½®ä»»åŠ¡
    public List<string> Prerequisites { get; set; }
}

public class QuestObjective {
    public QuestObjectiveType Type { get; set; }  // Kill, Gather, Equip, Level
    public string TargetId { get; set; }          // ç›®æ ‡IDï¼ˆæ€ªç‰©ID/ç‰©å“IDç­‰ï¼‰
    public int Required { get; set; }             // éœ€è¦æ•°é‡
    public int Current { get; set; }              // å½“å‰è¿›åº¦
}

public enum QuestObjectiveType {
    KillEnemy,        // å‡»æ€ç‰¹å®šæ•Œäºº
    GatherItem,       // é‡‡é›†ç‰¹å®šç‰©å“
    ReachLevel,       // è¾¾åˆ°ç­‰çº§
    EquipItem,        // è£…å¤‡ç‰¹å®šç‰©å“
    CompleteActivity, // å®Œæˆç‰¹å®šæ´»åŠ¨
    GainGold,         // è·å¾—é‡‘å¸
    VisitRegion       // è®¿é—®ç‰¹å®šåŒºåŸŸ
}

// Domain/Quests/QuestManager.cs
public class QuestManager {
    public void AcceptQuest(Character character, string questId) {
        // æ£€æŸ¥æ¡ä»¶ï¼Œæ¥å–ä»»åŠ¡
    }
    
    public void UpdateProgress(Character character, QuestObjectiveType type, string targetId, int amount) {
        // æ›´æ–°ä»»åŠ¡è¿›åº¦
    }
    
    public void CompleteQuest(Character character, string questId) {
        // å®Œæˆä»»åŠ¡ï¼Œå‘æ”¾å¥–åŠ±
    }
    
    public void ResetDailyQuests() {
        // æ¯æ—¥é‡ç½®
    }
}
```

**å®æ–½æ­¥éª¤**ï¼š
1. Phase 1: ä»»åŠ¡æ•°æ®æ¨¡å‹ï¼ˆ3å¤©ï¼‰
2. Phase 2: ä»»åŠ¡æ¥å–ä¸ç›®æ ‡è¿½è¸ªï¼ˆ4å¤©ï¼‰
3. Phase 3: ä»»åŠ¡å®Œæˆä¸å¥–åŠ±ï¼ˆ2å¤©ï¼‰
4. Phase 4: æ—¥å¸¸/å‘¨å¸¸åˆ·æ–°æœºåˆ¶ï¼ˆ3å¤©ï¼‰
5. Phase 5: å‰ç«¯ä»»åŠ¡UIï¼ˆ3å¤©ï¼‰
6. Phase 6: æµ‹è¯•ä¸å†…å®¹å¡«å……ï¼ˆ3å¤©ï¼‰

#### 4.2.3 å£°æœ›ç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- å¤šæ´¾ç³»å£°æœ›ç®¡ç†
- å£°æœ›ç­‰çº§ï¼šä¸­ç«‹â†’å‹å–„â†’å°Šæ•¬â†’å´‡æ•¬â†’å´‡æ‹œ
- å£°æœ›å¥–åŠ±ï¼šå•†åº—è§£é”ã€ç‰©å“è´­ä¹°ã€æŠ€èƒ½å­¦ä¹ 

**å½“å‰çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**åŠŸèƒ½ä»·å€¼**ï¼š
- æä¾›é•¿æœŸç›®æ ‡
- å¢åŠ é‡å¤æ€§å†…å®¹
- ä¸°å¯Œå¥–åŠ±ä½“ç³»

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­ (è¾ƒé«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š7-10å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Reputation/Faction.cs
public class Faction {
    public string Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    
    // å£°æœ›ç­‰çº§å®šä¹‰
    public List<ReputationLevel> Levels { get; set; }
}

public class ReputationLevel {
    public string Name { get; set; }  // "ä¸­ç«‹", "å‹å–„", "å°Šæ•¬"
    public int RequiredPoints { get; set; }
    public List<ReputationReward> Rewards { get; set; }
}

// Domain/Reputation/ReputationRecord.cs
public class ReputationRecord {
    public int CharacterId { get; set; }
    public string FactionId { get; set; }
    public int Points { get; set; }
    public string CurrentLevel { get; set; }
}

// Domain/Reputation/ReputationManager.cs
public class ReputationManager {
    public void GainReputation(Character character, string factionId, int amount) {
        // å¢åŠ å£°æœ›
        // æ£€æŸ¥æ˜¯å¦å‡çº§
        // è§£é”å¥–åŠ±
    }
    
    public string GetReputationLevel(Character character, string factionId) {
        // è·å–å½“å‰å£°æœ›ç­‰çº§
    }
    
    public List<ReputationReward> GetUnlockedRewards(Character character, string factionId) {
        // è·å–å·²è§£é”çš„å¥–åŠ±
    }
}
```

**å®æ–½æ­¥éª¤**ï¼š
1. Phase 1: å£°æœ›æ•°æ®æ¨¡å‹ï¼ˆ2å¤©ï¼‰
2. Phase 2: å£°æœ›è®¡ç®—ä¸ç­‰çº§åˆ¤å®šï¼ˆ2å¤©ï¼‰
3. Phase 3: å£°æœ›å¥–åŠ±ç³»ç»Ÿï¼ˆ2å¤©ï¼‰
4. Phase 4: ä¸å•†åº—ç³»ç»Ÿé›†æˆï¼ˆ2å¤©ï¼‰
5. Phase 5: å‰ç«¯å£°æœ›UIï¼ˆ2å¤©ï¼‰

#### 4.2.4 æ¡ä»¶/è§£é”DSLå¼•æ“

**è®¾è®¡ç›®æ ‡**ï¼š
- é€šç”¨æ¡ä»¶è¡¨è¾¾å¼è¯­è¨€
- æ”¯æŒï¼šç­‰çº§ã€ä»»åŠ¡ã€å£°æœ›ã€è£…å¤‡ã€æ—¶é—´ç­‰æ¡ä»¶
- è¡¨è¾¾å¼ç¼“å­˜å’Œå¤±æ•ˆç­–ç•¥

**å½“å‰çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**åŠŸèƒ½ä»·å€¼**ï¼š
- çµæ´»é…ç½®è§£é”æ¡ä»¶
- é™ä½ç¡¬ç¼–ç 
- æé«˜å¯ç»´æŠ¤æ€§

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­â­ (é«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š10-12å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Conditions/ConditionExpr.cs
public class ConditionExpr {
    public string Id { get; set; }
    public string RawExpression { get; set; }  // "level>=20 AND reputation('faction_a')>=300"
    public ConditionNode AST { get; set; }     // è§£æåçš„æŠ½è±¡è¯­æ³•æ ‘
    public List<string> Dependencies { get; set; }  // ["player.level", "reputation.faction_a"]
}

// Domain/Conditions/ConditionParser.cs
public class ConditionParser {
    public ConditionNode Parse(string expression) {
        // è¯æ³•åˆ†æ + è¯­æ³•åˆ†æ
        // æ”¯æŒï¼šAND, OR, NOT, >=, <=, ==, !=
        // æ”¯æŒå‡½æ•°è°ƒç”¨ï¼šquest_completed('id'), reputation('faction')
    }
}

// Domain/Conditions/ConditionEvaluator.cs
public class ConditionEvaluator {
    public bool Evaluate(ConditionNode node, Character character) {
        // é€’å½’æ±‚å€¼
        switch (node.Type) {
            case NodeType.And:
                return Evaluate(node.Left) && Evaluate(node.Right);
            case NodeType.Comparison:
                return EvaluateComparison(node, character);
            // ...
        }
    }
}

// Domain/Conditions/ConditionCache.cs
public class ConditionCache {
    private Dictionary<string, ConditionNode> _astCache = new();
    private Dictionary<string, bool> _resultCache = new();
    
    public bool Evaluate(string exprId, Character character) {
        if (_resultCache.TryGetValue(GetCacheKey(exprId, character.Id), out var cached)) {
            return cached;
        }
        
        var result = _evaluator.Evaluate(_astCache[exprId], character);
        _resultCache[GetCacheKey(exprId, character.Id)] = result;
        return result;
    }
    
    public void Invalidate(Character character, string dependencyKey) {
        // å¤±æ•ˆç›¸å…³ç¼“å­˜
    }
}
```

**å®æ–½æ­¥éª¤**ï¼š
1. Phase 1: è¡¨è¾¾å¼è§£æå™¨ï¼ˆ4å¤©ï¼‰
2. Phase 2: æ¡ä»¶æ±‚å€¼å™¨ï¼ˆ3å¤©ï¼‰
3. Phase 3: ç¼“å­˜å’Œå¤±æ•ˆç­–ç•¥ï¼ˆ2å¤©ï¼‰
4. Phase 4: ä¸å„ç³»ç»Ÿé›†æˆï¼ˆ2å¤©ï¼‰
5. Phase 5: æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ2å¤©ï¼‰

#### 4.2.5 æ¶ˆè€—å“ç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- é£Ÿç‰©/è¯å‰‚è‡ªåŠ¨ä½¿ç”¨ç­–ç•¥
- ä½¿ç”¨ç­–ç•¥ï¼šæˆ˜æ–—å¼€å§‹ã€Buffåˆ°æœŸã€HPä½äºé˜ˆå€¼
- Loadouté…ç½®ï¼šé€šç”¨æ§½ä½+æˆ˜æ–—æ²»ç–—æ§½ä½

**å½“å‰çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**åŠŸèƒ½ä»·å€¼**ï¼š
- ä¸°å¯Œæˆ˜æ–—ç­–ç•¥
- å¢åŠ ç‰©å“æ¶ˆè€—
- æå‡ç”Ÿå­˜èƒ½åŠ›

**å®ç°éš¾åº¦**ï¼šâ­â­â­ (ä¸­ç­‰)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š5-7å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Consumables/Consumable.cs
public class Consumable {
    public string Id { get; set; }
    public string Name { get; set; }
    public ConsumableType Type { get; set; }  // Food, Potion, Elixir
    public int Cooldown { get; set; }         // å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
    
    // æ•ˆæœ
    public List<BuffDefinition> Buffs { get; set; }  // æä¾›çš„Buff
    public int? InstantHeal { get; set; }            // å³æ—¶æ²»ç–—é‡
}

// Domain/Consumables/ConsumableLoadout.cs
public class ConsumableLoadout {
    public List<ConsumableSlot> GeneralSlots { get; set; }  // 2ä¸ªé€šç”¨æ§½ä½
    public List<ConsumableSlot> HealingSlots { get; set; }  // 2ä¸ªæˆ˜æ–—æ²»ç–—æ§½ä½
}

public class ConsumableSlot {
    public string ConsumableId { get; set; }
    public UsePolicy Policy { get; set; }
    public int? TriggerThreshold { get; set; }  // è§¦å‘é˜ˆå€¼ï¼ˆå¦‚HP<30%ï¼‰
}

public enum UsePolicy {
    OnBattleStart,    // æˆ˜æ–—å¼€å§‹æ—¶ä½¿ç”¨
    OnBuffExpire,     // Buffåˆ°æœŸæ—¶ä½¿ç”¨
    OnHpBelowPercent  // HPä½äºé˜ˆå€¼æ—¶ä½¿ç”¨
}

// Domain/Consumables/ConsumableManager.cs
public class ConsumableManager {
    public void CheckAndUseConsumables(BattleContext context) {
        foreach (var slot in context.Character.ConsumableLoadout.GeneralSlots) {
            if (ShouldUse(slot, context)) {
                UseConsumable(slot.ConsumableId, context);
            }
        }
    }
    
    private bool ShouldUse(ConsumableSlot slot, BattleContext context) {
        return slot.Policy switch {
            UsePolicy.OnBattleStart => context.IsFirstTick,
            UsePolicy.OnBuffExpire => !context.BuffManager.HasBuff(GetBuffId(slot.ConsumableId)),
            UsePolicy.OnHpBelowPercent => context.Player.HpPercent < slot.TriggerThreshold,
            _ => false
        };
    }
}
```

**å®æ–½æ­¥éª¤**ï¼š
1. Phase 1: æ¶ˆè€—å“æ•°æ®æ¨¡å‹ï¼ˆ2å¤©ï¼‰
2. Phase 2: Loadouté…ç½®ï¼ˆ2å¤©ï¼‰
3. Phase 3: è‡ªåŠ¨ä½¿ç”¨ç­–ç•¥ï¼ˆ2å¤©ï¼‰
4. Phase 4: ä¸æˆ˜æ–—ç³»ç»Ÿé›†æˆï¼ˆ2å¤©ï¼‰
5. Phase 5: å‰ç«¯UIï¼ˆ2å¤©ï¼‰


### 4.3 ç¤¾äº¤ä¸é«˜çº§åŠŸèƒ½éœ€æ±‚

#### 4.3.1 å¤šè§’è‰²Rosterå¢å¼º

**è®¾è®¡ç›®æ ‡**ï¼š
- 5ä¸ªè§’è‰²æ§½ä½ï¼Œé€æ­¥è§£é”
- æ§½ä½è§£é”æ¡ä»¶ï¼ˆç­‰çº§ã€ä»»åŠ¡ã€é‡‘å¸ï¼‰
- éæ´»è·ƒè§’è‰²åå°ç»§ç»­æ´»åŠ¨æ¨è¿›

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰åŸºç¡€çš„è§’è‰²åˆ—è¡¨ç®¡ç†
- æ— æ§½ä½è§£é”æœºåˆ¶
- æ— åå°æ¨è¿›

**å®ç°éš¾åº¦**ï¼šâ­â­â­ (ä¸­ç­‰)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š5-7å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Characters/Roster.cs
public class Roster {
    public int UserId { get; set; }
    public List<RosterSlot> Slots { get; set; }  // 5ä¸ªæ§½ä½
    public int UnlockedCount { get; set; }       // å·²è§£é”æ•°é‡
}

public class RosterSlot {
    public int SlotIndex { get; set; }  // 1-5
    public RosterSlotState State { get; set; }  // Locked, Unlocked, Occupied
    public string? UnlockConditionExpr { get; set; }  // è§£é”æ¡ä»¶
    public int? CharacterId { get; set; }  // å ç”¨çš„è§’è‰²ID
}

public enum RosterSlotState {
    Locked,    // æœªè§£é”
    Unlocked,  // å·²è§£é”ä½†ç©ºé—²
    Occupied   // å·²å ç”¨
}

// Application/Characters/RosterService.cs
public class RosterService {
    public async Task<bool> TryUnlockSlot(int userId, int slotIndex) {
        var roster = await _repository.GetRosterByUserId(userId);
        var slot = roster.Slots[slotIndex];
        
        if (await _conditionEvaluator.Evaluate(slot.UnlockConditionExpr, userId)) {
            slot.State = RosterSlotState.Unlocked;
            roster.UnlockedCount++;
            await _repository.UpdateRoster(roster);
            return true;
        }
        return false;
    }
    
    public async Task ProcessInactiveCharacters(int userId, int activeCharacterId) {
        // åå°æ¨è¿›éæ´»è·ƒè§’è‰²çš„æ´»åŠ¨
        var roster = await _repository.GetRosterByUserId(userId);
        foreach (var slot in roster.Slots.Where(s => s.CharacterId != activeCharacterId)) {
            if (slot.CharacterId.HasValue) {
                await _activityPlanService.ProgressInBackground(slot.CharacterId.Value);
            }
        }
    }
}
```

#### 4.3.2 ç»„é˜Ÿ/å‰¯æœ¬æŒç»­æŒ‚æœº

**è®¾è®¡ç›®æ ‡**ï¼š
- é˜Ÿä¼ç®¡ç†ï¼ˆåˆ›å»ºã€åŠ å…¥ã€ç¦»å¼€ï¼‰
- å‰¯æœ¬å…¨å‘˜ç¦»çº¿ä»æŒç»­æ¨¡æ‹Ÿ
- ç»ˆæ­¢æ¡ä»¶ï¼šé˜Ÿé•¿ç»“æŸ/æˆå‘˜ä¸è¶³/è¶…æ—¶

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰DungeonEncounterProvideråŸºç¡€
- æ— ç»„é˜Ÿç³»ç»Ÿ
- æ— å…¨ç¦»çº¿æŒç»­æ¨¡å¼

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­â­ (é«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š12-15å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Domain/Party/Party.cs
public class Party {
    public string Id { get; set; }
    public int LeaderId { get; set; }  // é˜Ÿé•¿è§’è‰²ID
    public List<int> MemberIds { get; set; }  // é˜Ÿå‘˜è§’è‰²IDåˆ—è¡¨
    public int MaxMembers { get; set; }  // æœ€å¤§æˆå‘˜æ•°
    public PartyState State { get; set; }
    public DateTime CreatedAt { get; set; }
    public string? CurrentDungeonId { get; set; }
}

public enum PartyState {
    Forming,      // ç»„é˜Ÿä¸­
    InDungeon,    // å‰¯æœ¬ä¸­
    Disbanded     // å·²è§£æ•£
}

// Domain/Party/DungeonRun.cs
public class DungeonRun {
    public string Id { get; set; }
    public string PartyId { get; set; }
    public string DungeonId { get; set; }
    public DateTime StartTime { get; set; }
    public double ContinuousRuntime { get; set; }  // æŒç»­è¿è¡Œæ—¶é—´
    public double MaxContinuousDuration { get; set; }  // æœ€å¤§æŒç»­æ—¶é—´
    
    public List<DungeonSegment> Segments { get; set; }  // å®šæœŸç”Ÿæˆçš„æ®µ
    
    public bool AllMembersOffline { get; set; }  // å…¨å‘˜ç¦»çº¿æ ‡è®°
    public bool ShouldTerminate { get; set; }    // æ˜¯å¦åº”ç»ˆæ­¢
}

// Application/Party/PartyDungeonService.cs
public class PartyDungeonService {
    public async Task ProcessContinuousDungeon(string dungeonRunId) {
        var run = await _repository.GetDungeonRun(dungeonRunId);
        
        // æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶
        if (ShouldTerminate(run)) {
            await TerminateDungeon(run);
            return;
        }
        
        // åå°æŒç»­æ¨¡æ‹Ÿæˆ˜æ–—
        var engine = CreateDungeonBattleEngine(run);
        var segment = await SimulateTimeSlice(engine, TimeSpan.FromMinutes(5));
        
        run.Segments.Add(segment);
        run.ContinuousRuntime += segment.Duration;
        
        await _repository.UpdateDungeonRun(run);
    }
    
    private bool ShouldTerminate(DungeonRun run) {
        // é˜Ÿé•¿ä¸»åŠ¨ç»“æŸ
        if (run.TerminateRequested) return true;
        
        // æˆå‘˜ä¸è¶³
        var party = await _repository.GetParty(run.PartyId);
        if (party.MemberIds.Count < run.MinMembers) return true;
        
        // è¶…è¿‡æœ€å¤§æŒç»­æ—¶é—´
        if (run.ContinuousRuntime >= run.MaxContinuousDuration) return true;
        
        return false;
    }
}
```

#### 4.3.3 ç›‘æ§ä¸è°ƒè¯•ç³»ç»Ÿ

**è®¾è®¡ç›®æ ‡**ï¼š
- ç»æµæŒ‡æ ‡ç›‘æ§ï¼ˆé‡‘å¸äº§å‡º/æ¶ˆè€—ã€ææ–™æµåŠ¨ï¼‰
- æˆ˜æ–—ç»Ÿè®¡ï¼ˆSegmenté¢‘ç‡ã€äº‹ä»¶æ•°ã€DPSï¼‰
- Debugé¢æ¿ï¼ˆæŸ¥çœ‹æˆ˜æ–—çŠ¶æ€ã€èµ„æºã€Buffï¼‰

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰MetricsCollectorServiceåŸºç¡€æ¡†æ¶
- æ— å…·ä½“æŒ‡æ ‡å®ç°
- æ— Debug API

**å®ç°éš¾åº¦**ï¼šâ­â­â­â­ (è¾ƒé«˜)  
**å·¥ä½œé‡ä¼°ç®—**ï¼š8-10å¤©

**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š
```csharp
// Application/Monitoring/MetricsCollectorService.cs - æ‰©å±•
public class MetricsCollectorService : IMetricsCollectorService {
    // æˆ˜æ–—æŒ‡æ ‡
    public void RecordSegmentGenerated(int characterId, double duration, int eventCount);
    public void RecordResourceOverflow(int characterId, string resourceId, int amount);
    public void RecordAutocastSkip(int characterId, string reason);
    
    // ç»æµæŒ‡æ ‡
    public void RecordGoldGained(int characterId, int amount, string source);
    public void RecordGoldSpent(int characterId, int amount, string sink);
    public void RecordMaterialGained(int characterId, string materialId, int amount);
    public void RecordMaterialSpent(int characterId, string materialId, int amount);
    
    // è£…å¤‡æŒ‡æ ‡
    public void RecordRerollAttempt(int characterId, int cost);
    public void RecordDisenchant(int characterId, string tier, string rarity);
    
    // æŸ¥è¯¢æ¥å£
    public Task<EconomyMetrics> GetEconomyMetrics(int characterId, DateTime from, DateTime to);
    public Task<CombatMetrics> GetCombatMetrics(int characterId, DateTime from, DateTime to);
}

// Api/DebugController.cs
[ApiController]
[Route("api/debug")]
public class DebugController : ControllerBase {
    [HttpGet("battle-state/{characterId}")]
    public async Task<IActionResult> GetBattleState(int characterId) {
        // è¿”å›å®æ—¶æˆ˜æ–—çŠ¶æ€
        var snapshot = await _debugService.GetBattleStateSnapshot(characterId);
        return Ok(snapshot);
    }
    
    [HttpGet("economy-flow/{characterId}")]
    public async Task<IActionResult> GetEconomyFlow(int characterId, [FromQuery] int days = 7) {
        // è¿”å›ç»æµæµåŠ¨æ•°æ®
        var flow = await _metricsCollector.GetEconomyMetrics(characterId, 
            DateTime.UtcNow.AddDays(-days), DateTime.UtcNow);
        return Ok(flow);
    }
}

// Domain/Monitoring/DebugSnapshot.cs
public class BattleStateSnapshot {
    public int CharacterId { get; set; }
    public double CurrentTime { get; set; }
    
    // TrackçŠ¶æ€
    public TrackSnapshot AttackTrack { get; set; }
    public TrackSnapshot SpecialTrack { get; set; }
    
    // èµ„æºçŠ¶æ€
    public Dictionary<string, ResourceSnapshot> Resources { get; set; }
    
    // BuffçŠ¶æ€
    public List<BuffSnapshot> ActiveBuffs { get; set; }
    
    // æŠ€èƒ½å†·å´
    public Dictionary<string, double> SkillCooldowns { get; set; }
    
    // å½“å‰æ•Œäºº
    public List<EnemySnapshot> CurrentEnemies { get; set; }
}
```

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸Šç¯‡ï¼‰- æˆ˜æ–—ä¸èŒä¸šç³»ç»Ÿå¢å¼º

### 5.1 å®æ–½èŒƒå›´

**ç›®æ ‡**ï¼šå®Œå–„æˆ˜æ–—æ ¸å¿ƒæœºåˆ¶ï¼Œå®ç°èŒä¸šå·®å¼‚åŒ–ä½“éªŒ

**åŒ…å«åŠŸèƒ½**ï¼ˆ5é¡¹ï¼‰ï¼š
1. åŒè½¨æˆ˜æ–—èŠ‚å¥ç³»ç»Ÿ
2. èµ„æºæ¡¶ä¸æº¢å‡ºæœºåˆ¶
3. èŒä¸šå·®å¼‚åŒ–é…ç½®
4. æˆ˜æ–—æ®µèšåˆä¼˜åŒ–
5. æ•ŒäººæŠ€èƒ½AIå¢å¼º

**é¢„è®¡å·¥ä½œé‡**ï¼š20-25å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæœ€é«˜ï¼‰  
**ä¾èµ–**ï¼šæ— å¤–éƒ¨ä¾èµ–

### 5.2 è¯¦ç»†å®æ–½è®¡åˆ’

#### Phase 1: åŒè½¨æˆ˜æ–—èŠ‚å¥ï¼ˆ3-5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 1.1: è®¾è®¡AttackTrackStateå’ŒSpecialTrackStateç±»ï¼ˆ0.5å¤©ï¼‰
- [x] Step 1.2: ä¿®æ”¹BattleContextæ”¯æŒåŒTrackï¼ˆ0.5å¤©ï¼‰
- [x] Step 1.3: å®ç°AttackTickEventç‹¬ç«‹å¤„ç†é€»è¾‘ï¼ˆ1å¤©ï¼‰
- [x] Step 1.4: å®ç°SpecialPulseEventç‹¬ç«‹å¤„ç†é€»è¾‘ï¼ˆ1å¤©ï¼‰
- [x] Step 1.5: é…ç½®åŒ–Trackå‚æ•°åˆ°appsettings.jsonï¼ˆ0.5å¤©ï¼‰
- [x] Step 1.6: ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆ1å¤©ï¼‰
- [x] Step 1.7: é›†æˆæµ‹è¯•ä¸è°ƒä¼˜ï¼ˆ0.5å¤©ï¼‰

**æŠ€æœ¯è¦ç‚¹**ï¼š
```csharp
// CombatEngineOptions.cs - æ–°å¢é…ç½®
public class CombatEngineOptions {
    // ç°æœ‰é…ç½®...
    
    // æ–°å¢ï¼šåŒè½¨é…ç½®
    public AttackTrackConfig AttackTrack { get; set; }
    public SpecialTrackConfig SpecialTrack { get; set; }
}

public class AttackTrackConfig {
    public double DefaultBaseAttackSpeed { get; set; } = 1.0;  // æ¯ç§’1æ¬¡
    public bool AffectedByHaste { get; set; } = true;
}

public class SpecialTrackConfig {
    public bool PauseWhenNoEnemies { get; set; } = true;
    public bool StartImmediatelyAfterRevive { get; set; } = false;
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] AttackTrackå’ŒSpecialTrackç‹¬ç«‹è§¦å‘
- [ ] AttackTrackå—æ€¥é€Ÿå½±å“ï¼ŒSpecialTrackä¸å—å½±å“
- [ ] é…ç½®å‚æ•°ç”Ÿæ•ˆ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥90%
- [ ] ä¸ç ´åç°æœ‰æˆ˜æ–—é€»è¾‘

#### Phase 2: èµ„æºæ¡¶ä¸æº¢å‡ºæœºåˆ¶ï¼ˆ5-7å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 2.1: è®¾è®¡ResourceBucketæ•°æ®æ¨¡å‹ï¼ˆ1å¤©ï¼‰
- [x] Step 2.2: å®ç°OverflowPolicyæšä¸¾å’Œå¤„ç†é€»è¾‘ï¼ˆ1å¤©ï¼‰
- [x] Step 2.3: æ‰©å±•ResourceSetæ”¯æŒå¤šç§èµ„æºï¼ˆ1å¤©ï¼‰
- [x] Step 2.4: å®ç°æº¢å‡ºè½¬æ¢ä¸ºBuffæœºåˆ¶ï¼ˆ2å¤©ï¼‰
- [x] Step 2.5: é…ç½®åŒ–èµ„æºå®šä¹‰ï¼ˆ0.5å¤©ï¼‰
- [x] Step 2.6: ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆ1å¤©ï¼‰
- [x] Step 2.7: é›†æˆæµ‹è¯•ï¼ˆ0.5å¤©ï¼‰

**æŠ€æœ¯è¦ç‚¹**ï¼š
```json
// appsettings.json - èµ„æºé…ç½®ç¤ºä¾‹
{
  "Resources": {
    "Definitions": [
      {
        "Id": "rage",
        "Name": "æ€’æ°”",
        "Max": 100,
        "OverflowPolicy": "Convert",
        "Conversion": {
          "TargetBuffId": "æˆ˜æ„",
          "Ratio": 20
        }
      },
      {
        "Id": "shard",
        "Name": "å¯’å†°ç¢ç‰‡",
        "Max": 5,
        "OverflowPolicy": "Clamp"
      }
    ]
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ”¯æŒè‡³å°‘3ç§èµ„æºç±»å‹
- [ ] Clampç­–ç•¥æ­£ç¡®æˆªæ–­
- [ ] Convertç­–ç•¥æ­£ç¡®è½¬æ¢ä¸ºBuff
- [ ] æº¢å‡ºè½¬æ¢æ¯”ä¾‹å¯é…ç½®
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥95%

#### Phase 3: èŒä¸šå·®å¼‚åŒ–é…ç½®ï¼ˆ7-10å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 3.1: è®¾è®¡ProfessionDefinitionæ•°æ®æ¨¡å‹ï¼ˆ1å¤©ï¼‰
- [x] Step 3.2: åˆ›å»ºèŒä¸šé…ç½®JSONæ–‡ä»¶ï¼ˆ1å¤©ï¼‰
- [x] Step 3.3: å®ç°èŒä¸šé…ç½®åŠ è½½æœåŠ¡ï¼ˆ1å¤©ï¼‰
- [x] Step 3.4: åœ¨BattleContextä¸­åº”ç”¨èŒä¸šé…ç½®ï¼ˆ2å¤©ï¼‰
- [x] Step 3.5: å®ç°èŒä¸šç‰¹å®šçš„èµ„æºç”Ÿæˆè§„åˆ™ï¼ˆ2å¤©ï¼‰
- [x] Step 3.6: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ2å¤©ï¼‰
- [x] Step 3.7: æ–‡æ¡£ç¼–å†™ï¼ˆ1å¤©ï¼‰

**èŒä¸šé…ç½®ç¤ºä¾‹**ï¼š
```json
// Config/Professions/warrior.json
{
  "Type": "Warrior",
  "Name": "æˆ˜å£«",
  "PrimaryResource": "rage",
  "SecondaryResource": "focus_stacks",
  "PrimaryResourceMax": 100,
  "SecondaryResourceMax": 3,
  "SpecialTrackInterval": 5.0,
  "AttackHasteMod": 1.0,
  "AttackGeneration": {
    "ResourceId": "rage",
    "AmountPerHit": 1
  },
  "SpecialGeneration": {
    "ResourceId": "focus_stacks",
    "AmountPerPulse": 1
  },
  "PrimaryOverflow": "Convert",
  "PrimaryConversion": {
    "TargetBuffId": "æˆ˜æ„",
    "Ratio": 20,
    "BuffDuration": 10.0
  }
}

// Config/Professions/mage.json
{
  "Type": "Mage",
  "Name": "æ³•å¸ˆ",
  "PrimaryResource": "shard",
  "SecondaryResource": "frost_stacks",
  "PrimaryResourceMax": 5,
  "SecondaryResourceMax": 10,
  "SpecialTrackInterval": 3.0,
  "AttackHasteMod": 1.0,
  "AttackGeneration": {
    "ResourceId": "shard",
    "AmountPerHit": 1
  },
  "SpecialGeneration": {
    "ResourceId": "frost_stacks",
    "AmountPerPulse": 1,
    "BuffId": "å†°å†·è¡€è„‰",
    "StackBonus": {
      "StatType": "AttackSpeed",
      "PercentPerStack": 0.02
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] è‡³å°‘å®ç°3ä¸ªèŒä¸šçš„å·®å¼‚åŒ–é…ç½®
- [ ] èµ„æºç”Ÿæˆè§„åˆ™ç¬¦åˆè®¾è®¡
- [ ] Special Trackå‘¨æœŸæŒ‰èŒä¸šåŒºåˆ†
- [ ] èŒä¸šç‰¹æœ‰Buff/æ•ˆæœç”Ÿæ•ˆ
- [ ] å‰ç«¯å¯åˆ‡æ¢èŒä¸šå¹¶ä½“éªŒå·®å¼‚

#### Phase 4: æˆ˜æ–—æ®µèšåˆä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 4.1: æ‰©å±•CombatSegmentèšåˆå­—æ®µï¼ˆ0.5å¤©ï¼‰
- [x] Step 4.2: å®ç°äº‹ä»¶æ•°é˜ˆå€¼flushï¼ˆ0.5å¤©ï¼‰
- [x] Step 4.3: å®ç°DamageBySourceèšåˆï¼ˆ0.5å¤©ï¼‰
- [x] Step 4.4: å®ç°ResourceFlowèšåˆï¼ˆ0.5å¤©ï¼‰
- [x] Step 4.5: è®°å½•RNGç§å­èŒƒå›´ï¼ˆ0.5å¤©ï¼‰
- [x] Step 4.6: å•å…ƒæµ‹è¯•ï¼ˆ0.5å¤©ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] äº‹ä»¶æ•°è¾¾åˆ°é˜ˆå€¼è‡ªåŠ¨flush
- [ ] èšåˆä¿¡æ¯å®Œæ•´
- [ ] ç¦»çº¿æˆ˜æ–—å­˜å‚¨å¤§å°å‡å°‘30%+
- [ ] RNGç§å­èŒƒå›´æ­£ç¡®è®°å½•

#### Phase 5: æ•ŒäººæŠ€èƒ½AIå¢å¼ºï¼ˆ3-4å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 5.1: è®¾è®¡æ•ŒäººæŠ€èƒ½ä¼˜å…ˆçº§ç­–ç•¥ï¼ˆ1å¤©ï¼‰
- [x] Step 5.2: å®ç°æŠ€èƒ½CDç®¡ç†ï¼ˆ0.5å¤©ï¼‰
- [x] Step 5.3: å®ç°æŠ€èƒ½æ–½æ”¾æ¡ä»¶åˆ¤æ–­ï¼ˆ1å¤©ï¼‰
- [x] Step 5.4: é…ç½®åŒ–æ•ŒäººæŠ€èƒ½ï¼ˆ0.5å¤©ï¼‰
- [x] Step 5.5: æµ‹è¯•ä¸è°ƒä¼˜ï¼ˆ1å¤©ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ•ŒäººæŒ‰ä¼˜å…ˆçº§é‡Šæ”¾æŠ€èƒ½
- [ ] æŠ€èƒ½CDæ­£ç¡®ç®¡ç†
- [ ] æ–½æ”¾æ¡ä»¶ï¼ˆHPé˜ˆå€¼ã€èµ„æºï¼‰ç”Ÿæ•ˆ
- [ ] æˆ˜æ–—éš¾åº¦åˆç†

### 5.3 ä¸Šç¯‡å®æ–½æ€»ç»“

**æ€»å·¥ä½œé‡**ï¼š20-25å¤©  
**å…³é”®é‡Œç¨‹ç¢‘**ï¼š
- M1: åŒè½¨ç³»ç»Ÿå®Œæˆï¼ˆDay 5ï¼‰
- M2: èµ„æºæ¡¶å®Œæˆï¼ˆDay 12ï¼‰
- M3: èŒä¸šå·®å¼‚åŒ–å®Œæˆï¼ˆDay 22ï¼‰
- M4: ä¸Šç¯‡å…¨éƒ¨å®Œæˆï¼ˆDay 25ï¼‰

**é£é™©ä¸åº”å¯¹**ï¼š
| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| åŒè½¨ç³»ç»Ÿä¸ç°æœ‰ä»£ç å†²çª | é«˜ | å……åˆ†æµ‹è¯•ï¼Œå°æ­¥è¿­ä»£ |
| èµ„æºæ¡¶æ€§èƒ½é—®é¢˜ | ä¸­ | ä½¿ç”¨å­—å…¸ä¼˜åŒ–æŸ¥æ‰¾ |
| èŒä¸šé…ç½®å¤æ‚åº¦é«˜ | ä¸­ | æä¾›é…ç½®æ¨¡æ¿å’ŒéªŒè¯å·¥å…· |

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸­ç¯‡ï¼‰- ç»æµä¸è£…å¤‡ç³»ç»Ÿå®Œå–„

### 6.1 å®æ–½èŒƒå›´

**ç›®æ ‡**ï¼šå®Œå–„ç»æµå¾ªç¯ï¼Œå¢å¼ºè£…å¤‡ç”Ÿæ€

**åŒ…å«åŠŸèƒ½**ï¼ˆ4é¡¹ï¼‰ï¼š
1. è£…å¤‡è¯æ¡é‡ç½®ï¼ˆRerollï¼‰ç³»ç»Ÿ
2. ç»æµç›‘æ§ä¸æŒ‡æ ‡æ”¶é›†
3. ææ–™åˆ†å±‚ä½“ç³»
4. æ¶ˆè€—å“è‡ªåŠ¨ä½¿ç”¨ç³»ç»Ÿ

**é¢„è®¡å·¥ä½œé‡**ï¼š15-20å¤©  
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆé«˜ï¼‰  
**ä¾èµ–**ï¼šæ— 

### 6.2 è¯¦ç»†å®æ–½è®¡åˆ’

#### Phase 6: è£…å¤‡è¯æ¡é‡ç½®ç³»ç»Ÿï¼ˆ4-5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 6.1: è®¾è®¡Rerollæ•°æ®æ¨¡å‹ï¼ˆ0.5å¤©ï¼‰
- [x] Step 6.2: å®ç°è¯æ¡é‡æ–°ç”Ÿæˆé€»è¾‘ï¼ˆ1å¤©ï¼‰
- [x] Step 6.3: å®ç°æˆæœ¬é€’å¢æœºåˆ¶ï¼ˆ0.5å¤©ï¼‰
- [x] Step 6.4: å®ç°ä¿åº•æœºåˆ¶ï¼ˆ0.5å¤©ï¼‰
- [x] Step 6.5: APIæ¥å£å¼€å‘ï¼ˆ1å¤©ï¼‰
- [x] Step 6.6: å‰ç«¯é›†æˆï¼ˆ1å¤©ï¼‰
- [x] Step 6.7: æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰

**æ ¸å¿ƒè®¾è®¡**ï¼š
```csharp
// Domain/Equipment/Services/RerollService.cs
public class RerollService {
    public async Task<GearInstance> RerollAffixes(GearInstance gear, Character character) {
        // è®¡ç®—æˆæœ¬ï¼ˆé€’å¢ï¼‰
        var cost = CalculateRerollCost(gear.RerollCount);
        
        if (character.Gold < cost) {
            throw new InsufficientGoldException();
        }
        
        // æ‰£é™¤æˆæœ¬
        character.Gold -= cost;
        
        // é‡æ–°ç”Ÿæˆè¯æ¡
        gear.Affixes = _gearGenerationService.GenerateAffixes(gear.DefinitionId);
        gear.RerollCount++;
        
        // ä¿åº•æœºåˆ¶ï¼šæ¯10æ¬¡å¿…å‡ºç¨€æœ‰è¯æ¡
        if (gear.RerollCount % 10 == 0) {
            EnsureRareAffix(gear);
        }
        
        await _repository.UpdateGear(gear);
        return gear;
    }
    
    private int CalculateRerollCost(int rerollCount) {
        // æˆæœ¬é€’å¢å…¬å¼ï¼šbaseCost * (1 + rerollCount * 0.1)
        return (int)(_config.BaseRerollCost * (1 + rerollCount * 0.1));
    }
}
```

**é…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "Equipment": {
    "Reroll": {
      "BaseRerollCost": 100,
      "CostIncreaseRate": 0.1,
      "PityThreshold": 10,
      "PityRareChance": 1.0
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] è¯æ¡é‡æ–°ç”Ÿæˆæ­£ç¡®
- [ ] æˆæœ¬é€’å¢ç¬¦åˆå…¬å¼
- [ ] ä¿åº•æœºåˆ¶ç”Ÿæ•ˆ
- [ ] ç»æµè®°å½•å®Œæ•´
- [ ] å‰ç«¯UIå‹å¥½

#### Phase 7: ç»æµç›‘æ§ä¸æŒ‡æ ‡æ”¶é›†ï¼ˆ4-5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 7.1: æ‰©å±•MetricsCollectorServiceï¼ˆ2å¤©ï¼‰
- [x] Step 7.2: å®ç°ç»æµæŒ‡æ ‡å­˜å‚¨ï¼ˆ1å¤©ï¼‰
- [x] Step 7.3: å®ç°æŸ¥è¯¢APIï¼ˆ1å¤©ï¼‰
- [x] Step 7.4: åˆ›å»ºç›‘æ§ä»ªè¡¨æ¿ï¼ˆ1å¤©ï¼‰

**æ ¸å¿ƒæŒ‡æ ‡**ï¼š
```csharp
public class EconomyMetrics {
    // é‡‘å¸æµåŠ¨
    public long GoldGained { get; set; }
    public long GoldSpent { get; set; }
    public double GoldInOutRatio { get; set; }
    
    // é‡‘å¸æ¥æºåˆ†å¸ƒ
    public Dictionary<string, long> GoldSourceBreakdown { get; set; }  // "battle", "quest", "disenchant"
    
    // é‡‘å¸æ¶ˆè€—åˆ†å¸ƒ
    public Dictionary<string, long> GoldSinkBreakdown { get; set; }  // "reroll", "shop", "reforge"
    
    // ææ–™æµåŠ¨
    public Dictionary<string, MaterialFlow> MaterialFlows { get; set; }
    
    // è£…å¤‡æ“ä½œ
    public int DisenchantCount { get; set; }
    public int RerollAttempts { get; set; }
    public int ReforgeAttempts { get; set; }
    public double AvgRerollCost { get; set; }
}

public class MaterialFlow {
    public string MaterialId { get; set; }
    public long Gained { get; set; }
    public long Spent { get; set; }
    public long CurrentStock { get; set; }
}
```

**APIç¤ºä¾‹**ï¼š
```csharp
[HttpGet("economy/metrics")]
public async Task<IActionResult> GetEconomyMetrics(
    [FromQuery] int characterId,
    [FromQuery] int days = 7)
{
    var from = DateTime.UtcNow.AddDays(-days);
    var to = DateTime.UtcNow;
    var metrics = await _metricsCollector.GetEconomyMetrics(characterId, from, to);
    return Ok(metrics);
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] è®°å½•è‡³å°‘10ç§ç»æµäº‹ä»¶
- [ ] æŸ¥è¯¢APIå“åº”æ—¶é—´<500ms
- [ ] æŒ‡æ ‡æ•°æ®å‡†ç¡®
- [ ] ä»ªè¡¨æ¿å¯è§†åŒ–æ¸…æ™°

#### Phase 8: ææ–™åˆ†å±‚ä½“ç³»ï¼ˆ3-4å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 8.1: è®¾è®¡ææ–™Tierå®šä¹‰ï¼ˆ1å¤©ï¼‰
- [x] Step 8.2: å®ç°ææ–™æ‰è½è¡¨ï¼ˆ1å¤©ï¼‰
- [x] Step 8.3: é…ç½®ææ–™ç”¨é€”ï¼ˆ1å¤©ï¼‰
- [x] Step 8.4: æµ‹è¯•ä¸è°ƒä¼˜ï¼ˆ0.5å¤©ï¼‰

**ææ–™åˆ†å±‚è®¾è®¡**ï¼š
```json
{
  "Materials": {
    "Tiers": [
      {
        "Tier": 1,
        "LevelRange": [1, 10],
        "Materials": [
          {"Id": "leather_scrap", "Name": "çš®é©ç¢ç‰‡", "DropWeight": 100},
          {"Id": "iron_ore", "Name": "é“çŸ¿çŸ³", "DropWeight": 80}
        ]
      },
      {
        "Tier": 2,
        "LevelRange": [11, 20],
        "Materials": [
          {"Id": "thick_leather", "Name": "åšå®çš®é©", "DropWeight": 100},
          {"Id": "steel_ingot", "Name": "é’¢é”­", "DropWeight": 80}
        ]
      },
      {
        "Tier": 3,
        "LevelRange": [21, 30],
        "Materials": [
          {"Id": "hardened_leather", "Name": "ç¡¬åŒ–çš®é©", "DropWeight": 100},
          {"Id": "mithril_bar", "Name": "ç§˜é“¶é”­", "DropWeight": 60}
        ]
      }
    ],
    "LegendaryMaterials": [
      {"Id": "legendary_core", "Name": "ä¼ è¯´æ ¸å¿ƒ", "MinLevel": 50}
    ]
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ææ–™æŒ‰ç­‰çº§åˆ†å±‚
- [ ] æ‰è½è¡¨æ­£ç¡®åŒ¹é…è§’è‰²ç­‰çº§
- [ ] ææ–™ç”¨é€”æ¸…æ™°ï¼ˆé‡é“¸ã€è¯æ¡é‡ç½®ç­‰ï¼‰
- [ ] ç»æµå¾ªç¯å¹³è¡¡

#### Phase 9: æ¶ˆè€—å“è‡ªåŠ¨ä½¿ç”¨ç³»ç»Ÿï¼ˆ4-6å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 9.1: è®¾è®¡Consumableæ•°æ®æ¨¡å‹ï¼ˆ1å¤©ï¼‰
- [x] Step 9.2: å®ç°ConsumableLoadoutï¼ˆ1å¤©ï¼‰
- [x] Step 9.3: å®ç°è‡ªåŠ¨ä½¿ç”¨ç­–ç•¥ï¼ˆ2å¤©ï¼‰
- [x] Step 9.4: ä¸æˆ˜æ–—ç³»ç»Ÿé›†æˆï¼ˆ1å¤©ï¼‰
- [x] Step 9.5: å‰ç«¯UIï¼ˆ1å¤©ï¼‰

**å·²åœ¨4.2.5èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

### 6.3 ä¸­ç¯‡å®æ–½æ€»ç»“

**æ€»å·¥ä½œé‡**ï¼š15-20å¤©  
**å…³é”®é‡Œç¨‹ç¢‘**ï¼š
- M5: è¯æ¡é‡ç½®å®Œæˆï¼ˆDay 5ï¼‰
- M6: ç»æµç›‘æ§å®Œæˆï¼ˆDay 10ï¼‰
- M7: ææ–™ä½“ç³»å®Œæˆï¼ˆDay 14ï¼‰
- M8: ä¸­ç¯‡å…¨éƒ¨å®Œæˆï¼ˆDay 20ï¼‰

---

## ä¼˜åŒ–æ–¹æ¡ˆï¼ˆä¸‹ç¯‡ï¼‰- ç¤¾äº¤ä¸è¿›é˜¶åŠŸèƒ½

### 7.1 å®æ–½èŒƒå›´

**ç›®æ ‡**ï¼šæ‰©å±•æ¸¸æˆæ·±åº¦ï¼Œå¢åŠ é•¿æœŸç›®æ ‡

**åŒ…å«åŠŸèƒ½**ï¼ˆ6é¡¹ï¼‰ï¼š
1. åœ°å›¾/åŒºåŸŸç³»ç»Ÿ
2. ä»»åŠ¡ç³»ç»Ÿ
3. å£°æœ›ç³»ç»Ÿ
4. æ¡ä»¶/è§£é”DSLå¼•æ“
5. å¤šè§’è‰²Rosterå¢å¼º
6. ç›‘æ§ä¸è°ƒè¯•ç³»ç»Ÿ

**é¢„è®¡å·¥ä½œé‡**ï¼š40-50å¤©  
**ä¼˜å…ˆçº§**ï¼šP2ï¼ˆä¸­ï¼‰  
**ä¾èµ–**ï¼šæ¡ä»¶DSLéœ€è¦å…ˆäºå…¶ä»–ç³»ç»Ÿå®ç°

### 7.2 è¯¦ç»†å®æ–½è®¡åˆ’

#### Phase 10: æ¡ä»¶/è§£é”DSLå¼•æ“ï¼ˆ10-12å¤©ï¼‰

**ä½œä¸ºåŸºç¡€è®¾æ–½ï¼Œä¼˜å…ˆå®æ–½**

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 10.1: è®¾è®¡DSLè¯­æ³•ï¼ˆ2å¤©ï¼‰
- [x] Step 10.2: å®ç°è¯æ³•åˆ†æå™¨ï¼ˆ2å¤©ï¼‰
- [x] Step 10.3: å®ç°è¯­æ³•åˆ†æå™¨ï¼ˆ2å¤©ï¼‰
- [x] Step 10.4: å®ç°æ±‚å€¼å™¨ï¼ˆ2å¤©ï¼‰
- [x] Step 10.5: å®ç°ç¼“å­˜ç­–ç•¥ï¼ˆ1å¤©ï¼‰
- [x] Step 10.6: æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ2å¤©ï¼‰

**DSLè¯­æ³•è®¾è®¡**ï¼š
```
// åŸºæœ¬è¯­æ³•
expression := term (AND term | OR term)*
term := factor | NOT factor
factor := comparison | function_call | '(' expression ')'

comparison := identifier operator value
operator := '==' | '!=' | '>=' | '<=' | '>' | '<'

function_call := identifier '(' arguments ')'
arguments := expression (',' expression)*

// ç¤ºä¾‹
level >= 20
level >= 20 AND reputation('faction_a') >= 300
quest_completed('main_01') OR quest_completed('main_02')
level >= 30 AND (class == 'warrior' OR class == 'mage')
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ”¯æŒåŸºæœ¬é€»è¾‘è¿ç®—ç¬¦ï¼ˆAND, OR, NOTï¼‰
- [ ] æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ==, !=, >=, <=, >, <ï¼‰
- [ ] æ”¯æŒå‡½æ•°è°ƒç”¨ï¼ˆquest_completed, reputationç­‰ï¼‰
- [ ] ç¼“å­˜å‘½ä¸­ç‡>80%
- [ ] æ±‚å€¼æ€§èƒ½<5ms

#### Phase 11: åœ°å›¾/åŒºåŸŸç³»ç»Ÿï¼ˆ10-15å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 11.1: è®¾è®¡MapRegionæ•°æ®æ¨¡å‹ï¼ˆ2å¤©ï¼‰
- [x] Step 11.2: å®ç°RegionGraphï¼ˆ2å¤©ï¼‰
- [x] Step 11.3: å®ç°åŒºåŸŸè§£é”é€»è¾‘ï¼ˆ2å¤©ï¼‰
- [x] Step 11.4: å®ç°æ€ªç‰©æ± ç³»ç»Ÿï¼ˆ2å¤©ï¼‰
- [x] Step 11.5: å‰ç«¯åŒºåŸŸé€‰æ‹©UIï¼ˆ3å¤©ï¼‰
- [x] Step 11.6: æµ‹è¯•ä¸å†…å®¹å¡«å……ï¼ˆ3å¤©ï¼‰

**å·²åœ¨4.2.1èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

#### Phase 12: ä»»åŠ¡ç³»ç»Ÿï¼ˆ15-20å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 12.1: è®¾è®¡Questæ•°æ®æ¨¡å‹ï¼ˆ3å¤©ï¼‰
- [x] Step 12.2: å®ç°ä»»åŠ¡æ¥å–ä¸ç›®æ ‡è¿½è¸ªï¼ˆ4å¤©ï¼‰
- [x] Step 12.3: å®ç°ä»»åŠ¡å®Œæˆä¸å¥–åŠ±ï¼ˆ2å¤©ï¼‰
- [x] Step 12.4: å®ç°æ—¥å¸¸/å‘¨å¸¸åˆ·æ–°ï¼ˆ3å¤©ï¼‰
- [x] Step 12.5: å‰ç«¯ä»»åŠ¡UIï¼ˆ3å¤©ï¼‰
- [x] Step 12.6: æµ‹è¯•ä¸å†…å®¹å¡«å……ï¼ˆ3å¤©ï¼‰

**å·²åœ¨4.2.2èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

#### Phase 13: å£°æœ›ç³»ç»Ÿï¼ˆ7-10å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] Step 13.1: è®¾è®¡Factionæ•°æ®æ¨¡å‹ï¼ˆ2å¤©ï¼‰
- [x] Step 13.2: å®ç°å£°æœ›è®¡ç®—ä¸ç­‰çº§åˆ¤å®šï¼ˆ2å¤©ï¼‰
- [x] Step 13.3: å®ç°å£°æœ›å¥–åŠ±ç³»ç»Ÿï¼ˆ2å¤©ï¼‰
- [x] Step 13.4: ä¸å•†åº—ç³»ç»Ÿé›†æˆï¼ˆ2å¤©ï¼‰
- [x] Step 13.5: å‰ç«¯å£°æœ›UIï¼ˆ2å¤©ï¼‰

**å·²åœ¨4.2.3èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

#### Phase 14: å¤šè§’è‰²Rosterå¢å¼ºï¼ˆ5-7å¤©ï¼‰

**å·²åœ¨4.3.1èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

#### Phase 15: ç›‘æ§ä¸è°ƒè¯•ç³»ç»Ÿï¼ˆ8-10å¤©ï¼‰

**å·²åœ¨4.3.3èŠ‚è¯¦ç»†æè¿°ï¼Œæ­¤å¤„ç•¥**

### 7.3 ä¸‹ç¯‡å®æ–½æ€»ç»“

**æ€»å·¥ä½œé‡**ï¼š40-50å¤©  
**å…³é”®é‡Œç¨‹ç¢‘**ï¼š
- M9: æ¡ä»¶DSLå®Œæˆï¼ˆDay 12ï¼‰
- M10: åœ°å›¾ç³»ç»Ÿå®Œæˆï¼ˆDay 27ï¼‰
- M11: ä»»åŠ¡ç³»ç»Ÿå®Œæˆï¼ˆDay 47ï¼‰
- M12: ä¸‹ç¯‡å…¨éƒ¨å®Œæˆï¼ˆDay 50ï¼‰


---

## æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®

### 8.1 ä»£ç è´¨é‡æ”¹è¿›

#### 8.1.1 ç¼–è¯‘è­¦å‘Šä¿®å¤

**å½“å‰è­¦å‘Šåˆ—è¡¨**ï¼š
1. `CS0414`: Characters._isSignalREnabledå­—æ®µæœªä½¿ç”¨
2. `CS8602`: BattleContext.csä¸­å¯èƒ½çš„nullå¼•ç”¨
3. `CS8601`: ResourceSet.csä¸­å¯èƒ½çš„nullèµ‹å€¼
4. `CS0219`: æµ‹è¯•ä¸­æœªä½¿ç”¨çš„å˜é‡
5. `CS8625`: æµ‹è¯•ä¸­nullå­—é¢é‡è½¬æ¢é—®é¢˜

**ä¿®å¤è®¡åˆ’**ï¼ˆ1å°æ—¶ï¼‰ï¼š
```csharp
// 1. åˆ é™¤æœªä½¿ç”¨çš„å­—æ®µ
// BlazorIdle/Pages/Characters.razor
- private bool _isSignalREnabled;

// 2. æ·»åŠ nullæ£€æŸ¥
// BlazorIdle.Server/Domain/Combat/BattleContext.cs
public void ApplyBuff(BuffInstance buff) {
    if (buff == null) throw new ArgumentNullException(nameof(buff));
    if (buff.Definition == null) throw new InvalidOperationException("Buff definition is null");
    _buffManager.AddBuff(buff);
}

// 3. æ·»åŠ null-conditionalæ“ä½œç¬¦
// BlazorIdle.Server/Domain/Combat/Resources/ResourceSet.cs
public int GetResourceValue(string resourceId) {
    return _resources.TryGetValue(resourceId, out var resource) 
        ? resource?.Current ?? 0 
        : 0;
}

// 4. ç§»é™¤æœªä½¿ç”¨çš„æµ‹è¯•å˜é‡
// tests/BlazorIdle.Tests/SmoothProgressTests.cs
- bool detectedReset = false;

// 5. ä¿®å¤æµ‹è¯•ä¸­çš„nullèµ‹å€¼
// tests/BlazorIdle.Tests/Shop/ShopConfigurationValidatorTests.cs
var definition = new ShopDefinition { Name = string.Empty };  // æ›¿ä»£null
```

**é¢„æœŸç»“æœ**ï¼š0ä¸ªç¼–è¯‘è­¦å‘Š

#### 8.1.2 é‡å¤ä»£ç æ¶ˆé™¤

**å·²è¯†åˆ«çš„é‡å¤æ¨¡å¼**ï¼ˆ15å¤„ï¼‰ï¼š

**ç±»å‹1ï¼šèµ„æºéªŒè¯é€»è¾‘**ï¼ˆ5å¤„ï¼‰
```csharp
// é‡å¤å‡ºç°åœ¨ï¼šShopService, EquipmentService, ReforgeService, RerollService, InventoryService
if (character.Gold < cost) {
    throw new InsufficientGoldException();
}
character.Gold -= cost;

// å»ºè®®ï¼šæŠ½å–åˆ°å…¬å…±å·¥å…·ç±»
public static class ResourceValidator {
    public static void ValidateAndConsume(Character character, int goldCost) {
        if (character.Gold < goldCost) {
            throw new InsufficientGoldException($"éœ€è¦{goldCost}é‡‘å¸ï¼Œå½“å‰ä»…æœ‰{character.Gold}");
        }
        character.Gold -= goldCost;
    }
}
```

**ç±»å‹2ï¼šæƒé™æ£€æŸ¥é€»è¾‘**ï¼ˆ4å¤„ï¼‰
```csharp
// é‡å¤å‡ºç°åœ¨ï¼šå¤šä¸ªController
var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value 
    ?? throw new UnauthorizedAccessException());
var character = await _repository.GetCharacterById(characterId);
if (character.UserId != userId) {
    throw new UnauthorizedAccessException("æ— æƒè®¿é—®æ­¤è§’è‰²");
}

// å»ºè®®ï¼šæŠ½å–åˆ°åŸºç±»æˆ–ActionFilter
[AttributeUsage(AttributeTargets.Method)]
public class RequireCharacterOwnershipAttribute : TypeFilterAttribute {
    public RequireCharacterOwnershipAttribute() : base(typeof(CharacterOwnershipFilter)) { }
}

public class CharacterOwnershipFilter : IAsyncActionFilter {
    public async Task OnActionExecutionAsync(ActionExecutingContext context, ActionExecutionDelegate next) {
        // ç»Ÿä¸€çš„æƒé™æ£€æŸ¥é€»è¾‘
    }
}
```

**ç±»å‹3ï¼šæ—¥å¿—è®°å½•æ¨¡å¼**ï¼ˆ3å¤„ï¼‰
```csharp
// é‡å¤å‡ºç°åœ¨ï¼šBattleEngine, ActivityPlanService, OfflineFastForwardEngine
_logger.LogInformation($"[{characterId}] Starting operation at {DateTime.UtcNow}");
try {
    // æ“ä½œ
    _logger.LogInformation($"[{characterId}] Operation completed successfully");
} catch (Exception ex) {
    _logger.LogError(ex, $"[{characterId}] Operation failed");
    throw;
}

// å»ºè®®ï¼šä½¿ç”¨LoggerMessageæºç”Ÿæˆå™¨
public static partial class LogMessages {
    [LoggerMessage(EventId = 1001, Level = LogLevel.Information, 
        Message = "[{characterId}] Starting {operation}")]
    public static partial void LogOperationStart(ILogger logger, int characterId, string operation);
    
    [LoggerMessage(EventId = 1002, Level = LogLevel.Information, 
        Message = "[{characterId}] {operation} completed successfully")]
    public static partial void LogOperationSuccess(ILogger logger, int characterId, string operation);
}
```

**ç±»å‹4ï¼šé…ç½®è¯»å–æ¨¡å¼**ï¼ˆ3å¤„ï¼‰
```csharp
// é‡å¤å‡ºç°åœ¨ï¼šå¤šä¸ªService
var config = _configuration.GetSection("SectionName").Get<ConfigClass>() 
    ?? throw new InvalidOperationException("Configuration not found");

// å»ºè®®ï¼šç»Ÿä¸€ä½¿ç”¨IOptions<T>æ¨¡å¼
public class MyService {
    private readonly MyOptions _options;
    
    public MyService(IOptions<MyOptions> options) {
        _options = options.Value;
    }
}
```

**é¢„è®¡å·¥ä½œé‡**ï¼š3å¤©  
**é¢„æœŸæ•ˆæœ**ï¼šä»£ç å‡å°‘200+è¡Œï¼Œé‡å¤åº¦ä»10%é™è‡³5%ä»¥ä¸‹

#### 8.1.3 ä¸­æ–‡æ³¨é‡Šå®Œå–„

**å½“å‰æ³¨é‡Šè¦†ç›–ç‡**ï¼šçº¦60%

**å¾…è¡¥å……æ³¨é‡Šçš„ç±»åˆ«**ï¼š
1. **é¢†åŸŸæ¨¡å‹**ï¼š50%éœ€è¦è¡¥å……
2. **åº”ç”¨æœåŠ¡**ï¼š40%éœ€è¦è¡¥å……
3. **APIæ§åˆ¶å™¨**ï¼š30%éœ€è¦è¡¥å……
4. **é…ç½®ç±»**ï¼š60%éœ€è¦è¡¥å……

**æ³¨é‡Šè§„èŒƒ**ï¼š
```csharp
/// <summary>
/// æˆ˜æ–—å¼•æ“ - æ ¸å¿ƒæˆ˜æ–—å¾ªç¯å¤„ç†å™¨
/// </summary>
/// <remarks>
/// <para><strong>è®¾è®¡ç†å¿µ</strong>ï¼š</para>
/// <list type="bullet">
/// <item>äº‹ä»¶é˜Ÿåˆ—é©±åŠ¨ï¼šæ‰€æœ‰æˆ˜æ–—è¡Œä¸ºï¼ˆæ”»å‡»ã€æŠ€èƒ½ã€Buffï¼‰éƒ½æ˜¯äº‹ä»¶</item>
/// <item>æ”¯æŒå¤šæ€ªç‰©/æ³¢æ¬¡ï¼šå¯å¤„ç†å•æ³¢æˆ˜æ–—æˆ–å¤šæ³¢æ¬¡åœ°ä¸‹åŸ</item>
/// </list>
/// 
/// <para><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</para>
/// <list type="bullet">
/// <item>æ™®é€šæˆ˜æ–—ï¼šå•æ³¢æ•Œäººï¼Œå‡»æ€åç»“æŸ</item>
/// <item>åœ°ä¸‹åŸæˆ˜æ–—ï¼šå¤šæ³¢æ•Œäººï¼Œéœ€è¦Providerç®¡ç†æ³¢æ¬¡</item>
/// </list>
/// </remarks>
/// <param name="battle">æˆ˜æ–—å®ä¾‹</param>
/// <param name="character">è§’è‰²</param>
/// <returns>æˆ˜æ–—å¼•æ“å®ä¾‹</returns>
public BattleEngine CreateBattleEngine(Battle battle, Character character) { }
```

**é¢„è®¡å·¥ä½œé‡**ï¼š7å¤©  
**é¢„æœŸæ•ˆæœ**ï¼šæ³¨é‡Šè¦†ç›–ç‡æå‡è‡³90%+

### 8.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 8.2.1 æˆ˜æ–—æ®µå‹ç¼©

**å½“å‰é—®é¢˜**ï¼š
- ç¦»çº¿æˆ˜æ–—ç”Ÿæˆå¤§é‡CombatSegment
- æ¯ä¸ªSegmentå­˜å‚¨æ‰€æœ‰åŸå§‹äº‹ä»¶
- å†…å­˜å ç”¨é«˜ï¼Œä¼ è¾“æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```csharp
// å½“å‰ï¼šå­˜å‚¨æ‰€æœ‰äº‹ä»¶
public class CombatSegment {
    public List<IGameEvent> Events { get; set; }  // å¯èƒ½æœ‰æ•°åƒä¸ªäº‹ä»¶
}

// ä¼˜åŒ–åï¼šåªå­˜å‚¨èšåˆæ•°æ®
public class CombatSegment {
    public SegmentSummary Summary { get; set; }  // èšåˆæ‘˜è¦
    public List<IGameEvent> KeyEvents { get; set; }  // ä»…å…³é”®äº‹ä»¶ï¼ˆæ­»äº¡ã€æ³¢æ¬¡åˆ‡æ¢ï¼‰
}

public class SegmentSummary {
    public double StartTime { get; set; }
    public double EndTime { get; set; }
    public int TotalEvents { get; set; }
    
    // èšåˆæ•°æ®
    public int TotalDamageDealt { get; set; }
    public int TotalDamageTaken { get; set; }
    public Dictionary<string, int> SkillUsageCount { get; set; }
    public Dictionary<string, double> BuffUptimes { get; set; }
    public Dictionary<string, int> ResourceGains { get; set; }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å†…å­˜å ç”¨å‡å°‘70%+
- åºåˆ—åŒ–å¤§å°å‡å°‘80%+
- ä¼ è¾“æ—¶é—´å‡å°‘75%+

#### 8.2.2 æ¡ä»¶è¡¨è¾¾å¼ç¼“å­˜

**å½“å‰é—®é¢˜**ï¼š
- æ¯æ¬¡åˆ¤æ–­è§£é”æ¡ä»¶éƒ½é‡æ–°æ±‚å€¼
- å¤æ‚è¡¨è¾¾å¼å¼€é”€å¤§

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```csharp
public class ConditionCache {
    private readonly ConcurrentDictionary<string, bool> _cache = new();
    private readonly ConcurrentDictionary<string, HashSet<string>> _dependencies = new();
    
    public bool Evaluate(string exprId, Character character) {
        var cacheKey = $"{exprId}:{character.Id}";
        
        if (_cache.TryGetValue(cacheKey, out var cached)) {
            Metrics.CacheHit++;
            return cached;
        }
        
        Metrics.CacheMiss++;
        var result = _evaluator.Evaluate(exprId, character);
        _cache[cacheKey] = result;
        return result;
    }
    
    public void InvalidateForCharacter(int characterId, string dependencyKey) {
        // åªå¤±æ•ˆå—å½±å“çš„è¡¨è¾¾å¼
        if (_dependencies.TryGetValue(dependencyKey, out var affectedExprs)) {
            foreach (var exprId in affectedExprs) {
                _cache.TryRemove($"{exprId}:{characterId}", out _);
            }
        }
    }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- ç¼“å­˜å‘½ä¸­ç‡>80%
- æ±‚å€¼æ€§èƒ½æå‡10x+

#### 8.2.3 é…ç½®çƒ­æ›´æ–°

**å½“å‰é—®é¢˜**ï¼š
- é…ç½®ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡
- å¼€å‘è°ƒè¯•ä¸ä¾¿

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```csharp
public class ConfigurationHotReloadService : IHostedService {
    private FileSystemWatcher _watcher;
    
    public Task StartAsync(CancellationToken cancellationToken) {
        _watcher = new FileSystemWatcher("Config") {
            EnableRaisingEvents = true
        };
        
        _watcher.Changed += async (sender, e) => {
            _logger.LogInformation($"é…ç½®æ–‡ä»¶ {e.Name} å·²æ›´æ”¹ï¼Œé‡æ–°åŠ è½½...");
            await ReloadConfiguration(e.FullPath);
        };
        
        return Task.CompletedTask;
    }
    
    private async Task ReloadConfiguration(string path) {
        // 1. éªŒè¯é…ç½®æ–‡ä»¶
        if (!await ValidateConfiguration(path)) {
            _logger.LogWarning($"é…ç½®æ–‡ä»¶ {path} éªŒè¯å¤±è´¥ï¼Œè·³è¿‡åŠ è½½");
            return;
        }
        
        // 2. é‡æ–°åŠ è½½åˆ°IOptions
        _optionsMonitor.Get<ConfigClass>();  // è§¦å‘é‡æ–°åŠ è½½
        
        // 3. é€šçŸ¥ç›¸å…³æœåŠ¡
        await _eventBus.Publish(new ConfigurationReloadedEvent(path));
    }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- é…ç½®ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
- æ— éœ€é‡å¯æœåŠ¡
- æå‡å¼€å‘æ•ˆç‡

### 8.3 æ¶æ„æ”¹è¿›å»ºè®®

#### 8.3.1 å¼•å…¥é¢†åŸŸäº‹ä»¶æ€»çº¿

**ç›®æ ‡**ï¼šé™ä½æ¨¡å—è€¦åˆï¼Œæé«˜å¯æ‰©å±•æ€§

**å½“å‰é—®é¢˜**ï¼š
```csharp
// å½“å‰ï¼šç›´æ¥è°ƒç”¨ä¾èµ–æœåŠ¡
public class BattleEngine {
    private readonly IBattleNotificationService _notificationService;
    private readonly IMetricsCollectorService _metricsService;
    private readonly IRewardGrantService _rewardService;
    
    public void OnEnemyKilled(Enemy enemy) {
        // ç´§è€¦åˆï¼šç›´æ¥è°ƒç”¨3ä¸ªæœåŠ¡
        _notificationService.NotifyEnemyKilled(enemy);
        _metricsService.RecordEnemyKilled(enemy);
        _rewardService.GrantKillReward(enemy);
    }
}
```

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
```csharp
// æ”¹è¿›åï¼šå‘å¸ƒé¢†åŸŸäº‹ä»¶
public class BattleEngine {
    private readonly IDomainEventBus _eventBus;
    
    public void OnEnemyKilled(Enemy enemy) {
        // æ¾è€¦åˆï¼šåªå‘å¸ƒäº‹ä»¶
        _eventBus.Publish(new EnemyKilledEvent {
            EnemyId = enemy.Id,
            CharacterId = Context.Character.Id,
            Timestamp = Clock.Now
        });
    }
}

// å„æœåŠ¡ç‹¬ç«‹è®¢é˜…äº‹ä»¶
public class BattleNotificationEventHandler : IDomainEventHandler<EnemyKilledEvent> {
    public async Task Handle(EnemyKilledEvent evt) {
        await _notificationService.NotifyEnemyKilled(evt);
    }
}

public class MetricsCollectorEventHandler : IDomainEventHandler<EnemyKilledEvent> {
    public async Task Handle(EnemyKilledEvent evt) {
        _metricsService.RecordEnemyKilled(evt);
    }
}
```

**ä¼˜åŠ¿**ï¼š
- BattleEngineä¸å†ä¾èµ–å…·ä½“æœåŠ¡
- æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ Event Handler
- æ˜“äºæµ‹è¯•

#### 8.3.2 å®Œå–„ä¾èµ–æ³¨å…¥

**å½“å‰é—®é¢˜**ï¼š
- éƒ¨åˆ†ç±»ä½¿ç”¨`new`ç›´æ¥å®ä¾‹åŒ–
- ä¸åˆ©äºæµ‹è¯•å’Œæ›¿æ¢å®ç°

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š
```csharp
// å½“å‰ï¼šç›´æ¥å®ä¾‹åŒ–
public class BattleEngine {
    public BattleEngine(Battle battle, Character character) {
        Context = new BattleContext();  // ä¸å¯æµ‹è¯•
        Clock = new GameClock();        // ä¸å¯æµ‹è¯•
    }
}

// æ”¹è¿›åï¼šä¾èµ–æ³¨å…¥
public class BattleEngine {
    public BattleEngine(
        Battle battle, 
        Character character,
        IBattleContextFactory contextFactory,  // å·¥å‚æ³¨å…¥
        IGameClock clock,                      // æ¥å£æ³¨å…¥
        ILogger<BattleEngine> logger) 
    {
        Context = contextFactory.Create(character);
        Clock = clock;
        _logger = logger;
    }
}

// æ³¨å†Œ
services.AddScoped<IBattleContextFactory, BattleContextFactory>();
services.AddScoped<IGameClock, GameClock>();
```

**ä¼˜åŠ¿**ï¼š
- æ˜“äºç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆå¯Mockï¼‰
- æ”¯æŒå¤šç§å®ç°åˆ‡æ¢
- ç¬¦åˆSOLIDåŸåˆ™

---

## å®æ–½è·¯çº¿å›¾

### 9.1 æ€»ä½“æ—¶é—´è§„åˆ’

**æ€»å·¥ä½œé‡**ï¼š75-95å¤©ï¼ˆçº¦3-4ä¸ªæœˆï¼‰

```
Phase åˆ†ç»„            â”‚ å·¥ä½œé‡    â”‚ ä¼˜å…ˆçº§ â”‚ æ—¶é—´çª—å£
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä¸Šç¯‡ï¼ˆæˆ˜æ–—ç³»ç»Ÿï¼‰      â”‚ 20-25å¤©  â”‚ P0     â”‚ Month 1
ä¸­ç¯‡ï¼ˆç»æµè£…å¤‡ï¼‰      â”‚ 15-20å¤©  â”‚ P1     â”‚ Month 2
ä¸‹ç¯‡ï¼ˆç¤¾äº¤è¿›é˜¶ï¼‰      â”‚ 40-50å¤©  â”‚ P2     â”‚ Month 3-4
ä»£ç è´¨é‡æ”¹è¿›         â”‚ 10å¤©     â”‚ P1     â”‚ ç©¿æ’è¿›è¡Œ
```

### 9.2 è¯¦ç»†ç”˜ç‰¹å›¾

```
Week â”‚ 1  â”‚ 2  â”‚ 3  â”‚ 4  â”‚ 5  â”‚ 6  â”‚ 7  â”‚ 8  â”‚ 9  â”‚ 10 â”‚ 11 â”‚ 12 â”‚ 13 â”‚ 14 â”‚ 15 â”‚ 16 â”‚
â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
Ph1  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph2  â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆ   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph3  â”‚    â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆ  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph4  â”‚    â”‚    â”‚    â”‚â–ˆâ–ˆ  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph5  â”‚    â”‚    â”‚    â”‚  â–ˆâ–ˆâ”‚â–ˆ   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
Ph6  â”‚    â”‚    â”‚    â”‚    â”‚ â–ˆâ–ˆâ–ˆâ”‚â–ˆ   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph7  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚ â–ˆâ–ˆâ–ˆâ”‚â–ˆ   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph8  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚ â–ˆâ–ˆâ–ˆâ”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph9  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚   â–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
Ph10 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆ â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
Ph11 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚   â–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆ â”‚    â”‚    â”‚    â”‚    â”‚
Ph12 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚   â–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚    â”‚
Ph13 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆ   â”‚
Ph14 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚ â–ˆâ–ˆâ–ˆâ”‚
Ph15 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚   â–ˆâ”‚
â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
ä»£ç è´¨é‡â”‚ â–ˆ  â”‚  â–ˆ â”‚   â–ˆâ”‚    â”‚    â”‚ â–ˆ  â”‚    â”‚    â”‚ â–ˆ  â”‚    â”‚    â”‚  â–ˆ â”‚    â”‚    â”‚ â–ˆ  â”‚    â”‚
```

### 9.3 é‡Œç¨‹ç¢‘ä¸äº¤ä»˜ç‰©

| é‡Œç¨‹ç¢‘ | æ—¶é—´ç‚¹ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|--------|--------|----------|
| **M1: åŒè½¨å®Œæˆ** | Week 1 | AttackTrack + SpecialTrack | ç‹¬ç«‹è§¦å‘ï¼Œé…ç½®ç”Ÿæ•ˆ |
| **M2: èµ„æºæ¡¶å®Œæˆ** | Week 3 | ResourceBucket + Overflow | æ”¯æŒ3ç§èµ„æºï¼Œæº¢å‡ºæ­£ç¡® |
| **M3: èŒä¸šå·®å¼‚åŒ–å®Œæˆ** | Week 5 | 3ä¸ªèŒä¸šé…ç½® | èŒä¸šä½“éªŒå·®å¼‚æ˜æ˜¾ |
| **M4: ä¸Šç¯‡å…¨éƒ¨å®Œæˆ** | Week 5 | æˆ˜æ–—ç³»ç»Ÿå¢å¼º | æ‰€æœ‰Phaseæµ‹è¯•é€šè¿‡ |
| **M5: è¯æ¡é‡ç½®å®Œæˆ** | Week 6 | Rerollç³»ç»Ÿ | æˆæœ¬é€’å¢ï¼Œä¿åº•ç”Ÿæ•ˆ |
| **M6: ç»æµç›‘æ§å®Œæˆ** | Week 7 | ç›‘æ§ä»ªè¡¨æ¿ | 10+æŒ‡æ ‡å¯æŸ¥è¯¢ |
| **M7: ä¸­ç¯‡å…¨éƒ¨å®Œæˆ** | Week 9 | ç»æµè£…å¤‡å®Œå–„ | ç»æµå¾ªç¯å¹³è¡¡ |
| **M8: æ¡ä»¶DSLå®Œæˆ** | Week 11 | æ¡ä»¶å¼•æ“ | è§£ææ±‚å€¼æ­£ç¡® |
| **M9: åœ°å›¾ç³»ç»Ÿå®Œæˆ** | Week 13 | åŒºåŸŸè§£é” | è‡³å°‘5ä¸ªåŒºåŸŸ |
| **M10: ä»»åŠ¡ç³»ç»Ÿå®Œæˆ** | Week 15 | ä»»åŠ¡ç®¡ç† | ä¸»çº¿+æ—¥å¸¸ä»»åŠ¡ |
| **M11: ä¸‹ç¯‡å…¨éƒ¨å®Œæˆ** | Week 16 | ç¤¾äº¤è¿›é˜¶åŠŸèƒ½ | æ‰€æœ‰åŠŸèƒ½å¯ç”¨ |
| **M12: é¡¹ç›®å®Œæˆ** | Week 16 | å®Œæ•´ç³»ç»Ÿ | æœ€ç»ˆéªŒæ”¶é€šè¿‡ |

### 9.4 èµ„æºåˆ†é…å»ºè®®

**æ¨èå›¢é˜Ÿé…ç½®**ï¼š
- **åç«¯å¼€å‘**ï¼š2äººï¼ˆä¸»åŠ›ï¼‰
- **å‰ç«¯å¼€å‘**ï¼š1äºº
- **æµ‹è¯•**ï¼š0.5äººï¼ˆå…¼èŒï¼‰
- **äº§å“/ç­–åˆ’**ï¼š0.5äººï¼ˆé…ç½®å†…å®¹ï¼‰

**å·¥ä½œåˆ†é…**ï¼š
```
å¼€å‘è€…Aï¼ˆåç«¯èµ„æ·±ï¼‰ï¼š
- Phase 1-5: æˆ˜æ–—ç³»ç»Ÿ
- Phase 10: æ¡ä»¶DSL
- Phase 13-15: é«˜çº§åŠŸèƒ½

å¼€å‘è€…Bï¼ˆåç«¯ï¼‰ï¼š
- Phase 6-9: ç»æµè£…å¤‡
- Phase 11-12: åœ°å›¾ä»»åŠ¡

å¼€å‘è€…Cï¼ˆå‰ç«¯ï¼‰ï¼š
- æ‰€æœ‰Phaseçš„å‰ç«¯UI
- SignalRé›†æˆ
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
```

### 9.5 é£é™©ç®¡ç†

| é£é™©ç±»å‹ | é£é™©æè¿° | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|---------|---------|------|------|---------|
| **æŠ€æœ¯é£é™©** | åŒè½¨ç³»ç»Ÿä¸ç°æœ‰ä»£ç å†²çª | ä¸­ | é«˜ | å……åˆ†æµ‹è¯•ï¼Œå¿…è¦æ—¶é‡æ„ç°æœ‰ä»£ç  |
| **æŠ€æœ¯é£é™©** | æ¡ä»¶DSLæ€§èƒ½é—®é¢˜ | ä½ | ä¸­ | å®ç°ç¼“å­˜ï¼Œæ€§èƒ½æµ‹è¯• |
| **è¿›åº¦é£é™©** | ä½ä¼°å·¥ä½œé‡å¯¼è‡´å»¶æœŸ | ä¸­ | é«˜ | é¢„ç•™20%ç¼“å†²æ—¶é—´ï¼Œä¼˜å…ˆçº§æ’åº |
| **èµ„æºé£é™©** | äººå‘˜ä¸è¶³æˆ–ç¦»èŒ | ä½ | é«˜ | çŸ¥è¯†æ–‡æ¡£åŒ–ï¼Œä»£ç å¯äº¤æ¥ |
| **è´¨é‡é£é™©** | æ–°åŠŸèƒ½å¼•å…¥Bug | ä¸­ | ä¸­ | å®Œå–„æµ‹è¯•è¦†ç›–ï¼Œåˆ†é˜¶æ®µä¸Šçº¿ |
| **å†…å®¹é£é™©** | æ¸¸æˆå¹³è¡¡æ€§é—®é¢˜ | ä¸­ | ä¸­ | æ•°æ®å¯é…ç½®ï¼Œæ˜“äºè°ƒæ•´ |

**é£é™©åº”å¯¹ç­–ç•¥**ï¼š
1. **æŠ€æœ¯é¢„ç ”**ï¼šå¤æ‚åŠŸèƒ½å…ˆåšPOCéªŒè¯å¯è¡Œæ€§
2. **å°æ­¥è¿­ä»£**ï¼šæ¯ä¸ªPhaseç‹¬ç«‹å¯éªŒæ”¶
3. **æµ‹è¯•å…ˆè¡Œ**ï¼šå…³é”®åŠŸèƒ½å…ˆå†™æµ‹è¯•
4. **å®šæœŸReview**ï¼šæ¯å‘¨è¿›è¡Œä»£ç Review
5. **ç°åº¦å‘å¸ƒ**ï¼šæ–°åŠŸèƒ½å…ˆå°èŒƒå›´æµ‹è¯•

---

## éªŒæ”¶æ–‡æ¡£

### 10.1 éªŒæ”¶æ ‡å‡†æ€»è§ˆ

**éªŒæ”¶åˆ†çº§**ï¼š
- **P0ï¼ˆå¿…é¡»ï¼‰**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»100%å®Œæˆ
- **P1ï¼ˆé‡è¦ï¼‰**ï¼šé‡è¦åŠŸèƒ½ï¼Œå¿…é¡»90%+å®Œæˆ
- **P2ï¼ˆä¸€èˆ¬ï¼‰**ï¼šå¢å¼ºåŠŸèƒ½ï¼Œå®Œæˆåº¦70%+å³å¯

### 10.2 ä¸Šç¯‡éªŒæ”¶æ¸…å•

#### Phase 1: åŒè½¨æˆ˜æ–—èŠ‚å¥

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: AttackTrackå’ŒSpecialTrackç‹¬ç«‹è§¦å‘
- [ ] P0: AttackTrackå—æ€¥é€Ÿå½±å“
- [ ] P0: SpecialTrackä¸å—æ€¥é€Ÿå½±å“
- [ ] P1: Trackå‚æ•°å¯é…ç½®
- [ ] P1: PauseWhenNoEnemiesç”Ÿæ•ˆ

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥90%
- [ ] P0: ä¸ç ´åç°æœ‰æˆ˜æ–—é€»è¾‘
- [ ] P1: æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™ï¼ˆ<5%ï¼‰

**æ–‡æ¡£éªŒæ”¶**ï¼š
- [ ] P1: ä»£ç æœ‰å®Œæ•´XMLæ³¨é‡Š
- [ ] P1: é…ç½®æœ‰è¯´æ˜æ–‡æ¡£

#### Phase 2: èµ„æºæ¡¶ä¸æº¢å‡º

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: æ”¯æŒè‡³å°‘3ç§èµ„æºç±»å‹
- [ ] P0: Clampç­–ç•¥æ­£ç¡®æˆªæ–­
- [ ] P0: Convertç­–ç•¥æ­£ç¡®è½¬æ¢ä¸ºBuff
- [ ] P1: èµ„æºç±»å‹å¯é…ç½®
- [ ] P1: æº¢å‡ºæ¯”ä¾‹å¯é…ç½®

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥95%
- [ ] P0: æ— å†…å­˜æ³„æ¼
- [ ] P1: èµ„æºæŸ¥æ‰¾æ€§èƒ½<1ms

#### Phase 3: èŒä¸šå·®å¼‚åŒ–

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: å®ç°è‡³å°‘3ä¸ªèŒä¸šé…ç½®
- [ ] P0: èµ„æºç”Ÿæˆè§„åˆ™ç¬¦åˆè®¾è®¡
- [ ] P0: Special Trackå‘¨æœŸæŒ‰èŒä¸šåŒºåˆ†
- [ ] P1: èŒä¸šç‰¹æœ‰Buffç”Ÿæ•ˆ
- [ ] P1: å‰ç«¯å¯åˆ‡æ¢èŒä¸š

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡
- [ ] P1: èŒä¸šä½“éªŒå·®å¼‚æ˜æ˜¾
- [ ] P1: æ¸¸æˆå¹³è¡¡æ€§åˆç†

#### Phase 4: æˆ˜æ–—æ®µèšåˆ

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: äº‹ä»¶æ•°é˜ˆå€¼flushç”Ÿæ•ˆ
- [ ] P0: èšåˆä¿¡æ¯å®Œæ•´
- [ ] P1: RNGç§å­èŒƒå›´è®°å½•

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: ç¦»çº¿æˆ˜æ–—å­˜å‚¨å¤§å°å‡å°‘30%+
- [ ] P1: Segmentç”Ÿæˆæ€§èƒ½<10ms

#### Phase 5: æ•ŒäººæŠ€èƒ½AI

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: æ•ŒäººæŒ‰ä¼˜å…ˆçº§é‡Šæ”¾æŠ€èƒ½
- [ ] P1: æ–½æ”¾æ¡ä»¶ç”Ÿæ•ˆ

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P1: æˆ˜æ–—éš¾åº¦åˆç†
- [ ] P1: AIè¡Œä¸ºç¬¦åˆé¢„æœŸ

### 10.3 ä¸­ç¯‡éªŒæ”¶æ¸…å•

#### Phase 6: è£…å¤‡è¯æ¡é‡ç½®

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è¯æ¡é‡æ–°ç”Ÿæˆæ­£ç¡®
- [ ] P0: æˆæœ¬é€’å¢ç¬¦åˆå…¬å¼
- [ ] P0: ä¿åº•æœºåˆ¶ç”Ÿæ•ˆ
- [ ] P1: å‰ç«¯UIå‹å¥½

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: ç»æµè®°å½•å®Œæ•´
- [ ] P1: æ“ä½œå“åº”æ—¶é—´<500ms

#### Phase 7: ç»æµç›‘æ§

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è®°å½•è‡³å°‘10ç§ç»æµäº‹ä»¶
- [ ] P0: æŸ¥è¯¢APIæ­£å¸¸å·¥ä½œ
- [ ] P1: ä»ªè¡¨æ¿å¯è§†åŒ–æ¸…æ™°

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: æŒ‡æ ‡æ•°æ®å‡†ç¡®
- [ ] P0: æŸ¥è¯¢å“åº”æ—¶é—´<500ms

#### Phase 8: ææ–™åˆ†å±‚

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: ææ–™æŒ‰ç­‰çº§åˆ†å±‚
- [ ] P0: æ‰è½è¡¨åŒ¹é…è§’è‰²ç­‰çº§
- [ ] P1: ææ–™ç”¨é€”æ¸…æ™°

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P1: ç»æµå¾ªç¯å¹³è¡¡

#### Phase 9: æ¶ˆè€—å“ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è‡ªåŠ¨ä½¿ç”¨ç­–ç•¥ç”Ÿæ•ˆ
- [ ] P0: Loadouté…ç½®æ­£ç¡®
- [ ] P1: å‰ç«¯UIå®Œæ•´

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P1: æˆ˜æ–—ç­–ç•¥ä¸°å¯Œåº¦æå‡

### 10.4 ä¸‹ç¯‡éªŒæ”¶æ¸…å•

#### Phase 10: æ¡ä»¶DSLå¼•æ“

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: æ”¯æŒåŸºæœ¬é€»è¾‘è¿ç®—ç¬¦
- [ ] P0: æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦
- [ ] P0: æ”¯æŒå‡½æ•°è°ƒç”¨
- [ ] P1: ç¼“å­˜å‘½ä¸­ç‡>80%

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P0: æ±‚å€¼æ€§èƒ½<5ms
- [ ] P0: è¡¨è¾¾å¼è§£ææ­£ç¡®ç‡100%

#### Phase 11: åœ°å›¾ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è‡³å°‘5ä¸ªåŒºåŸŸå¯ç”¨
- [ ] P0: åŒºåŸŸè§£é”é€»è¾‘æ­£ç¡®
- [ ] P1: æ€ªç‰©æ± éšæœºç”Ÿæˆ

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P1: å†…å®¹å¼•å¯¼æ¸…æ™°

#### Phase 12: ä»»åŠ¡ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: ä¸»çº¿ä»»åŠ¡é“¾å®Œæ•´
- [ ] P0: æ—¥å¸¸ä»»åŠ¡åˆ·æ–°æ­£å¸¸
- [ ] P1: ä»»åŠ¡ç›®æ ‡è¿½è¸ªå‡†ç¡®

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] P1: æ¸¸æˆç›®æ ‡æ˜ç¡®

#### Phase 13: å£°æœ›ç³»ç»Ÿ

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è‡³å°‘3ä¸ªæ´¾ç³»
- [ ] P0: å£°æœ›è®¡ç®—æ­£ç¡®
- [ ] P1: å£°æœ›å¥–åŠ±ç”Ÿæ•ˆ

#### Phase 14: Rosterå¢å¼º

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: æ§½ä½è§£é”æ­£å¸¸
- [ ] P1: åå°æ¨è¿›ç”Ÿæ•ˆ

#### Phase 15: ç›‘æ§è°ƒè¯•

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] P0: è‡³å°‘15ä¸ªç›‘æ§æŒ‡æ ‡
- [ ] P1: Debug APIå¯ç”¨

### 10.5 ä»£ç è´¨é‡éªŒæ”¶

**æ•´ä½“æŒ‡æ ‡**ï¼š
- [ ] P0: ç¼–è¯‘è­¦å‘Š=0
- [ ] P0: å•å…ƒæµ‹è¯•é€šè¿‡ç‡=100%
- [ ] P1: ä»£ç è¦†ç›–ç‡â‰¥85%
- [ ] P1: ä»£ç é‡å¤åº¦<5%
- [ ] P1: æ³¨é‡Šè¦†ç›–ç‡â‰¥90%

**æ€§èƒ½æŒ‡æ ‡**ï¼š
- [ ] P0: APIå“åº”æ—¶é—´ä¸­ä½æ•°<500ms
- [ ] P0: P99å“åº”æ—¶é—´<2s
- [ ] P1: å†…å­˜å ç”¨ç¨³å®šï¼ˆæ— æ³„æ¼ï¼‰
- [ ] P1: CPUä½¿ç”¨ç‡<70%

**å®‰å…¨æŒ‡æ ‡**ï¼š
- [ ] P0: æ— SQLæ³¨å…¥æ¼æ´
- [ ] P0: æ— XSSæ¼æ´
- [ ] P0: æƒé™æ£€æŸ¥å®Œæ•´
- [ ] P1: æ—¥å¿—ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯

### 10.6 æœ€ç»ˆéªŒæ”¶æŠ¥å‘Šæ¨¡æ¿

```markdown
# æœåŠ¡ç«¯åŠŸèƒ½å®ç°ä¸ä¼˜åŒ– - æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š

**é¡¹ç›®åç§°**: BlazorIdleæœåŠ¡ç«¯å¢å¼º  
**éªŒæ”¶æ—¥æœŸ**: YYYY-MM-DD  
**éªŒæ”¶äººå‘˜**: XXX  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0

## éªŒæ”¶æ¦‚å†µ

| åˆ†ç±» | P0å¿…é¡»é¡¹ | P1é‡è¦é¡¹ | P2ä¸€èˆ¬é¡¹ |
|------|---------|---------|---------|
| ä¸Šç¯‡ | 15/15 âœ… | 10/10 âœ… | 5/6 âš ï¸ |
| ä¸­ç¯‡ | 12/12 âœ… | 8/9 âš ï¸ | 4/5 âš ï¸ |
| ä¸‹ç¯‡ | 18/18 âœ… | 12/14 âš ï¸ | 7/10 âš ï¸ |
| ä»£ç è´¨é‡ | 5/5 âœ… | 6/7 âš ï¸ | N/A |
| **æ€»è®¡** | **50/50 âœ…** | **36/40 âš ï¸** | **16/21 âš ï¸** |

**æ•´ä½“è¯„ä¼°**: âœ… é€šè¿‡éªŒæ”¶  
**å®Œæˆåº¦**: P0: 100% | P1: 90% | P2: 76%

## è¯¦ç»†éªŒæ”¶ç»“æœ

### ä¸Šç¯‡ï¼šæˆ˜æ–—ä¸èŒä¸šç³»ç»Ÿå¢å¼º

#### Phase 1: åŒè½¨æˆ˜æ–—èŠ‚å¥ âœ…
- åŠŸèƒ½å®Œæ•´æ€§ï¼š5/5
- ä»£ç è´¨é‡ï¼šä¼˜ç§€
- æ–‡æ¡£å®Œå–„åº¦ï¼šå®Œæ•´
- é—ç•™é—®é¢˜ï¼šæ— 

#### Phase 2: èµ„æºæ¡¶ä¸æº¢å‡º âœ…
- åŠŸèƒ½å®Œæ•´æ€§ï¼š5/5
- ä»£ç è´¨é‡ï¼šä¼˜ç§€
- æµ‹è¯•è¦†ç›–ç‡ï¼š97%
- é—ç•™é—®é¢˜ï¼šæ— 

#### Phase 3: èŒä¸šå·®å¼‚åŒ– âœ…
- å·²å®ç°èŒä¸šï¼šæˆ˜å£«ã€æ³•å¸ˆã€åˆºå®¢
- ä½“éªŒå·®å¼‚ï¼šæ˜æ˜¾
- æ¸¸æˆå¹³è¡¡æ€§ï¼šè‰¯å¥½
- é—ç•™é—®é¢˜ï¼šç›—è´¼èŒä¸šå¾…è¡¥å……ï¼ˆP2ï¼‰

#### Phase 4: æˆ˜æ–—æ®µèšåˆ âœ…
- å­˜å‚¨ä¼˜åŒ–ï¼šå‡å°‘65%
- æ€§èƒ½æå‡ï¼šè¾¾æ ‡
- é—ç•™é—®é¢˜ï¼šæ— 

#### Phase 5: æ•ŒäººæŠ€èƒ½AI âœ…
- AIæ™ºèƒ½åº¦ï¼šè‰¯å¥½
- æˆ˜æ–—éš¾åº¦ï¼šåˆç†
- é—ç•™é—®é¢˜ï¼šæ— 

### ä¸­ç¯‡ï¼šç»æµä¸è£…å¤‡ç³»ç»Ÿå®Œå–„

ï¼ˆç±»ä¼¼æ ¼å¼ï¼‰

### ä¸‹ç¯‡ï¼šç¤¾äº¤ä¸è¿›é˜¶åŠŸèƒ½

ï¼ˆç±»ä¼¼æ ¼å¼ï¼‰

## é—ç•™é—®é¢˜æ¸…å•

| é—®é¢˜ID | æè¿° | ä¼˜å…ˆçº§ | è®¡åˆ’å¤„ç†æ—¶é—´ |
|--------|------|--------|-------------|
| ISS-001 | ç›—è´¼èŒä¸šé…ç½®å¾…è¡¥å…… | P2 | ä¸‹ä¸ªè¿­ä»£ |
| ISS-002 | éƒ¨åˆ†ç›‘æ§æŒ‡æ ‡æ•°æ®ä¸å¤Ÿè¯¦ç»† | P1 | 1å‘¨å†…ä¿®å¤ |
| ISS-003 | ä»»åŠ¡ç³»ç»Ÿæˆå°±ç±»å‹å¾…å®Œå–„ | P2 | åç»­ç‰ˆæœ¬ |

## æ€§èƒ½æµ‹è¯•ç»“æœ

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| APIå“åº”æ—¶é—´ï¼ˆä¸­ä½æ•°ï¼‰ | <500ms | 342ms | âœ… |
| APIå“åº”æ—¶é—´ï¼ˆP99ï¼‰ | <2s | 1.8s | âœ… |
| ç¦»çº¿æˆ˜æ–—æ¨¡æ‹Ÿï¼ˆ10å°æ—¶ï¼‰ | <30s | 24s | âœ… |
| å†…å­˜å ç”¨ï¼ˆç¨³å®šçŠ¶æ€ï¼‰ | <500MB | 410MB | âœ… |
| æ•°æ®åº“æŸ¥è¯¢ï¼ˆå¹³å‡ï¼‰ | <100ms | 78ms | âœ… |

## éªŒæ”¶ç»“è®º

âœ… **é¡¹ç›®é€šè¿‡éªŒæ”¶**

æ‰€æœ‰P0å¿…é¡»é¡¹å·²100%å®Œæˆï¼ŒP1é‡è¦é¡¹å®Œæˆ90%ï¼Œè¶…å‡ºé¢„æœŸç›®æ ‡ï¼ˆ80%ï¼‰ã€‚é—ç•™çš„P1å’ŒP2é—®é¢˜å‡ä¸ºéé˜»å¡æ€§é—®é¢˜ï¼Œå¯åœ¨åç»­è¿­ä»£ä¸­è§£å†³ã€‚

### ä¼˜ç‚¹

1. âœ… ä»£ç è´¨é‡é«˜ï¼Œæ³¨é‡Šå®Œå–„
2. âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
3. âœ… æ€§èƒ½è¡¨ç°ä¼˜ç§€
4. âœ… å¯ç»´æŠ¤æ€§å¼º

### æ”¹è¿›å»ºè®®

1. âš ï¸ éƒ¨åˆ†P1åŠŸèƒ½å¯è¿›ä¸€æ­¥ä¼˜åŒ–
2. âš ï¸ æ–‡æ¡£å¯å¢åŠ æ›´å¤šä½¿ç”¨ç¤ºä¾‹
3. âš ï¸ ç›‘æ§æŒ‡æ ‡å¯æ›´åŠ ä¸°å¯Œ

### ç­¾ç½²

**å¼€å‘è´Ÿè´£äºº**: __________ æ—¥æœŸ: __________  
**æµ‹è¯•è´Ÿè´£äºº**: __________ æ—¥æœŸ: __________  
**é¡¹ç›®è´Ÿè´£äºº**: __________ æ—¥æœŸ: __________  
```

---

## é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| Track | æˆ˜æ–—èŠ‚å¥è½¨é“ï¼ˆAttack / Specialï¼‰ |
| ResourceBucket | èŒä¸šèµ„æºæ¡¶ï¼ˆå¦‚æ€’æ°”ã€ç¢ç‰‡ï¼‰ |
| OverflowPolicy | èµ„æºæº¢å‡ºç­–ç•¥ï¼ˆClamp / Convertï¼‰ |
| CombatSegment | æˆ˜æ–—æ®µï¼Œèšåˆä¸€æ®µæ—¶é—´å†…çš„æˆ˜æ–—äº‹ä»¶ |
| ConditionExpr | æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºè§£é”åˆ¤å®š |
| DSL | é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDomain-Specific Languageï¼‰ |
| MapRegion | åœ°å›¾åŒºåŸŸ |
| Faction | æ´¾ç³»ï¼Œç”¨äºå£°æœ›ç³»ç»Ÿ |
| Roster | è§’è‰²åˆ—è¡¨ï¼Œå¤šè§’è‰²ç®¡ç† |

### B. å‚è€ƒæ–‡æ¡£

1. **æ•´åˆè®¾è®¡æ€»ç»“.txt** - ç³»ç»Ÿæ¶æ„è®¾è®¡è“å›¾
2. **æœåŠ¡ç«¯ä»£ç ä¼˜åŒ–é¡¹ç›®æ€»ç»“.md** - ä»£ç ä¼˜åŒ–ç»éªŒæ€»ç»“
3. **æˆ˜æ–—å¾ªç¯ä¼˜åŒ–é¡¹ç›®æ€»ç»“.md** - æˆ˜æ–—ç³»ç»Ÿä¼˜åŒ–è®°å½•
4. **å•†åº—ç³»ç»ŸPhase5äº¤ä»˜è¯´æ˜.md** - é…ç½®åŒ–å®è·µç»éªŒ
5. **SignalR_æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š.md** - SignalRå®æ–½ç»éªŒ
6. **è£…å¤‡ç³»ç»ŸæŒç»­ä¼˜åŒ–æŠ¥å‘Š2025-10-12.md** - è£…å¤‡ç³»ç»Ÿé‡æ„ç»éªŒ

### C. è”ç³»æ–¹å¼

**é¡¹ç›®ä»“åº“**: https://github.com/Solaireshen97/BlazorIdle  
**é—®é¢˜åé¦ˆ**: GitHub Issues  
**æŠ€æœ¯è®¨è®º**: é¡¹ç›®è®¨è®ºåŒº

---

**æ–‡æ¡£ç»“æŸ**

**åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æ€»é¡µæ•°**: 60+é¡µ  
**æ€»å­—æ•°**: 30,000+å­—  
**ä½œè€…**: AIåŠ©æ‰‹ + é¡¹ç›®åˆ†æ

