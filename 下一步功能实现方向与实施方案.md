# BlazorIdle ä¸‹ä¸€æ­¥åŠŸèƒ½å®ç°æ–¹å‘ä¸å®æ–½æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ  
**åŸºäº**: æ•´åˆè®¾è®¡æ€»ç»“.txt (V3.1) + é¡¹ç›®è¿›åº¦ä¸è§„åˆ’.md  
**ä½œè€…**: ç³»ç»Ÿè§„åˆ’  
**çŠ¶æ€**: ä»…æ–¹æ¡ˆï¼Œä¸åŒ…å«å®é™…ä¿®æ”¹

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#1-æ‰§è¡Œæ‘˜è¦)
2. [å½“å‰é¡¹ç›®çŠ¶æ€è¯„ä¼°](#2-å½“å‰é¡¹ç›®çŠ¶æ€è¯„ä¼°)
3. [æ ¸å¿ƒç“¶é¢ˆåˆ†æ](#3-æ ¸å¿ƒç“¶é¢ˆåˆ†æ)
4. [åŠŸèƒ½å®ç°ä¼˜å…ˆçº§çŸ©é˜µ](#4-åŠŸèƒ½å®ç°ä¼˜å…ˆçº§çŸ©é˜µ)
5. [è¯¦ç»†å®æ–½æ–¹æ¡ˆ](#5-è¯¦ç»†å®æ–½æ–¹æ¡ˆ)
6. [æŠ€æœ¯å€ºåŠ¡æ¸…ç†è®¡åˆ’](#6-æŠ€æœ¯å€ºåŠ¡æ¸…ç†è®¡åˆ’)
7. [é£é™©è¯„ä¼°ä¸ç¼“è§£](#7-é£é™©è¯„ä¼°ä¸ç¼“è§£)
8. [èµ„æºä¼°ç®—ä¸æ—¶é—´çº¿](#8-èµ„æºä¼°ç®—ä¸æ—¶é—´çº¿)
9. [æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶](#9-æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶)

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 é¡¹ç›®ç°çŠ¶

BlazorIdle æ˜¯ä¸€æ¬¾"æœåŠ¡ç«¯æƒå¨ + æ”¾ç½®å¾ªç¯ + æ„ç­‘æ·±åº¦"çš„ Web RPG æ¸¸æˆï¼Œå½“å‰å·²å®Œæˆï¼š

- âœ… **äº‹ä»¶é©±åŠ¨æˆ˜æ–—å¼•æ“** (95% å®Œæˆ)
- âœ… **åŒè½¨æˆ˜æ–—ç³»ç»Ÿ** (100% å®Œæˆ)
- âœ… **èµ„æºä¸ Buff ç³»ç»Ÿ** (90% å®Œæˆ)
- âœ… **æŠ€èƒ½ä¸è‡ªåŠ¨æ–½æ”¾** (85% å®Œæˆ)
- âœ… **åŸºç¡€ç»æµç³»ç»Ÿ** (80% å®Œæˆ)

**æ€»ä½“å®Œæˆåº¦**: çº¦ **28%**

### 1.2 å…³é”®é—®é¢˜

1. **æœåŠ¡å™¨ç«¯æ³¨å†Œé—®é¢˜**ï¼ˆå·²åˆ†æï¼Œè§é…å¥—æ–‡æ¡£ï¼‰
2. **ç¦»çº¿å¿«è¿›ç³»ç»Ÿç¼ºå¤±**ï¼ˆæ”¾ç½®æ¸¸æˆæ ¸å¿ƒï¼‰
3. **æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿç¼ºå¤±**ï¼ˆå¤šä»»åŠ¡ç®¡ç†ï¼‰
4. **è£…å¤‡å¼ºåŒ–ç”Ÿæ€ç¼ºå¤±**ï¼ˆæ„ç­‘æ·±åº¦ï¼‰

### 1.3 æˆ˜ç•¥ç›®æ ‡

**3 ä¸ªæœˆç›®æ ‡**ï¼ˆQ1 2025ï¼‰:
- ä¿®å¤ DI é—®é¢˜ï¼Œç¡®ä¿æœåŠ¡å™¨å¯å¯åŠ¨
- å®ç°æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿï¼ˆå¤šæ§½è°ƒåº¦ï¼‰
- å®ç°ç¦»çº¿å¿«è¿›å¼•æ“
- å®Œæˆåœ°å›¾åŒºåŸŸåŸºç¡€

**6 ä¸ªæœˆç›®æ ‡**ï¼ˆQ2 2025ï¼‰:
- å®Œæ•´è£…å¤‡ç³»ç»Ÿï¼ˆTier/Affix/åˆ†è§£/é‡é“¸ï¼‰
- ç»æµé—­ç¯å»ºç«‹
- ä»»åŠ¡ä¸å£°æœ›ç³»ç»Ÿ

**12 ä¸ªæœˆç›®æ ‡**ï¼ˆ2025å…¨å¹´ï¼‰:
- å¤šè§’è‰² Roster ç³»ç»Ÿ
- é…ç½®ç‰ˆæœ¬åŒ–ä¸çƒ­æ›´æ–°
- åˆæ­¥ç¤¾äº¤åŠŸèƒ½ï¼ˆç»„é˜Ÿ/å‰¯æœ¬ï¼‰

---

## 2. å½“å‰é¡¹ç›®çŠ¶æ€è¯„ä¼°

### 2.1 å·²å®ç°åŠŸèƒ½æ¸…å•

#### 2.1.1 æˆ˜æ–—å¼•æ“ï¼ˆæ ¸å¿ƒï¼‰â­â­â­â­â­

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è´¨é‡è¯„ä¼° | å¤‡æ³¨ |
|---------|--------|---------|------|
| **GameClock** | 100% | â­â­â­â­â­ | é€»è¾‘æ—¶é’Ÿï¼Œå•è°ƒé€’å¢ |
| **EventScheduler** | 100% | â­â­â­â­â­ | ä¼˜å…ˆé˜Ÿåˆ—è°ƒåº¦ï¼ŒO(log n) |
| **TrackState** | 100% | â­â­â­â­â­ | åŒè½¨ï¼ˆAttack + Specialï¼‰ |
| **BattleRunner** | 100% | â­â­â­â­ | äº‹ä»¶å¾ªç¯ï¼Œå¯å›æ”¾ |
| **StepBattleCoordinator** | 100% | â­â­â­â­â­ | å¼‚æ­¥æˆ˜æ–—ç®¡ç† |
| **å›æ”¾ç³»ç»Ÿ** | 100% | â­â­â­â­ | åŸºäº BattleRecord |

**äº®ç‚¹**:
- ç¡®å®šæ€§æ—¶é—´æ¨è¿›
- RNG å¯å›æ”¾ï¼ˆæ®µçº§ç§å­ï¼‰
- å¿«ç…§æ¢å¤æœºåˆ¶å®Œå–„
- å¹‚ç­‰ Finalizer è®¾è®¡ä¼˜ç§€

#### 2.1.2 èµ„æºä¸çŠ¶æ€ç®¡ç† â­â­â­â­

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è´¨é‡è¯„ä¼° | å¤‡æ³¨ |
|---------|--------|---------|------|
| **ResourceBucket** | 100% | â­â­â­â­â­ | ä¸‰ç§æº¢å‡ºç­–ç•¥ |
| **BuffInstance** | 90% | â­â­â­â­ | ç¼ºå°‘æº¢å‡ºè½¬æ¢ |
| **BuffAggregate** | 100% | â­â­â­â­â­ | å±æ€§èšåˆå…¬å¼å®Œå–„ |
| **DoT/HoT** | 100% | â­â­â­â­ | å‘¨æœŸæ€§æ•ˆæœ |

**äº®ç‚¹**:
- èµ„æºæº¢å‡ºè½¬æ¢æœºåˆ¶ï¼ˆConvertï¼‰
- Buff å åŠ ç­–ç•¥å®Œæ•´
- Haste å¿«ç…§æ”¯æŒ

#### 2.1.3 æŠ€èƒ½ç³»ç»Ÿ â­â­â­â­

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è´¨é‡è¯„ä¼° | å¤‡æ³¨ |
|---------|--------|---------|------|
| **SkillDefinition** | 100% | â­â­â­â­ | æ•°æ®é©±åŠ¨ |
| **SkillRuntime** | 100% | â­â­â­â­â­ | å¤šå……èƒ½æœºåˆ¶ |
| **AutoCastEngine** | 85% | â­â­â­â­ | åŸºç¡€ä¼˜å…ˆçº§ |
| **æ–½æ³•æ‰“æ–­** | 100% | â­â­â­â­ | å……èƒ½è¿”è¿˜ |

**äº®ç‚¹**:
- å¤šå……èƒ½é“¾å¼è§¦å‘
- Off-GCD ç¼–ç»‡
- æ‰“æ–­æœºåˆ¶å®Œå–„

#### 2.1.4 Proc ç³»ç»Ÿ â­â­â­â­â­

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è´¨é‡è¯„ä¼° | å¤‡æ³¨ |
|---------|--------|---------|------|
| **RPPM** | 100% | â­â­â­â­â­ | çœŸå®è§¦å‘é¢‘ç‡ |
| **è§¦å‘ç±»å‹** | 100% | â­â­â­â­â­ | OnHit/OnCrit/OnCast |
| **ICD** | 100% | â­â­â­â­ | å†·å´ç®¡ç† |
| **æ¥æºè¿‡æ»¤** | 100% | â­â­â­â­ | å¯é…ç½®ä¸å« DoT |

**è¯„ä»·**: è®¾è®¡ä¼˜ç§€ï¼ŒåŠŸèƒ½å®Œæ•´

#### 2.1.5 ç»æµç³»ç»Ÿ â­â­â­

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è´¨é‡è¯„ä¼° | å¤‡æ³¨ |
|---------|--------|---------|------|
| **LootTable** | 100% | â­â­â­â­ | æ‰è½è¡¨å®šä¹‰ |
| **EconomyCalculator** | 100% | â­â­â­â­â­ | åŒæ¨¡å¼ï¼ˆæœŸæœ›/æŠ½æ ·ï¼‰ |
| **RewardGrantService** | 100% | â­â­â­â­ | å¹‚ç­‰æ€§ä¿è¯ |
| **InventoryItem** | 100% | â­â­â­ | åŸºç¡€èƒŒåŒ… |
| **ç»æµç›‘æ§** | 0% | - | æœªå®ç° |

**äº®ç‚¹**:
- ç‹¬ç«‹ç»æµ RNG
- å¹‚ç­‰æ€§è®¾è®¡
- åŒæ¨¡å¼æ”¯æŒ

**ç¼ºå¤±**:
- ç›‘æ§æŒ‡æ ‡
- äº§å‡º/æ¶ˆè€—å¹³è¡¡

### 2.2 æœªå®ç°åŠŸèƒ½æ¸…å•

#### 2.2.1 æ ¸å¿ƒç³»ç»Ÿï¼ˆP0 - å¿…é¡»å®Œæˆï¼‰

| ç³»ç»Ÿ | å½±å“ | ç´§æ€¥åº¦ |
|-----|------|-------|
| **æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿ** | æ— æ³•å¤šä»»åŠ¡ï¼Œæ— æ³•é˜Ÿåˆ— | â­â­â­â­â­ |
| **ç¦»çº¿å¿«è¿›å¼•æ“** | æ”¾ç½®æ¸¸æˆæ ¸å¿ƒç¼ºå¤± | â­â­â­â­â­ |
| **è£…å¤‡å¼ºåŒ–ç”Ÿæ€** | æ„ç­‘æ·±åº¦ä¸è¶³ | â­â­â­â­ |
| **åœ°å›¾ä¸åŒºåŸŸç³»ç»Ÿ** | å†…å®¹å¹³å¦ï¼Œæ— è¿›åº¦æ„Ÿ | â­â­â­â­ |

#### 2.2.2 å¢å¼ºç³»ç»Ÿï¼ˆP1 - åº”è¯¥å®Œæˆï¼‰

| ç³»ç»Ÿ | å½±å“ | ç´§æ€¥åº¦ |
|-----|------|-------|
| **æ¡ä»¶è§£é” DSL** | æ— æ³•å®ç°å¤æ‚é€»è¾‘ | â­â­â­ |
| **ä»»åŠ¡ä¸å£°æœ›** | ç¼ºå°‘å¼•å¯¼å’Œé•¿æœŸç›®æ ‡ | â­â­â­ |
| **CombatSegment èšåˆ** | æŸ¥è¯¢æ€§èƒ½å¾…ä¼˜åŒ– | â­â­â­ |
| **ç»æµç›‘æ§** | æ— æ³•æ§åˆ¶é€šèƒ€ | â­â­â­ |

#### 2.2.3 æ‰©å±•ç³»ç»Ÿï¼ˆP2 - å¯ä»¥è€ƒè™‘ï¼‰

| ç³»ç»Ÿ | å½±å“ | ç´§æ€¥åº¦ |
|-----|------|-------|
| **å¤šè§’è‰² Roster** | å•è§’è‰²ä½“éªŒå•è–„ | â­â­ |
| **é…ç½®ç‰ˆæœ¬åŒ–** | è¿ç»´ä¾¿åˆ©æ€§ | â­â­ |
| **ç»„é˜Ÿä¸å‰¯æœ¬** | ç¤¾äº¤åŠŸèƒ½ | â­ |
| **æ¶ˆè€—å“ç³»ç»Ÿ** | é¢å¤–ç©æ³• | â­ |

---

## 3. æ ¸å¿ƒç“¶é¢ˆåˆ†æ

### 3.1 æŠ€æœ¯ç“¶é¢ˆ

#### 3.1.1 ä¾èµ–æ³¨å…¥é—®é¢˜ï¼ˆå·²è¯†åˆ«ï¼‰

**é—®é¢˜**: `CombatActivityExecutor` (Singleton) ä¾èµ– `ICharacterRepository` (Scoped)

**å½±å“**:
- æœåŠ¡å™¨æ— æ³•å¯åŠ¨
- æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨
- å‰ç«¯é›†æˆæ— æ³•æµ‹è¯•

**è§£å†³æ–¹æ¡ˆ**: å‚è§ã€ŠæœåŠ¡å™¨ç«¯æ³¨å†Œé—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ.mdã€‹

#### 3.1.2 EventScheduler æœªç‹¬ç«‹

**é—®é¢˜**: å½“å‰äº‹ä»¶è°ƒåº¦æ··æ‚åœ¨ `BattleRunner` ä¸­

**å½±å“**:
- éš¾ä»¥åœ¨ç¦»çº¿ç³»ç»Ÿä¸­å¤ç”¨
- ä»£ç è€¦åˆåº¦é«˜
- éš¾ä»¥å•ç‹¬æµ‹è¯•

**è§£å†³æ–¹æ¡ˆ**:
```csharp
// æŠ½å–ä¸ºç‹¬ç«‹ç»„ä»¶
public class EventScheduler
{
    private PriorityQueue<IGameEvent, double> _queue;
    
    public void Schedule(IGameEvent evt);
    public IGameEvent PopNext();
    public bool HasEvents { get; }
}
```

#### 3.1.3 ResourceBucket ç¼ºå°‘èŒä¸šèµ„æº

**é—®é¢˜**: å½“å‰ä»…æ”¯æŒ Health/Mana

**å½±å“**:
- èŒä¸šå·®å¼‚åŒ–ä¸æ˜æ˜¾
- æ— æ³•å®ç°æ€’æ°”ã€ç¢ç‰‡ç­‰æœºåˆ¶
- æº¢å‡ºè½¬æ¢æ— æ³•å……åˆ†åˆ©ç”¨

**è§£å†³æ–¹æ¡ˆ**: å‚è§ Phase 1 è¯¦ç»†æ–¹æ¡ˆ

### 3.2 æ¶æ„ç“¶é¢ˆ

#### 3.2.1 æ´»åŠ¨ç³»ç»Ÿç¼ºå¤±

**é—®é¢˜**: è§’è‰²åªèƒ½è¿›è¡Œå•ä¸€æˆ˜æ–—æ´»åŠ¨

**å½±å“**:
- æ— æ³•åŒæ—¶æŒ‚æœºå’Œé‡‡é›†
- æ— æ³•é˜Ÿåˆ—å¤šä¸ªä»»åŠ¡
- ç¦»çº¿ç³»ç»Ÿæ— æ³•å®ç°

**è§£å†³æ–¹æ¡ˆ**: å‚è§ Phase 3 è¯¦ç»†æ–¹æ¡ˆ

#### 3.2.2 æ•°æ®èšåˆä¸è¶³

**é—®é¢˜**: `CombatSegment` å­˜å‚¨åŸå§‹äº‹ä»¶ï¼Œæ— èšåˆç»Ÿè®¡

**å½±å“**:
- æŸ¥è¯¢æ…¢ï¼ˆéœ€éå†æ‰€æœ‰äº‹ä»¶ï¼‰
- å­˜å‚¨æˆæœ¬é«˜
- ç¦»çº¿ç™»å½•å¡é¡¿

**è§£å†³æ–¹æ¡ˆ**: å‚è§ Phase 4 è¯¦ç»†æ–¹æ¡ˆ

### 3.3 å†…å®¹ç“¶é¢ˆ

#### 3.3.1 è£…å¤‡ç³»ç»Ÿç®€å•

**é—®é¢˜**: è£…å¤‡æ— åŠ¨æ€ç”Ÿæˆï¼Œæ— è¯æ¡ç³»ç»Ÿ

**å½±å“**:
- æ„ç­‘æ·±åº¦ä¸¥é‡ä¸è¶³
- ç©å®¶æ— é•¿æœŸè¿½æ±‚ç›®æ ‡
- ç»æµå¾ªç¯æ— æ¶ˆè€—ç«¯

**è§£å†³æ–¹æ¡ˆ**: å‚è§ Phase 6 è¯¦ç»†æ–¹æ¡ˆ

#### 3.3.2 åœ°å›¾å¹³å¦

**é—®é¢˜**: æ— åŒºåŸŸæ¦‚å¿µï¼Œæ— è§£é”é“¾

**å½±å“**:
- å†…å®¹æ— å±‚æ¬¡
- ç¼ºå°‘è¿›åº¦æ„Ÿ
- ç©å®¶è¿·å¤±æ–¹å‘

**è§£å†³æ–¹æ¡ˆ**: å‚è§ Phase 5 è¯¦ç»†æ–¹æ¡ˆ

---

## 4. åŠŸèƒ½å®ç°ä¼˜å…ˆçº§çŸ©é˜µ

### 4.1 å½±å“ vs ç´§æ€¥åº¦çŸ©é˜µ

```
å½±å“åº¦
  â†‘
  |  P0-Critical        P0-High
  |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
é«˜ |  â”‚ 1. æ´»åŠ¨è®¡åˆ’     â”‚ 3. è£…å¤‡ç³»ç»Ÿ     â”‚
  |  â”‚ 2. ç¦»çº¿å¿«è¿›     â”‚ 4. åœ°å›¾åŒºåŸŸ     â”‚
  |  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  |  â”‚ 5. æ¡ä»¶ DSL     â”‚ 7. ç»æµç›‘æ§     â”‚
ä¸­ |  â”‚ 6. ä»»åŠ¡å£°æœ›     â”‚ 8. Segment ä¼˜åŒ– â”‚
  |  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  |  â”‚ 9. Roster       â”‚11. Debug é¢æ¿   â”‚
ä½ |  â”‚10. Config ç‰ˆæœ¬  â”‚12. ç»„é˜Ÿå‰¯æœ¬     â”‚
  |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  |        é«˜                   ä½
  +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç´§æ€¥åº¦
```

### 4.2 ä¾èµ–å…³ç³»å›¾

```
Phase 0: DI é—®é¢˜ä¿®å¤
  â†“
Phase 1: æˆ˜æ–—å¼•æ“é‡æ„
  â”œâ”€> EventScheduler ç‹¬ç«‹
  â”œâ”€> ResourceBucket æ‰©å±•
  â””â”€> Buff æº¢å‡ºè½¬æ¢
  â†“
Phase 2/3: æ´»åŠ¨è®¡åˆ’ç³»ç»Ÿ â† å¿…é¡»ä¾èµ– Phase 1
  â†“
Phase 4: ç¦»çº¿å¿«è¿›å¼•æ“ â† ä¾èµ– Phase 2/3
  â†“
Phase 5: åœ°å›¾/æ¡ä»¶ DSL â† å¯ä¸ Phase 4 å¹¶è¡Œ
  â†“
Phase 6: è£…å¤‡ç³»ç»Ÿ â† ä¾èµ– Phase 5ï¼ˆæ‰è½åœºæ™¯ï¼‰
  â†“
Phase 7-9: å¢å¼ºä¸ä¼˜åŒ–
  â†“
Phase 10-12: æ‰©å±•åŠŸèƒ½
```

### 4.3 æ¨èå®æ–½é¡ºåº

| é˜¶æ®µ | æ—¶é—´ | æ ¸å¿ƒäº¤ä»˜ | ä¾èµ– |
|-----|------|---------|-----|
| **Phase 0** | 1å‘¨ | DI é—®é¢˜ä¿®å¤ | æ—  |
| **Phase 1** | 2å‘¨ | æˆ˜æ–—å¼•æ“é‡æ„ | Phase 0 |
| **Phase 2** | 3å‘¨ | æ´»åŠ¨è®¡åˆ’åŸºç¡€ | Phase 1 |
| **Phase 3** | 2å‘¨ | æ´»åŠ¨è®¡åˆ’å®Œå–„ | Phase 2 |
| **Phase 4** | 3å‘¨ | ç¦»çº¿å¿«è¿›å¼•æ“ | Phase 3 |
| **Phase 5** | 4å‘¨ | åœ°å›¾/æ¡ä»¶ DSL | Phase 4 |
| **Phase 6** | 6å‘¨ | è£…å¤‡ç³»ç»Ÿ | Phase 5 |
| **Phase 7+** | æŒç»­ | å¢å¼ºä¸æ‰©å±• | Phase 6 |

**æ€»è®¡**: çº¦ 4-5 ä¸ªæœˆå®Œæˆæ ¸å¿ƒç³»ç»Ÿ

---

## 5. è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### Phase 0: DI é—®é¢˜ä¿®å¤ï¼ˆ1 å‘¨ï¼‰

#### ç›®æ ‡
âœ… æœåŠ¡å™¨å¯æ­£å¸¸å¯åŠ¨
âœ… æ´»åŠ¨è®¡åˆ’ API å¯è°ƒç”¨
âœ… å‰ç«¯é›†æˆå¯æµ‹è¯•

#### è¯¦ç»†æ–¹æ¡ˆ

å‚è§ã€ŠæœåŠ¡å™¨ç«¯æ³¨å†Œé—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ.mdã€‹ï¼Œæ ¸å¿ƒæ”¹åŠ¨ï¼š

1. **ä¿®æ”¹ CombatActivityExecutor æ„é€ å‡½æ•°**
   - åˆ é™¤ `ICharacterRepository` å‚æ•°
   - æ·»åŠ  `IServiceScopeFactory` å‚æ•°

2. **ä¿®æ”¹ StartAsync æ–¹æ³•**
   - åˆ›å»ºä¸´æ—¶ Scope
   - ä» Scope è·å– Repository
   - ä½¿ç”¨ `using` è¯­å¥ç¡®ä¿é‡Šæ”¾

3. **æµ‹è¯•éªŒè¯**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - æ‰‹åŠ¨æµ‹è¯•

#### äº¤ä»˜ç‰©
- [x] `CombatActivityExecutor.cs` ä¿®æ”¹
- [x] å•å…ƒæµ‹è¯•
- [x] æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [x] API ç«¯ç‚¹å¯è°ƒç”¨

---

### Phase 1: æˆ˜æ–—å¼•æ“é‡æ„ï¼ˆ2 å‘¨ï¼‰

#### ç›®æ ‡
âœ… EventScheduler ç‹¬ç«‹å¯å¤ç”¨
âœ… ResourceBucket æ”¯æŒèŒä¸šèµ„æº
âœ… Buff æº¢å‡ºè½¬æ¢å®Œå–„

#### 1.1 EventScheduler ç‹¬ç«‹åŒ–

**å½“å‰é—®é¢˜**: äº‹ä»¶è°ƒåº¦é€»è¾‘æ··æ‚åœ¨ `BattleRunner` ä¸­

**æ”¹é€ æ–¹æ¡ˆ**:

```csharp
// æ–°æ–‡ä»¶: Domain/Combat/EventScheduler.cs
public class EventScheduler
{
    private PriorityQueue<IGameEvent, double> _queue = new();
    
    public void Schedule(IGameEvent evt)
    {
        _queue.Enqueue(evt, evt.ExecuteAt);
    }
    
    public IGameEvent PopNext()
    {
        return _queue.Dequeue();
    }
    
    public bool HasEvents => _queue.Count > 0;
    
    public int Count => _queue.Count;
}
```

**BattleRunner æ”¹é€ **:

```csharp
// ä¿®æ”¹: Application/Battles/BattleRunner.cs
public class BattleRunner
{
    public BattleResult Run(BattleContext context)
    {
        var scheduler = new EventScheduler();  // ä½¿ç”¨ç‹¬ç«‹è°ƒåº¦å™¨
        var clock = new GameClock();
        
        // åˆå§‹åŒ–äº‹ä»¶
        scheduler.Schedule(new AttackTickEvent(...));
        scheduler.Schedule(new SpecialPulseEvent(...));
        
        while (scheduler.HasEvents)
        {
            var evt = scheduler.PopNext();
            clock.AdvanceTo(evt.ExecuteAt);
            evt.Execute(context);
            
            // å¯èƒ½è°ƒåº¦æ–°äº‹ä»¶
            // scheduler.Schedule(...)
        }
        
        return BuildResult(context);
    }
}
```

**ä¼˜åŠ¿**:
- âœ… å¯åœ¨ç¦»çº¿ç³»ç»Ÿä¸­å¤ç”¨
- âœ… æ˜“äºå•ç‹¬æµ‹è¯•
- âœ… ä»£ç æ›´æ¸…æ™°

#### 1.2 ResourceBucket èŒä¸šèµ„æºæ‰©å±•

**å½“å‰çŠ¶æ€**: ä»… Health/Mana

**æ‰©å±•æ–¹æ¡ˆ**:

```csharp
// æ‰©å±•: Domain/Combat/Resources/ResourceBucket.cs
public enum ResourceType
{
    Health,
    Mana,
    Rage,           // æˆ˜å£«ï¼šæ€’æ°”
    ShardIce,       // æ³•å¸ˆï¼šå†°ç¢ç‰‡
    Focus,          // æ¸¸ä¾ ï¼šé›†ä¸­å€¼
    Energy,         // ç›—è´¼ï¼šèƒ½é‡
    ComboPoints,    // ç›—è´¼ï¼šè¿å‡»ç‚¹
    HolyPower,      // åœ£éª‘å£«ï¼šåœ£èƒ½
    // æœªæ¥æ‰©å±•...
}

public class ResourceBucket
{
    public ResourceType Type { get; init; }
    public double Current { get; private set; }
    public double Max { get; init; }
    public OverflowPolicy OverflowPolicy { get; init; }
    
    // æº¢å‡ºè½¬æ¢é…ç½®
    public double ConvertUnit { get; init; }  // æ¯ N ç‚¹è½¬æ¢ 1 æ¬¡
    public string? ConversionTag { get; init; }  // è½¬æ¢ç›®æ ‡ï¼ˆBuff ID ç­‰ï¼‰
    
    // æº¢å‡ºè®¡æ•°å™¨
    public int ConversionCount { get; private set; }
    
    public void Add(double amount, out int conversions)
    {
        conversions = 0;
        Current += amount;
        
        if (Current > Max)
        {
            var overflow = Current - Max;
            
            switch (OverflowPolicy)
            {
                case OverflowPolicy.Clamp:
                    Current = Max;
                    break;
                    
                case OverflowPolicy.Convert:
                    if (ConvertUnit > 0 && ConversionTag != null)
                    {
                        conversions = (int)(overflow / ConvertUnit);
                        ConversionCount += conversions;
                        Current = Max;  // æº¢å‡ºéƒ¨åˆ†è½¬æ¢åå½’é›¶
                    }
                    break;
                    
                case OverflowPolicy.Ignore:
                    // å…è®¸è¶…å‡º
                    break;
            }
        }
    }
}
```

**èŒä¸šé›†æˆç¤ºä¾‹ - æˆ˜å£«**:

```csharp
// Domain/Combat/Professions/WarriorProfession.cs
public class WarriorProfession : IProfessionModule
{
    public void InitializeResources(BattleContext context)
    {
        // æ€’æ°”èµ„æº
        var rage = new ResourceBucket
        {
            Type = ResourceType.Rage,
            Current = 0,
            Max = 100,
            OverflowPolicy = OverflowPolicy.Convert,
            ConvertUnit = 20,  // æ¯ 20 æ€’æ°”æº¢å‡º â†’ 1 å±‚æˆ˜æ„ Buff
            ConversionTag = "buff_battle_focus"
        };
        
        context.Resources.Add(ResourceType.Rage, rage);
    }
    
    public void OnAttackTick(BattleContext context, TrackState track)
    {
        // æ™®æ”»ç”Ÿæˆ 10 æ€’æ°”
        var rage = context.Resources[ResourceType.Rage];
        rage.Add(10, out int conversions);
        
        // å¦‚æœäº§ç”Ÿè½¬æ¢ï¼Œæ·»åŠ  Buff
        if (conversions > 0)
        {
            var buff = new BuffInstance
            {
                Id = "buff_battle_focus",
                Stacks = conversions,
                MaxStacks = 5,
                DurationSeconds = 10
            };
            context.Buffs.Add(buff);
        }
    }
}
```

#### 1.3 Buff æº¢å‡ºè½¬æ¢å®Œå–„

**å½“å‰é—®é¢˜**: Buff å±‚æ•°æº¢å‡ºå¤„ç†ä¸å®Œæ•´

**æ”¹é€ æ–¹æ¡ˆ**:

```csharp
// æ‰©å±•: Domain/Combat/Buffs/BuffInstance.cs
public class BuffInstance
{
    public string Id { get; init; }
    public int Stacks { get; set; }
    public int MaxStacks { get; init; }
    public double ExpireAt { get; set; }
    
    // æ–°å¢ï¼šå±‚æ•°æº¢å‡ºç­–ç•¥
    public BuffStackOverflowPolicy StackOverflowPolicy { get; init; }
    
    public void AddStacks(int count, out int overflow)
    {
        overflow = 0;
        Stacks += count;
        
        if (Stacks > MaxStacks)
        {
            overflow = Stacks - MaxStacks;
            
            switch (StackOverflowPolicy)
            {
                case BuffStackOverflowPolicy.Clamp:
                    Stacks = MaxStacks;
                    break;
                    
                case BuffStackOverflowPolicy.Refresh:
                    Stacks = MaxStacks;
                    // ExpireAt åˆ·æ–°åœ¨å¤–éƒ¨å¤„ç†
                    break;
                    
                case BuffStackOverflowPolicy.Trigger:
                    Stacks = 0;  // è§¦å‘æ•ˆæœåæ¸…é›¶
                    // è§¦å‘äº‹ä»¶ç”±å¤–éƒ¨å¤„ç†
                    break;
            }
        }
    }
}

public enum BuffStackOverflowPolicy
{
    Clamp,      // æˆªæ–­åˆ°ä¸Šé™
    Refresh,    // åˆ·æ–°æ—¶é•¿
    Trigger     // è§¦å‘ç‰¹æ®Šæ•ˆæœå¹¶æ¸…é›¶ï¼ˆå¦‚"è“„åŠ¿"è§¦å‘åçˆ†å‘ï¼‰
}
```

#### äº¤ä»˜ç‰©
- [ ] `EventScheduler.cs` æ–°æ–‡ä»¶
- [ ] `BattleRunner.cs` é‡æ„
- [ ] `ResourceBucket.cs` æ‰©å±•
- [ ] `WarriorProfession.cs` é›†æˆ
- [ ] `MageProfession.cs` é›†æˆï¼ˆå¯é€‰ï¼‰
- [ ] `BuffInstance.cs` æº¢å‡ºç­–ç•¥
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

#### éªŒæ”¶æ ‡å‡†
- [ ] EventScheduler å¯ç‹¬ç«‹è¿è¡Œ
- [ ] æˆ˜å£«æ€’æ°”æº¢å‡ºæ­£ç¡®è½¬æ¢ä¸ºæˆ˜æ„ Buff
- [ ] Buff å±‚æ•°æº¢å‡ºç­–ç•¥æ­£ç¡®å·¥ä½œ
- [ ] åŸæœ‰æˆ˜æ–—é€»è¾‘ä¸å—å½±å“

---

### Phase 2: æ´»åŠ¨è®¡åˆ’åŸºç¡€ï¼ˆ3 å‘¨ï¼‰

#### ç›®æ ‡
âœ… ActivityPlan æ•°æ®æ¨¡å‹
âœ… ActivitySlot å¤šæ§½è°ƒåº¦
âœ… é™åˆ¶ç±»å‹æ”¯æŒ

#### 2.1 æ•°æ®æ¨¡å‹è®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Domain/Activity/ActivityPlan.cs
public class ActivityPlan
{
    public Guid Id { get; init; }
    public Guid CharacterId { get; init; }
    public ActivityType Type { get; init; }
    public LimitSpec Limit { get; init; }
    public PlanState State { get; set; }
    public string PayloadJson { get; init; }
    
    // è¿›åº¦è·Ÿè¸ª
    public ActivityProgress Progress { get; set; }
    
    // æ—¶é—´æˆ³
    public DateTime CreatedAtUtc { get; init; }
    public DateTime? StartedAtUtc { get; set; }
    public DateTime? CompletedAtUtc { get; set; }
    
    // æ–¹æ³•
    public bool IsLimitReached();
    public void UpdateProgress(double simulatedSeconds, int completedCount);
    public void Complete();
    public void Cancel();
}

public enum ActivityType
{
    Combat,      // æˆ˜æ–—
    Gather,      // é‡‡é›†ï¼ˆæœªæ¥ï¼‰
    Craft,       // åˆ¶ä½œï¼ˆæœªæ¥ï¼‰
    Idle         // ç©ºé—²
}

public enum PlanState
{
    Pending,     // å¾…æ‰§è¡Œï¼ˆé˜Ÿåˆ—ä¸­ï¼‰
    Running,     // è¿è¡Œä¸­
    Completed,   // å·²å®Œæˆ
    Cancelled    // å·²å–æ¶ˆ
}

// é™åˆ¶è§„æ ¼
public abstract record LimitSpec;

public record DurationLimit(double DurationSeconds) : LimitSpec;
public record CountLimit(int TargetCount) : LimitSpec;
public record InfiniteLimit() : LimitSpec;

// è¿›åº¦
public class ActivityProgress
{
    public double SimulatedSeconds { get; set; }
    public int CompletedCount { get; set; }
}
```

#### 2.2 æ§½ä½ç³»ç»Ÿè®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Domain/Activity/ActivitySlot.cs
public class ActivitySlot
{
    public int SlotIndex { get; init; }
    public Guid CharacterId { get; init; }
    
    // å½“å‰è¿è¡Œçš„è®¡åˆ’
    public Guid? CurrentPlanId { get; set; }
    
    // é˜Ÿåˆ—ä¸­çš„è®¡åˆ’ï¼ˆæŒ‰é¡ºåºï¼‰
    public List<Guid> QueuedPlanIds { get; } = new();
    
    // æ–¹æ³•
    public bool IsIdle => CurrentPlanId == null;
    public bool HasQueue => QueuedPlanIds.Count > 0;
    
    public void StartPlan(Guid planId);
    public Guid? DequeueNext();
    public void EnqueuePlan(Guid planId);
    public void ClearCurrent();
}
```

#### 2.3 åè°ƒå™¨è®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Application/Activities/ActivityCoordinator.cs
public class ActivityCoordinator
{
    private readonly ConcurrentDictionary<Guid, ActivityPlan> _plans = new();
    private readonly ConcurrentDictionary<Guid, ActivitySlot[]> _characterSlots = new();
    private readonly ConcurrentDictionary<Guid, ActivityExecutionContext> _contexts = new();
    private readonly IEnumerable<IActivityExecutor> _executors;
    
    public ActivityCoordinator(IEnumerable<IActivityExecutor> executors)
    {
        _executors = executors;
    }
    
    // åˆ›å»ºè®¡åˆ’
    public async Task<Guid> CreatePlanAsync(
        Guid characterId, 
        int slotIndex, 
        ActivityType type, 
        LimitSpec limit, 
        string payloadJson);
    
    // æ¨è¿›æ´»åŠ¨ï¼ˆç”± HostedService è°ƒç”¨ï¼‰
    public async Task AdvanceAsync(CancellationToken ct);
    
    // å–æ¶ˆè®¡åˆ’
    public async Task CancelPlanAsync(Guid planId);
    
    // è·å–æ§½ä½çŠ¶æ€
    public ActivitySlot[] GetCharacterSlots(Guid characterId);
    
    // è·å–è®¡åˆ’è¯¦æƒ…
    public ActivityPlan? GetPlan(Guid planId);
}
```

#### 2.4 æ‰§è¡Œå™¨æ¥å£

```csharp
// æ–°æ–‡ä»¶: Application/Activities/IActivityExecutor.cs
public interface IActivityExecutor
{
    ActivityType SupportedType { get; }
    
    // å¯åŠ¨æ´»åŠ¨
    Task<ActivityExecutionContext> StartAsync(
        ActivityPlan plan, 
        CancellationToken ct = default);
    
    // æ¨è¿›æ´»åŠ¨
    Task AdvanceAsync(
        ActivityPlan plan, 
        ActivityExecutionContext context, 
        CancellationToken ct = default);
    
    // åœæ­¢æ´»åŠ¨
    Task StopAsync(
        ActivityPlan plan, 
        ActivityExecutionContext context, 
        CancellationToken ct = default);
    
    // æ£€æŸ¥æ˜¯å¦å®Œæˆ
    Task<bool> CheckCompletionAsync(
        ActivityPlan plan, 
        ActivityExecutionContext context, 
        CancellationToken ct = default);
}

// æ‰§è¡Œä¸Šä¸‹æ–‡
public class ActivityExecutionContext
{
    public Guid PlanId { get; init; }
    public Guid? UnderlyingExecutionId { get; set; }  // å¦‚æˆ˜æ–— ID
    public Dictionary<string, object> Data { get; } = new();
    public DateTime LastUpdatedAtUtc { get; set; }
}
```

#### 2.5 API ç«¯ç‚¹è®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Presentation/Controllers/ActivityController.cs
[ApiController]
[Route("api/activities")]
public class ActivityController : ControllerBase
{
    private readonly ActivityCoordinator _coordinator;
    
    // POST /api/activities/plans
    [HttpPost("plans")]
    public async Task<IActionResult> CreatePlan(
        [FromBody] CreateActivityPlanRequest request);
    
    // GET /api/activities/plans/{planId}
    [HttpGet("plans/{planId:guid}")]
    public IActionResult GetPlan(Guid planId);
    
    // GET /api/activities/characters/{characterId}/slots
    [HttpGet("characters/{characterId:guid}/slots")]
    public IActionResult GetCharacterSlots(Guid characterId);
    
    // POST /api/activities/plans/{planId}/cancel
    [HttpPost("plans/{planId:guid}/cancel")]
    public async Task<IActionResult> CancelPlan(Guid planId);
}
```

#### äº¤ä»˜ç‰©
- [ ] `ActivityPlan.cs` é¢†åŸŸæ¨¡å‹
- [ ] `ActivitySlot.cs` æ§½ä½æ¨¡å‹
- [ ] `ActivityCoordinator.cs` åè°ƒå™¨
- [ ] `IActivityExecutor.cs` æ‰§è¡Œå™¨æ¥å£
- [ ] `CombatActivityExecutor.cs` æˆ˜æ–—æ‰§è¡Œå™¨å®ç°
- [ ] `ActivityController.cs` API æ§åˆ¶å™¨
- [ ] `ActivityHostedService.cs` åå°æœåŠ¡
- [ ] æ•°æ®åº“è¿ç§»
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

#### éªŒæ”¶æ ‡å‡†
- [ ] å¯åˆ›å»ºæ´»åŠ¨è®¡åˆ’
- [ ] æ§½ä½æ­£ç¡®ç®¡ç†å½“å‰å’Œé˜Ÿåˆ—è®¡åˆ’
- [ ] è®¡åˆ’è‡ªåŠ¨æ¨è¿›
- [ ] è®¡åˆ’å®Œæˆåè‡ªåŠ¨å¯åŠ¨é˜Ÿåˆ—ä¸‹ä¸€ä¸ª
- [ ] å¯å–æ¶ˆè¿è¡Œä¸­æˆ–é˜Ÿåˆ—ä¸­çš„è®¡åˆ’

---

### Phase 3: æ´»åŠ¨è®¡åˆ’å®Œå–„ï¼ˆ2 å‘¨ï¼‰

#### ç›®æ ‡
âœ… å‰ç«¯é›†æˆå®Œå–„
âœ… è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
âœ… é”™è¯¯å¤„ç†ä¼˜åŒ–

#### 3.1 å‰ç«¯ç»„ä»¶æ”¹è¿›

**å½“å‰çŠ¶æ€**: å‰ç«¯å·²å®ç°åŸºç¡€ UIï¼ˆè§ `å‰ç«¯é›†æˆè¯´æ˜.md`ï¼‰

**æ”¹è¿›æ–¹å‘**:

1. **è¿›åº¦æ¡ä¼˜åŒ–**
   - å¹³æ»‘åŠ¨ç”»
   - é¢œè‰²ç¼–ç ï¼ˆç»¿è‰²=è¿è¡Œä¸­ï¼Œè“è‰²=å·²å®Œæˆï¼Œç°è‰²=å·²å–æ¶ˆï¼‰
   - ç™¾åˆ†æ¯”æ˜¾ç¤º

2. **é”™è¯¯æç¤º**
   - Toast é€šçŸ¥
   - è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - é‡è¯•æœºåˆ¶

3. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡å–æ¶ˆ
   - æ‰¹é‡åˆ›å»ºï¼ˆæ¨¡æ¿ï¼‰

#### 3.2 åç«¯ä¼˜åŒ–

1. **å¹‚ç­‰æ€§ä¿è¯**
   - åˆ›å»ºè®¡åˆ’å¹‚ç­‰ï¼ˆåŸºäº characterId + slotIndex + æ—¶é—´çª—å£ï¼‰
   - å–æ¶ˆè®¡åˆ’å¹‚ç­‰

2. **å¹¶å‘æ§åˆ¶**
   - ä¹è§‚é”æˆ–æ‚²è§‚é”ï¼ˆé˜²æ­¢åŒä¸€æ§½ä½å¹¶å‘åˆ›å»ºï¼‰

3. **ç›‘æ§åŸ‹ç‚¹**
   - è®¡åˆ’åˆ›å»º/å®Œæˆ/å–æ¶ˆæ¬¡æ•°
   - å¹³å‡æ‰§è¡Œæ—¶é•¿
   - é˜Ÿåˆ—æ·±åº¦

#### äº¤ä»˜ç‰©
- [ ] å‰ç«¯ UI ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å¹‚ç­‰æ€§å®ç°
- [ ] ç›‘æ§åŸ‹ç‚¹
- [ ] ç”¨æˆ·æ–‡æ¡£

---

### Phase 4: ç¦»çº¿å¿«è¿›å¼•æ“ï¼ˆ3 å‘¨ï¼‰

#### ç›®æ ‡
âœ… ç¦»çº¿æ—¶é—´è®¡ç®—
âœ… å¿«é€Ÿæ¨è¿›æˆ˜æ–—
âœ… Segment æ‰¹é‡ç”Ÿæˆ

#### 4.1 æ ¸å¿ƒè®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Application/Activities/OfflineFastForwardEngine.cs
public class OfflineFastForwardEngine
{
    private readonly IServiceScopeFactory _scopeFactory;
    private readonly ActivityCoordinator _coordinator;
    
    public async Task<OfflineResult> ProcessOfflinePeriodAsync(
        Guid characterId,
        DateTime lastOnlineUtc,
        DateTime nowUtc,
        CancellationToken ct = default)
    {
        // 1. è®¡ç®—ç¦»çº¿æ—¶é•¿ï¼ˆä¸Šé™ 12 å°æ—¶ï¼‰
        var offlineSeconds = Math.Min(
            (nowUtc - lastOnlineUtc).TotalSeconds,
            12 * 3600);
        
        // 2. åŠ è½½è§’è‰²çš„æ´»åŠ¨è®¡åˆ’
        await LoadCharacterPlansAsync(characterId, ct);
        
        // 3. è·å–æ§½ä½
        var slots = _coordinator.GetCharacterSlots(characterId);
        
        // 4. å¯¹æ¯ä¸ªæ§½ä½æ¨è¿›æ´»åŠ¨
        var results = new List<SlotOfflineResult>();
        
        foreach (var slot in slots)
        {
            if (slot.CurrentPlanId.HasValue)
            {
                var plan = _coordinator.GetPlan(slot.CurrentPlanId.Value);
                if (plan?.State == PlanState.Running)
                {
                    var result = await FastForwardPlanAsync(
                        plan, 
                        offlineSeconds, 
                        ct);
                    results.Add(result);
                }
            }
        }
        
        // 5. æ±‡æ€»ç»“æœ
        return AggregateResults(results);
    }
    
    private async Task<SlotOfflineResult> FastForwardPlanAsync(
        ActivityPlan plan, 
        double seconds, 
        CancellationToken ct)
    {
        // ä½¿ç”¨ EventScheduler å¿«é€Ÿæ¨è¿›
        // ç”Ÿæˆ CombatSegment è€Œéè¯¦ç»†äº‹ä»¶
        // ...
    }
}
```

#### 4.2 å¿«è¿›ç­–ç•¥

**å…³é”®åŸåˆ™**: ä½¿ç”¨ä¸åœ¨çº¿ç›¸åŒçš„æˆ˜æ–—å¼•æ“ï¼Œä½†ï¼š

1. **è·³è·ƒæ—¶é—´æ¨è¿›**
   - ä¸è®°å½•è¯¦ç»†äº‹ä»¶
   - ç›´æ¥ç”Ÿæˆ Segment èšåˆæ•°æ®

2. **åˆ†æ®µç»“ç®—**
   - æ¯ 5 åˆ†é’Ÿç”Ÿæˆä¸€ä¸ª Segment
   - é˜²æ­¢å•æ¬¡æ¨è¿›æ—¶é—´è¿‡é•¿

3. **é™åˆ¶æ£€æŸ¥**
   - æ¯æ®µæ£€æŸ¥æ˜¯å¦è¾¾åˆ°é™åˆ¶
   - è¾¾åˆ°é™åˆ¶ç«‹å³åœæ­¢

#### 4.3 æ•°æ®ç»“æ„

```csharp
public class OfflineResult
{
    public double ProcessedSeconds { get; init; }
    public long TotalGold { get; init; }
    public long TotalExp { get; init; }
    public Dictionary<string, int> TotalItems { get; init; }
    public int CompletedPlans { get; init; }
    public List<SlotOfflineResult> SlotResults { get; init; }
}

public class SlotOfflineResult
{
    public int SlotIndex { get; init; }
    public Guid PlanId { get; init; }
    public double SimulatedSeconds { get; init; }
    public int CompletedCount { get; init; }
    public bool ReachedLimit { get; init; }
    public List<CombatSegment> Segments { get; init; }
}
```

#### 4.4 API ç«¯ç‚¹

```csharp
// POST /api/offline/process
[HttpPost("process")]
public async Task<IActionResult> ProcessOffline(
    [FromBody] ProcessOfflineRequest request)
{
    var result = await _offlineEngine.ProcessOfflinePeriodAsync(
        request.CharacterId,
        request.LastOnlineUtc,
        DateTime.UtcNow);
    
    return Ok(result);
}
```

#### 4.5 å‰ç«¯é›†æˆ

```razor
<!-- OfflineRewardPanel.razor -->
@if (offlineResult != null)
{
    <div class="offline-panel">
        <h3>ç¦»çº¿æ”¶ç›Š</h3>
        <p>ç¦»çº¿æ—¶é•¿: @FormatDuration(offlineResult.ProcessedSeconds)</p>
        <p>é‡‘å¸: +@offlineResult.TotalGold</p>
        <p>ç»éªŒ: +@offlineResult.TotalExp</p>
        <h4>ç‰©å“:</h4>
        <ul>
            @foreach (var item in offlineResult.TotalItems)
            {
                <li>@item.Key x @item.Value</li>
            }
        </ul>
        <button @onclick="ClaimRewards">é¢†å–</button>
    </div>
}
```

#### äº¤ä»˜ç‰©
- [ ] `OfflineFastForwardEngine.cs`
- [ ] `OfflineController.cs` API
- [ ] `OfflineRewardPanel.razor` å‰ç«¯
- [ ] æ•°æ®åº“è¿ç§»ï¼ˆå­˜å‚¨æœ€ååœ¨çº¿æ—¶é—´ï¼‰
- [ ] å•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ12å°æ—¶æ¨è¿› < 5ç§’ï¼‰

#### éªŒæ”¶æ ‡å‡†
- [ ] ç¦»çº¿ç™»å½•è‡ªåŠ¨ç»“ç®—
- [ ] ç¦»çº¿æ”¶ç›Šæ­£ç¡®è®¡ç®—
- [ ] 12 å°æ—¶æ¨è¿›åœ¨ 5 ç§’å†…å®Œæˆ
- [ ] å†…å­˜å ç”¨åˆç†ï¼ˆ< 100MBï¼‰

---

### Phase 5: åœ°å›¾/æ¡ä»¶ DSLï¼ˆ4 å‘¨ï¼‰

#### ç›®æ ‡
âœ… MapRegion æ•°æ®æ¨¡å‹
âœ… ConditionExpr è§£æå¼•æ“
âœ… åŒºåŸŸè§£é”é€»è¾‘

#### 5.1 MapRegion è®¾è®¡

```csharp
// æ–°æ–‡ä»¶: Domain/World/MapRegion.cs
public class MapRegion
{
    public string Id { get; init; }
    public string Name { get; init; }
    public (int min, int max) LevelRange { get; init; }
    
    // æ€ªç‰©æ± 
    public List<EnemyPoolEntry> MonsterPool { get; init; }
    
    // é‡‡é›†èŠ‚ç‚¹ï¼ˆæœªæ¥ï¼‰
    public List<GatheringNode> GatheringNodes { get; init; }
    
    // åœ°åŸï¼ˆæœªæ¥ï¼‰
    public List<string> DungeonIds { get; init; }
    
    // è§£é”æ¡ä»¶
    public string? UnlockConditionExpr { get; init; }
    
    // åŒºåŸŸç‰¹æ€§
    public Dictionary<string, double> Modifiers { get; init; }  // å¦‚ "gold_bonus": 1.2
}

public class EnemyPoolEntry
{
    public string EnemyId { get; init; }
    public double Weight { get; init; }
}
```

#### 5.2 ConditionExpr å¼•æ“

```csharp
// æ–°æ–‡ä»¶: Domain/Unlock/ConditionExpr.cs
public class ConditionExpr
{
    public string Id { get; init; }
    public string Raw { get; init; }  // "AND(level>=20, quest.completed('Q123'))"
    
    // è§£æåçš„ AST
    private IConditionNode? _ast;
    
    // ä¾èµ–é”®
    public List<string> Dependencies { get; private set; } = new();
    
    public bool Evaluate(ConditionContext ctx)
    {
        if (_ast == null)
        {
            _ast = ConditionParser.Parse(Raw);
            Dependencies = _ast.GetDependencies();
        }
        
        return _ast.Evaluate(ctx);
    }
}

// æ¡ä»¶ä¸Šä¸‹æ–‡
public class ConditionContext
{
    public int Level { get; init; }
    public Dictionary<string, int> Reputations { get; init; }
    public HashSet<string> CompletedQuests { get; init; }
    // æ›´å¤š...
}
```

**DSL è¯­æ³•ç¤ºä¾‹**:

```
AND(level>=20, reputation.factionA>=300)
OR(quest.completed('Q123'), achievement.earned('ACH_001'))
NOT(region.visited('darkforest'))
level>=10 AND level<=20
```

#### 5.3 è§£æå™¨å®ç°

```csharp
// æ–°æ–‡ä»¶: Domain/Unlock/ConditionParser.cs
public static class ConditionParser
{
    public static IConditionNode Parse(string expr)
    {
        // ç®€å•é€’å½’ä¸‹é™è§£æå™¨
        var tokens = Tokenize(expr);
        return ParseExpression(tokens);
    }
    
    private static List<Token> Tokenize(string expr)
    {
        // AND, OR, NOT, (,), >=, <=, ==, !=, æ•°å­—, å­—ç¬¦ä¸²
    }
    
    private static IConditionNode ParseExpression(List<Token> tokens)
    {
        // è§£æä¸º AST
    }
}

// AST èŠ‚ç‚¹æ¥å£
public interface IConditionNode
{
    bool Evaluate(ConditionContext ctx);
    List<string> GetDependencies();
}

// ç¤ºä¾‹èŠ‚ç‚¹
public class AndNode : IConditionNode
{
    public List<IConditionNode> Children { get; init; }
    
    public bool Evaluate(ConditionContext ctx)
    {
        return Children.All(c => c.Evaluate(ctx));
    }
    
    public List<string> GetDependencies()
    {
        return Children.SelectMany(c => c.GetDependencies()).Distinct().ToList();
    }
}

public class ComparisonNode : IConditionNode
{
    public string Key { get; init; }  // "level", "reputation.factionA"
    public ComparisonOperator Operator { get; init; }
    public object Value { get; init; }
    
    public bool Evaluate(ConditionContext ctx)
    {
        var actual = ctx.GetValue(Key);
        return Compare(actual, Value, Operator);
    }
    
    public List<string> GetDependencies() => new() { Key };
}
```

#### 5.4 ç¼“å­˜å±‚

```csharp
// æ–°æ–‡ä»¶: Application/Unlock/ConditionCache.cs
public class ConditionCache
{
    // è§£æç¼“å­˜ï¼ˆASTï¼‰
    private ConcurrentDictionary<string, ConditionExpr> _parseCache = new();
    
    // ç»“æœç¼“å­˜
    private ConcurrentDictionary<string, (bool result, DateTime cachedAt)> _resultCache = new();
    
    // ä¾èµ–ç´¢å¼•ï¼ˆåå‘ç´¢å¼•ï¼‰
    private Dictionary<string, HashSet<string>> _dependencyIndex = new();
    
    public bool Evaluate(string exprId, ConditionContext ctx)
    {
        // 1. æ£€æŸ¥ç»“æœç¼“å­˜
        if (_resultCache.TryGetValue(exprId, out var cached))
        {
            // å¯é€‰ï¼šæ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
            return cached.result;
        }
        
        // 2. è·å–æˆ–è§£æè¡¨è¾¾å¼
        var expr = _parseCache.GetOrAdd(exprId, id => new ConditionExpr { Raw = LoadRaw(id) });
        
        // 3. è¯„ä¼°
        var result = expr.Evaluate(ctx);
        
        // 4. ç¼“å­˜ç»“æœ
        _resultCache[exprId] = (result, DateTime.UtcNow);
        
        // 5. æ›´æ–°ä¾èµ–ç´¢å¼•
        foreach (var dep in expr.Dependencies)
        {
            if (!_dependencyIndex.ContainsKey(dep))
                _dependencyIndex[dep] = new HashSet<string>();
            _dependencyIndex[dep].Add(exprId);
        }
        
        return result;
    }
    
    // å¤±æ•ˆç‰¹å®šä¾èµ–é”®
    public void Invalidate(string dependencyKey)
    {
        if (_dependencyIndex.TryGetValue(dependencyKey, out var affectedExprs))
        {
            foreach (var exprId in affectedExprs)
            {
                _resultCache.TryRemove(exprId, out _);
            }
        }
    }
}
```

#### 5.5 åŒºåŸŸè§£é” API

```csharp
// GET /api/world/regions
[HttpGet("regions")]
public IActionResult GetRegions([FromQuery] Guid characterId)
{
    var character = _characters.GetAsync(characterId).Result;
    var ctx = BuildConditionContext(character);
    
    var regions = _regionRegistry.GetAll();
    var result = regions.Select(r => new
    {
        r.Id,
        r.Name,
        r.LevelRange,
        Unlocked = EvaluateUnlock(r, ctx)
    });
    
    return Ok(result);
}
```

#### äº¤ä»˜ç‰©
- [ ] `MapRegion.cs` æ•°æ®æ¨¡å‹
- [ ] `ConditionExpr.cs` æ¡ä»¶å¼•æ“
- [ ] `ConditionParser.cs` è§£æå™¨
- [ ] `ConditionCache.cs` ç¼“å­˜å±‚
- [ ] `RegionRegistry.cs` åŒºåŸŸæ³¨å†Œè¡¨
- [ ] `WorldController.cs` API
- [ ] å‰ç«¯åœ°å›¾ç•Œé¢
- [ ] å•å…ƒæµ‹è¯•ï¼ˆè§£æå™¨ + è¯„ä¼°å™¨ï¼‰

#### éªŒæ”¶æ ‡å‡†
- [ ] æ¡ä»¶è¡¨è¾¾å¼æ­£ç¡®è§£æ
- [ ] åŒºåŸŸè§£é”é€»è¾‘æ­£ç¡®
- [ ] å‰ç«¯åœ°å›¾å¯è§†åŒ–æ¸…æ™°
- [ ] ç¼“å­˜æœ‰æ•ˆæå‡æ€§èƒ½

---

### Phase 6: è£…å¤‡ç³»ç»Ÿï¼ˆ6 å‘¨ï¼‰

#### ç›®æ ‡
âœ… GearInstance åŠ¨æ€ç”Ÿæˆ
âœ… Affix è¯æ¡ç³»ç»Ÿ
âœ… Tier å‡çº§
âœ… åˆ†è§£ä¸é‡é“¸

#### è¯¦ç»†æ–¹æ¡ˆå‚è§ã€Šé¡¹ç›®è¿›åº¦ä¸è§„åˆ’.mdã€‹ç¬¬ 506-650 è¡Œ

**æ ¸å¿ƒäº¤ä»˜**:
1. GearDefinition / GearInstance
2. Affix ç”Ÿæˆå™¨
3. DisenchantService
4. ReforgeTierService
5. RerollService
6. SetBonus å¥—è£…

**æ—¶é—´åˆ†é…**:
- Week 1-3: GearInstance + åŸºç¡€ Affix
- Week 4-5: åˆ†è§£ä¸ææ–™
- Week 6: Tier å‡çº§ + Reroll

---

## 6. æŠ€æœ¯å€ºåŠ¡æ¸…ç†è®¡åˆ’

### 6.1 å‘½åç©ºé—´ç»Ÿä¸€ï¼ˆ1 å¤©ï¼‰

**é—®é¢˜**: `BlazorWebGame.*` ä¸ `BlazorIdle.Server.*` æ··ç”¨

**æ–¹æ¡ˆ**: å…¨å±€é‡å‘½åä¸º `BlazorIdle.Server.*`

**å·¥å…·**: Rider / Visual Studio çš„ "Rename Namespace"

### 6.2 æŒä¹…åŒ–å±‚è§£è€¦ï¼ˆ3-5 å¤©ï¼‰

**é—®é¢˜**: é¢†åŸŸæ¨¡å‹ä¸ EF å®ä½“æ··ç”¨

**æ–¹æ¡ˆ**: å¼•å…¥ Mapper å±‚

```csharp
// Domain
public class Character { /* çº¯é¢†åŸŸé€»è¾‘ */ }

// Infrastructure
public class CharacterEntity { /* EF å®ä½“ */ }

// Mapper
public static class CharacterMapper
{
    public static Character ToDomain(CharacterEntity entity);
    public static CharacterEntity ToEntity(Character domain);
}
```

### 6.3 RNG ç§å­èŒƒå›´è®°å½•ï¼ˆ1 å¤©ï¼‰

**é—®é¢˜**: CombatSegment æœªè®°å½• RNG ç§å­èŒƒå›´

**æ–¹æ¡ˆ**: æ·»åŠ å­—æ®µ

```csharp
public class CombatSegment
{
    // æ–°å¢
    public long RngSeedStart { get; set; }
    public long RngSeedEnd { get; set; }
}
```

---

## 7. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 7.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **EventScheduler é‡æ„ç ´åç°æœ‰æˆ˜æ–—** | ä¸­ | é«˜ | å®Œæ•´å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• |
| **ç¦»çº¿å¿«è¿›æ€§èƒ½ä¸è¾¾æ ‡** | ä¸­ | é«˜ | æ€§èƒ½åŸºå‡†æµ‹è¯• + ä¼˜åŒ– |
| **æ¡ä»¶ DSL è§£æå™¨ Bug** | ä¸­ | ä¸­ | å…¨é¢è¯­æ³•æµ‹è¯• |
| **è£…å¤‡ç³»ç»Ÿå¤æ‚åº¦è¶…é¢„æœŸ** | é«˜ | ä¸­ | åˆ†é˜¶æ®µäº¤ä»˜ï¼Œå…ˆç®€åŒ– |

### 7.2 è¿›åº¦é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **Phase 1 å»¶æœŸå½±å“åç»­** | ä¸­ | é«˜ | é¢„ç•™ç¼“å†²æ—¶é—´ |
| **å¼€å‘äººåŠ›ä¸è¶³** | ä¸­ | é«˜ | ä¼˜å…ˆçº§æ’åºï¼Œå‰Šå‡ P2 åŠŸèƒ½ |
| **æµ‹è¯•ä¸å……åˆ†å¯¼è‡´è¿”å·¥** | é«˜ | ä¸­ | æ¯ Phase å¿…é¡»é€šè¿‡éªŒæ”¶ |

### 7.3 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **ç©å®¶éœ€æ±‚å˜åŒ–** | ä½ | ä¸­ | å¿«é€Ÿè¿­ä»£ï¼Œçµæ´»è°ƒæ•´ |
| **ç«å“æŠ¢å…ˆ** | ä½ | ä½ | ä¸“æ³¨æ ¸å¿ƒç‰¹è‰² |

---

## 8. èµ„æºä¼°ç®—ä¸æ—¶é—´çº¿

### 8.1 å¼€å‘å·¥æ—¶ä¼°ç®—

| Phase | å·¥ä½œæ—¥ | äººå¤© | å¤‡æ³¨ |
|-------|--------|------|------|
| **Phase 0** | 5 | 5 | DI é—®é¢˜ä¿®å¤ |
| **Phase 1** | 10 | 10 | æˆ˜æ–—å¼•æ“é‡æ„ |
| **Phase 2** | 15 | 15 | æ´»åŠ¨è®¡åˆ’åŸºç¡€ |
| **Phase 3** | 10 | 10 | æ´»åŠ¨è®¡åˆ’å®Œå–„ |
| **Phase 4** | 15 | 15 | ç¦»çº¿å¿«è¿› |
| **Phase 5** | 20 | 20 | åœ°å›¾/æ¡ä»¶ DSL |
| **Phase 6** | 30 | 30 | è£…å¤‡ç³»ç»Ÿ |
| **æ€»è®¡** | 105 å¤© | 105 äººå¤© | çº¦ 5 ä¸ªæœˆ |

### 8.2 ç”˜ç‰¹å›¾ï¼ˆç®€åŒ–ï¼‰

```
2025 Q1          â”‚ Jan  â”‚ Feb  â”‚ Mar  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
Phase 0 (DI)    â”‚ â–ˆâ–ˆ   â”‚      â”‚      â”‚
Phase 1 (æˆ˜æ–—)  â”‚   â–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆ    â”‚      â”‚
Phase 2 (æ´»åŠ¨)  â”‚      â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆ    â”‚
Phase 3 (æ´»åŠ¨)  â”‚      â”‚      â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ”‚

2025 Q2          â”‚ Apr  â”‚ May  â”‚ Jun  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
Phase 4 (ç¦»çº¿)  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ â”‚â–ˆâ–ˆ    â”‚      â”‚
Phase 5 (åœ°å›¾)  â”‚      â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
Phase 6 (è£…å¤‡)  â”‚      â”‚      â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ”‚
```

### 8.3 é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | äº¤ä»˜ |
|--------|------|------|
| **M1: æœåŠ¡å™¨å¯è¿è¡Œ** | Week 1 | DI é—®é¢˜ä¿®å¤ |
| **M2: æˆ˜æ–—å¼•æ“é‡æ„** | Week 3 | EventScheduler + ResourceBucket |
| **M3: æ´»åŠ¨è®¡åˆ’å¯ç”¨** | Week 8 | å¤šæ§½è°ƒåº¦ + é˜Ÿåˆ— |
| **M4: ç¦»çº¿å¿«è¿›ä¸Šçº¿** | Week 11 | ç¦»çº¿æ”¶ç›Š |
| **M5: åœ°å›¾ç³»ç»Ÿä¸Šçº¿** | Week 15 | åŒºåŸŸè§£é” + æ¡ä»¶ DSL |
| **M6: è£…å¤‡ç³»ç»Ÿä¸Šçº¿** | Week 21 | Tier/Affix/åˆ†è§£/é‡é“¸ |

---

## 9. æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶

### 9.1 æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|-----|------|---------|
| **æœåŠ¡å™¨å¯åŠ¨æ—¶é—´** | < 5 ç§’ | æ‰‹åŠ¨æµ‹è¯• |
| **API å“åº”æ—¶é—´ï¼ˆP95ï¼‰** | < 200ms | æ€§èƒ½æµ‹è¯• |
| **ç¦»çº¿å¿«è¿›é€Ÿåº¦** | 12 å°æ—¶ < 5 ç§’ | æ€§èƒ½æµ‹è¯• |
| **å†…å­˜å ç”¨** | < 500MB | ç›‘æ§å·¥å…· |
| **å•å…ƒæµ‹è¯•è¦†ç›–ç‡** | > 80% | dotCover |

### 9.2 åŠŸèƒ½æŒ‡æ ‡

| åŠŸèƒ½ | éªŒæ”¶æ ‡å‡† |
|-----|---------|
| **æ´»åŠ¨è®¡åˆ’** | å¯åˆ›å»º/å–æ¶ˆ/é˜Ÿåˆ— 3 ä¸ªè®¡åˆ’ |
| **ç¦»çº¿å¿«è¿›** | ç¦»çº¿ 12 å°æ—¶æ­£ç¡®ç»“ç®— |
| **åœ°å›¾è§£é”** | 5 ä¸ªåŒºåŸŸæ­£ç¡®è§£é”é“¾ |
| **è£…å¤‡ç³»ç»Ÿ** | å¯ç”Ÿæˆ/åˆ†è§£/é‡é“¸è£…å¤‡ |

### 9.3 ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|-----|------|
| **é¦–æ¬¡ä¸Šæ‰‹æ—¶é—´** | < 5 åˆ†é’Ÿ |
| **æ“ä½œå“åº”æ„Ÿ** | æ— æ˜æ˜¾å¡é¡¿ |
| **é”™è¯¯æç¤º** | æ¸…æ™°æ˜“æ‡‚ |

---

## 10. æ€»ç»“ä¸å»ºè®®

### 10.1 å…³é”®æˆåŠŸå› ç´ 

1. âœ… **ä¼˜å…ˆä¿®å¤ DI é—®é¢˜**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. âœ… **åˆ†é˜¶æ®µäº¤ä»˜**ï¼ˆæ¯ Phase ç‹¬ç«‹å¯æµ‹è¯•ï¼‰
3. âœ… **ä¿æŒå‘åå…¼å®¹**ï¼ˆä¸ç ´åç°æœ‰åŠŸèƒ½ï¼‰
4. âœ… **å……åˆ†æµ‹è¯•**ï¼ˆå•å…ƒ + é›†æˆ + æ‰‹åŠ¨ï¼‰
5. âœ… **æ–‡æ¡£åŒæ­¥**ï¼ˆä»£ç ä¸æ–‡æ¡£ä¸€è‡´ï¼‰

### 10.2 å»ºè®®çš„å¼€å‘é¡ºåº

```
1. ä¿®å¤ DI é—®é¢˜ï¼ˆ1 å‘¨ï¼‰  â† ç«‹å³å¼€å§‹
   â†“
2. é‡æ„æˆ˜æ–—å¼•æ“ï¼ˆ2 å‘¨ï¼‰
   â†“
3. å®ç°æ´»åŠ¨è®¡åˆ’ï¼ˆ5 å‘¨ï¼‰
   â†“
4. å®ç°ç¦»çº¿å¿«è¿›ï¼ˆ3 å‘¨ï¼‰  â† æ ¸å¿ƒä½“éªŒ
   â†“
5. å®ç°åœ°å›¾åŒºåŸŸï¼ˆ4 å‘¨ï¼‰
   â†“
6. å®ç°è£…å¤‡ç³»ç»Ÿï¼ˆ6 å‘¨ï¼‰  â† é•¿æœŸç›®æ ‡
```

### 10.3 æœ€åçš„è¯

BlazorIdle é¡¹ç›®çš„æŠ€æœ¯åŸºåº§éå¸¸æ‰å®ï¼Œè®¾è®¡æ–‡æ¡£ä¹Ÿæå…¶å®Œå–„ã€‚å½“å‰çš„å…³é”®æ˜¯ï¼š

1. **å¿«é€Ÿä¿®å¤ DI é—®é¢˜**ï¼Œè®©æœåŠ¡å™¨å¯è¿è¡Œ
2. **å®Œæˆæ ¸å¿ƒç©æ³•ç³»ç»Ÿ**ï¼ˆæ´»åŠ¨ + ç¦»çº¿ + è£…å¤‡ï¼‰
3. **å»ºç«‹ç»æµé—­ç¯**ï¼Œè®©æ¸¸æˆæœ‰é•¿æœŸç›®æ ‡

å®Œæˆè¿™äº›åï¼Œæ¸¸æˆå°†ä»"æŠ€æœ¯ Demo"èœ•å˜ä¸º"å¯ç©çš„ Alpha ç‰ˆæœ¬"ã€‚

**å»ºè®®é‡‡ç”¨æ•æ·å¼€å‘**ï¼Œæ¯ 2-3 å‘¨å‘å¸ƒä¸€ä¸ªå¯ç©ç‰ˆæœ¬ï¼Œå¿«é€ŸéªŒè¯è®¾è®¡ã€‚

ç¥é¡¹ç›®æˆåŠŸï¼ğŸš€

---

**æ–‡æ¡£ç»´æŠ¤**:
- æ¯å®Œæˆä¸€ä¸ª Phase åæ›´æ–°è¿›åº¦
- å‘ç°æ–°é—®é¢˜æˆ–é£é™©åŠæ—¶è®°å½•
- å®šæœŸå›é¡¾ä¼˜å…ˆçº§
